<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Semantics of Simply Typed Lambda Calculus in Agda</title>
    <style>body {
    margin: 0;
    font-size: 12px;
    font-family: sans-serif;
    background-color: #ffffff;
    color: #000000;
}

.nav {
    position: fixed;
    width: 200px;
    height: 100%;
    background-color: #e0e0e0;
    overflow-y: auto;
}

a.nav-title {
    display: block;
    color: #002d6a;
    font-weight: bold;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 9px;
    padding-bottom: 3px;
    text-decoration: none;
}

a.nav-title:hover {
    color: #b61818;
}

.nav-part {
    display: block;
    color: #000000;
    font-weight: bold;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 9px;
    padding-bottom: 3px;
}

a.nav-item {
    display: block;
    color: #002d6a;
    text-decoration: none;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 3px;
    padding-bottom: 3px;
}

a.nav-item:hover {
    color: #b61818;
    background-color: #ccc;
}

a.nav-item.active {
    background-color: #f0c9a1;
}

a.nav-item.active:hover {
    color: #b61818;
    background-color: #e5b88b;
}

.content {
    margin-left: 200px;
    padding: 10px;
}

.Agda {
    margin: 0;
}

a.comment-link {
    color: inherit;
    background-color: #fefbbc;
}

@media (max-width: 500px) {
    .nav {
        display: none;
    }
    .content {
        margin-left: 0 !important;
    }
}
</style>
    <style>/* Aspects. */
.Agda .Comment       { color: #B22222 }
.Agda .Background    {}
.Agda .Markup        { color: #000000 }
.Agda .Keyword       { color: #CD6600 }
.Agda .String        { color: #B22222 }
.Agda .Number        { color: #A020F0 }
.Agda .Symbol        { color: #404040 }
.Agda .PrimitiveType { color: #0000CD }
.Agda .Pragma        { color: black   }
.Agda .Operator      {}

/* NameKinds. */
.Agda .Bound                  { color: black   }
.Agda .Generalizable          { color: black   }
.Agda .InductiveConstructor   { color: #008B00 }
.Agda .CoinductiveConstructor { color: #8B7500 }
.Agda .Datatype               { color: #0000CD }
.Agda .Field                  { color: #EE1289 }
.Agda .Function               { color: #0000CD }
.Agda .Module                 { color: #A020F0 }
.Agda .Postulate              { color: #0000CD }
.Agda .Primitive              { color: #0000CD }
.Agda .Record                 { color: #0000CD }

/* OtherAspects. */
.Agda .DottedPattern      {}
.Agda .UnsolvedMeta       { color: black; background: yellow         }
.Agda .UnsolvedConstraint { color: black; background: yellow         }
.Agda .TerminationProblem { color: black; background: #FFA07A        }
.Agda .IncompletePattern  { color: black; background: #F5DEB3        }
.Agda .Error              { color: red;   text-decoration: underline }
.Agda .TypeChecks         { color: black; background: #ADD8E6        }

/* Standard attributes. */
.Agda a { text-decoration: none }
.Agda a[href]:hover { background-color: #B4EEB4 }
</style>
  </head>
  <body>
    <div class="nav">
      <a class="nav-title" href="#Top">Semantics of&nbsp;Simply Typed Lambda Calculus in&nbsp;Agda</a>
      
        
          <div class="nav-part">I. Operational semantics</div>
        
      
        
          <a class="nav-item" href="#1:Library">1. Standard library definitions</a>
        
      
        
          <a class="nav-item" href="#2:Types">2. Types</a>
        
      
        
          <a class="nav-item" href="#3:Rules">3. Introduction and elimination rules</a>
        
      
        
          <a class="nav-item" href="#4:Utensils">4. Boilerplate utensils for introduction and elimination rules</a>
        
      
        
          <a class="nav-item" href="#5:Term">5. Terms</a>
        
      
        
          <a class="nav-item" href="#6:SomeTerms">6. Examples of terms</a>
        
      
        
          <a class="nav-item" href="#7:CompiledTerm">7. Compiled term representation</a>
        
      
        
          <a class="nav-item" href="#8:Compilation">8. Compilation</a>
        
      
        
          <a class="nav-item" href="#9:Runtime">9. Run-time term representation</a>
        
      
        
          <a class="nav-item" href="#10:OperationalElimination">10. Operational semantics for elimination rules</a>
        
      
        
          <a class="nav-item" href="#11:Operational">11. Operational semantics for the whole calculus</a>
        
      
        
          <div class="nav-part">II. Denotational semantics</div>
        
      
        
          <a class="nav-item" href="#12:Locality">12. Locality lemma</a>
        
      
        
          <a class="nav-item" href="#13:SomeValues">13. Examples of values</a>
        
      
        
          <a class="nav-item" href="#14:Trace">14. Definition of a computation trace</a>
        
      
        
          <a class="nav-item" href="#15:DenotationValue">15. Definition of denotation for values</a>
        
      
        
          <a class="nav-item" href="#16:DenotationRest">16. Definition of denotation for other objects</a>
        
      
        
          <a class="nav-item" href="#17:DenotationalIntroduction">17. Denotational semantics for introduction rules</a>
        
      
        
          <a class="nav-item" href="#18:DenotationalElimination">18. Denotational semantics for elimination rules</a>
        
      
        
          <a class="nav-item" href="#19:Denotational">19. Denotational semantics for the whole calculus</a>
        
      
        
          <a class="nav-item" href="#20:Interpreter">20. Interpreter</a>
        
      
      <div style="height: 50px"></div>
    </div>
    <div class="content" id="Top">
      
      
      <pre class="Agda"><span id="1" class="Keyword">module</span> <a id="8" href="" class="Module">STLC</a> <span id="13" class="Keyword">where</span>
<span id="19" class="Comment">-- ma look no imports</span>

<span id="42" class="Comment">{-

   Semantics of Simply Typed Lambda Calculus in Agda
   Zhenya Vinogradov · 6 July 2020

   We describe operational semantics for simply typed lambda calculus by defining a function
   which describes a single computation step (sections 1-11). Then we prove that operational
   semantics are terminating by providing denotational-style semantics, i.e. interpreting
   types of our calculus as corresponding meta-language types (sections 12-19). As the
   termination proof is constructive, it allows us to define an interpreter for the calculus,
   which computes resulting value for a term (section 20).

   This file has 20 sections (also listed in the navigation bar in the rendered version):

   Part I. Operational semantics
     <a class="comment-link" href="#1:Library">1. Standard library definitions</a>
     <a class="comment-link" href="#2:Types">2. Types</a>
     <a class="comment-link" href="#3:Rules">3. Introduction and elimination rules</a>
     <a class="comment-link" href="#4:Utensils">4. Boilerplate utensils for introduction and elimination rules</a>
     <a class="comment-link" href="#5:Term">5. Terms</a>
     <a class="comment-link" href="#6:SomeTerms">6. Examples of terms</a>
     <a class="comment-link" href="#7:CompiledTerm">7. Compiled term representation</a>
     <a class="comment-link" href="#8:Compilation">8. Compilation</a>
     <a class="comment-link" href="#9:Runtime">9. Run-time term representation</a>
     <a class="comment-link" href="#10:OperationalElimination">10. Operational semantics for elimination rules</a>
     <a class="comment-link" href="#11:Operational">11. Operational semantics for the whole calculus</a>
   Part II. Denotational semantics
     <a class="comment-link" href="#12:Locality">12. Locality lemma</a>
     <a class="comment-link" href="#13:SomeValues">13. Examples of values</a>
     <a class="comment-link" href="#14:Trace">14. Definition of a computation trace</a>
     <a class="comment-link" href="#15:DenotationValue">15. Definition of denotation for values</a>
     <a class="comment-link" href="#16:DenotationRest">16. Definition of denotation for other objects</a>
     <a class="comment-link" href="#17:DenotationalIntroducti">17. Denotational semantics for introduction rules</a>
     <a class="comment-link" href="#18:DenotationalElimination">18. Denotational semantics for elimination rules</a>
     <a class="comment-link" href="#19:Denotational">19. Denotational semantics for the whole calculus</a>
     <a class="comment-link" href="#20:Interpreter">20. Interpreter</a>

   This file is available in two versions:
   * rendered: <a class="comment-link" href="https://zhenyavinogradov.github.io/stlc/">https://zhenyavinogradov.github.io/stlc/</a>
   * raw code on github: <a class="comment-link" href="https://github.com/zhenyavinogradov/stlc/blob/barin/STLC.agda">https://github.com/zhenyavinogradov/stlc/blob/barin/STLC.agda</a>

-}</span>



<span id="2266" class="Keyword">module</span> <a id="1:Library"></a><a id="2273" href="#2273" class="Module">1:Library</a> <span id="2283" class="Keyword">where</span>
  <span id="2291" class="Comment">{-
     1. Standard library definitions
  -}</span>

  <span id="2339" class="Comment">-- Pair</span>
  <span id="2349" class="Keyword">infixr</span> <span id="2356" class="Number">15</span> <a id="2359" href="#2387" class="Record Operator">_×_</a>
  <span id="2365" class="Keyword">infixr</span> <span id="2372" class="Number">5</span> <a id="2374" href="#2431" class="InductiveConstructor Operator">_,_</a>
  <span id="2380" class="Keyword">record</span> <a id="1:Library._×_"></a><a id="2387" href="#2387" class="Record Operator">_×_</a> <span id="2391" class="Symbol">(</span><a id="2392" href="#2392" class="Bound">X</a> <a id="2394" href="#2394" class="Bound">Y</a> <span id="2396" class="Symbol">:</span> <span id="2398" class="PrimitiveType">Set</span><span id="2401" class="Symbol">)</span> <span id="2403" class="Symbol">:</span> <span id="2405" class="PrimitiveType">Set</span> <span id="2409" class="Keyword">where</span>
    <span id="2419" class="Keyword">constructor</span> <a id="1:Library._×_._,_"></a><a id="2431" href="#2431" class="InductiveConstructor Operator">_,_</a>
    <span id="2439" class="Keyword">field</span>
      <a id="1:Library._×_.fst"></a><a id="2451" href="#2451" class="Field">fst</a> <span id="2455" class="Symbol">:</span> <a id="2457" href="#2392" class="Bound">X</a>
      <a id="1:Library._×_.snd"></a><a id="2465" href="#2465" class="Field">snd</a> <span id="2469" class="Symbol">:</span> <a id="2471" href="#2394" class="Bound">Y</a>

  <span id="2476" class="Comment">-- Dependent sum</span>
  <span id="2495" class="Keyword">infixr</span> <span id="2502" class="Number">5</span> <a id="2504" href="#2572" class="InductiveConstructor Operator">_,,_</a>
  <span id="2511" class="Keyword">record</span> <a id="1:Library.Σ"></a><a id="2518" href="#2518" class="Record">Σ</a> <span id="2520" class="Symbol">(</span><a id="2521" href="#2521" class="Bound">Ω</a> <span id="2523" class="Symbol">:</span> <span id="2525" class="PrimitiveType">Set</span><span id="2528" class="Symbol">)</span> <span id="2530" class="Symbol">(</span><a id="2531" href="#2531" class="Bound">X</a> <span id="2533" class="Symbol">:</span> <a id="2535" href="#2521" class="Bound">Ω</a> <span id="2537" class="Symbol">→</span> <span id="2539" class="PrimitiveType">Set</span><span id="2542" class="Symbol">)</span> <span id="2544" class="Symbol">:</span> <span id="2546" class="PrimitiveType">Set</span> <span id="2550" class="Keyword">where</span>
    <span id="2560" class="Keyword">constructor</span> <a id="1:Library.Σ._,,_"></a><a id="2572" href="#2572" class="InductiveConstructor Operator">_,,_</a>
    <span id="2581" class="Keyword">field</span>
      <a id="1:Library.Σ.first"></a><a id="2593" href="#2593" class="Field">first</a>  <span id="2600" class="Symbol">:</span> <a id="2602" href="#2521" class="Bound">Ω</a>
      <a id="1:Library.Σ.second"></a><a id="2610" href="#2610" class="Field">second</a> <span id="2617" class="Symbol">:</span> <a id="2619" href="#2531" class="Bound">X</a> <a id="2621" href="#2593" class="Field">first</a>

  <span id="2630" class="Comment">-- Equality</span>
  <span id="2644" class="Keyword">data</span> <a id="1:Library.Eq"></a><a id="2649" href="#2649" class="Datatype">Eq</a> <span id="2652" class="Symbol">{</span><a id="2653" href="#2653" class="Bound">X</a> <span id="2655" class="Symbol">:</span> <span id="2657" class="PrimitiveType">Set</span><span id="2660" class="Symbol">}</span> <span id="2662" class="Symbol">(</span><a id="2663" href="#2663" class="Bound">x</a> <span id="2665" class="Symbol">:</span> <a id="2667" href="#2653" class="Bound">X</a><span id="2668" class="Symbol">)</span> <span id="2670" class="Symbol">:</span> <a id="2672" href="#2653" class="Bound">X</a> <span id="2674" class="Symbol">→</span> <span id="2676" class="PrimitiveType">Set</span> <span id="2680" class="Keyword">where</span>
    <a id="1:Library.Eq.refl"></a><a id="2690" href="#2690" class="InductiveConstructor">refl</a> <span id="2695" class="Symbol">:</span> <a id="2697" href="#2649" class="Datatype">Eq</a> <a id="2700" href="#2663" class="Bound">x</a> <a id="2702" href="#2663" class="Bound">x</a>

  <span id="2707" class="Comment">-- Synonym for 'Eq'</span>
  <a id="1:Library._≡_"></a><a id="2729" href="#2729" class="Function Operator">_≡_</a> <span id="2733" class="Symbol">=</span> <a id="2735" href="#2649" class="Datatype">Eq</a>

  <span id="2741" class="Comment">-- List</span>
  <span id="2751" class="Keyword">infixr</span> <span id="2758" class="Number">5</span> <a id="2760" href="#2819" class="InductiveConstructor Operator">_∷_</a>
  <span id="2766" class="Keyword">data</span> <a id="1:Library.List"></a><a id="2771" href="#2771" class="Datatype">List</a> <span id="2776" class="Symbol">(</span><a id="2777" href="#2777" class="Bound">X</a> <span id="2779" class="Symbol">:</span> <span id="2781" class="PrimitiveType">Set</span><span id="2784" class="Symbol">)</span> <span id="2786" class="Symbol">:</span> <span id="2788" class="PrimitiveType">Set</span> <span id="2792" class="Keyword">where</span>
    <a id="1:Library.List.ε"></a><a id="2802" href="#2802" class="InductiveConstructor">ε</a>   <span id="2806" class="Symbol">:</span> <a id="2808" href="#2771" class="Datatype">List</a> <a id="2813" href="#2777" class="Bound">X</a>
    <a id="1:Library.List._∷_"></a><a id="2819" href="#2819" class="InductiveConstructor Operator">_∷_</a> <span id="2823" class="Symbol">:</span> <a id="2825" href="#2777" class="Bound">X</a> <span id="2827" class="Symbol">→</span> <a id="2829" href="#2771" class="Datatype">List</a> <a id="2834" href="#2777" class="Bound">X</a> <span id="2836" class="Symbol">→</span> <a id="2838" href="#2771" class="Datatype">List</a> <a id="2843" href="#2777" class="Bound">X</a>

  <span id="2848" class="Comment">-- Heterogeneous list</span>
  <span id="2872" class="Keyword">data</span> <a id="1:Library.All"></a><a id="2877" href="#2877" class="Datatype">All</a> <span id="2881" class="Symbol">{</span><a id="2882" href="#2882" class="Bound">Ω</a> <span id="2884" class="Symbol">:</span> <span id="2886" class="PrimitiveType">Set</span><span id="2889" class="Symbol">}</span> <span id="2891" class="Symbol">(</span><a id="2892" href="#2892" class="Bound">X</a> <span id="2894" class="Symbol">:</span> <a id="2896" href="#2882" class="Bound">Ω</a> <span id="2898" class="Symbol">→</span> <span id="2900" class="PrimitiveType">Set</span><span id="2903" class="Symbol">)</span> <span id="2905" class="Symbol">:</span> <a id="2907" href="#2771" class="Datatype">List</a> <a id="2912" href="#2882" class="Bound">Ω</a> <span id="2914" class="Symbol">→</span> <span id="2916" class="PrimitiveType">Set</span> <span id="2920" class="Keyword">where</span>
    <a id="1:Library.All.ε"></a><a id="2930" href="#2930" class="InductiveConstructor">ε</a>   <span id="2934" class="Symbol">:</span> <a id="2936" href="#2877" class="Datatype">All</a> <a id="2940" href="#2892" class="Bound">X</a> <a id="2942" href="#2802" class="InductiveConstructor">ε</a>
    <a id="1:Library.All._∷_"></a><a id="2948" href="#2948" class="InductiveConstructor Operator">_∷_</a> <span id="2952" class="Symbol">:</span> <span id="2954" class="Symbol">∀</span> <span id="2956" class="Symbol">{</span><a id="2957" href="#2957" class="Bound">ω</a> <a id="2959" href="#2959" class="Bound">ωs</a><span id="2961" class="Symbol">}</span> <span id="2963" class="Symbol">→</span> <a id="2965" href="#2892" class="Bound">X</a> <a id="2967" href="#2957" class="Bound">ω</a> <span id="2969" class="Symbol">→</span> <a id="2971" href="#2877" class="Datatype">All</a> <a id="2975" href="#2892" class="Bound">X</a> <a id="2977" href="#2959" class="Bound">ωs</a> <span id="2980" class="Symbol">→</span> <a id="2982" href="#2877" class="Datatype">All</a> <a id="2986" href="#2892" class="Bound">X</a> <span id="2988" class="Symbol">(</span><a id="2989" href="#2957" class="Bound">ω</a> <a id="2991" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="2993" href="#2959" class="Bound">ωs</a><span id="2995" class="Symbol">)</span>

  <span id="3000" class="Comment">-- Heterogeneous list for Set₁</span>
  <span id="3033" class="Keyword">data</span> <a id="1:Library.All₁"></a><a id="3038" href="#3038" class="Datatype">All₁</a> <span id="3043" class="Symbol">{</span><a id="3044" href="#3044" class="Bound">Ω</a> <span id="3046" class="Symbol">:</span> <span id="3048" class="PrimitiveType">Set</span><span id="3051" class="Symbol">}</span> <span id="3053" class="Symbol">(</span><a id="3054" href="#3054" class="Bound">X</a> <span id="3056" class="Symbol">:</span> <a id="3058" href="#3044" class="Bound">Ω</a> <span id="3060" class="Symbol">→</span> <span id="3062" class="PrimitiveType">Set₁</span><span id="3066" class="Symbol">)</span> <span id="3068" class="Symbol">:</span> <a id="3070" href="#2771" class="Datatype">List</a> <a id="3075" href="#3044" class="Bound">Ω</a> <span id="3077" class="Symbol">→</span> <span id="3079" class="PrimitiveType">Set₁</span> <span id="3084" class="Keyword">where</span>
    <a id="1:Library.All₁.ε"></a><a id="3094" href="#3094" class="InductiveConstructor">ε</a>   <span id="3098" class="Symbol">:</span> <a id="3100" href="#3038" class="Datatype">All₁</a> <a id="3105" href="#3054" class="Bound">X</a> <a id="3107" href="#2802" class="InductiveConstructor">ε</a>
    <a id="1:Library.All₁._∷_"></a><a id="3113" href="#3113" class="InductiveConstructor Operator">_∷_</a> <span id="3117" class="Symbol">:</span> <span id="3119" class="Symbol">∀</span> <span id="3121" class="Symbol">{</span><a id="3122" href="#3122" class="Bound">ω</a> <a id="3124" href="#3124" class="Bound">ωs</a><span id="3126" class="Symbol">}</span> <span id="3128" class="Symbol">→</span> <a id="3130" href="#3054" class="Bound">X</a> <a id="3132" href="#3122" class="Bound">ω</a> <span id="3134" class="Symbol">→</span> <a id="3136" href="#3038" class="Datatype">All₁</a> <a id="3141" href="#3054" class="Bound">X</a> <a id="3143" href="#3124" class="Bound">ωs</a> <span id="3146" class="Symbol">→</span> <a id="3148" href="#3038" class="Datatype">All₁</a> <a id="3153" href="#3054" class="Bound">X</a> <span id="3155" class="Symbol">(</span><a id="3156" href="#3122" class="Bound">ω</a> <a id="3158" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="3160" href="#3124" class="Bound">ωs</a><span id="3162" class="Symbol">)</span>

  <span id="3167" class="Comment">-- 'Any X ωs' states that 'X' holds for some element of 'ωs'</span>
  <span id="3230" class="Keyword">data</span> <a id="1:Library.Any"></a><a id="3235" href="#3235" class="Datatype">Any</a> <span id="3239" class="Symbol">{</span><a id="3240" href="#3240" class="Bound">Ω</a> <span id="3242" class="Symbol">:</span> <span id="3244" class="PrimitiveType">Set</span><span id="3247" class="Symbol">}</span> <span id="3249" class="Symbol">(</span><a id="3250" href="#3250" class="Bound">X</a> <span id="3252" class="Symbol">:</span> <a id="3254" href="#3240" class="Bound">Ω</a> <span id="3256" class="Symbol">→</span> <span id="3258" class="PrimitiveType">Set</span><span id="3261" class="Symbol">)</span> <span id="3263" class="Symbol">:</span> <a id="3265" href="#2771" class="Datatype">List</a> <a id="3270" href="#3240" class="Bound">Ω</a> <span id="3272" class="Symbol">→</span> <span id="3274" class="PrimitiveType">Set</span> <span id="3278" class="Keyword">where</span>
    <a id="1:Library.Any.here"></a><a id="3288" href="#3288" class="InductiveConstructor">here</a>  <span id="3294" class="Symbol">:</span> <span id="3296" class="Symbol">∀</span> <span id="3298" class="Symbol">{</span><a id="3299" href="#3299" class="Bound">ω</a> <a id="3301" href="#3301" class="Bound">ωs</a><span id="3303" class="Symbol">}</span> <span id="3305" class="Symbol">→</span> <a id="3307" href="#3250" class="Bound">X</a> <a id="3309" href="#3299" class="Bound">ω</a> <span id="3311" class="Symbol">→</span> <a id="3313" href="#3235" class="Datatype">Any</a> <a id="3317" href="#3250" class="Bound">X</a> <span id="3319" class="Symbol">(</span><a id="3320" href="#3299" class="Bound">ω</a> <a id="3322" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="3324" href="#3301" class="Bound">ωs</a><span id="3326" class="Symbol">)</span>
    <a id="1:Library.Any.there"></a><a id="3332" href="#3332" class="InductiveConstructor">there</a> <span id="3338" class="Symbol">:</span> <span id="3340" class="Symbol">∀</span> <span id="3342" class="Symbol">{</span><a id="3343" href="#3343" class="Bound">ω</a> <a id="3345" href="#3345" class="Bound">ωs</a><span id="3347" class="Symbol">}</span> <span id="3349" class="Symbol">→</span> <a id="3351" href="#3235" class="Datatype">Any</a> <a id="3355" href="#3250" class="Bound">X</a> <a id="3357" href="#3345" class="Bound">ωs</a> <span id="3360" class="Symbol">→</span> <a id="3362" href="#3235" class="Datatype">Any</a> <a id="3366" href="#3250" class="Bound">X</a> <span id="3368" class="Symbol">(</span><a id="3369" href="#3343" class="Bound">ω</a> <a id="3371" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="3373" href="#3345" class="Bound">ωs</a><span id="3375" class="Symbol">)</span>

  <span id="3380" class="Comment">-- 'Has ωs ω' points at a position of 'ω' in 'ωs'</span>
  <a id="1:Library.Has"></a><a id="3432" href="#3432" class="Function">Has</a> <span id="3436" class="Symbol">:</span> <span id="3438" class="Symbol">{</span><a id="3439" href="#3439" class="Bound">Ω</a> <span id="3441" class="Symbol">:</span> <span id="3443" class="PrimitiveType">Set</span><span id="3446" class="Symbol">}</span> <span id="3448" class="Symbol">→</span> <a id="3450" href="#2771" class="Datatype">List</a> <a id="3455" href="#3439" class="Bound">Ω</a> <span id="3457" class="Symbol">→</span> <a id="3459" href="#3439" class="Bound">Ω</a> <span id="3461" class="Symbol">→</span> <span id="3463" class="PrimitiveType">Set</span>
  <a id="3469" href="#3432" class="Function">Has</a> <a id="3473" href="#3473" class="Bound">ωs</a> <a id="3476" href="#3476" class="Bound">ω</a> <span id="3478" class="Symbol">=</span> <a id="3480" href="#3235" class="Datatype">Any</a> <span id="3484" class="Symbol">(</span><a id="3485" href="#2649" class="Datatype">Eq</a> <a id="3488" href="#3476" class="Bound">ω</a><span id="3489" class="Symbol">)</span> <a id="3491" href="#3473" class="Bound">ωs</a>

  <span id="3497" class="Comment">-- 'All× X Y (ω , ψ)' states that 'X' holds for 'ω' and 'Y' holds for 'ψ'</span>
  <span id="3573" class="Keyword">data</span> <a id="1:Library.All×"></a><a id="3578" href="#3578" class="Datatype">All×</a> <span id="3583" class="Symbol">{</span><a id="3584" href="#3584" class="Bound">Ω</a> <a id="3586" href="#3586" class="Bound">Ψ</a> <span id="3588" class="Symbol">:</span> <span id="3590" class="PrimitiveType">Set</span><span id="3593" class="Symbol">}</span> <span id="3595" class="Symbol">(</span><a id="3596" href="#3596" class="Bound">X</a> <span id="3598" class="Symbol">:</span> <a id="3600" href="#3584" class="Bound">Ω</a> <span id="3602" class="Symbol">→</span> <span id="3604" class="PrimitiveType">Set</span><span id="3607" class="Symbol">)</span> <span id="3609" class="Symbol">(</span><a id="3610" href="#3610" class="Bound">Y</a> <span id="3612" class="Symbol">:</span> <a id="3614" href="#3586" class="Bound">Ψ</a> <span id="3616" class="Symbol">→</span> <span id="3618" class="PrimitiveType">Set</span><span id="3621" class="Symbol">)</span> <span id="3623" class="Symbol">:</span> <a id="3625" href="#3584" class="Bound">Ω</a> <a id="3627" href="#2387" class="Record Operator">×</a> <a id="3629" href="#3586" class="Bound">Ψ</a> <span id="3631" class="Symbol">→</span> <span id="3633" class="PrimitiveType">Set</span> <span id="3637" class="Keyword">where</span>
    <a id="1:Library.All×._,_"></a><a id="3647" href="#3647" class="InductiveConstructor Operator">_,_</a> <span id="3651" class="Symbol">:</span> <span id="3653" class="Symbol">∀</span> <span id="3655" class="Symbol">{</span><a id="3656" href="#3656" class="Bound">ω</a> <a id="3658" href="#3658" class="Bound">ψ</a><span id="3659" class="Symbol">}</span> <span id="3661" class="Symbol">→</span> <a id="3663" href="#3596" class="Bound">X</a> <a id="3665" href="#3656" class="Bound">ω</a> <span id="3667" class="Symbol">→</span> <a id="3669" href="#3610" class="Bound">Y</a> <a id="3671" href="#3658" class="Bound">ψ</a> <span id="3673" class="Symbol">→</span> <a id="3675" href="#3578" class="Datatype">All×</a> <a id="3680" href="#3596" class="Bound">X</a> <a id="3682" href="#3610" class="Bound">Y</a> <span id="3684" class="Symbol">(</span><a id="3685" href="#3656" class="Bound">ω</a> <a id="3687" href="#2431" class="InductiveConstructor Operator">,</a> <a id="3689" href="#3658" class="Bound">ψ</a><span id="3690" class="Symbol">)</span>

  <span id="3695" class="Comment">-- 'AllΣ P (ω ,, x)' states that 'P' holds for 'x'</span>
  <span id="3748" class="Keyword">data</span> <a id="1:Library.AllΣ"></a><a id="3753" href="#3753" class="Datatype">AllΣ</a> <span id="3758" class="Symbol">{</span><a id="3759" href="#3759" class="Bound">Ω</a> <span id="3761" class="Symbol">:</span> <span id="3763" class="PrimitiveType">Set</span><span id="3766" class="Symbol">}</span> <span id="3768" class="Symbol">{</span><a id="3769" href="#3769" class="Bound">X</a> <span id="3771" class="Symbol">:</span> <a id="3773" href="#3759" class="Bound">Ω</a> <span id="3775" class="Symbol">→</span> <span id="3777" class="PrimitiveType">Set</span><span id="3780" class="Symbol">}</span> <span id="3782" class="Symbol">(</span><a id="3783" href="#3783" class="Bound">P</a> <span id="3785" class="Symbol">:</span> <span id="3787" class="Symbol">∀</span> <a id="3789" href="#3789" class="Bound">ω</a> <span id="3791" class="Symbol">→</span> <a id="3793" href="#3769" class="Bound">X</a> <a id="3795" href="#3789" class="Bound">ω</a> <span id="3797" class="Symbol">→</span> <span id="3799" class="PrimitiveType">Set</span><span id="3802" class="Symbol">)</span> <span id="3804" class="Symbol">:</span> <a id="3806" href="#2518" class="Record">Σ</a> <a id="3808" href="#3759" class="Bound">Ω</a> <a id="3810" href="#3769" class="Bound">X</a> <span id="3812" class="Symbol">→</span> <span id="3814" class="PrimitiveType">Set</span> <span id="3818" class="Keyword">where</span>
    <a id="1:Library.AllΣ._,,_"></a><a id="3828" href="#3828" class="InductiveConstructor Operator">_,,_</a> <span id="3833" class="Symbol">:</span> <span id="3835" class="Symbol">(</span><a id="3836" href="#3836" class="Bound">ω</a> <span id="3838" class="Symbol">:</span> <a id="3840" href="#3759" class="Bound">Ω</a><span id="3841" class="Symbol">)</span> <span id="3843" class="Symbol">→</span> <span id="3845" class="Symbol">{</span><a id="3846" href="#3846" class="Bound">x</a> <span id="3848" class="Symbol">:</span> <a id="3850" href="#3769" class="Bound">X</a> <a id="3852" href="#3836" class="Bound">ω</a><span id="3853" class="Symbol">}</span> <span id="3855" class="Symbol">→</span> <a id="3857" href="#3783" class="Bound">P</a> <a id="3859" href="#3836" class="Bound">ω</a> <a id="3861" href="#3846" class="Bound">x</a> <span id="3863" class="Symbol">→</span> <a id="3865" href="#3753" class="Datatype">AllΣ</a> <a id="3870" href="#3783" class="Bound">P</a> <span id="3872" class="Symbol">(</span><a id="3873" href="#3836" class="Bound">ω</a> <a id="3875" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="3878" href="#3846" class="Bound">x</a><span id="3879" class="Symbol">)</span>

  <span id="3884" class="Comment">-- 'All2 P ωs xs' states that 'P' holds for all elements of 'xs'</span>
  <span id="3951" class="Keyword">data</span> <a id="1:Library.All2"></a><a id="3956" href="#3956" class="Datatype">All2</a> <span id="3961" class="Symbol">{</span><a id="3962" href="#3962" class="Bound">Ω</a> <span id="3964" class="Symbol">:</span> <span id="3966" class="PrimitiveType">Set</span><span id="3969" class="Symbol">}</span> <span id="3971" class="Symbol">{</span><a id="3972" href="#3972" class="Bound">X</a> <span id="3974" class="Symbol">:</span> <a id="3976" href="#3962" class="Bound">Ω</a> <span id="3978" class="Symbol">→</span> <span id="3980" class="PrimitiveType">Set</span><span id="3983" class="Symbol">}</span> <span id="3985" class="Symbol">(</span><a id="3986" href="#3986" class="Bound">P</a> <span id="3988" class="Symbol">:</span> <span id="3990" class="Symbol">∀</span> <a id="3992" href="#3992" class="Bound">ω</a> <span id="3994" class="Symbol">→</span> <a id="3996" href="#3972" class="Bound">X</a> <a id="3998" href="#3992" class="Bound">ω</a> <span id="4000" class="Symbol">→</span> <span id="4002" class="PrimitiveType">Set</span><span id="4005" class="Symbol">)</span> <span id="4007" class="Symbol">:</span> <span id="4009" class="Symbol">∀</span> <a id="4011" href="#4011" class="Bound">ωs</a> <span id="4014" class="Symbol">→</span> <a id="4016" href="#2877" class="Datatype">All</a> <a id="4020" href="#3972" class="Bound">X</a> <a id="4022" href="#4011" class="Bound">ωs</a> <span id="4025" class="Symbol">→</span> <span id="4027" class="PrimitiveType">Set</span> <span id="4031" class="Keyword">where</span>
    <a id="1:Library.All2.ε"></a><a id="4041" href="#4041" class="InductiveConstructor">ε</a>   <span id="4045" class="Symbol">:</span> <a id="4047" href="#3956" class="Datatype">All2</a> <a id="4052" href="#3986" class="Bound">P</a> <a id="4054" href="#2802" class="InductiveConstructor">ε</a> <a id="4056" href="#2930" class="InductiveConstructor">ε</a>
    <a id="1:Library.All2._∷_"></a><a id="4062" href="#4062" class="InductiveConstructor Operator">_∷_</a> <span id="4066" class="Symbol">:</span> <span id="4068" class="Symbol">∀</span> <span id="4070" class="Symbol">{</span><a id="4071" href="#4071" class="Bound">ω</a> <a id="4073" href="#4073" class="Bound">ωs</a> <a id="4076" href="#4076" class="Bound">x</a> <a id="4078" href="#4078" class="Bound">xs</a><span id="4080" class="Symbol">}</span> <span id="4082" class="Symbol">→</span> <a id="4084" href="#3986" class="Bound">P</a> <a id="4086" href="#4071" class="Bound">ω</a> <a id="4088" href="#4076" class="Bound">x</a> <span id="4090" class="Symbol">→</span> <a id="4092" href="#3956" class="Datatype">All2</a> <a id="4097" href="#3986" class="Bound">P</a> <a id="4099" href="#4073" class="Bound">ωs</a> <a id="4102" href="#4078" class="Bound">xs</a> <span id="4105" class="Symbol">→</span> <a id="4107" href="#3956" class="Datatype">All2</a> <a id="4112" href="#3986" class="Bound">P</a> <span id="4114" class="Symbol">(</span><a id="4115" href="#4071" class="Bound">ω</a> <a id="4117" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="4119" href="#4073" class="Bound">ωs</a><span id="4121" class="Symbol">)</span> <span id="4123" class="Symbol">(</span><a id="4124" href="#4076" class="Bound">x</a> <a id="4126" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="4128" href="#4078" class="Bound">xs</a><span id="4130" class="Symbol">)</span>

  <span id="4135" class="Comment">-- 'AllAny P ωs xᵢ' states that 'P' holds for the value which 'xᵢ' points to</span>
  <span id="4214" class="Keyword">data</span> <a id="1:Library.AllAny"></a><a id="4219" href="#4219" class="Datatype">AllAny</a> <span id="4226" class="Symbol">{</span><a id="4227" href="#4227" class="Bound">Ω</a> <span id="4229" class="Symbol">:</span> <span id="4231" class="PrimitiveType">Set</span><span id="4234" class="Symbol">}</span> <span id="4236" class="Symbol">{</span><a id="4237" href="#4237" class="Bound">X</a> <span id="4239" class="Symbol">:</span> <a id="4241" href="#4227" class="Bound">Ω</a> <span id="4243" class="Symbol">→</span> <span id="4245" class="PrimitiveType">Set</span><span id="4248" class="Symbol">}</span> <span id="4250" class="Symbol">(</span><a id="4251" href="#4251" class="Bound">P</a> <span id="4253" class="Symbol">:</span> <span id="4255" class="Symbol">∀</span> <a id="4257" href="#4257" class="Bound">ω</a> <span id="4259" class="Symbol">→</span> <a id="4261" href="#4237" class="Bound">X</a> <a id="4263" href="#4257" class="Bound">ω</a> <span id="4265" class="Symbol">→</span> <span id="4267" class="PrimitiveType">Set</span><span id="4270" class="Symbol">)</span> <span id="4272" class="Symbol">:</span> <span id="4274" class="Symbol">∀</span> <a id="4276" href="#4276" class="Bound">ωs</a> <span id="4279" class="Symbol">→</span> <a id="4281" href="#3235" class="Datatype">Any</a> <a id="4285" href="#4237" class="Bound">X</a> <a id="4287" href="#4276" class="Bound">ωs</a> <span id="4290" class="Symbol">→</span> <span id="4292" class="PrimitiveType">Set</span> <span id="4296" class="Keyword">where</span>
    <a id="1:Library.AllAny.here"></a><a id="4306" href="#4306" class="InductiveConstructor">here</a>  <span id="4312" class="Symbol">:</span> <span id="4314" class="Symbol">∀</span> <span id="4316" class="Symbol">{</span><a id="4317" href="#4317" class="Bound">ω</a> <a id="4319" href="#4319" class="Bound">ωs</a> <a id="4322" href="#4322" class="Bound">x</a><span id="4323" class="Symbol">}</span> <span id="4325" class="Symbol">→</span> <a id="4327" href="#4251" class="Bound">P</a> <a id="4329" href="#4317" class="Bound">ω</a> <a id="4331" href="#4322" class="Bound">x</a> <span id="4333" class="Symbol">→</span> <a id="4335" href="#4219" class="Datatype">AllAny</a> <a id="4342" href="#4251" class="Bound">P</a> <span id="4344" class="Symbol">(</span><a id="4345" href="#4317" class="Bound">ω</a> <a id="4347" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="4349" href="#4319" class="Bound">ωs</a><span id="4351" class="Symbol">)</span> <span id="4353" class="Symbol">(</span><a id="4354" href="#3288" class="InductiveConstructor">here</a> <a id="4359" href="#4322" class="Bound">x</a><span id="4360" class="Symbol">)</span>
    <a id="1:Library.AllAny.there"></a><a id="4366" href="#4366" class="InductiveConstructor">there</a> <span id="4372" class="Symbol">:</span> <span id="4374" class="Symbol">∀</span> <span id="4376" class="Symbol">{</span><a id="4377" href="#4377" class="Bound">ω</a> <a id="4379" href="#4379" class="Bound">ωs</a> <a id="4382" href="#4382" class="Bound">xᵢ</a><span id="4384" class="Symbol">}</span> <span id="4386" class="Symbol">→</span> <a id="4388" href="#4219" class="Datatype">AllAny</a> <a id="4395" href="#4251" class="Bound">P</a> <a id="4397" href="#4379" class="Bound">ωs</a> <a id="4400" href="#4382" class="Bound">xᵢ</a> <span id="4403" class="Symbol">→</span> <a id="4405" href="#4219" class="Datatype">AllAny</a> <a id="4412" href="#4251" class="Bound">P</a> <span id="4414" class="Symbol">(</span><a id="4415" href="#4377" class="Bound">ω</a> <a id="4417" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="4419" href="#4379" class="Bound">ωs</a><span id="4421" class="Symbol">)</span> <span id="4423" class="Symbol">(</span><a id="4424" href="#3332" class="InductiveConstructor">there</a> <a id="4430" href="#4382" class="Bound">xᵢ</a><span id="4432" class="Symbol">)</span>

  <span id="4437" class="Comment">-- Functorial map for List</span>
  <a id="1:Library.mapList"></a><a id="4466" href="#4466" class="Function">mapList</a> <span id="4474" class="Symbol">:</span> <span id="4476" class="Symbol">{</span><a id="4477" href="#4477" class="Bound">X</a> <a id="4479" href="#4479" class="Bound">Y</a> <span id="4481" class="Symbol">:</span> <span id="4483" class="PrimitiveType">Set</span><span id="4486" class="Symbol">}</span> <span id="4488" class="Symbol">→</span> <span id="4490" class="Symbol">(</span><a id="4491" href="#4477" class="Bound">X</a> <span id="4493" class="Symbol">→</span> <a id="4495" href="#4479" class="Bound">Y</a><span id="4496" class="Symbol">)</span> <span id="4498" class="Symbol">→</span> <span id="4500" class="Symbol">(</span><a id="4501" href="#2771" class="Datatype">List</a> <a id="4506" href="#4477" class="Bound">X</a> <span id="4508" class="Symbol">→</span> <a id="4510" href="#2771" class="Datatype">List</a> <a id="4515" href="#4479" class="Bound">Y</a><span id="4516" class="Symbol">)</span>
  <a id="4520" href="#4466" class="Function">mapList</a> <a id="4528" href="#4528" class="Bound">f</a>  <a id="4531" href="#2802" class="InductiveConstructor">ε</a>       <span id="4539" class="Symbol">=</span> <a id="4541" href="#2802" class="InductiveConstructor">ε</a>
  <a id="4545" href="#4466" class="Function">mapList</a> <a id="4553" href="#4553" class="Bound">f</a> <span id="4555" class="Symbol">(</span><a id="4556" href="#4556" class="Bound">x</a> <a id="4558" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="4560" href="#4560" class="Bound">xs</a><span id="4562" class="Symbol">)</span> <span id="4564" class="Symbol">=</span> <a id="4566" href="#4553" class="Bound">f</a> <a id="4568" href="#4556" class="Bound">x</a> <a id="4570" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="4572" href="#4466" class="Function">mapList</a> <a id="4580" href="#4553" class="Bound">f</a> <a id="4582" href="#4560" class="Bound">xs</a>

  <span id="4588" class="Comment">-- Functorial map for All</span>
  <a id="1:Library.mapAll"></a><a id="4616" href="#4616" class="Function">mapAll</a> <span id="4623" class="Symbol">:</span> <span id="4625" class="Symbol">{</span><a id="4626" href="#4626" class="Bound">Ω</a> <span id="4628" class="Symbol">:</span> <span id="4630" class="PrimitiveType">Set</span><span id="4633" class="Symbol">}</span> <span id="4635" class="Symbol">{</span><a id="4636" href="#4636" class="Bound">X</a> <a id="4638" href="#4638" class="Bound">Y</a> <span id="4640" class="Symbol">:</span> <a id="4642" href="#4626" class="Bound">Ω</a> <span id="4644" class="Symbol">→</span> <span id="4646" class="PrimitiveType">Set</span><span id="4649" class="Symbol">}</span> <span id="4651" class="Symbol">→</span> <span id="4653" class="Symbol">(∀</span> <span id="4656" class="Symbol">{</span><a id="4657" href="#4657" class="Bound">ω</a><span id="4658" class="Symbol">}</span> <span id="4660" class="Symbol">→</span> <a id="4662" href="#4636" class="Bound">X</a> <a id="4664" href="#4657" class="Bound">ω</a> <span id="4666" class="Symbol">→</span> <a id="4668" href="#4638" class="Bound">Y</a> <a id="4670" href="#4657" class="Bound">ω</a><span id="4671" class="Symbol">)</span> <span id="4673" class="Symbol">→</span> <span id="4675" class="Symbol">(∀</span> <span id="4678" class="Symbol">{</span><a id="4679" href="#4679" class="Bound">ωs</a><span id="4681" class="Symbol">}</span> <span id="4683" class="Symbol">→</span> <a id="4685" href="#2877" class="Datatype">All</a> <a id="4689" href="#4636" class="Bound">X</a> <a id="4691" href="#4679" class="Bound">ωs</a> <span id="4694" class="Symbol">→</span> <a id="4696" href="#2877" class="Datatype">All</a> <a id="4700" href="#4638" class="Bound">Y</a> <a id="4702" href="#4679" class="Bound">ωs</a><span id="4704" class="Symbol">)</span>
  <a id="4708" href="#4616" class="Function">mapAll</a> <a id="4715" href="#4715" class="Bound">f</a>  <a id="4718" href="#2930" class="InductiveConstructor">ε</a>       <span id="4726" class="Symbol">=</span> <a id="4728" href="#2930" class="InductiveConstructor">ε</a>
  <a id="4732" href="#4616" class="Function">mapAll</a> <a id="4739" href="#4739" class="Bound">f</a> <span id="4741" class="Symbol">(</span><a id="4742" href="#4742" class="Bound">x</a> <a id="4744" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="4746" href="#4746" class="Bound">xs</a><span id="4748" class="Symbol">)</span> <span id="4750" class="Symbol">=</span> <a id="4752" href="#4739" class="Bound">f</a> <a id="4754" href="#4742" class="Bound">x</a> <a id="4756" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="4758" href="#4616" class="Function">mapAll</a> <a id="4765" href="#4739" class="Bound">f</a> <a id="4767" href="#4746" class="Bound">xs</a>

  <span id="4773" class="Comment">-- Functorial map for Any</span>
  <a id="1:Library.mapAny"></a><a id="4801" href="#4801" class="Function">mapAny</a> <span id="4808" class="Symbol">:</span> <span id="4810" class="Symbol">{</span><a id="4811" href="#4811" class="Bound">Ω</a> <span id="4813" class="Symbol">:</span> <span id="4815" class="PrimitiveType">Set</span><span id="4818" class="Symbol">}</span> <span id="4820" class="Symbol">{</span><a id="4821" href="#4821" class="Bound">X</a> <a id="4823" href="#4823" class="Bound">Y</a> <span id="4825" class="Symbol">:</span> <a id="4827" href="#4811" class="Bound">Ω</a> <span id="4829" class="Symbol">→</span> <span id="4831" class="PrimitiveType">Set</span><span id="4834" class="Symbol">}</span> <span id="4836" class="Symbol">→</span> <span id="4838" class="Symbol">(∀</span> <span id="4841" class="Symbol">{</span><a id="4842" href="#4842" class="Bound">ω</a><span id="4843" class="Symbol">}</span> <span id="4845" class="Symbol">→</span> <a id="4847" href="#4821" class="Bound">X</a> <a id="4849" href="#4842" class="Bound">ω</a> <span id="4851" class="Symbol">→</span> <a id="4853" href="#4823" class="Bound">Y</a> <a id="4855" href="#4842" class="Bound">ω</a><span id="4856" class="Symbol">)</span> <span id="4858" class="Symbol">→</span> <span id="4860" class="Symbol">(∀</span> <span id="4863" class="Symbol">{</span><a id="4864" href="#4864" class="Bound">ωs</a><span id="4866" class="Symbol">}</span> <span id="4868" class="Symbol">→</span> <a id="4870" href="#3235" class="Datatype">Any</a> <a id="4874" href="#4821" class="Bound">X</a> <a id="4876" href="#4864" class="Bound">ωs</a> <span id="4879" class="Symbol">→</span> <a id="4881" href="#3235" class="Datatype">Any</a> <a id="4885" href="#4823" class="Bound">Y</a> <a id="4887" href="#4864" class="Bound">ωs</a><span id="4889" class="Symbol">)</span>
  <a id="4893" href="#4801" class="Function">mapAny</a> <a id="4900" href="#4900" class="Bound">f</a> <span id="4902" class="Symbol">(</span><a id="4903" href="#3288" class="InductiveConstructor">here</a> <a id="4908" href="#4908" class="Bound">x</a><span id="4909" class="Symbol">)</span>   <span id="4913" class="Symbol">=</span> <a id="4915" href="#3288" class="InductiveConstructor">here</a> <span id="4920" class="Symbol">(</span><a id="4921" href="#4900" class="Bound">f</a> <a id="4923" href="#4908" class="Bound">x</a><span id="4924" class="Symbol">)</span>
  <a id="4928" href="#4801" class="Function">mapAny</a> <a id="4935" href="#4935" class="Bound">f</a> <span id="4937" class="Symbol">(</span><a id="4938" href="#3332" class="InductiveConstructor">there</a> <a id="4944" href="#4944" class="Bound">xᵢ</a><span id="4946" class="Symbol">)</span> <span id="4948" class="Symbol">=</span> <a id="4950" href="#3332" class="InductiveConstructor">there</a> <span id="4956" class="Symbol">(</span><a id="4957" href="#4801" class="Function">mapAny</a> <a id="4964" href="#4935" class="Bound">f</a> <a id="4966" href="#4944" class="Bound">xᵢ</a><span id="4968" class="Symbol">)</span>

  <span id="4973" class="Comment">-- Functorial map for All2</span>
  <a id="1:Library.mapAll2"></a><a id="5002" href="#5002" class="Function">mapAll2</a>
      <span id="5016" class="Symbol">:</span> <span id="5018" class="Symbol">{</span><a id="5019" href="#5019" class="Bound">Ω</a> <span id="5021" class="Symbol">:</span> <span id="5023" class="PrimitiveType">Set</span><span id="5026" class="Symbol">}</span> <span id="5028" class="Symbol">{</span><a id="5029" href="#5029" class="Bound">X</a> <a id="5031" href="#5031" class="Bound">Y</a> <span id="5033" class="Symbol">:</span> <a id="5035" href="#5019" class="Bound">Ω</a> <span id="5037" class="Symbol">→</span> <span id="5039" class="PrimitiveType">Set</span><span id="5042" class="Symbol">}</span> <span id="5044" class="Symbol">{</span><a id="5045" href="#5045" class="Bound">AllX</a> <span id="5050" class="Symbol">:</span> <span id="5052" class="Symbol">∀</span> <a id="5054" href="#5054" class="Bound">ω</a> <span id="5056" class="Symbol">→</span> <a id="5058" href="#5029" class="Bound">X</a> <a id="5060" href="#5054" class="Bound">ω</a> <span id="5062" class="Symbol">→</span> <span id="5064" class="PrimitiveType">Set</span><span id="5067" class="Symbol">}</span> <span id="5069" class="Symbol">{</span><a id="5070" href="#5070" class="Bound">AllY</a> <span id="5075" class="Symbol">:</span> <span id="5077" class="Symbol">∀</span> <a id="5079" href="#5079" class="Bound">ω</a> <span id="5081" class="Symbol">→</span> <a id="5083" href="#5031" class="Bound">Y</a> <a id="5085" href="#5079" class="Bound">ω</a> <span id="5087" class="Symbol">→</span> <span id="5089" class="PrimitiveType">Set</span><span id="5092" class="Symbol">}</span>
      <span id="5100" class="Symbol">→</span> <span id="5102" class="Symbol">(</span><a id="5103" href="#5103" class="Bound">f</a> <span id="5105" class="Symbol">:</span> <span id="5107" class="Symbol">∀</span> <span id="5109" class="Symbol">{</span><a id="5110" href="#5110" class="Bound">ω</a><span id="5111" class="Symbol">}</span> <span id="5113" class="Symbol">→</span> <a id="5115" href="#5029" class="Bound">X</a> <a id="5117" href="#5110" class="Bound">ω</a> <span id="5119" class="Symbol">→</span> <a id="5121" href="#5031" class="Bound">Y</a> <a id="5123" href="#5110" class="Bound">ω</a><span id="5124" class="Symbol">)</span>
      <span id="5132" class="Symbol">→</span> <span id="5134" class="Symbol">(</span><a id="5135" href="#5135" class="Bound">allF</a> <span id="5140" class="Symbol">:</span> <span id="5142" class="Symbol">∀</span> <span id="5144" class="Symbol">{</span><a id="5145" href="#5145" class="Bound">ω</a> <a id="5147" href="#5147" class="Bound">x</a><span id="5148" class="Symbol">}</span> <span id="5150" class="Symbol">→</span> <a id="5152" href="#5045" class="Bound">AllX</a> <a id="5157" href="#5145" class="Bound">ω</a> <a id="5159" href="#5147" class="Bound">x</a> <span id="5161" class="Symbol">→</span> <a id="5163" href="#5070" class="Bound">AllY</a> <a id="5168" href="#5145" class="Bound">ω</a> <span id="5170" class="Symbol">(</span><a id="5171" href="#5103" class="Bound">f</a> <a id="5173" href="#5147" class="Bound">x</a><span id="5174" class="Symbol">))</span>
      <span id="5183" class="Symbol">→</span> <span id="5185" class="Symbol">∀</span> <span id="5187" class="Symbol">{</span><a id="5188" href="#5188" class="Bound">ωs</a> <a id="5191" href="#5191" class="Bound">xs</a><span id="5193" class="Symbol">}</span> <span id="5195" class="Symbol">→</span> <a id="5197" href="#3956" class="Datatype">All2</a> <a id="5202" href="#5045" class="Bound">AllX</a> <a id="5207" href="#5188" class="Bound">ωs</a> <a id="5210" href="#5191" class="Bound">xs</a> <span id="5213" class="Symbol">→</span> <a id="5215" href="#3956" class="Datatype">All2</a> <a id="5220" href="#5070" class="Bound">AllY</a> <a id="5225" href="#5188" class="Bound">ωs</a> <span id="5228" class="Symbol">(</span><a id="5229" href="#4616" class="Function">mapAll</a> <a id="5236" href="#5103" class="Bound">f</a> <a id="5238" href="#5191" class="Bound">xs</a><span id="5240" class="Symbol">)</span>
  <a id="5244" href="#5002" class="Function">mapAll2</a> <a id="5252" href="#5252" class="Bound">f</a> <a id="5254" href="#5254" class="Bound">allF</a>  <a id="5260" href="#4041" class="InductiveConstructor">ε</a>       <span id="5268" class="Symbol">=</span> <a id="5270" href="#4041" class="InductiveConstructor">ε</a>
  <a id="5274" href="#5002" class="Function">mapAll2</a> <a id="5282" href="#5282" class="Bound">f</a> <a id="5284" href="#5284" class="Bound">allF</a> <span id="5289" class="Symbol">(</span><a id="5290" href="#5290" class="Bound">p</a> <a id="5292" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="5294" href="#5294" class="Bound">ps</a><span id="5296" class="Symbol">)</span> <span id="5298" class="Symbol">=</span> <a id="5300" href="#5284" class="Bound">allF</a> <a id="5305" href="#5290" class="Bound">p</a> <a id="5307" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="5309" href="#5002" class="Function">mapAll2</a> <a id="5317" href="#5282" class="Bound">f</a> <a id="5319" href="#5284" class="Bound">allF</a> <a id="5324" href="#5294" class="Bound">ps</a>

  <span id="5330" class="Comment">-- Functorial map for AllAny</span>
  <a id="1:Library.mapAllAny"></a><a id="5361" href="#5361" class="Function">mapAllAny</a>
      <span id="5377" class="Symbol">:</span> <span id="5379" class="Symbol">{</span><a id="5380" href="#5380" class="Bound">Ω</a> <span id="5382" class="Symbol">:</span> <span id="5384" class="PrimitiveType">Set</span><span id="5387" class="Symbol">}</span> <span id="5389" class="Symbol">{</span><a id="5390" href="#5390" class="Bound">X</a> <a id="5392" href="#5392" class="Bound">Y</a> <span id="5394" class="Symbol">:</span> <a id="5396" href="#5380" class="Bound">Ω</a> <span id="5398" class="Symbol">→</span> <span id="5400" class="PrimitiveType">Set</span><span id="5403" class="Symbol">}</span> <span id="5405" class="Symbol">{</span><a id="5406" href="#5406" class="Bound">AllX</a> <span id="5411" class="Symbol">:</span> <span id="5413" class="Symbol">∀</span> <a id="5415" href="#5415" class="Bound">ω</a> <span id="5417" class="Symbol">→</span> <a id="5419" href="#5390" class="Bound">X</a> <a id="5421" href="#5415" class="Bound">ω</a> <span id="5423" class="Symbol">→</span> <span id="5425" class="PrimitiveType">Set</span><span id="5428" class="Symbol">}</span> <span id="5430" class="Symbol">{</span><a id="5431" href="#5431" class="Bound">AllY</a> <span id="5436" class="Symbol">:</span> <span id="5438" class="Symbol">∀</span> <a id="5440" href="#5440" class="Bound">ω</a> <span id="5442" class="Symbol">→</span> <a id="5444" href="#5392" class="Bound">Y</a> <a id="5446" href="#5440" class="Bound">ω</a> <span id="5448" class="Symbol">→</span> <span id="5450" class="PrimitiveType">Set</span><span id="5453" class="Symbol">}</span>
      <span id="5461" class="Symbol">→</span> <span id="5463" class="Symbol">(</span><a id="5464" href="#5464" class="Bound">f</a> <span id="5466" class="Symbol">:</span> <span id="5468" class="Symbol">∀</span> <span id="5470" class="Symbol">{</span><a id="5471" href="#5471" class="Bound">ω</a><span id="5472" class="Symbol">}</span> <span id="5474" class="Symbol">→</span> <a id="5476" href="#5390" class="Bound">X</a> <a id="5478" href="#5471" class="Bound">ω</a> <span id="5480" class="Symbol">→</span> <a id="5482" href="#5392" class="Bound">Y</a> <a id="5484" href="#5471" class="Bound">ω</a><span id="5485" class="Symbol">)</span>
      <span id="5493" class="Symbol">→</span> <span id="5495" class="Symbol">(</span><a id="5496" href="#5496" class="Bound">allF</a> <span id="5501" class="Symbol">:</span> <span id="5503" class="Symbol">∀</span> <span id="5505" class="Symbol">{</span><a id="5506" href="#5506" class="Bound">ω</a> <a id="5508" href="#5508" class="Bound">x</a><span id="5509" class="Symbol">}</span> <span id="5511" class="Symbol">→</span> <a id="5513" href="#5406" class="Bound">AllX</a> <a id="5518" href="#5506" class="Bound">ω</a> <a id="5520" href="#5508" class="Bound">x</a> <span id="5522" class="Symbol">→</span> <a id="5524" href="#5431" class="Bound">AllY</a> <a id="5529" href="#5506" class="Bound">ω</a> <span id="5531" class="Symbol">(</span><a id="5532" href="#5464" class="Bound">f</a> <a id="5534" href="#5508" class="Bound">x</a><span id="5535" class="Symbol">))</span>
      <span id="5544" class="Symbol">→</span> <span id="5546" class="Symbol">∀</span> <span id="5548" class="Symbol">{</span><a id="5549" href="#5549" class="Bound">ωs</a> <a id="5552" href="#5552" class="Bound">xs</a><span id="5554" class="Symbol">}</span> <span id="5556" class="Symbol">→</span> <a id="5558" href="#4219" class="Datatype">AllAny</a> <a id="5565" href="#5406" class="Bound">AllX</a> <a id="5570" href="#5549" class="Bound">ωs</a> <a id="5573" href="#5552" class="Bound">xs</a> <span id="5576" class="Symbol">→</span> <a id="5578" href="#4219" class="Datatype">AllAny</a> <a id="5585" href="#5431" class="Bound">AllY</a> <a id="5590" href="#5549" class="Bound">ωs</a> <span id="5593" class="Symbol">(</span><a id="5594" href="#4801" class="Function">mapAny</a> <a id="5601" href="#5464" class="Bound">f</a> <a id="5603" href="#5552" class="Bound">xs</a><span id="5605" class="Symbol">)</span>
  <a id="5609" href="#5361" class="Function">mapAllAny</a> <a id="5619" href="#5619" class="Bound">f</a> <a id="5621" href="#5621" class="Bound">allF</a> <span id="5626" class="Symbol">(</span><a id="5627" href="#4306" class="InductiveConstructor">here</a> <a id="5632" href="#5632" class="Bound">p</a><span id="5633" class="Symbol">)</span>   <span id="5637" class="Symbol">=</span> <a id="5639" href="#4306" class="InductiveConstructor">here</a> <span id="5644" class="Symbol">(</span><a id="5645" href="#5621" class="Bound">allF</a> <a id="5650" href="#5632" class="Bound">p</a><span id="5651" class="Symbol">)</span>
  <a id="5655" href="#5361" class="Function">mapAllAny</a> <a id="5665" href="#5665" class="Bound">f</a> <a id="5667" href="#5667" class="Bound">allF</a> <span id="5672" class="Symbol">(</span><a id="5673" href="#4366" class="InductiveConstructor">there</a> <a id="5679" href="#5679" class="Bound">pᵢ</a><span id="5681" class="Symbol">)</span> <span id="5683" class="Symbol">=</span> <a id="5685" href="#4366" class="InductiveConstructor">there</a> <span id="5691" class="Symbol">(</span><a id="5692" href="#5361" class="Function">mapAllAny</a> <a id="5702" href="#5665" class="Bound">f</a> <a id="5704" href="#5667" class="Bound">allF</a> <a id="5709" href="#5679" class="Bound">pᵢ</a><span id="5711" class="Symbol">)</span>

  <span id="5716" class="Comment">-- Identity function</span>
  <a id="1:Library.identity"></a><a id="5739" href="#5739" class="Function">identity</a> <span id="5748" class="Symbol">:</span> <span id="5750" class="Symbol">{</span><a id="5751" href="#5751" class="Bound">X</a> <span id="5753" class="Symbol">:</span> <span id="5755" class="PrimitiveType">Set</span><span id="5758" class="Symbol">}</span> <span id="5760" class="Symbol">→</span> <a id="5762" href="#5751" class="Bound">X</a> <span id="5764" class="Symbol">→</span> <a id="5766" href="#5751" class="Bound">X</a>
  <a id="5770" href="#5739" class="Function">identity</a> <a id="5779" href="#5779" class="Bound">x</a> <span id="5781" class="Symbol">=</span> <a id="5783" href="#5779" class="Bound">x</a>

  <span id="5788" class="Comment">-- Proves that function application preserves equality</span>
  <a id="1:Library.cong"></a><a id="5845" href="#5845" class="Function">cong</a> <span id="5850" class="Symbol">:</span> <span id="5852" class="Symbol">{</span><a id="5853" href="#5853" class="Bound">X</a> <a id="5855" href="#5855" class="Bound">Y</a> <span id="5857" class="Symbol">:</span> <span id="5859" class="PrimitiveType">Set</span><span id="5862" class="Symbol">}</span> <span id="5864" class="Symbol">→</span> <span id="5866" class="Symbol">(</span><a id="5867" href="#5867" class="Bound">f</a> <span id="5869" class="Symbol">:</span> <a id="5871" href="#5853" class="Bound">X</a> <span id="5873" class="Symbol">→</span> <a id="5875" href="#5855" class="Bound">Y</a><span id="5876" class="Symbol">)</span> <span id="5878" class="Symbol">→</span> <span id="5880" class="Symbol">∀</span> <span id="5882" class="Symbol">{</span><a id="5883" href="#5883" class="Bound">x</a> <a id="5885" href="#5885" class="Bound">x'</a><span id="5887" class="Symbol">}</span> <span id="5889" class="Symbol">→</span> <a id="5891" href="#5883" class="Bound">x</a> <a id="5893" href="#2729" class="Function Operator">≡</a> <a id="5895" href="#5885" class="Bound">x'</a> <span id="5898" class="Symbol">→</span> <a id="5900" href="#5867" class="Bound">f</a> <a id="5902" href="#5883" class="Bound">x</a> <a id="5904" href="#2729" class="Function Operator">≡</a> <a id="5906" href="#5867" class="Bound">f</a> <a id="5908" href="#5885" class="Bound">x'</a>
  <a id="5913" href="#5845" class="Function">cong</a> <a id="5918" href="#5918" class="Bound">f</a> <a id="5920" href="#2690" class="InductiveConstructor">refl</a> <span id="5925" class="Symbol">=</span> <a id="5927" href="#2690" class="InductiveConstructor">refl</a>

  <span id="5935" class="Comment">-- Proves that index of a predicate can be replaced with an equal one</span>
  <a id="1:Library.transport"></a><a id="6007" href="#6007" class="Function">transport</a> <span id="6017" class="Symbol">:</span> <span id="6019" class="Symbol">{</span><a id="6020" href="#6020" class="Bound">Ω</a> <span id="6022" class="Symbol">:</span> <span id="6024" class="PrimitiveType">Set</span><span id="6027" class="Symbol">}</span> <span id="6029" class="Symbol">→</span> <span id="6031" class="Symbol">(</span><a id="6032" href="#6032" class="Bound">X</a> <span id="6034" class="Symbol">:</span> <a id="6036" href="#6020" class="Bound">Ω</a> <span id="6038" class="Symbol">→</span> <span id="6040" class="PrimitiveType">Set</span><span id="6043" class="Symbol">)</span> <span id="6045" class="Symbol">→</span> <span id="6047" class="Symbol">∀</span> <span id="6049" class="Symbol">{</span><a id="6050" href="#6050" class="Bound">ω</a> <a id="6052" href="#6052" class="Bound">ω'</a><span id="6054" class="Symbol">}</span> <span id="6056" class="Symbol">→</span> <a id="6058" href="#6050" class="Bound">ω</a> <a id="6060" href="#2729" class="Function Operator">≡</a> <a id="6062" href="#6052" class="Bound">ω'</a> <span id="6065" class="Symbol">→</span> <a id="6067" href="#6032" class="Bound">X</a> <a id="6069" href="#6050" class="Bound">ω</a> <span id="6071" class="Symbol">→</span> <a id="6073" href="#6032" class="Bound">X</a> <a id="6075" href="#6052" class="Bound">ω'</a>
  <a id="6080" href="#6007" class="Function">transport</a> <a id="6090" href="#6090" class="Bound">X</a> <a id="6092" href="#2690" class="InductiveConstructor">refl</a> <a id="6097" href="#6097" class="Bound">x</a> <span id="6099" class="Symbol">=</span> <a id="6101" href="#6097" class="Bound">x</a>

  <span id="6106" class="Comment">-- Shorthands for 'Has' for several first elements</span>
  <a id="1:Library.$0"></a><a id="6159" href="#6159" class="Function">$0</a> <span id="6162" class="Symbol">:</span> <span id="6164" class="Symbol">∀</span> <span id="6166" class="Symbol">{</span><a id="6167" href="#6167" class="Bound">Ω</a> <a id="6169" href="#6169" class="Bound">ω₀</a> <a id="6172" href="#6172" class="Bound">ωs</a><span id="6174" class="Symbol">}</span>             <span id="6188" class="Symbol">→</span> <a id="6190" href="#3432" class="Function">Has</a> <span id="6194" class="Symbol">{</span><a id="6195" href="#6167" class="Bound">Ω</a><span id="6196" class="Symbol">}</span> <span id="6198" class="Symbol">(</span><a id="6199" href="#6169" class="Bound">ω₀</a> <a id="6202" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6204" href="#6172" class="Bound">ωs</a><span id="6206" class="Symbol">)</span> <a id="6208" href="#6169" class="Bound">ω₀</a>
  <a id="1:Library.$1"></a><a id="6213" href="#6213" class="Function">$1</a> <span id="6216" class="Symbol">:</span> <span id="6218" class="Symbol">∀</span> <span id="6220" class="Symbol">{</span><a id="6221" href="#6221" class="Bound">Ω</a> <a id="6223" href="#6223" class="Bound">ω₀</a> <a id="6226" href="#6226" class="Bound">ω₁</a> <a id="6229" href="#6229" class="Bound">ωs</a><span id="6231" class="Symbol">}</span>          <span id="6242" class="Symbol">→</span> <a id="6244" href="#3432" class="Function">Has</a> <span id="6248" class="Symbol">{</span><a id="6249" href="#6221" class="Bound">Ω</a><span id="6250" class="Symbol">}</span> <span id="6252" class="Symbol">(</span><a id="6253" href="#6223" class="Bound">ω₀</a> <a id="6256" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6258" href="#6226" class="Bound">ω₁</a> <a id="6261" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6263" href="#6229" class="Bound">ωs</a><span id="6265" class="Symbol">)</span> <a id="6267" href="#6226" class="Bound">ω₁</a>
  <a id="1:Library.$2"></a><a id="6272" href="#6272" class="Function">$2</a> <span id="6275" class="Symbol">:</span> <span id="6277" class="Symbol">∀</span> <span id="6279" class="Symbol">{</span><a id="6280" href="#6280" class="Bound">Ω</a> <a id="6282" href="#6282" class="Bound">ω₀</a> <a id="6285" href="#6285" class="Bound">ω₁</a> <a id="6288" href="#6288" class="Bound">ω₂</a> <a id="6291" href="#6291" class="Bound">ωs</a><span id="6293" class="Symbol">}</span>       <span id="6301" class="Symbol">→</span> <a id="6303" href="#3432" class="Function">Has</a> <span id="6307" class="Symbol">{</span><a id="6308" href="#6280" class="Bound">Ω</a><span id="6309" class="Symbol">}</span> <span id="6311" class="Symbol">(</span><a id="6312" href="#6282" class="Bound">ω₀</a> <a id="6315" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6317" href="#6285" class="Bound">ω₁</a> <a id="6320" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6322" href="#6288" class="Bound">ω₂</a> <a id="6325" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6327" href="#6291" class="Bound">ωs</a><span id="6329" class="Symbol">)</span> <a id="6331" href="#6288" class="Bound">ω₂</a>
  <a id="1:Library.$3"></a><a id="6336" href="#6336" class="Function">$3</a> <span id="6339" class="Symbol">:</span> <span id="6341" class="Symbol">∀</span> <span id="6343" class="Symbol">{</span><a id="6344" href="#6344" class="Bound">Ω</a> <a id="6346" href="#6346" class="Bound">ω₀</a> <a id="6349" href="#6349" class="Bound">ω₁</a> <a id="6352" href="#6352" class="Bound">ω₂</a> <a id="6355" href="#6355" class="Bound">ω₃</a> <a id="6358" href="#6358" class="Bound">ωs</a><span id="6360" class="Symbol">}</span>    <span id="6365" class="Symbol">→</span> <a id="6367" href="#3432" class="Function">Has</a> <span id="6371" class="Symbol">{</span><a id="6372" href="#6344" class="Bound">Ω</a><span id="6373" class="Symbol">}</span> <span id="6375" class="Symbol">(</span><a id="6376" href="#6346" class="Bound">ω₀</a> <a id="6379" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6381" href="#6349" class="Bound">ω₁</a> <a id="6384" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6386" href="#6352" class="Bound">ω₂</a> <a id="6389" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6391" href="#6355" class="Bound">ω₃</a> <a id="6394" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6396" href="#6358" class="Bound">ωs</a><span id="6398" class="Symbol">)</span> <a id="6400" href="#6355" class="Bound">ω₃</a>
  <a id="1:Library.$4"></a><a id="6405" href="#6405" class="Function">$4</a> <span id="6408" class="Symbol">:</span> <span id="6410" class="Symbol">∀</span> <span id="6412" class="Symbol">{</span><a id="6413" href="#6413" class="Bound">Ω</a> <a id="6415" href="#6415" class="Bound">ω₀</a> <a id="6418" href="#6418" class="Bound">ω₁</a> <a id="6421" href="#6421" class="Bound">ω₂</a> <a id="6424" href="#6424" class="Bound">ω₃</a> <a id="6427" href="#6427" class="Bound">ω₄</a> <a id="6430" href="#6430" class="Bound">ωs</a><span id="6432" class="Symbol">}</span> <span id="6434" class="Symbol">→</span> <a id="6436" href="#3432" class="Function">Has</a> <span id="6440" class="Symbol">{</span><a id="6441" href="#6413" class="Bound">Ω</a><span id="6442" class="Symbol">}</span> <span id="6444" class="Symbol">(</span><a id="6445" href="#6415" class="Bound">ω₀</a> <a id="6448" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6450" href="#6418" class="Bound">ω₁</a> <a id="6453" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6455" href="#6421" class="Bound">ω₂</a> <a id="6458" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6460" href="#6424" class="Bound">ω₃</a> <a id="6463" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6465" href="#6427" class="Bound">ω₄</a> <a id="6468" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="6470" href="#6430" class="Bound">ωs</a><span id="6472" class="Symbol">)</span> <a id="6474" href="#6427" class="Bound">ω₄</a>
  <a id="6479" href="#6159" class="Function">$0</a> <span id="6482" class="Symbol">=</span> <a id="6484" href="#3288" class="InductiveConstructor">here</a> <a id="6489" href="#2690" class="InductiveConstructor">refl</a>
  <a id="6496" href="#6213" class="Function">$1</a> <span id="6499" class="Symbol">=</span> <a id="6501" href="#3332" class="InductiveConstructor">there</a> <a id="6507" href="#6159" class="Function">$0</a>
  <a id="6512" href="#6272" class="Function">$2</a> <span id="6515" class="Symbol">=</span> <a id="6517" href="#3332" class="InductiveConstructor">there</a> <a id="6523" href="#6213" class="Function">$1</a>
  <a id="6528" href="#6336" class="Function">$3</a> <span id="6531" class="Symbol">=</span> <a id="6533" href="#3332" class="InductiveConstructor">there</a> <a id="6539" href="#6272" class="Function">$2</a>
  <a id="6544" href="#6405" class="Function">$4</a> <span id="6547" class="Symbol">=</span> <a id="6549" href="#3332" class="InductiveConstructor">there</a> <a id="6555" href="#6336" class="Function">$3</a>

  <span id="6561" class="Comment">-- Returns ith element of 'All'</span>
  <a id="1:Library.get"></a><a id="6595" href="#6595" class="Function">get</a> <span id="6599" class="Symbol">:</span> <span id="6601" class="Symbol">{</span><a id="6602" href="#6602" class="Bound">Ω</a> <span id="6604" class="Symbol">:</span> <span id="6606" class="PrimitiveType">Set</span><span id="6609" class="Symbol">}</span> <span id="6611" class="Symbol">{</span><a id="6612" href="#6612" class="Bound">X</a> <span id="6614" class="Symbol">:</span> <a id="6616" href="#6602" class="Bound">Ω</a> <span id="6618" class="Symbol">→</span> <span id="6620" class="PrimitiveType">Set</span><span id="6623" class="Symbol">}</span> <span id="6625" class="Symbol">→</span> <span id="6627" class="Symbol">∀</span> <span id="6629" class="Symbol">{</span><a id="6630" href="#6630" class="Bound">ω</a> <a id="6632" href="#6632" class="Bound">ωs</a><span id="6634" class="Symbol">}</span> <span id="6636" class="Symbol">→</span> <a id="6638" href="#2877" class="Datatype">All</a> <a id="6642" href="#6612" class="Bound">X</a> <a id="6644" href="#6632" class="Bound">ωs</a> <span id="6647" class="Symbol">→</span> <a id="6649" href="#3432" class="Function">Has</a> <a id="6653" href="#6632" class="Bound">ωs</a> <a id="6656" href="#6630" class="Bound">ω</a> <span id="6658" class="Symbol">→</span> <a id="6660" href="#6612" class="Bound">X</a> <a id="6662" href="#6630" class="Bound">ω</a>
  <a id="6666" href="#6595" class="Function">get</a> <span id="6670" class="Symbol">(</span><a id="6671" href="#6671" class="Bound">x</a> <a id="6673" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="6675" href="#6675" class="Bound">xs</a><span id="6677" class="Symbol">)</span> <span id="6679" class="Symbol">(</span><a id="6680" href="#3288" class="InductiveConstructor">here</a> <a id="6685" href="#2690" class="InductiveConstructor">refl</a><span id="6689" class="Symbol">)</span> <span id="6691" class="Symbol">=</span> <a id="6693" href="#6671" class="Bound">x</a>
  <a id="6697" href="#6595" class="Function">get</a> <span id="6701" class="Symbol">(</span><a id="6702" href="#6702" class="Bound">x</a> <a id="6704" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="6706" href="#6706" class="Bound">xs</a><span id="6708" class="Symbol">)</span> <span id="6710" class="Symbol">(</span><a id="6711" href="#3332" class="InductiveConstructor">there</a> <a id="6717" href="#6717" class="Bound">i</a><span id="6718" class="Symbol">)</span>   <span id="6722" class="Symbol">=</span> <a id="6724" href="#6595" class="Function">get</a> <a id="6728" href="#6706" class="Bound">xs</a> <a id="6731" href="#6717" class="Bound">i</a>

  <span id="6736" class="Comment">-- Returns ith element of 'All2'</span>
  <a id="1:Library.get2"></a><a id="6771" href="#6771" class="Function">get2</a> <span id="6776" class="Symbol">:</span> <span id="6778" class="Symbol">{</span><a id="6779" href="#6779" class="Bound">Ω</a> <span id="6781" class="Symbol">:</span> <span id="6783" class="PrimitiveType">Set</span><span id="6786" class="Symbol">}</span> <span id="6788" class="Symbol">{</span><a id="6789" href="#6789" class="Bound">X</a> <span id="6791" class="Symbol">:</span> <a id="6793" href="#6779" class="Bound">Ω</a> <span id="6795" class="Symbol">→</span> <span id="6797" class="PrimitiveType">Set</span><span id="6800" class="Symbol">}</span> <span id="6802" class="Symbol">{</span><a id="6803" href="#6803" class="Bound">P</a> <span id="6805" class="Symbol">:</span> <span id="6807" class="Symbol">∀</span> <a id="6809" href="#6809" class="Bound">ω</a> <span id="6811" class="Symbol">→</span> <a id="6813" href="#6789" class="Bound">X</a> <a id="6815" href="#6809" class="Bound">ω</a> <span id="6817" class="Symbol">→</span> <span id="6819" class="PrimitiveType">Set</span><span id="6822" class="Symbol">}</span> <span id="6824" class="Symbol">→</span> <span id="6826" class="Symbol">∀</span> <span id="6828" class="Symbol">{</span><a id="6829" href="#6829" class="Bound">ω</a> <a id="6831" href="#6831" class="Bound">ωs</a> <a id="6834" href="#6834" class="Bound">xs</a><span id="6836" class="Symbol">}</span> <span id="6838" class="Symbol">→</span> <a id="6840" href="#3956" class="Datatype">All2</a> <a id="6845" href="#6803" class="Bound">P</a> <a id="6847" href="#6831" class="Bound">ωs</a> <a id="6850" href="#6834" class="Bound">xs</a> <span id="6853" class="Symbol">→</span> <span id="6855" class="Symbol">(</span><a id="6856" href="#6856" class="Bound">i</a> <span id="6858" class="Symbol">:</span> <a id="6860" href="#3432" class="Function">Has</a> <a id="6864" href="#6831" class="Bound">ωs</a> <a id="6867" href="#6829" class="Bound">ω</a><span id="6868" class="Symbol">)</span> <span id="6870" class="Symbol">→</span> <a id="6872" href="#6803" class="Bound">P</a> <a id="6874" href="#6829" class="Bound">ω</a> <span id="6876" class="Symbol">(</span><a id="6877" href="#6595" class="Function">get</a> <a id="6881" href="#6834" class="Bound">xs</a> <a id="6884" href="#6856" class="Bound">i</a><span id="6885" class="Symbol">)</span>
  <a id="6889" href="#6771" class="Function">get2</a> <span id="6894" class="Symbol">(</span><a id="6895" href="#6895" class="Bound">p</a> <a id="6897" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="6899" href="#6899" class="Bound">ps</a><span id="6901" class="Symbol">)</span> <span id="6903" class="Symbol">(</span><a id="6904" href="#3288" class="InductiveConstructor">here</a> <a id="6909" href="#2690" class="InductiveConstructor">refl</a><span id="6913" class="Symbol">)</span> <span id="6915" class="Symbol">=</span> <a id="6917" href="#6895" class="Bound">p</a>
  <a id="6921" href="#6771" class="Function">get2</a> <span id="6926" class="Symbol">(</span><a id="6927" href="#6927" class="Bound">p</a> <a id="6929" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="6931" href="#6931" class="Bound">ps</a><span id="6933" class="Symbol">)</span> <span id="6935" class="Symbol">(</span><a id="6936" href="#3332" class="InductiveConstructor">there</a> <a id="6942" href="#6942" class="Bound">i</a><span id="6943" class="Symbol">)</span>   <span id="6947" class="Symbol">=</span> <a id="6949" href="#6771" class="Function">get2</a> <a id="6954" href="#6931" class="Bound">ps</a> <a id="6957" href="#6942" class="Bound">i</a>

  <span id="6962" class="Comment">-- List concatenation</span>
  <span id="6986" class="Keyword">infixr</span> <span id="6993" class="Number">5</span> <a id="6995" href="#7002" class="Function Operator">_++_</a>
  <a id="1:Library._++_"></a><a id="7002" href="#7002" class="Function Operator">_++_</a> <span id="7007" class="Symbol">:</span> <span id="7009" class="Symbol">{</span><a id="7010" href="#7010" class="Bound">X</a> <span id="7012" class="Symbol">:</span> <span id="7014" class="PrimitiveType">Set</span><span id="7017" class="Symbol">}</span> <span id="7019" class="Symbol">→</span> <a id="7021" href="#2771" class="Datatype">List</a> <a id="7026" href="#7010" class="Bound">X</a> <span id="7028" class="Symbol">→</span> <a id="7030" href="#2771" class="Datatype">List</a> <a id="7035" href="#7010" class="Bound">X</a> <span id="7037" class="Symbol">→</span> <a id="7039" href="#2771" class="Datatype">List</a> <a id="7044" href="#7010" class="Bound">X</a>
  <a id="7048" href="#2802" class="InductiveConstructor">ε</a>        <a id="7057" href="#7002" class="Function Operator">++</a> <a id="7060" href="#7060" class="Bound">ys</a> <span id="7063" class="Symbol">=</span> <a id="7065" href="#7060" class="Bound">ys</a>
  <span id="7070" class="Symbol">(</span><a id="7071" href="#7071" class="Bound">x</a> <a id="7073" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="7075" href="#7075" class="Bound">xs</a><span id="7077" class="Symbol">)</span> <a id="7079" href="#7002" class="Function Operator">++</a> <a id="7082" href="#7082" class="Bound">ys</a> <span id="7085" class="Symbol">=</span> <a id="7087" href="#7071" class="Bound">x</a> <a id="7089" href="#2819" class="InductiveConstructor Operator">∷</a> <span id="7091" class="Symbol">(</span><a id="7092" href="#7075" class="Bound">xs</a> <a id="7095" href="#7002" class="Function Operator">++</a> <a id="7098" href="#7082" class="Bound">ys</a><span id="7100" class="Symbol">)</span>


  <span id="7106" class="Comment">{-
     Some properties of 'Has'
  -}</span>

  <a id="1:Library.has-skip"></a><a id="7147" href="#7147" class="Function">has-skip</a> <span id="7156" class="Symbol">:</span> <span id="7158" class="Symbol">{</span><a id="7159" href="#7159" class="Bound">Ω</a> <span id="7161" class="Symbol">:</span> <span id="7163" class="PrimitiveType">Set</span><span id="7166" class="Symbol">}</span> <span id="7168" class="Symbol">→</span> <span id="7170" class="Symbol">{</span><a id="7171" href="#7171" class="Bound">τs</a> <span id="7174" class="Symbol">:</span> <a id="7176" href="#2771" class="Datatype">List</a> <a id="7181" href="#7159" class="Bound">Ω</a><span id="7182" class="Symbol">}</span> <span id="7184" class="Symbol">→</span> <span id="7186" class="Symbol">{</span><a id="7187" href="#7187" class="Bound">τ</a> <span id="7189" class="Symbol">:</span> <a id="7191" href="#7159" class="Bound">Ω</a><span id="7192" class="Symbol">}</span> <span id="7194" class="Symbol">→</span> <span id="7196" class="Symbol">(</span><a id="7197" href="#7197" class="Bound">ρs</a> <span id="7200" class="Symbol">:</span> <a id="7202" href="#2771" class="Datatype">List</a> <a id="7207" href="#7159" class="Bound">Ω</a><span id="7208" class="Symbol">)</span> <span id="7210" class="Symbol">→</span> <a id="7212" href="#3432" class="Function">Has</a> <a id="7216" href="#7171" class="Bound">τs</a> <a id="7219" href="#7187" class="Bound">τ</a> <span id="7221" class="Symbol">→</span> <a id="7223" href="#3432" class="Function">Has</a> <span id="7227" class="Symbol">(</span><a id="7228" href="#7197" class="Bound">ρs</a> <a id="7231" href="#7002" class="Function Operator">++</a> <a id="7234" href="#7171" class="Bound">τs</a><span id="7236" class="Symbol">)</span> <a id="7238" href="#7187" class="Bound">τ</a>
  <a id="7242" href="#7147" class="Function">has-skip</a>  <a id="7252" href="#2802" class="InductiveConstructor">ε</a>       <a id="7260" href="#7260" class="Bound">i</a> <span id="7262" class="Symbol">=</span> <a id="7264" href="#7260" class="Bound">i</a>
  <a id="7268" href="#7147" class="Function">has-skip</a> <span id="7277" class="Symbol">(</span><a id="7278" href="#7278" class="Bound">ρ</a> <a id="7280" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="7282" href="#7282" class="Bound">ρs</a><span id="7284" class="Symbol">)</span> <a id="7286" href="#7286" class="Bound">i</a> <span id="7288" class="Symbol">=</span> <a id="7290" href="#3332" class="InductiveConstructor">there</a> <span id="7296" class="Symbol">(</span><a id="7297" href="#7147" class="Function">has-skip</a> <a id="7306" href="#7282" class="Bound">ρs</a> <a id="7309" href="#7286" class="Bound">i</a><span id="7310" class="Symbol">)</span>

  <a id="1:Library.has-append"></a><a id="7315" href="#7315" class="Function">has-append</a> <span id="7326" class="Symbol">:</span> <span id="7328" class="Symbol">{</span><a id="7329" href="#7329" class="Bound">Ω</a> <span id="7331" class="Symbol">:</span> <span id="7333" class="PrimitiveType">Set</span><span id="7336" class="Symbol">}</span> <span id="7338" class="Symbol">→</span> <span id="7340" class="Symbol">{</span><a id="7341" href="#7341" class="Bound">τs</a> <span id="7344" class="Symbol">:</span> <a id="7346" href="#2771" class="Datatype">List</a> <a id="7351" href="#7329" class="Bound">Ω</a><span id="7352" class="Symbol">}</span> <span id="7354" class="Symbol">→</span> <span id="7356" class="Symbol">{</span><a id="7357" href="#7357" class="Bound">τ</a> <span id="7359" class="Symbol">:</span> <a id="7361" href="#7329" class="Bound">Ω</a><span id="7362" class="Symbol">}</span> <span id="7364" class="Symbol">→</span> <span id="7366" class="Symbol">(</span><a id="7367" href="#7367" class="Bound">ρs</a> <span id="7370" class="Symbol">:</span> <a id="7372" href="#2771" class="Datatype">List</a> <a id="7377" href="#7329" class="Bound">Ω</a><span id="7378" class="Symbol">)</span> <span id="7380" class="Symbol">→</span> <a id="7382" href="#3432" class="Function">Has</a> <a id="7386" href="#7341" class="Bound">τs</a> <a id="7389" href="#7357" class="Bound">τ</a> <span id="7391" class="Symbol">→</span> <a id="7393" href="#3432" class="Function">Has</a> <span id="7397" class="Symbol">(</span><a id="7398" href="#7341" class="Bound">τs</a> <a id="7401" href="#7002" class="Function Operator">++</a> <a id="7404" href="#7367" class="Bound">ρs</a><span id="7406" class="Symbol">)</span> <a id="7408" href="#7357" class="Bound">τ</a>
  <a id="7412" href="#7315" class="Function">has-append</a> <a id="7423" href="#7423" class="Bound">ρs</a> <span id="7426" class="Symbol">(</span><a id="7427" href="#3288" class="InductiveConstructor">here</a> <a id="7432" href="#7432" class="Bound">e</a><span id="7433" class="Symbol">)</span>  <span id="7436" class="Symbol">=</span> <a id="7438" href="#3288" class="InductiveConstructor">here</a> <a id="7443" href="#7432" class="Bound">e</a>
  <a id="7447" href="#7315" class="Function">has-append</a> <a id="7458" href="#7458" class="Bound">ρs</a> <span id="7461" class="Symbol">(</span><a id="7462" href="#3332" class="InductiveConstructor">there</a> <a id="7468" href="#7468" class="Bound">i</a><span id="7469" class="Symbol">)</span> <span id="7471" class="Symbol">=</span> <a id="7473" href="#3332" class="InductiveConstructor">there</a> <span id="7479" class="Symbol">(</span><a id="7480" href="#7315" class="Function">has-append</a> <a id="7491" href="#7458" class="Bound">ρs</a> <a id="7494" href="#7468" class="Bound">i</a><span id="7495" class="Symbol">)</span>

  <a id="1:Library.has-splice"></a><a id="7500" href="#7500" class="Function">has-splice</a> <span id="7511" class="Symbol">:</span> <span id="7513" class="Symbol">{</span><a id="7514" href="#7514" class="Bound">Ω</a> <span id="7516" class="Symbol">:</span> <span id="7518" class="PrimitiveType">Set</span><span id="7521" class="Symbol">}</span> <span id="7523" class="Symbol">→</span> <span id="7525" class="Symbol">{</span><a id="7526" href="#7526" class="Bound">τ</a> <span id="7528" class="Symbol">:</span> <a id="7530" href="#7514" class="Bound">Ω</a><span id="7531" class="Symbol">}</span> <span id="7533" class="Symbol">→</span> <span id="7535" class="Symbol">(</span><a id="7536" href="#7536" class="Bound">τs</a> <a id="7539" href="#7539" class="Bound">τs'</a> <a id="7543" href="#7543" class="Bound">ρs</a> <span id="7546" class="Symbol">:</span> <a id="7548" href="#2771" class="Datatype">List</a> <a id="7553" href="#7514" class="Bound">Ω</a><span id="7554" class="Symbol">)</span> <span id="7556" class="Symbol">→</span> <a id="7558" href="#3432" class="Function">Has</a> <span id="7562" class="Symbol">(</span><a id="7563" href="#7536" class="Bound">τs</a> <a id="7566" href="#7002" class="Function Operator">++</a> <a id="7569" href="#7539" class="Bound">τs'</a><span id="7572" class="Symbol">)</span> <a id="7574" href="#7526" class="Bound">τ</a> <span id="7576" class="Symbol">→</span> <a id="7578" href="#3432" class="Function">Has</a> <span id="7582" class="Symbol">(</span><a id="7583" href="#7536" class="Bound">τs</a> <a id="7586" href="#7002" class="Function Operator">++</a> <a id="7589" href="#7543" class="Bound">ρs</a> <a id="7592" href="#7002" class="Function Operator">++</a> <a id="7595" href="#7539" class="Bound">τs'</a><span id="7598" class="Symbol">)</span> <a id="7600" href="#7526" class="Bound">τ</a>
  <a id="7604" href="#7500" class="Function">has-splice</a>  <a id="7616" href="#2802" class="InductiveConstructor">ε</a>       <a id="7624" href="#7624" class="Bound">τs'</a> <a id="7628" href="#7628" class="Bound">ρs</a>  <a id="7632" href="#7632" class="Bound">i</a>        <span id="7641" class="Symbol">=</span> <a id="7643" href="#7147" class="Function">has-skip</a> <a id="7652" href="#7628" class="Bound">ρs</a> <a id="7655" href="#7632" class="Bound">i</a>
  <a id="7659" href="#7500" class="Function">has-splice</a> <span id="7670" class="Symbol">(</span><a id="7671" href="#7671" class="Bound">τ</a> <a id="7673" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="7675" href="#7675" class="Bound">τs</a><span id="7677" class="Symbol">)</span> <a id="7679" href="#7679" class="Bound">τs'</a> <a id="7683" href="#7683" class="Bound">ρs</a> <span id="7686" class="Symbol">(</span><a id="7687" href="#3288" class="InductiveConstructor">here</a> <a id="7692" href="#7692" class="Bound">e</a><span id="7693" class="Symbol">)</span>  <span id="7696" class="Symbol">=</span> <a id="7698" href="#3288" class="InductiveConstructor">here</a> <a id="7703" href="#7692" class="Bound">e</a>
  <a id="7707" href="#7500" class="Function">has-splice</a> <span id="7718" class="Symbol">(</span><a id="7719" href="#7719" class="Bound">τ</a> <a id="7721" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="7723" href="#7723" class="Bound">τs</a><span id="7725" class="Symbol">)</span> <a id="7727" href="#7727" class="Bound">τs'</a> <a id="7731" href="#7731" class="Bound">ρs</a> <span id="7734" class="Symbol">(</span><a id="7735" href="#3332" class="InductiveConstructor">there</a> <a id="7741" href="#7741" class="Bound">i</a><span id="7742" class="Symbol">)</span> <span id="7744" class="Symbol">=</span> <a id="7746" href="#3332" class="InductiveConstructor">there</a> <span id="7752" class="Symbol">(</span><a id="7753" href="#7500" class="Function">has-splice</a> <a id="7764" href="#7723" class="Bound">τs</a> <a id="7767" href="#7727" class="Bound">τs'</a> <a id="7771" href="#7731" class="Bound">ρs</a> <a id="7774" href="#7741" class="Bound">i</a><span id="7775" class="Symbol">)</span>

  <a id="1:Library.has-abs"></a><a id="7780" href="#7780" class="Function">has-abs</a> <span id="7788" class="Symbol">:</span> <span id="7790" class="Symbol">{</span><a id="7791" href="#7791" class="Bound">Ω</a> <span id="7793" class="Symbol">:</span> <span id="7795" class="PrimitiveType">Set</span><span id="7798" class="Symbol">}</span> <span id="7800" class="Symbol">→</span> <span id="7802" class="Symbol">{</span><a id="7803" href="#7803" class="Bound">τ</a> <span id="7805" class="Symbol">:</span> <a id="7807" href="#7791" class="Bound">Ω</a><span id="7808" class="Symbol">}</span> <span id="7810" class="Symbol">→</span> <span id="7812" class="Symbol">(</span><a id="7813" href="#7813" class="Bound">τ'</a> <span id="7816" class="Symbol">:</span> <a id="7818" href="#7791" class="Bound">Ω</a><span id="7819" class="Symbol">)</span> <span id="7821" class="Symbol">→</span> <span id="7823" class="Symbol">(</span><a id="7824" href="#7824" class="Bound">τs</a> <a id="7827" href="#7827" class="Bound">ρs</a> <span id="7830" class="Symbol">:</span> <a id="7832" href="#2771" class="Datatype">List</a> <a id="7837" href="#7791" class="Bound">Ω</a><span id="7838" class="Symbol">)</span> <span id="7840" class="Symbol">→</span> <a id="7842" href="#3432" class="Function">Has</a> <span id="7846" class="Symbol">(</span><a id="7847" href="#7813" class="Bound">τ'</a> <a id="7850" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="7852" href="#7824" class="Bound">τs</a><span id="7854" class="Symbol">)</span> <a id="7856" href="#7803" class="Bound">τ</a> <span id="7858" class="Symbol">→</span> <a id="7860" href="#3432" class="Function">Has</a> <span id="7864" class="Symbol">(</span><a id="7865" href="#7813" class="Bound">τ'</a> <a id="7868" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="7870" href="#7827" class="Bound">ρs</a> <a id="7873" href="#7002" class="Function Operator">++</a> <a id="7876" href="#7824" class="Bound">τs</a><span id="7878" class="Symbol">)</span> <a id="7880" href="#7803" class="Bound">τ</a>
  <a id="7884" href="#7780" class="Function">has-abs</a> <a id="7892" href="#7892" class="Bound">τ'</a> <a id="7895" href="#7895" class="Bound">τs</a> <a id="7898" href="#7898" class="Bound">ρs</a> <a id="7901" href="#7901" class="Bound">i</a> <span id="7903" class="Symbol">=</span> <a id="7905" href="#7500" class="Function">has-splice</a> <span id="7916" class="Symbol">(</span><a id="7917" href="#7892" class="Bound">τ'</a> <a id="7920" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="7922" href="#2802" class="InductiveConstructor">ε</a><span id="7923" class="Symbol">)</span> <a id="7925" href="#7895" class="Bound">τs</a> <a id="7928" href="#7898" class="Bound">ρs</a> <a id="7931" href="#7901" class="Bound">i</a>

  <a id="1:Library.has-cons"></a><a id="7936" href="#7936" class="Function">has-cons</a> <span id="7945" class="Symbol">:</span> <span id="7947" class="Symbol">{</span><a id="7948" href="#7948" class="Bound">Ω</a> <span id="7950" class="Symbol">:</span> <span id="7952" class="PrimitiveType">Set</span><span id="7955" class="Symbol">}</span> <span id="7957" class="Symbol">→</span> <span id="7959" class="Symbol">{</span><a id="7960" href="#7960" class="Bound">τs</a> <span id="7963" class="Symbol">:</span> <a id="7965" href="#2771" class="Datatype">List</a> <a id="7970" href="#7948" class="Bound">Ω</a><span id="7971" class="Symbol">}</span> <span id="7973" class="Symbol">→</span> <span id="7975" class="Symbol">{</span><a id="7976" href="#7976" class="Bound">τ'</a> <a id="7979" href="#7979" class="Bound">τ</a> <span id="7981" class="Symbol">:</span> <a id="7983" href="#7948" class="Bound">Ω</a><span id="7984" class="Symbol">}</span> <span id="7986" class="Symbol">→</span> <a id="7988" href="#3432" class="Function">Has</a> <a id="7992" href="#7960" class="Bound">τs</a> <a id="7995" href="#7976" class="Bound">τ'</a> <span id="7998" class="Symbol">→</span> <a id="8000" href="#3432" class="Function">Has</a> <span id="8004" class="Symbol">(</span><a id="8005" href="#7976" class="Bound">τ'</a> <a id="8008" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="8010" href="#7960" class="Bound">τs</a><span id="8012" class="Symbol">)</span> <a id="8014" href="#7979" class="Bound">τ</a> <span id="8016" class="Symbol">→</span> <a id="8018" href="#3432" class="Function">Has</a> <a id="8022" href="#7960" class="Bound">τs</a> <a id="8025" href="#7979" class="Bound">τ</a>
  <a id="8029" href="#7936" class="Function">has-cons</a> <a id="8038" href="#8038" class="Bound">i</a> <span id="8040" class="Symbol">(</span><a id="8041" href="#3288" class="InductiveConstructor">here</a> <a id="8046" href="#2690" class="InductiveConstructor">refl</a><span id="8050" class="Symbol">)</span> <span id="8052" class="Symbol">=</span> <a id="8054" href="#8038" class="Bound">i</a>
  <a id="8058" href="#7936" class="Function">has-cons</a> <a id="8067" href="#8067" class="Bound">i</a> <span id="8069" class="Symbol">(</span><a id="8070" href="#3332" class="InductiveConstructor">there</a> <a id="8076" href="#8076" class="Bound">j</a><span id="8077" class="Symbol">)</span>   <span id="8081" class="Symbol">=</span> <a id="8083" href="#8076" class="Bound">j</a>

  <a id="1:Library.has-prepend"></a><a id="8088" href="#8088" class="Function">has-prepend</a> <span id="8100" class="Symbol">:</span> <span id="8102" class="Symbol">{</span><a id="8103" href="#8103" class="Bound">Ω</a> <span id="8105" class="Symbol">:</span> <span id="8107" class="PrimitiveType">Set</span><span id="8110" class="Symbol">}</span> <span id="8112" class="Symbol">→</span> <span id="8114" class="Symbol">{</span><a id="8115" href="#8115" class="Bound">τs</a> <a id="8118" href="#8118" class="Bound">τs'</a> <span id="8122" class="Symbol">:</span> <a id="8124" href="#2771" class="Datatype">List</a> <a id="8129" href="#8103" class="Bound">Ω</a><span id="8130" class="Symbol">}</span> <span id="8132" class="Symbol">→</span> <span id="8134" class="Symbol">(∀</span> <span id="8137" class="Symbol">{</span><a id="8138" href="#8138" class="Bound">τ</a><span id="8139" class="Symbol">}</span> <span id="8141" class="Symbol">→</span> <a id="8143" href="#3432" class="Function">Has</a> <a id="8147" href="#8115" class="Bound">τs</a> <a id="8150" href="#8138" class="Bound">τ</a> <span id="8152" class="Symbol">→</span> <a id="8154" href="#3432" class="Function">Has</a> <a id="8158" href="#8118" class="Bound">τs'</a> <a id="8162" href="#8138" class="Bound">τ</a><span id="8163" class="Symbol">)</span> <span id="8165" class="Symbol">→</span> <span id="8167" class="Symbol">(</span><a id="8168" href="#8168" class="Bound">σs</a> <span id="8171" class="Symbol">:</span> <a id="8173" href="#2771" class="Datatype">List</a> <a id="8178" href="#8103" class="Bound">Ω</a><span id="8179" class="Symbol">)</span> <span id="8181" class="Symbol">→</span> <span id="8183" class="Symbol">(∀</span> <span id="8186" class="Symbol">{</span><a id="8187" href="#8187" class="Bound">τ</a><span id="8188" class="Symbol">}</span> <span id="8190" class="Symbol">→</span> <a id="8192" href="#3432" class="Function">Has</a> <span id="8196" class="Symbol">(</span><a id="8197" href="#8168" class="Bound">σs</a> <a id="8200" href="#7002" class="Function Operator">++</a> <a id="8203" href="#8115" class="Bound">τs</a><span id="8205" class="Symbol">)</span> <a id="8207" href="#8187" class="Bound">τ</a> <span id="8209" class="Symbol">→</span> <a id="8211" href="#3432" class="Function">Has</a> <span id="8215" class="Symbol">(</span><a id="8216" href="#8168" class="Bound">σs</a> <a id="8219" href="#7002" class="Function Operator">++</a> <a id="8222" href="#8118" class="Bound">τs'</a><span id="8225" class="Symbol">)</span> <a id="8227" href="#8187" class="Bound">τ</a><span id="8228" class="Symbol">)</span>
  <a id="8232" href="#8088" class="Function">has-prepend</a> <a id="8244" href="#8244" class="Bound">f</a>  <a id="8247" href="#2802" class="InductiveConstructor">ε</a>        <a id="8256" href="#8256" class="Bound">x</a>        <span id="8265" class="Symbol">=</span> <a id="8267" href="#8244" class="Bound">f</a> <a id="8269" href="#8256" class="Bound">x</a>
  <a id="8273" href="#8088" class="Function">has-prepend</a> <a id="8285" href="#8285" class="Bound">f</a> <span id="8287" class="Symbol">(</span><a id="8288" href="#8288" class="Bound">σ</a> <a id="8290" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="8292" href="#8292" class="Bound">σs</a><span id="8294" class="Symbol">)</span> <span id="8296" class="Symbol">(</span><a id="8297" href="#3288" class="InductiveConstructor">here</a> <a id="8302" href="#8302" class="Bound">x</a><span id="8303" class="Symbol">)</span>  <span id="8306" class="Symbol">=</span> <a id="8308" href="#3288" class="InductiveConstructor">here</a> <a id="8313" href="#8302" class="Bound">x</a>
  <a id="8317" href="#8088" class="Function">has-prepend</a> <a id="8329" href="#8329" class="Bound">f</a> <span id="8331" class="Symbol">(</span><a id="8332" href="#8332" class="Bound">σ</a> <a id="8334" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="8336" href="#8336" class="Bound">σs</a><span id="8338" class="Symbol">)</span> <span id="8340" class="Symbol">(</span><a id="8341" href="#3332" class="InductiveConstructor">there</a> <a id="8347" href="#8347" class="Bound">x</a><span id="8348" class="Symbol">)</span> <span id="8350" class="Symbol">=</span> <a id="8352" href="#3332" class="InductiveConstructor">there</a> <span id="8358" class="Symbol">(</span><a id="8359" href="#8088" class="Function">has-prepend</a> <a id="8371" href="#8329" class="Bound">f</a> <a id="8373" href="#8336" class="Bound">σs</a> <a id="8376" href="#8347" class="Bound">x</a><span id="8377" class="Symbol">)</span>

<span id="8380" class="Keyword">open</span> <a id="8385" href="#2273" class="Module">1:Library</a>



<span id="8398" class="Keyword">module</span> <a id="2:Types"></a><a id="8405" href="#8405" class="Module">2:Types</a> <span id="8413" class="Keyword">where</span>
  <span id="8421" class="Comment">{-
     2. Types
  -}</span>

  <span id="8446" class="Comment">-- Types defined in our calculus. We have functions, finite coproducts, finite products, and</span>
  <span id="8541" class="Comment">-- a couple of inductive and coinductive types</span>
  <span id="8590" class="Keyword">infixr</span> <span id="8597" class="Number">5</span> <a id="8599" href="#8631" class="InductiveConstructor Operator">_⇒_</a>
  <span id="8605" class="Keyword">data</span> <a id="2:Types.Type"></a><a id="8610" href="#8610" class="Datatype">Type</a> <span id="8615" class="Symbol">:</span> <span id="8617" class="PrimitiveType">Set</span> <span id="8621" class="Keyword">where</span>
    <a id="2:Types.Type._⇒_"></a><a id="8631" href="#8631" class="InductiveConstructor Operator">_⇒_</a>      <span id="8640" class="Symbol">:</span> <a id="8642" href="#8610" class="Datatype">Type</a> <span id="8647" class="Symbol">→</span> <a id="8649" href="#8610" class="Datatype">Type</a> <span id="8654" class="Symbol">→</span> <a id="8656" href="#8610" class="Datatype">Type</a> <span id="8661" class="Comment">-- function</span>
    <a id="2:Types.Type.#Sum"></a><a id="8677" href="#8677" class="InductiveConstructor">#Sum</a>     <span id="8686" class="Symbol">:</span> <a id="8688" href="#2771" class="Datatype">List</a> <a id="8693" href="#8610" class="Datatype">Type</a> <span id="8698" class="Symbol">→</span> <a id="8700" href="#8610" class="Datatype">Type</a>   <span id="8707" class="Comment">-- sum of a list of types</span>
    <a id="2:Types.Type.#Product"></a><a id="8737" href="#8737" class="InductiveConstructor">#Product</a> <span id="8746" class="Symbol">:</span> <a id="8748" href="#2771" class="Datatype">List</a> <a id="8753" href="#8610" class="Datatype">Type</a> <span id="8758" class="Symbol">→</span> <a id="8760" href="#8610" class="Datatype">Type</a>   <span id="8767" class="Comment">-- product of a list of types</span>
    <a id="2:Types.Type.#Nat"></a><a id="8801" href="#8801" class="InductiveConstructor">#Nat</a>     <span id="8810" class="Symbol">:</span> <a id="8812" href="#8610" class="Datatype">Type</a>               <span id="8831" class="Comment">-- natural number</span>
    <a id="2:Types.Type.#Conat"></a><a id="8853" href="#8853" class="InductiveConstructor">#Conat</a>   <span id="8862" class="Symbol">:</span> <a id="8864" href="#8610" class="Datatype">Type</a>               <span id="8883" class="Comment">-- conatural number (potentially infinite number)</span>
    <a id="2:Types.Type.#Stream"></a><a id="8937" href="#8937" class="InductiveConstructor">#Stream</a>  <span id="8946" class="Symbol">:</span> <a id="8948" href="#8610" class="Datatype">Type</a> <span id="8953" class="Symbol">→</span> <a id="8955" href="#8610" class="Datatype">Type</a>        <span id="8967" class="Comment">-- stream (infinite sequence)</span>

  <span id="9000" class="Comment">-- Empty sum</span>
  <a id="2:Types.#Void"></a><a id="9015" href="#9015" class="Function">#Void</a> <span id="9021" class="Symbol">:</span> <a id="9023" href="#8610" class="Datatype">Type</a>
  <a id="9030" href="#9015" class="Function">#Void</a> <span id="9036" class="Symbol">=</span> <a id="9038" href="#8677" class="InductiveConstructor">#Sum</a> <a id="9043" href="#2802" class="InductiveConstructor">ε</a>

  <span id="9048" class="Comment">-- Empty product</span>
  <a id="2:Types.#Unit"></a><a id="9067" href="#9067" class="Function">#Unit</a> <span id="9073" class="Symbol">:</span> <a id="9075" href="#8610" class="Datatype">Type</a>
  <a id="9082" href="#9067" class="Function">#Unit</a> <span id="9088" class="Symbol">=</span> <a id="9090" href="#8737" class="InductiveConstructor">#Product</a> <a id="9099" href="#2802" class="InductiveConstructor">ε</a>

  <span id="9104" class="Comment">-- Sum of two types</span>
  <a id="2:Types.#Either"></a><a id="9126" href="#9126" class="Function">#Either</a> <span id="9134" class="Symbol">:</span> <a id="9136" href="#8610" class="Datatype">Type</a> <span id="9141" class="Symbol">→</span> <a id="9143" href="#8610" class="Datatype">Type</a> <span id="9148" class="Symbol">→</span> <a id="9150" href="#8610" class="Datatype">Type</a>
  <a id="9157" href="#9126" class="Function">#Either</a> <a id="9165" href="#9165" class="Bound">σ</a> <a id="9167" href="#9167" class="Bound">τ</a> <span id="9169" class="Symbol">=</span> <a id="9171" href="#8677" class="InductiveConstructor">#Sum</a> <span id="9176" class="Symbol">(</span><a id="9177" href="#9165" class="Bound">σ</a> <a id="9179" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="9181" href="#9167" class="Bound">τ</a> <a id="9183" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="9185" href="#2802" class="InductiveConstructor">ε</a><span id="9186" class="Symbol">)</span>

  <span id="9191" class="Comment">-- Product of two types</span>
  <a id="2:Types.#Pair"></a><a id="9217" href="#9217" class="Function">#Pair</a> <span id="9223" class="Symbol">:</span> <a id="9225" href="#8610" class="Datatype">Type</a> <span id="9230" class="Symbol">→</span> <a id="9232" href="#8610" class="Datatype">Type</a> <span id="9237" class="Symbol">→</span> <a id="9239" href="#8610" class="Datatype">Type</a>
  <a id="9246" href="#9217" class="Function">#Pair</a> <a id="9252" href="#9252" class="Bound">σ</a> <a id="9254" href="#9254" class="Bound">τ</a> <span id="9256" class="Symbol">=</span> <a id="9258" href="#8737" class="InductiveConstructor">#Product</a> <span id="9267" class="Symbol">(</span><a id="9268" href="#9252" class="Bound">σ</a> <a id="9270" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="9272" href="#9254" class="Bound">τ</a> <a id="9274" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="9276" href="#2802" class="InductiveConstructor">ε</a><span id="9277" class="Symbol">)</span>

  <span id="9282" class="Comment">-- Bool</span>
  <a id="2:Types.#Bool"></a><a id="9292" href="#9292" class="Function">#Bool</a> <span id="9298" class="Symbol">:</span> <a id="9300" href="#8610" class="Datatype">Type</a>
  <a id="9307" href="#9292" class="Function">#Bool</a> <span id="9313" class="Symbol">=</span> <a id="9315" href="#9126" class="Function">#Either</a> <a id="9323" href="#9067" class="Function">#Unit</a> <a id="9329" href="#9067" class="Function">#Unit</a>

  <span id="9338" class="Comment">-- Maybe</span>
  <a id="2:Types.#Maybe"></a><a id="9349" href="#9349" class="Function">#Maybe</a> <span id="9356" class="Symbol">:</span> <a id="9358" href="#8610" class="Datatype">Type</a> <span id="9363" class="Symbol">→</span> <a id="9365" href="#8610" class="Datatype">Type</a>
  <a id="9372" href="#9349" class="Function">#Maybe</a> <a id="9379" href="#9379" class="Bound">τ</a> <span id="9381" class="Symbol">=</span> <a id="9383" href="#9126" class="Function">#Either</a> <a id="9391" href="#9067" class="Function">#Unit</a> <a id="9397" href="#9379" class="Bound">τ</a>

<span id="9400" class="Keyword">open</span> <a id="9405" href="#8405" class="Module">2:Types</a>



<span id="9416" class="Keyword">module</span> <a id="3:Rules"></a><a id="9423" href="#9423" class="Module">3:Rules</a> <span id="9431" class="Keyword">where</span>
  <span id="9439" class="Comment">{-
     3. Introduction and elimination rules
  -}</span>

  <span id="9493" class="Comment">{-
     We define introduction and elimination rules for our calculus, parameterized by two
     special types: '%Abstraction' and '%Value'. In next sections we use different
     instantiatons of these two types to define different representations for terms
     of our calculus.
  -}</span>

  <span id="9782" class="Comment">-- Introduction rules</span>
  <span id="9806" class="Keyword">data</span> <a id="3:Rules.Intr"></a><a id="9811" href="#9811" class="Datatype">Intr</a> <span id="9816" class="Symbol">(</span><a id="9817" href="#9817" class="Bound">%Abstraction</a> <span id="9830" class="Symbol">:</span> <a id="9832" href="#8610" class="Datatype">Type</a> <span id="9837" class="Symbol">→</span> <a id="9839" href="#8610" class="Datatype">Type</a> <span id="9844" class="Symbol">→</span> <span id="9846" class="PrimitiveType">Set</span><span id="9849" class="Symbol">)</span> <span id="9851" class="Symbol">(</span><a id="9852" href="#9852" class="Bound">%Value</a> <span id="9859" class="Symbol">:</span> <a id="9861" href="#8610" class="Datatype">Type</a> <span id="9866" class="Symbol">→</span> <span id="9868" class="PrimitiveType">Set</span><span id="9871" class="Symbol">)</span> <span id="9873" class="Symbol">:</span> <a id="9875" href="#8610" class="Datatype">Type</a> <span id="9880" class="Symbol">→</span> <span id="9882" class="PrimitiveType">Set</span> <span id="9886" class="Keyword">where</span>
    <span id="9896" class="Comment">-- A function is defined by a lambda abstraction</span>
    <a id="3:Rules.Intr.intrArrow"></a><a id="9949" href="#9949" class="InductiveConstructor">intrArrow</a> <span id="9959" class="Symbol">:</span> <span id="9961" class="Symbol">∀</span> <span id="9963" class="Symbol">{</span><a id="9964" href="#9964" class="Bound">ρ</a> <a id="9966" href="#9966" class="Bound">τ</a><span id="9967" class="Symbol">}</span> <span id="9969" class="Symbol">→</span> <a id="9971" href="#9817" class="Bound">%Abstraction</a> <a id="9984" href="#9964" class="Bound">ρ</a> <a id="9986" href="#9966" class="Bound">τ</a> <span id="9988" class="Symbol">→</span> <a id="9990" href="#9811" class="Datatype">Intr</a> <a id="9995" href="#9817" class="Bound">%Abstraction</a> <a id="10008" href="#9852" class="Bound">%Value</a> <span id="10015" class="Symbol">(</span><a id="10016" href="#9964" class="Bound">ρ</a> <a id="10018" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="10020" href="#9966" class="Bound">τ</a><span id="10021" class="Symbol">)</span>

    <span id="10028" class="Comment">-- To construct '#Sum τs', provide a value for one of the types in τs</span>
    <a id="3:Rules.Intr.intrSum"></a><a id="10102" href="#10102" class="InductiveConstructor">intrSum</a> <span id="10110" class="Symbol">:</span> <span id="10112" class="Symbol">∀</span> <span id="10114" class="Symbol">{</span><a id="10115" href="#10115" class="Bound">τs</a><span id="10117" class="Symbol">}</span> <span id="10119" class="Symbol">→</span> <a id="10121" href="#3235" class="Datatype">Any</a> <a id="10125" href="#9852" class="Bound">%Value</a> <a id="10132" href="#10115" class="Bound">τs</a> <span id="10135" class="Symbol">→</span> <a id="10137" href="#9811" class="Datatype">Intr</a> <a id="10142" href="#9817" class="Bound">%Abstraction</a> <a id="10155" href="#9852" class="Bound">%Value</a> <span id="10162" class="Symbol">(</span><a id="10163" href="#8677" class="InductiveConstructor">#Sum</a> <a id="10168" href="#10115" class="Bound">τs</a><span id="10170" class="Symbol">)</span>

    <span id="10177" class="Comment">-- To construct '#Product τs', provide a value for each type in τs</span>
    <a id="3:Rules.Intr.intrProduct"></a><a id="10248" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="10260" class="Symbol">:</span> <span id="10262" class="Symbol">∀</span> <span id="10264" class="Symbol">{</span><a id="10265" href="#10265" class="Bound">τs</a><span id="10267" class="Symbol">}</span> <span id="10269" class="Symbol">→</span> <a id="10271" href="#2877" class="Datatype">All</a> <a id="10275" href="#9852" class="Bound">%Value</a> <a id="10282" href="#10265" class="Bound">τs</a> <span id="10285" class="Symbol">→</span> <a id="10287" href="#9811" class="Datatype">Intr</a> <a id="10292" href="#9817" class="Bound">%Abstraction</a> <a id="10305" href="#9852" class="Bound">%Value</a> <span id="10312" class="Symbol">(</span><a id="10313" href="#8737" class="InductiveConstructor">#Product</a> <a id="10322" href="#10265" class="Bound">τs</a><span id="10324" class="Symbol">)</span>

    <span id="10331" class="Comment">-- To construct '#Nat', provide a value of type '#Maybe #Nat'. 'nothing' corresponds to</span>
    <span id="10423" class="Comment">-- zero, 'just n' corresponds to the successor of 'n'</span>
    <a id="3:Rules.Intr.intrNat"></a><a id="10481" href="#10481" class="InductiveConstructor">intrNat</a> <span id="10489" class="Symbol">:</span> <a id="10491" href="#9852" class="Bound">%Value</a> <span id="10498" class="Symbol">(</span><a id="10499" href="#9349" class="Function">#Maybe</a> <a id="10506" href="#8801" class="InductiveConstructor">#Nat</a><span id="10510" class="Symbol">)</span> <span id="10512" class="Symbol">→</span> <a id="10514" href="#9811" class="Datatype">Intr</a> <a id="10519" href="#9817" class="Bound">%Abstraction</a> <a id="10532" href="#9852" class="Bound">%Value</a> <a id="10539" href="#8801" class="InductiveConstructor">#Nat</a>

    <span id="10549" class="Comment">-- Conatural number is defined by a triple '(ρ ,, v , f)', where ρ is a type, 'v' is a</span>
    <span id="10640" class="Comment">-- value of type ρ and 'f' is a function of type 'ρ ⇒ #Maybe ρ'. 'v' represents current</span>
    <span id="10732" class="Comment">-- state, 'f' returns 'nothing' if the number is zero, or 'just u' if the number is the</span>
    <span id="10824" class="Comment">-- successor of 'u'</span>
    <a id="3:Rules.Intr.intrConat"></a><a id="10848" href="#10848" class="InductiveConstructor">intrConat</a> <span id="10858" class="Symbol">:</span> <a id="10860" href="#2518" class="Record">Σ</a> <a id="10862" href="#8610" class="Datatype">Type</a> <span id="10867" class="Symbol">(\</span><a id="10869" href="#10869" class="Bound">ρ</a> <span id="10871" class="Symbol">→</span> <a id="10873" href="#9852" class="Bound">%Value</a> <a id="10880" href="#10869" class="Bound">ρ</a> <a id="10882" href="#2387" class="Record Operator">×</a> <a id="10884" href="#9852" class="Bound">%Value</a> <span id="10891" class="Symbol">(</span><a id="10892" href="#10869" class="Bound">ρ</a> <a id="10894" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="10896" href="#9349" class="Function">#Maybe</a> <a id="10903" href="#10869" class="Bound">ρ</a><span id="10904" class="Symbol">))</span> <span id="10907" class="Symbol">→</span> <a id="10909" href="#9811" class="Datatype">Intr</a> <a id="10914" href="#9817" class="Bound">%Abstraction</a> <a id="10927" href="#9852" class="Bound">%Value</a> <a id="10934" href="#8853" class="InductiveConstructor">#Conat</a>

    <span id="10946" class="Comment">-- Stream of elements of type τ is defined by a triple (ρ ,, v , f), where ρ is a type,</span>
    <span id="11038" class="Comment">-- 'v' is a value of type ρ and 'f' is a function of type 'ρ ⇒ #Pair τ ρ'. 'v' represents</span>
    <span id="11132" class="Comment">-- current state, 'f' returns a pair containing stream head and stream tail</span>
    <a id="3:Rules.Intr.intrStream"></a><a id="11212" href="#11212" class="InductiveConstructor">intrStream</a> <span id="11223" class="Symbol">:</span> <span id="11225" class="Symbol">∀</span> <span id="11227" class="Symbol">{</span><a id="11228" href="#11228" class="Bound">τ</a><span id="11229" class="Symbol">}</span> <span id="11231" class="Symbol">→</span> <a id="11233" href="#2518" class="Record">Σ</a> <a id="11235" href="#8610" class="Datatype">Type</a> <span id="11240" class="Symbol">(\</span><a id="11242" href="#11242" class="Bound">ρ</a> <span id="11244" class="Symbol">→</span> <a id="11246" href="#9852" class="Bound">%Value</a> <a id="11253" href="#11242" class="Bound">ρ</a> <a id="11255" href="#2387" class="Record Operator">×</a> <a id="11257" href="#9852" class="Bound">%Value</a> <span id="11264" class="Symbol">(</span><a id="11265" href="#11242" class="Bound">ρ</a> <a id="11267" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="11269" href="#9217" class="Function">#Pair</a> <a id="11275" href="#11228" class="Bound">τ</a> <a id="11277" href="#11242" class="Bound">ρ</a><span id="11278" class="Symbol">))</span> <span id="11281" class="Symbol">→</span> <a id="11283" href="#9811" class="Datatype">Intr</a> <a id="11288" href="#9817" class="Bound">%Abstraction</a> <a id="11301" href="#9852" class="Bound">%Value</a> <span id="11308" class="Symbol">(</span><a id="11309" href="#8937" class="InductiveConstructor">#Stream</a> <a id="11317" href="#11228" class="Bound">τ</a><span id="11318" class="Symbol">)</span>

  <span id="11323" class="Comment">-- Elimination rules</span>
  <span id="11346" class="Keyword">data</span> <a id="3:Rules.Elim"></a><a id="11351" href="#11351" class="Datatype">Elim</a> <span id="11356" class="Symbol">(</span><a id="11357" href="#11357" class="Bound">%Value</a> <span id="11364" class="Symbol">:</span> <a id="11366" href="#8610" class="Datatype">Type</a> <span id="11371" class="Symbol">→</span> <span id="11373" class="PrimitiveType">Set</span><span id="11376" class="Symbol">)</span> <span id="11378" class="Symbol">:</span> <a id="11380" href="#8610" class="Datatype">Type</a> <span id="11385" class="Symbol">→</span> <a id="11387" href="#8610" class="Datatype">Type</a> <span id="11392" class="Symbol">→</span> <span id="11394" class="PrimitiveType">Set</span> <span id="11398" class="Keyword">where</span>
    <span id="11408" class="Comment">-- To eliminate 'ρ ⇒ τ', provide a value of type ρ; the result will be of type τ</span>
    <a id="3:Rules.Elim.elimArrow"></a><a id="11493" href="#11493" class="InductiveConstructor">elimArrow</a> <span id="11503" class="Symbol">:</span> <span id="11505" class="Symbol">∀</span> <span id="11507" class="Symbol">{</span><a id="11508" href="#11508" class="Bound">ρ</a> <a id="11510" href="#11510" class="Bound">τ</a><span id="11511" class="Symbol">}</span> <span id="11513" class="Symbol">→</span> <a id="11515" href="#11357" class="Bound">%Value</a> <a id="11522" href="#11508" class="Bound">ρ</a> <span id="11524" class="Symbol">→</span> <a id="11526" href="#11351" class="Datatype">Elim</a> <a id="11531" href="#11357" class="Bound">%Value</a> <span id="11538" class="Symbol">(</span><a id="11539" href="#11508" class="Bound">ρ</a> <a id="11541" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="11543" href="#11510" class="Bound">τ</a><span id="11544" class="Symbol">)</span> <a id="11546" href="#11510" class="Bound">τ</a>

    <span id="11553" class="Comment">-- To eliminate '#Sum τs', provide a function 'τ ⇒ ϕ' for each type τ in τs; the result</span>
    <span id="11645" class="Comment">-- will be of type ϕ</span>
    <a id="3:Rules.Elim.elimSum"></a><a id="11670" href="#11670" class="InductiveConstructor">elimSum</a> <span id="11678" class="Symbol">:</span> <span id="11680" class="Symbol">∀</span> <span id="11682" class="Symbol">{</span><a id="11683" href="#11683" class="Bound">τs</a> <a id="11686" href="#11686" class="Bound">ϕ</a><span id="11687" class="Symbol">}</span> <span id="11689" class="Symbol">→</span> <a id="11691" href="#2877" class="Datatype">All</a> <span id="11695" class="Symbol">(\</span><a id="11697" href="#11697" class="Bound">τ</a> <span id="11699" class="Symbol">→</span> <a id="11701" href="#11357" class="Bound">%Value</a> <span id="11708" class="Symbol">(</span><a id="11709" href="#11697" class="Bound">τ</a> <a id="11711" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="11713" href="#11686" class="Bound">ϕ</a><span id="11714" class="Symbol">))</span> <a id="11717" href="#11683" class="Bound">τs</a> <span id="11720" class="Symbol">→</span> <a id="11722" href="#11351" class="Datatype">Elim</a> <a id="11727" href="#11357" class="Bound">%Value</a> <span id="11734" class="Symbol">(</span><a id="11735" href="#8677" class="InductiveConstructor">#Sum</a> <a id="11740" href="#11683" class="Bound">τs</a><span id="11742" class="Symbol">)</span> <a id="11744" href="#11686" class="Bound">ϕ</a>

    <span id="11751" class="Comment">-- If τ is a member of τs, we can eliminate '#Product τs' to get a value of type τ</span>
    <a id="3:Rules.Elim.elimProduct"></a><a id="11838" href="#11838" class="InductiveConstructor">elimProduct</a> <span id="11850" class="Symbol">:</span> <span id="11852" class="Symbol">∀</span> <span id="11854" class="Symbol">{</span><a id="11855" href="#11855" class="Bound">τs</a> <a id="11858" href="#11858" class="Bound">τ</a><span id="11859" class="Symbol">}</span> <span id="11861" class="Symbol">→</span> <a id="11863" href="#3432" class="Function">Has</a> <a id="11867" href="#11855" class="Bound">τs</a> <a id="11870" href="#11858" class="Bound">τ</a> <span id="11872" class="Symbol">→</span> <a id="11874" href="#11351" class="Datatype">Elim</a> <a id="11879" href="#11357" class="Bound">%Value</a> <span id="11886" class="Symbol">(</span><a id="11887" href="#8737" class="InductiveConstructor">#Product</a> <a id="11896" href="#11855" class="Bound">τs</a><span id="11898" class="Symbol">)</span> <a id="11900" href="#11858" class="Bound">τ</a>

    <span id="11907" class="Comment">-- Elimination for '#Nat' is recursion</span>
    <a id="3:Rules.Elim.elimNat"></a><a id="11950" href="#11950" class="InductiveConstructor">elimNat</a> <span id="11958" class="Symbol">:</span> <span id="11960" class="Symbol">∀</span> <span id="11962" class="Symbol">{</span><a id="11963" href="#11963" class="Bound">ϕ</a><span id="11964" class="Symbol">}</span> <span id="11966" class="Symbol">→</span> <a id="11968" href="#11357" class="Bound">%Value</a> <span id="11975" class="Symbol">(</span><a id="11976" href="#9349" class="Function">#Maybe</a> <a id="11983" href="#11963" class="Bound">ϕ</a> <a id="11985" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="11987" href="#11963" class="Bound">ϕ</a><span id="11988" class="Symbol">)</span> <span id="11990" class="Symbol">→</span> <a id="11992" href="#11351" class="Datatype">Elim</a> <a id="11997" href="#11357" class="Bound">%Value</a> <a id="12004" href="#8801" class="InductiveConstructor">#Nat</a> <a id="12009" href="#11963" class="Bound">ϕ</a>

    <span id="12016" class="Comment">-- '#Conat' can be deconstructed into '#Maybe #Conat', giving 'nothing' for zero, or</span>
    <span id="12105" class="Comment">-- 'just n' for the successor of 'n'</span>
    <a id="3:Rules.Elim.elimConat"></a><a id="12146" href="#12146" class="InductiveConstructor">elimConat</a> <span id="12156" class="Symbol">:</span> <a id="12158" href="#11351" class="Datatype">Elim</a> <a id="12163" href="#11357" class="Bound">%Value</a> <a id="12170" href="#8853" class="InductiveConstructor">#Conat</a> <span id="12177" class="Symbol">(</span><a id="12178" href="#9349" class="Function">#Maybe</a> <a id="12185" href="#8853" class="InductiveConstructor">#Conat</a><span id="12191" class="Symbol">)</span>

    <span id="12198" class="Comment">-- '#Stream τ' can be deconstructed into '#Pair τ (#Stream τ)', giving a pair containing</span>
    <span id="12291" class="Comment">-- stream head and stream tail</span>
    <a id="3:Rules.Elim.elimStream"></a><a id="12326" href="#12326" class="InductiveConstructor">elimStream</a> <span id="12337" class="Symbol">:</span> <span id="12339" class="Symbol">∀</span> <span id="12341" class="Symbol">{</span><a id="12342" href="#12342" class="Bound">τ</a><span id="12343" class="Symbol">}</span> <span id="12345" class="Symbol">→</span> <a id="12347" href="#11351" class="Datatype">Elim</a> <a id="12352" href="#11357" class="Bound">%Value</a> <span id="12359" class="Symbol">(</span><a id="12360" href="#8937" class="InductiveConstructor">#Stream</a> <a id="12368" href="#12342" class="Bound">τ</a><span id="12369" class="Symbol">)</span> <span id="12371" class="Symbol">(</span><a id="12372" href="#9217" class="Function">#Pair</a> <a id="12378" href="#12342" class="Bound">τ</a> <span id="12380" class="Symbol">(</span><a id="12381" href="#8937" class="InductiveConstructor">#Stream</a> <a id="12389" href="#12342" class="Bound">τ</a><span id="12390" class="Symbol">))</span>

  <span id="12396" class="Comment">-- An expression is either an introduction rule, or an elimination rule with a value it applies to</span>
  <span id="12497" class="Keyword">data</span> <a id="3:Rules.Expr"></a><a id="12502" href="#12502" class="Datatype">Expr</a> <span id="12507" class="Symbol">(</span><a id="12508" href="#12508" class="Bound">%Abstraction</a> <span id="12521" class="Symbol">:</span> <a id="12523" href="#8610" class="Datatype">Type</a> <span id="12528" class="Symbol">→</span> <a id="12530" href="#8610" class="Datatype">Type</a> <span id="12535" class="Symbol">→</span> <span id="12537" class="PrimitiveType">Set</span><span id="12540" class="Symbol">)</span> <span id="12542" class="Symbol">(</span><a id="12543" href="#12543" class="Bound">%Value</a> <span id="12550" class="Symbol">:</span> <a id="12552" href="#8610" class="Datatype">Type</a> <span id="12557" class="Symbol">→</span> <span id="12559" class="PrimitiveType">Set</span><span id="12562" class="Symbol">)</span> <span id="12564" class="Symbol">(</span><a id="12565" href="#12565" class="Bound">τ</a> <span id="12567" class="Symbol">:</span> <a id="12569" href="#8610" class="Datatype">Type</a><span id="12573" class="Symbol">)</span> <span id="12575" class="Symbol">:</span> <span id="12577" class="PrimitiveType">Set</span> <span id="12581" class="Keyword">where</span>
    <a id="3:Rules.Expr.intr"></a><a id="12591" href="#12591" class="InductiveConstructor">intr</a> <span id="12596" class="Symbol">:</span> <a id="12598" href="#9811" class="Datatype">Intr</a> <a id="12603" href="#12508" class="Bound">%Abstraction</a> <a id="12616" href="#12543" class="Bound">%Value</a> <a id="12623" href="#12565" class="Bound">τ</a>         <span id="12633" class="Symbol">→</span> <a id="12635" href="#12502" class="Datatype">Expr</a> <a id="12640" href="#12508" class="Bound">%Abstraction</a> <a id="12653" href="#12543" class="Bound">%Value</a> <a id="12660" href="#12565" class="Bound">τ</a>
    <a id="3:Rules.Expr.elim"></a><a id="12666" href="#12666" class="InductiveConstructor">elim</a> <span id="12671" class="Symbol">:</span> <span id="12673" class="Symbol">∀</span> <span id="12675" class="Symbol">{</span><a id="12676" href="#12676" class="Bound">ϕ</a><span id="12677" class="Symbol">}</span> <span id="12679" class="Symbol">→</span> <a id="12681" href="#12543" class="Bound">%Value</a> <a id="12688" href="#12676" class="Bound">ϕ</a> <span id="12690" class="Symbol">→</span> <a id="12692" href="#11351" class="Datatype">Elim</a> <a id="12697" href="#12543" class="Bound">%Value</a> <a id="12704" href="#12676" class="Bound">ϕ</a> <a id="12706" href="#12565" class="Bound">τ</a> <span id="12708" class="Symbol">→</span> <a id="12710" href="#12502" class="Datatype">Expr</a> <a id="12715" href="#12508" class="Bound">%Abstraction</a> <a id="12728" href="#12543" class="Bound">%Value</a> <a id="12735" href="#12565" class="Bound">τ</a>

<span id="12738" class="Keyword">open</span> <a id="12743" href="#9423" class="Module">3:Rules</a>



<span id="12754" class="Keyword">module</span> <a id="4:Utensils"></a><a id="12761" href="#12761" class="Module">4:Utensils</a> <span id="12772" class="Keyword">where</span>
  <span id="12780" class="Comment">{-
     4. Boilerplate utensils for introduction and elimination rules
  -}</span>

  <span id="12859" class="Comment">-- Functorial map for Intr</span>
  <a id="4:Utensils.mapIntr"></a><a id="12888" href="#12888" class="Function">mapIntr</a>
      <span id="12902" class="Symbol">:</span> <span id="12904" class="Symbol">∀</span> <span id="12906" class="Symbol">{</span><a id="12907" href="#12907" class="Bound">%A1</a> <a id="12911" href="#12911" class="Bound">%A2</a> <a id="12915" href="#12915" class="Bound">%V1</a> <a id="12919" href="#12919" class="Bound">%V2</a><span id="12922" class="Symbol">}</span>
      <span id="12930" class="Symbol">→</span> <span id="12932" class="Symbol">(</span><a id="12933" href="#12933" class="Bound">%mapA</a> <span id="12939" class="Symbol">:</span> <span id="12941" class="Symbol">∀</span> <span id="12943" class="Symbol">{</span><a id="12944" href="#12944" class="Bound">ρ</a> <a id="12946" href="#12946" class="Bound">τ</a><span id="12947" class="Symbol">}</span> <span id="12949" class="Symbol">→</span> <a id="12951" href="#12907" class="Bound">%A1</a> <a id="12955" href="#12944" class="Bound">ρ</a> <a id="12957" href="#12946" class="Bound">τ</a> <span id="12959" class="Symbol">→</span> <a id="12961" href="#12911" class="Bound">%A2</a> <a id="12965" href="#12944" class="Bound">ρ</a> <a id="12967" href="#12946" class="Bound">τ</a><span id="12968" class="Symbol">)</span> <span id="12970" class="Symbol">→</span> <span id="12972" class="Symbol">(</span><a id="12973" href="#12973" class="Bound">%mapV</a> <span id="12979" class="Symbol">:</span> <span id="12981" class="Symbol">∀</span> <span id="12983" class="Symbol">{</span><a id="12984" href="#12984" class="Bound">τ</a><span id="12985" class="Symbol">}</span> <span id="12987" class="Symbol">→</span> <a id="12989" href="#12915" class="Bound">%V1</a> <a id="12993" href="#12984" class="Bound">τ</a> <span id="12995" class="Symbol">→</span> <a id="12997" href="#12919" class="Bound">%V2</a> <a id="13001" href="#12984" class="Bound">τ</a><span id="13002" class="Symbol">)</span> <span id="13004" class="Symbol">→</span> <span id="13006" class="Symbol">(∀</span> <span id="13009" class="Symbol">{</span><a id="13010" href="#13010" class="Bound">τ</a><span id="13011" class="Symbol">}</span> <span id="13013" class="Symbol">→</span> <a id="13015" href="#9811" class="Datatype">Intr</a> <a id="13020" href="#12907" class="Bound">%A1</a> <a id="13024" href="#12915" class="Bound">%V1</a> <a id="13028" href="#13010" class="Bound">τ</a> <span id="13030" class="Symbol">→</span> <a id="13032" href="#9811" class="Datatype">Intr</a> <a id="13037" href="#12911" class="Bound">%A2</a> <a id="13041" href="#12919" class="Bound">%V2</a> <a id="13045" href="#13010" class="Bound">τ</a><span id="13046" class="Symbol">)</span>
  <a id="13050" href="#12888" class="Function">mapIntr</a> <a id="13058" href="#13058" class="Bound">%mapA</a> <a id="13064" href="#13064" class="Bound">%mapV</a> <span id="13070" class="Symbol">(</span><a id="13071" href="#9949" class="InductiveConstructor">intrArrow</a> <a id="13081" href="#13081" class="Bound">abs</a><span id="13084" class="Symbol">)</span>           <span id="13096" class="Symbol">=</span> <a id="13098" href="#9949" class="InductiveConstructor">intrArrow</a> <span id="13108" class="Symbol">(</span><a id="13109" href="#13058" class="Bound">%mapA</a> <a id="13115" href="#13081" class="Bound">abs</a><span id="13118" class="Symbol">)</span> 
  <a id="13123" href="#12888" class="Function">mapIntr</a> <a id="13131" href="#13131" class="Bound">%mapA</a> <a id="13137" href="#13137" class="Bound">%mapV</a> <span id="13143" class="Symbol">(</span><a id="13144" href="#10102" class="InductiveConstructor">intrSum</a> <a id="13152" href="#13152" class="Bound">vᵢ</a><span id="13154" class="Symbol">)</span>              <span id="13169" class="Symbol">=</span> <a id="13171" href="#10102" class="InductiveConstructor">intrSum</a> <span id="13179" class="Symbol">(</span><a id="13180" href="#4801" class="Function">mapAny</a> <a id="13187" href="#13137" class="Bound">%mapV</a> <a id="13193" href="#13152" class="Bound">vᵢ</a><span id="13195" class="Symbol">)</span>
  <a id="13199" href="#12888" class="Function">mapIntr</a> <a id="13207" href="#13207" class="Bound">%mapA</a> <a id="13213" href="#13213" class="Bound">%mapV</a> <span id="13219" class="Symbol">(</span><a id="13220" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="13232" href="#13232" class="Bound">vs</a><span id="13234" class="Symbol">)</span>          <span id="13245" class="Symbol">=</span> <a id="13247" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="13259" class="Symbol">(</span><a id="13260" href="#4616" class="Function">mapAll</a> <a id="13267" href="#13213" class="Bound">%mapV</a> <a id="13273" href="#13232" class="Bound">vs</a><span id="13275" class="Symbol">)</span>
  <a id="13279" href="#12888" class="Function">mapIntr</a> <a id="13287" href="#13287" class="Bound">%mapA</a> <a id="13293" href="#13293" class="Bound">%mapV</a> <span id="13299" class="Symbol">(</span><a id="13300" href="#10481" class="InductiveConstructor">intrNat</a> <a id="13308" href="#13308" class="Bound">v</a><span id="13309" class="Symbol">)</span>               <span id="13325" class="Symbol">=</span> <a id="13327" href="#10481" class="InductiveConstructor">intrNat</a> <span id="13335" class="Symbol">(</span><a id="13336" href="#13293" class="Bound">%mapV</a> <a id="13342" href="#13308" class="Bound">v</a><span id="13343" class="Symbol">)</span>
  <a id="13347" href="#12888" class="Function">mapIntr</a> <a id="13355" href="#13355" class="Bound">%mapA</a> <a id="13361" href="#13361" class="Bound">%mapV</a> <span id="13367" class="Symbol">(</span><a id="13368" href="#10848" class="InductiveConstructor">intrConat</a> <span id="13378" class="Symbol">(</span><a id="13379" href="#13379" class="Bound">ρ</a> <a id="13381" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="13384" href="#13384" class="Bound">v</a> <a id="13386" href="#2431" class="InductiveConstructor Operator">,</a> <a id="13388" href="#13388" class="Bound">f</a><span id="13389" class="Symbol">))</span>  <span id="13393" class="Symbol">=</span> <a id="13395" href="#10848" class="InductiveConstructor">intrConat</a> <span id="13405" class="Symbol">(</span><a id="13406" href="#13379" class="Bound">ρ</a> <a id="13408" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="13411" href="#13361" class="Bound">%mapV</a> <a id="13417" href="#13384" class="Bound">v</a> <a id="13419" href="#2431" class="InductiveConstructor Operator">,</a> <a id="13421" href="#13361" class="Bound">%mapV</a> <a id="13427" href="#13388" class="Bound">f</a><span id="13428" class="Symbol">)</span>
  <a id="13432" href="#12888" class="Function">mapIntr</a> <a id="13440" href="#13440" class="Bound">%mapA</a> <a id="13446" href="#13446" class="Bound">%mapV</a> <span id="13452" class="Symbol">(</span><a id="13453" href="#11212" class="InductiveConstructor">intrStream</a> <span id="13464" class="Symbol">(</span><a id="13465" href="#13465" class="Bound">ρ</a> <a id="13467" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="13470" href="#13470" class="Bound">v</a> <a id="13472" href="#2431" class="InductiveConstructor Operator">,</a> <a id="13474" href="#13474" class="Bound">f</a><span id="13475" class="Symbol">))</span> <span id="13478" class="Symbol">=</span> <a id="13480" href="#11212" class="InductiveConstructor">intrStream</a> <span id="13491" class="Symbol">(</span><a id="13492" href="#13465" class="Bound">ρ</a> <a id="13494" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="13497" href="#13446" class="Bound">%mapV</a> <a id="13503" href="#13470" class="Bound">v</a> <a id="13505" href="#2431" class="InductiveConstructor Operator">,</a> <a id="13507" href="#13446" class="Bound">%mapV</a> <a id="13513" href="#13474" class="Bound">f</a><span id="13514" class="Symbol">)</span>

  <span id="13519" class="Comment">-- Functorial map for Elim</span>
  <a id="4:Utensils.mapElim"></a><a id="13548" href="#13548" class="Function">mapElim</a> <span id="13556" class="Symbol">:</span> <span id="13558" class="Symbol">∀</span> <span id="13560" class="Symbol">{</span><a id="13561" href="#13561" class="Bound">%V1</a> <a id="13565" href="#13565" class="Bound">%V2</a><span id="13568" class="Symbol">}</span> <span id="13570" class="Symbol">→</span> <span id="13572" class="Symbol">(</span><a id="13573" href="#13573" class="Bound">%mapV</a> <span id="13579" class="Symbol">:</span> <span id="13581" class="Symbol">∀</span> <span id="13583" class="Symbol">{</span><a id="13584" href="#13584" class="Bound">τ</a><span id="13585" class="Symbol">}</span> <span id="13587" class="Symbol">→</span> <a id="13589" href="#13561" class="Bound">%V1</a> <a id="13593" href="#13584" class="Bound">τ</a> <span id="13595" class="Symbol">→</span> <a id="13597" href="#13565" class="Bound">%V2</a> <a id="13601" href="#13584" class="Bound">τ</a><span id="13602" class="Symbol">)</span> <span id="13604" class="Symbol">→</span> <span id="13606" class="Symbol">(∀</span> <span id="13609" class="Symbol">{</span><a id="13610" href="#13610" class="Bound">τ</a> <a id="13612" href="#13612" class="Bound">ϕ</a><span id="13613" class="Symbol">}</span> <span id="13615" class="Symbol">→</span> <a id="13617" href="#11351" class="Datatype">Elim</a> <a id="13622" href="#13561" class="Bound">%V1</a> <a id="13626" href="#13610" class="Bound">τ</a> <a id="13628" href="#13612" class="Bound">ϕ</a> <span id="13630" class="Symbol">→</span> <a id="13632" href="#11351" class="Datatype">Elim</a> <a id="13637" href="#13565" class="Bound">%V2</a> <a id="13641" href="#13610" class="Bound">τ</a> <a id="13643" href="#13612" class="Bound">ϕ</a><span id="13644" class="Symbol">)</span>
  <a id="13648" href="#13548" class="Function">mapElim</a> <a id="13656" href="#13656" class="Bound">%mapV</a> <span id="13662" class="Symbol">(</span><a id="13663" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="13673" href="#13673" class="Bound">v</a><span id="13674" class="Symbol">)</span>   <span id="13678" class="Symbol">=</span> <a id="13680" href="#11493" class="InductiveConstructor">elimArrow</a> <span id="13690" class="Symbol">(</span><a id="13691" href="#13656" class="Bound">%mapV</a> <a id="13697" href="#13673" class="Bound">v</a><span id="13698" class="Symbol">)</span>
  <a id="13702" href="#13548" class="Function">mapElim</a> <a id="13710" href="#13710" class="Bound">%mapV</a> <span id="13716" class="Symbol">(</span><a id="13717" href="#11670" class="InductiveConstructor">elimSum</a> <a id="13725" href="#13725" class="Bound">fs</a><span id="13727" class="Symbol">)</span>    <span id="13732" class="Symbol">=</span> <a id="13734" href="#11670" class="InductiveConstructor">elimSum</a> <span id="13742" class="Symbol">(</span><a id="13743" href="#4616" class="Function">mapAll</a> <a id="13750" href="#13710" class="Bound">%mapV</a> <a id="13756" href="#13725" class="Bound">fs</a><span id="13758" class="Symbol">)</span>
  <a id="13762" href="#13548" class="Function">mapElim</a> <a id="13770" href="#13770" class="Bound">%mapV</a> <span id="13776" class="Symbol">(</span><a id="13777" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="13789" href="#13789" class="Bound">i</a><span id="13790" class="Symbol">)</span> <span id="13792" class="Symbol">=</span> <a id="13794" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="13806" href="#13789" class="Bound">i</a>
  <a id="13810" href="#13548" class="Function">mapElim</a> <a id="13818" href="#13818" class="Bound">%mapV</a> <span id="13824" class="Symbol">(</span><a id="13825" href="#11950" class="InductiveConstructor">elimNat</a> <a id="13833" href="#13833" class="Bound">f</a><span id="13834" class="Symbol">)</span>     <span id="13840" class="Symbol">=</span> <a id="13842" href="#11950" class="InductiveConstructor">elimNat</a> <span id="13850" class="Symbol">(</span><a id="13851" href="#13818" class="Bound">%mapV</a> <a id="13857" href="#13833" class="Bound">f</a><span id="13858" class="Symbol">)</span>
  <a id="13862" href="#13548" class="Function">mapElim</a> <a id="13870" href="#13870" class="Bound">%mapV</a>  <a id="13877" href="#12146" class="InductiveConstructor">elimConat</a>      <span id="13892" class="Symbol">=</span> <a id="13894" href="#12146" class="InductiveConstructor">elimConat</a>
  <a id="13906" href="#13548" class="Function">mapElim</a> <a id="13914" href="#13914" class="Bound">%mapV</a>  <a id="13921" href="#12326" class="InductiveConstructor">elimStream</a>     <span id="13936" class="Symbol">=</span> <a id="13938" href="#12326" class="InductiveConstructor">elimStream</a>

  <span id="13952" class="Comment">-- Functorial map for Expr</span>
  <a id="4:Utensils.mapExpr"></a><a id="13981" href="#13981" class="Function">mapExpr</a>
      <span id="13995" class="Symbol">:</span> <span id="13997" class="Symbol">∀</span> <span id="13999" class="Symbol">{</span><a id="14000" href="#14000" class="Bound">%A1</a> <a id="14004" href="#14004" class="Bound">%A2</a> <a id="14008" href="#14008" class="Bound">%V1</a> <a id="14012" href="#14012" class="Bound">%V2</a><span id="14015" class="Symbol">}</span>
      <span id="14023" class="Symbol">→</span> <span id="14025" class="Symbol">(</span><a id="14026" href="#14026" class="Bound">%mapA</a> <span id="14032" class="Symbol">:</span> <span id="14034" class="Symbol">∀</span> <span id="14036" class="Symbol">{</span><a id="14037" href="#14037" class="Bound">ρ</a> <a id="14039" href="#14039" class="Bound">τ</a><span id="14040" class="Symbol">}</span> <span id="14042" class="Symbol">→</span> <a id="14044" href="#14000" class="Bound">%A1</a> <a id="14048" href="#14037" class="Bound">ρ</a> <a id="14050" href="#14039" class="Bound">τ</a> <span id="14052" class="Symbol">→</span> <a id="14054" href="#14004" class="Bound">%A2</a> <a id="14058" href="#14037" class="Bound">ρ</a> <a id="14060" href="#14039" class="Bound">τ</a><span id="14061" class="Symbol">)</span> <span id="14063" class="Symbol">→</span> <span id="14065" class="Symbol">(</span><a id="14066" href="#14066" class="Bound">%mapV</a> <span id="14072" class="Symbol">:</span> <span id="14074" class="Symbol">∀</span> <span id="14076" class="Symbol">{</span><a id="14077" href="#14077" class="Bound">τ</a><span id="14078" class="Symbol">}</span> <span id="14080" class="Symbol">→</span> <a id="14082" href="#14008" class="Bound">%V1</a> <a id="14086" href="#14077" class="Bound">τ</a> <span id="14088" class="Symbol">→</span> <a id="14090" href="#14012" class="Bound">%V2</a> <a id="14094" href="#14077" class="Bound">τ</a><span id="14095" class="Symbol">)</span> <span id="14097" class="Symbol">→</span> <span id="14099" class="Symbol">(∀</span> <span id="14102" class="Symbol">{</span><a id="14103" href="#14103" class="Bound">τ</a><span id="14104" class="Symbol">}</span> <span id="14106" class="Symbol">→</span> <a id="14108" href="#12502" class="Datatype">Expr</a> <a id="14113" href="#14000" class="Bound">%A1</a> <a id="14117" href="#14008" class="Bound">%V1</a> <a id="14121" href="#14103" class="Bound">τ</a> <span id="14123" class="Symbol">→</span> <a id="14125" href="#12502" class="Datatype">Expr</a> <a id="14130" href="#14004" class="Bound">%A2</a> <a id="14134" href="#14012" class="Bound">%V2</a> <a id="14138" href="#14103" class="Bound">τ</a><span id="14139" class="Symbol">)</span>
  <a id="14143" href="#13981" class="Function">mapExpr</a> <a id="14151" href="#14151" class="Bound">%mapA</a> <a id="14157" href="#14157" class="Bound">%mapV</a> <span id="14163" class="Symbol">(</span><a id="14164" href="#12591" class="InductiveConstructor">intr</a> <a id="14169" href="#14169" class="Bound">rule</a><span id="14173" class="Symbol">)</span>       <span id="14181" class="Symbol">=</span> <a id="14183" href="#12591" class="InductiveConstructor">intr</a> <span id="14188" class="Symbol">(</span><a id="14189" href="#12888" class="Function">mapIntr</a> <a id="14197" href="#14151" class="Bound">%mapA</a> <a id="14203" href="#14157" class="Bound">%mapV</a> <a id="14209" href="#14169" class="Bound">rule</a><span id="14213" class="Symbol">)</span>
  <a id="14217" href="#13981" class="Function">mapExpr</a> <a id="14225" href="#14225" class="Bound">%mapA</a> <a id="14231" href="#14231" class="Bound">%mapV</a> <span id="14237" class="Symbol">(</span><a id="14238" href="#12666" class="InductiveConstructor">elim</a> <a id="14243" href="#14243" class="Bound">value</a> <a id="14249" href="#14249" class="Bound">rule</a><span id="14253" class="Symbol">)</span> <span id="14255" class="Symbol">=</span> <a id="14257" href="#12666" class="InductiveConstructor">elim</a> <span id="14262" class="Symbol">(</span><a id="14263" href="#14231" class="Bound">%mapV</a> <a id="14269" href="#14243" class="Bound">value</a><span id="14274" class="Symbol">)</span> <span id="14276" class="Symbol">(</span><a id="14277" href="#13548" class="Function">mapElim</a> <a id="14285" href="#14231" class="Bound">%mapV</a> <a id="14291" href="#14249" class="Bound">rule</a><span id="14295" class="Symbol">)</span>

  <span id="14300" class="Comment">-- 'AllIntr %AllA %AllV τ rule' states that:</span>
  <span id="14347" class="Comment">-- 1. all instances of '%A' in 'rule' satisfy '%AllA'</span>
  <span id="14403" class="Comment">-- 2. all instances of '%V' in 'rule' satisfy '%AllV'</span>
  <span id="14459" class="Keyword">data</span> <a id="4:Utensils.AllIntr"></a><a id="14464" href="#14464" class="Datatype">AllIntr</a>
      <span id="14478" class="Symbol">{</span><a id="14479" href="#14479" class="Bound">%A</a> <span id="14482" class="Symbol">:</span> <a id="14484" href="#8610" class="Datatype">Type</a> <span id="14489" class="Symbol">→</span> <a id="14491" href="#8610" class="Datatype">Type</a> <span id="14496" class="Symbol">→</span> <span id="14498" class="PrimitiveType">Set</span><span id="14501" class="Symbol">}</span> <span id="14503" class="Symbol">{</span><a id="14504" href="#14504" class="Bound">%V</a> <span id="14507" class="Symbol">:</span> <a id="14509" href="#8610" class="Datatype">Type</a> <span id="14514" class="Symbol">→</span> <span id="14516" class="PrimitiveType">Set</span><span id="14519" class="Symbol">}</span>
      <span id="14527" class="Symbol">(</span><a id="14528" href="#14528" class="Bound">%AllA</a> <span id="14534" class="Symbol">:</span> <span id="14536" class="Symbol">(</span><a id="14537" href="#14537" class="Bound">ρ</a> <a id="14539" href="#14539" class="Bound">τ</a> <span id="14541" class="Symbol">:</span> <a id="14543" href="#8610" class="Datatype">Type</a><span id="14547" class="Symbol">)</span> <span id="14549" class="Symbol">→</span> <a id="14551" href="#14479" class="Bound">%A</a> <a id="14554" href="#14537" class="Bound">ρ</a> <a id="14556" href="#14539" class="Bound">τ</a> <span id="14558" class="Symbol">→</span> <span id="14560" class="PrimitiveType">Set</span><span id="14563" class="Symbol">)</span> <span id="14565" class="Symbol">(</span><a id="14566" href="#14566" class="Bound">%AllV</a> <span id="14572" class="Symbol">:</span> <span id="14574" class="Symbol">(</span><a id="14575" href="#14575" class="Bound">τ</a> <span id="14577" class="Symbol">:</span> <a id="14579" href="#8610" class="Datatype">Type</a><span id="14583" class="Symbol">)</span> <span id="14585" class="Symbol">→</span> <a id="14587" href="#14504" class="Bound">%V</a> <a id="14590" href="#14575" class="Bound">τ</a> <span id="14592" class="Symbol">→</span> <span id="14594" class="PrimitiveType">Set</span><span id="14597" class="Symbol">)</span>
      <span id="14605" class="Symbol">:</span> <span id="14607" class="Symbol">∀</span> <a id="14609" href="#14609" class="Bound">τ</a> <span id="14611" class="Symbol">→</span> <a id="14613" href="#9811" class="Datatype">Intr</a> <a id="14618" href="#14479" class="Bound">%A</a> <a id="14621" href="#14504" class="Bound">%V</a> <a id="14624" href="#14609" class="Bound">τ</a> <span id="14626" class="Symbol">→</span> <span id="14628" class="PrimitiveType">Set</span> <span id="14632" class="Keyword">where</span>
    <a id="4:Utensils.AllIntr.mkAllIntrArrow"></a><a id="14642" href="#14642" class="InductiveConstructor">mkAllIntrArrow</a>   <span id="14659" class="Symbol">:</span> <span id="14661" class="Symbol">∀</span> <span id="14663" class="Symbol">{</span><a id="14664" href="#14664" class="Bound">ρ</a> <a id="14666" href="#14666" class="Bound">τ</a> <a id="14668" href="#14668" class="Bound">abs</a><span id="14671" class="Symbol">}</span> <span id="14673" class="Symbol">→</span> <a id="14675" href="#14528" class="Bound">%AllA</a> <a id="14681" href="#14664" class="Bound">ρ</a> <a id="14683" href="#14666" class="Bound">τ</a> <a id="14685" href="#14668" class="Bound">abs</a>                                        <span id="14728" class="Symbol">→</span> <a id="14730" href="#14464" class="Datatype">AllIntr</a> <span id="14738" class="Symbol">_</span> <span id="14740" class="Symbol">_</span> <span id="14742" class="Symbol">(</span><a id="14743" href="#14664" class="Bound">ρ</a> <a id="14745" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="14747" href="#14666" class="Bound">τ</a><span id="14748" class="Symbol">)</span>       <span id="14756" class="Symbol">(</span><a id="14757" href="#9949" class="InductiveConstructor">intrArrow</a> <a id="14767" href="#14668" class="Bound">abs</a><span id="14770" class="Symbol">)</span>
    <a id="4:Utensils.AllIntr.mkAllIntrSum"></a><a id="14776" href="#14776" class="InductiveConstructor">mkAllIntrSum</a>     <span id="14793" class="Symbol">:</span> <span id="14795" class="Symbol">∀</span> <span id="14797" class="Symbol">{</span><a id="14798" href="#14798" class="Bound">τs</a> <a id="14801" href="#14801" class="Bound">vᵢ</a><span id="14803" class="Symbol">}</span>   <span id="14807" class="Symbol">→</span> <a id="14809" href="#4219" class="Datatype">AllAny</a> <a id="14816" href="#14566" class="Bound">%AllV</a> <a id="14822" href="#14798" class="Bound">τs</a> <a id="14825" href="#14801" class="Bound">vᵢ</a>                                   <span id="14862" class="Symbol">→</span> <a id="14864" href="#14464" class="Datatype">AllIntr</a> <span id="14872" class="Symbol">_</span> <span id="14874" class="Symbol">_</span> <span id="14876" class="Symbol">(</span><a id="14877" href="#8677" class="InductiveConstructor">#Sum</a> <a id="14882" href="#14798" class="Bound">τs</a><span id="14884" class="Symbol">)</span>     <span id="14890" class="Symbol">(</span><a id="14891" href="#10102" class="InductiveConstructor">intrSum</a> <a id="14899" href="#14801" class="Bound">vᵢ</a><span id="14901" class="Symbol">)</span>
    <a id="4:Utensils.AllIntr.mkAllIntrProduct"></a><a id="14907" href="#14907" class="InductiveConstructor">mkAllIntrProduct</a> <span id="14924" class="Symbol">:</span> <span id="14926" class="Symbol">∀</span> <span id="14928" class="Symbol">{</span><a id="14929" href="#14929" class="Bound">τs</a> <a id="14932" href="#14932" class="Bound">vs</a><span id="14934" class="Symbol">}</span>   <span id="14938" class="Symbol">→</span> <a id="14940" href="#3956" class="Datatype">All2</a> <a id="14945" href="#14566" class="Bound">%AllV</a> <a id="14951" href="#14929" class="Bound">τs</a> <a id="14954" href="#14932" class="Bound">vs</a>                                     <span id="14993" class="Symbol">→</span> <a id="14995" href="#14464" class="Datatype">AllIntr</a> <span id="15003" class="Symbol">_</span> <span id="15005" class="Symbol">_</span> <span id="15007" class="Symbol">(</span><a id="15008" href="#8737" class="InductiveConstructor">#Product</a> <a id="15017" href="#14929" class="Bound">τs</a><span id="15019" class="Symbol">)</span> <span id="15021" class="Symbol">(</span><a id="15022" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="15034" href="#14932" class="Bound">vs</a><span id="15036" class="Symbol">)</span>
    <a id="4:Utensils.AllIntr.mkAllIntrNat"></a><a id="15042" href="#15042" class="InductiveConstructor">mkAllIntrNat</a>     <span id="15059" class="Symbol">:</span> <span id="15061" class="Symbol">∀</span> <span id="15063" class="Symbol">{</span><a id="15064" href="#15064" class="Bound">v</a><span id="15065" class="Symbol">}</span>       <span id="15073" class="Symbol">→</span> <a id="15075" href="#14566" class="Bound">%AllV</a> <span id="15081" class="Symbol">(</span><a id="15082" href="#9349" class="Function">#Maybe</a> <a id="15089" href="#8801" class="InductiveConstructor">#Nat</a><span id="15093" class="Symbol">)</span> <a id="15095" href="#15064" class="Bound">v</a>                                <span id="15128" class="Symbol">→</span> <a id="15130" href="#14464" class="Datatype">AllIntr</a> <span id="15138" class="Symbol">_</span> <span id="15140" class="Symbol">_</span>  <a id="15143" href="#8801" class="InductiveConstructor">#Nat</a>         <span id="15156" class="Symbol">(</span><a id="15157" href="#10481" class="InductiveConstructor">intrNat</a> <a id="15165" href="#15064" class="Bound">v</a><span id="15166" class="Symbol">)</span>
    <a id="4:Utensils.AllIntr.mkAllIntrConat"></a><a id="15172" href="#15172" class="InductiveConstructor">mkAllIntrConat</a>   <span id="15189" class="Symbol">:</span> <span id="15191" class="Symbol">∀</span> <span id="15193" class="Symbol">{</span><a id="15194" href="#15194" class="Bound">r</a><span id="15195" class="Symbol">}</span>       <span id="15203" class="Symbol">→</span> <a id="15205" href="#3753" class="Datatype">AllΣ</a> <span id="15210" class="Symbol">(\</span><a id="15212" href="#15212" class="Bound">ρ</a> <span id="15214" class="Symbol">→</span> <a id="15216" href="#3578" class="Datatype">All×</a> <span id="15221" class="Symbol">(</span><a id="15222" href="#14566" class="Bound">%AllV</a> <a id="15228" href="#15212" class="Bound">ρ</a><span id="15229" class="Symbol">)</span> <span id="15231" class="Symbol">(</span><a id="15232" href="#14566" class="Bound">%AllV</a> <span id="15238" class="Symbol">(</span><a id="15239" href="#15212" class="Bound">ρ</a> <a id="15241" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="15243" href="#9349" class="Function">#Maybe</a> <a id="15250" href="#15212" class="Bound">ρ</a><span id="15251" class="Symbol">)))</span> <a id="15255" href="#15194" class="Bound">r</a>  <span id="15258" class="Symbol">→</span> <a id="15260" href="#14464" class="Datatype">AllIntr</a> <span id="15268" class="Symbol">_</span> <span id="15270" class="Symbol">_</span>  <a id="15273" href="#8853" class="InductiveConstructor">#Conat</a>       <span id="15286" class="Symbol">(</span><a id="15287" href="#10848" class="InductiveConstructor">intrConat</a> <a id="15297" href="#15194" class="Bound">r</a><span id="15298" class="Symbol">)</span>
    <a id="4:Utensils.AllIntr.mkAllIntrStream"></a><a id="15304" href="#15304" class="InductiveConstructor">mkAllIntrStream</a>  <span id="15321" class="Symbol">:</span> <span id="15323" class="Symbol">∀</span> <span id="15325" class="Symbol">{</span><a id="15326" href="#15326" class="Bound">τ</a> <a id="15328" href="#15328" class="Bound">r</a><span id="15329" class="Symbol">}</span>     <span id="15335" class="Symbol">→</span> <a id="15337" href="#3753" class="Datatype">AllΣ</a> <span id="15342" class="Symbol">(\</span><a id="15344" href="#15344" class="Bound">ρ</a> <span id="15346" class="Symbol">→</span> <a id="15348" href="#3578" class="Datatype">All×</a> <span id="15353" class="Symbol">(</span><a id="15354" href="#14566" class="Bound">%AllV</a> <a id="15360" href="#15344" class="Bound">ρ</a><span id="15361" class="Symbol">)</span> <span id="15363" class="Symbol">(</span><a id="15364" href="#14566" class="Bound">%AllV</a> <span id="15370" class="Symbol">(</span><a id="15371" href="#15344" class="Bound">ρ</a> <a id="15373" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="15375" href="#9217" class="Function">#Pair</a> <a id="15381" href="#15326" class="Bound">τ</a> <a id="15383" href="#15344" class="Bound">ρ</a><span id="15384" class="Symbol">)))</span> <a id="15388" href="#15328" class="Bound">r</a> <span id="15390" class="Symbol">→</span> <a id="15392" href="#14464" class="Datatype">AllIntr</a> <span id="15400" class="Symbol">_</span> <span id="15402" class="Symbol">_</span> <span id="15404" class="Symbol">(</span><a id="15405" href="#8937" class="InductiveConstructor">#Stream</a> <a id="15413" href="#15326" class="Bound">τ</a><span id="15414" class="Symbol">)</span>   <span id="15418" class="Symbol">(</span><a id="15419" href="#11212" class="InductiveConstructor">intrStream</a> <a id="15430" href="#15328" class="Bound">r</a><span id="15431" class="Symbol">)</span>

  <span id="15436" class="Comment">-- 'AllElim %AllV τ ϕ rule' states that all instances of '%V' in 'rule' satisfy '%AllV'</span>
  <span id="15526" class="Keyword">data</span> <a id="4:Utensils.AllElim"></a><a id="15531" href="#15531" class="Datatype">AllElim</a> <span id="15539" class="Symbol">{</span><a id="15540" href="#15540" class="Bound">%V</a> <span id="15543" class="Symbol">:</span> <a id="15545" href="#8610" class="Datatype">Type</a> <span id="15550" class="Symbol">→</span> <span id="15552" class="PrimitiveType">Set</span><span id="15555" class="Symbol">}</span> <span id="15557" class="Symbol">(</span><a id="15558" href="#15558" class="Bound">%AllV</a> <span id="15564" class="Symbol">:</span> <span id="15566" class="Symbol">(</span><a id="15567" href="#15567" class="Bound">τ</a> <span id="15569" class="Symbol">:</span> <a id="15571" href="#8610" class="Datatype">Type</a><span id="15575" class="Symbol">)</span> <span id="15577" class="Symbol">→</span> <a id="15579" href="#15540" class="Bound">%V</a> <a id="15582" href="#15567" class="Bound">τ</a> <span id="15584" class="Symbol">→</span> <span id="15586" class="PrimitiveType">Set</span><span id="15589" class="Symbol">)</span> <span id="15591" class="Symbol">:</span> <span id="15593" class="Symbol">∀</span> <a id="15595" href="#15595" class="Bound">τ</a> <a id="15597" href="#15597" class="Bound">ϕ</a> <span id="15599" class="Symbol">→</span> <a id="15601" href="#11351" class="Datatype">Elim</a> <a id="15606" href="#15540" class="Bound">%V</a> <a id="15609" href="#15595" class="Bound">τ</a> <a id="15611" href="#15597" class="Bound">ϕ</a> <span id="15613" class="Symbol">→</span> <span id="15615" class="PrimitiveType">Set</span> <span id="15619" class="Keyword">where</span>
    <a id="4:Utensils.AllElim.mkAllElimArrow"></a><a id="15629" href="#15629" class="InductiveConstructor">mkAllElimArrow</a>   <span id="15646" class="Symbol">:</span> <span id="15648" class="Symbol">∀</span> <span id="15650" class="Symbol">{</span><a id="15651" href="#15651" class="Bound">ρ</a> <a id="15653" href="#15653" class="Bound">τ</a> <a id="15655" href="#15655" class="Bound">v</a><span id="15656" class="Symbol">}</span>   <span id="15660" class="Symbol">→</span> <a id="15662" href="#15558" class="Bound">%AllV</a> <a id="15668" href="#15651" class="Bound">ρ</a> <a id="15670" href="#15655" class="Bound">v</a>                        <span id="15695" class="Symbol">→</span> <a id="15697" href="#15531" class="Datatype">AllElim</a> <span id="15705" class="Symbol">_</span> <span id="15707" class="Symbol">(</span><a id="15708" href="#15651" class="Bound">ρ</a> <a id="15710" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="15712" href="#15653" class="Bound">τ</a><span id="15713" class="Symbol">)</span>       <a id="15721" href="#15653" class="Bound">τ</a>                   <span id="15741" class="Symbol">(</span><a id="15742" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="15752" href="#15655" class="Bound">v</a><span id="15753" class="Symbol">)</span>
    <a id="4:Utensils.AllElim.mkAllElimSum"></a><a id="15759" href="#15759" class="InductiveConstructor">mkAllElimSum</a>     <span id="15776" class="Symbol">:</span> <span id="15778" class="Symbol">∀</span> <span id="15780" class="Symbol">{</span><a id="15781" href="#15781" class="Bound">τs</a> <a id="15784" href="#15784" class="Bound">ϕ</a> <a id="15786" href="#15786" class="Bound">fs</a><span id="15788" class="Symbol">}</span> <span id="15790" class="Symbol">→</span> <a id="15792" href="#3956" class="Datatype">All2</a> <span id="15797" class="Symbol">(\</span><a id="15799" href="#15799" class="Bound">τ</a> <span id="15801" class="Symbol">→</span> <a id="15803" href="#15558" class="Bound">%AllV</a> <span id="15809" class="Symbol">(</span><a id="15810" href="#15799" class="Bound">τ</a> <a id="15812" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="15814" href="#15784" class="Bound">ϕ</a><span id="15815" class="Symbol">))</span> <a id="15818" href="#15781" class="Bound">τs</a> <a id="15821" href="#15786" class="Bound">fs</a>  <span id="15825" class="Symbol">→</span> <a id="15827" href="#15531" class="Datatype">AllElim</a> <span id="15835" class="Symbol">_</span> <span id="15837" class="Symbol">(</span><a id="15838" href="#8677" class="InductiveConstructor">#Sum</a> <a id="15843" href="#15781" class="Bound">τs</a><span id="15845" class="Symbol">)</span>     <a id="15851" href="#15784" class="Bound">ϕ</a>                   <span id="15871" class="Symbol">(</span><a id="15872" href="#11670" class="InductiveConstructor">elimSum</a> <a id="15880" href="#15786" class="Bound">fs</a><span id="15882" class="Symbol">)</span>
    <a id="4:Utensils.AllElim.mkAllElimProduct"></a><a id="15888" href="#15888" class="InductiveConstructor">mkAllElimProduct</a> <span id="15905" class="Symbol">:</span> <span id="15907" class="Symbol">∀</span> <span id="15909" class="Symbol">{</span><a id="15910" href="#15910" class="Bound">τs</a> <a id="15913" href="#15913" class="Bound">τ</a><span id="15914" class="Symbol">}</span>    <span id="15919" class="Symbol">→</span> <span id="15921" class="Symbol">(</span><a id="15922" href="#15922" class="Bound">i</a> <span id="15924" class="Symbol">:</span> <a id="15926" href="#3432" class="Function">Has</a> <a id="15930" href="#15910" class="Bound">τs</a> <a id="15933" href="#15913" class="Bound">τ</a><span id="15934" class="Symbol">)</span>                   <span id="15954" class="Symbol">→</span> <a id="15956" href="#15531" class="Datatype">AllElim</a> <span id="15964" class="Symbol">_</span> <span id="15966" class="Symbol">(</span><a id="15967" href="#8737" class="InductiveConstructor">#Product</a> <a id="15976" href="#15910" class="Bound">τs</a><span id="15978" class="Symbol">)</span> <a id="15980" href="#15913" class="Bound">τ</a>                   <span id="16000" class="Symbol">(</span><a id="16001" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="16013" href="#15922" class="Bound">i</a><span id="16014" class="Symbol">)</span>
    <a id="4:Utensils.AllElim.mkAllElimNat"></a><a id="16020" href="#16020" class="InductiveConstructor">mkAllElimNat</a>     <span id="16037" class="Symbol">:</span> <span id="16039" class="Symbol">∀</span> <span id="16041" class="Symbol">{</span><a id="16042" href="#16042" class="Bound">ϕ</a> <a id="16044" href="#16044" class="Bound">f</a><span id="16045" class="Symbol">}</span>     <span id="16051" class="Symbol">→</span> <a id="16053" href="#15558" class="Bound">%AllV</a> <span id="16059" class="Symbol">(</span><a id="16060" href="#9349" class="Function">#Maybe</a> <a id="16067" href="#16042" class="Bound">ϕ</a> <a id="16069" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="16071" href="#16042" class="Bound">ϕ</a><span id="16072" class="Symbol">)</span> <a id="16074" href="#16044" class="Bound">f</a>           <span id="16086" class="Symbol">→</span> <a id="16088" href="#15531" class="Datatype">AllElim</a> <span id="16096" class="Symbol">_</span>  <a id="16099" href="#8801" class="InductiveConstructor">#Nat</a>         <a id="16112" href="#16042" class="Bound">ϕ</a>                   <span id="16132" class="Symbol">(</span><a id="16133" href="#11950" class="InductiveConstructor">elimNat</a> <a id="16141" href="#16044" class="Bound">f</a><span id="16142" class="Symbol">)</span>
    <a id="4:Utensils.AllElim.mkAllElimConat"></a><a id="16148" href="#16148" class="InductiveConstructor">mkAllElimConat</a>   <span id="16165" class="Symbol">:</span>                                                  <a id="16216" href="#15531" class="Datatype">AllElim</a> <span id="16224" class="Symbol">_</span>  <a id="16227" href="#8853" class="InductiveConstructor">#Conat</a>      <span id="16239" class="Symbol">(</span><a id="16240" href="#9349" class="Function">#Maybe</a> <a id="16247" href="#8853" class="InductiveConstructor">#Conat</a><span id="16253" class="Symbol">)</span>       <a id="16261" href="#12146" class="InductiveConstructor">elimConat</a>
    <a id="4:Utensils.AllElim.mkAllElimStream"></a><a id="16275" href="#16275" class="InductiveConstructor">mkAllElimStream</a>  <span id="16292" class="Symbol">:</span> <span id="16294" class="Symbol">∀</span> <span id="16296" class="Symbol">{</span><a id="16297" href="#16297" class="Bound">τ</a><span id="16298" class="Symbol">}</span>                                          <span id="16341" class="Symbol">→</span> <a id="16343" href="#15531" class="Datatype">AllElim</a> <span id="16351" class="Symbol">_</span> <span id="16353" class="Symbol">(</span><a id="16354" href="#8937" class="InductiveConstructor">#Stream</a> <a id="16362" href="#16297" class="Bound">τ</a><span id="16363" class="Symbol">)</span>  <span id="16366" class="Symbol">(</span><a id="16367" href="#9217" class="Function">#Pair</a> <a id="16373" href="#16297" class="Bound">τ</a> <span id="16375" class="Symbol">(</span><a id="16376" href="#8937" class="InductiveConstructor">#Stream</a> <a id="16384" href="#16297" class="Bound">τ</a><span id="16385" class="Symbol">))</span> <a id="16388" href="#12326" class="InductiveConstructor">elimStream</a>

  <span id="16402" class="Comment">-- Functorial map for AllIntr</span>
  <a id="4:Utensils.mapAllIntr"></a><a id="16434" href="#16434" class="Function">mapAllIntr</a>
      <span id="16451" class="Symbol">:</span> <span id="16453" class="Symbol">{</span><a id="16454" href="#16454" class="Bound">%A1</a> <a id="16458" href="#16458" class="Bound">%A2</a> <span id="16462" class="Symbol">:</span> <a id="16464" href="#8610" class="Datatype">Type</a> <span id="16469" class="Symbol">→</span> <a id="16471" href="#8610" class="Datatype">Type</a> <span id="16476" class="Symbol">→</span> <span id="16478" class="PrimitiveType">Set</span><span id="16481" class="Symbol">}</span> <span id="16483" class="Symbol">→</span> <span id="16485" class="Symbol">{</span><a id="16486" href="#16486" class="Bound">%V1</a> <a id="16490" href="#16490" class="Bound">%V2</a> <span id="16494" class="Symbol">:</span> <a id="16496" href="#8610" class="Datatype">Type</a> <span id="16501" class="Symbol">→</span> <span id="16503" class="PrimitiveType">Set</span><span id="16506" class="Symbol">}</span>
      <span id="16514" class="Symbol">→</span> <span id="16516" class="Symbol">{</span><a id="16517" href="#16517" class="Bound">%AllA1</a> <span id="16524" class="Symbol">:</span> <span id="16526" class="Symbol">∀</span> <a id="16528" href="#16528" class="Bound">ρ</a> <a id="16530" href="#16530" class="Bound">τ</a> <span id="16532" class="Symbol">→</span> <a id="16534" href="#16454" class="Bound">%A1</a> <a id="16538" href="#16528" class="Bound">ρ</a> <a id="16540" href="#16530" class="Bound">τ</a> <span id="16542" class="Symbol">→</span> <span id="16544" class="PrimitiveType">Set</span><span id="16547" class="Symbol">}</span> <span id="16549" class="Symbol">{</span><a id="16550" href="#16550" class="Bound">%AllA2</a> <span id="16557" class="Symbol">:</span> <span id="16559" class="Symbol">∀</span> <a id="16561" href="#16561" class="Bound">ρ</a> <a id="16563" href="#16563" class="Bound">τ</a> <span id="16565" class="Symbol">→</span> <a id="16567" href="#16458" class="Bound">%A2</a> <a id="16571" href="#16561" class="Bound">ρ</a> <a id="16573" href="#16563" class="Bound">τ</a> <span id="16575" class="Symbol">→</span> <span id="16577" class="PrimitiveType">Set</span><span id="16580" class="Symbol">}</span> <span id="16582" class="Symbol">{</span><a id="16583" href="#16583" class="Bound">%AllV1</a> <span id="16590" class="Symbol">:</span> <span id="16592" class="Symbol">∀</span> <a id="16594" href="#16594" class="Bound">τ</a> <span id="16596" class="Symbol">→</span> <a id="16598" href="#16486" class="Bound">%V1</a> <a id="16602" href="#16594" class="Bound">τ</a> <span id="16604" class="Symbol">→</span> <span id="16606" class="PrimitiveType">Set</span><span id="16609" class="Symbol">}</span> <span id="16611" class="Symbol">{</span><a id="16612" href="#16612" class="Bound">%AllV2</a> <span id="16619" class="Symbol">:</span> <span id="16621" class="Symbol">∀</span> <a id="16623" href="#16623" class="Bound">τ</a> <span id="16625" class="Symbol">→</span> <a id="16627" href="#16490" class="Bound">%V2</a> <a id="16631" href="#16623" class="Bound">τ</a> <span id="16633" class="Symbol">→</span> <span id="16635" class="PrimitiveType">Set</span><span id="16638" class="Symbol">}</span>
      <span id="16646" class="Symbol">→</span> <span id="16648" class="Symbol">(</span><a id="16649" href="#16649" class="Bound">%mapA</a> <span id="16655" class="Symbol">:</span> <span id="16657" class="Symbol">∀</span> <span id="16659" class="Symbol">{</span><a id="16660" href="#16660" class="Bound">ρ</a> <a id="16662" href="#16662" class="Bound">τ</a><span id="16663" class="Symbol">}</span> <span id="16665" class="Symbol">→</span> <a id="16667" href="#16454" class="Bound">%A1</a> <a id="16671" href="#16660" class="Bound">ρ</a> <a id="16673" href="#16662" class="Bound">τ</a> <span id="16675" class="Symbol">→</span> <a id="16677" href="#16458" class="Bound">%A2</a> <a id="16681" href="#16660" class="Bound">ρ</a> <a id="16683" href="#16662" class="Bound">τ</a><span id="16684" class="Symbol">)</span>
      <span id="16692" class="Symbol">→</span> <span id="16694" class="Symbol">(</span><a id="16695" href="#16695" class="Bound">%mapV</a> <span id="16701" class="Symbol">:</span> <span id="16703" class="Symbol">∀</span> <span id="16705" class="Symbol">{</span><a id="16706" href="#16706" class="Bound">τ</a><span id="16707" class="Symbol">}</span> <span id="16709" class="Symbol">→</span> <a id="16711" href="#16486" class="Bound">%V1</a> <a id="16715" href="#16706" class="Bound">τ</a> <span id="16717" class="Symbol">→</span> <a id="16719" href="#16490" class="Bound">%V2</a> <a id="16723" href="#16706" class="Bound">τ</a><span id="16724" class="Symbol">)</span>
      <span id="16732" class="Symbol">→</span> <span id="16734" class="Symbol">(</span><a id="16735" href="#16735" class="Bound">%mapAllA</a> <span id="16744" class="Symbol">:</span> <span id="16746" class="Symbol">∀</span> <span id="16748" class="Symbol">{</span><a id="16749" href="#16749" class="Bound">ρ</a> <a id="16751" href="#16751" class="Bound">τ</a> <a id="16753" href="#16753" class="Bound">abs</a><span id="16756" class="Symbol">}</span> <span id="16758" class="Symbol">→</span> <a id="16760" href="#16517" class="Bound">%AllA1</a> <a id="16767" href="#16749" class="Bound">ρ</a> <a id="16769" href="#16751" class="Bound">τ</a> <a id="16771" href="#16753" class="Bound">abs</a> <span id="16775" class="Symbol">→</span> <a id="16777" href="#16550" class="Bound">%AllA2</a> <a id="16784" href="#16749" class="Bound">ρ</a> <a id="16786" href="#16751" class="Bound">τ</a> <span id="16788" class="Symbol">(</span><a id="16789" href="#16649" class="Bound">%mapA</a> <a id="16795" href="#16753" class="Bound">abs</a><span id="16798" class="Symbol">))</span>
      <span id="16807" class="Symbol">→</span> <span id="16809" class="Symbol">(</span><a id="16810" href="#16810" class="Bound">%mapAllV</a> <span id="16819" class="Symbol">:</span> <span id="16821" class="Symbol">∀</span> <span id="16823" class="Symbol">{</span><a id="16824" href="#16824" class="Bound">τ</a> <a id="16826" href="#16826" class="Bound">v</a><span id="16827" class="Symbol">}</span> <span id="16829" class="Symbol">→</span> <a id="16831" href="#16583" class="Bound">%AllV1</a> <a id="16838" href="#16824" class="Bound">τ</a> <a id="16840" href="#16826" class="Bound">v</a> <span id="16842" class="Symbol">→</span> <a id="16844" href="#16612" class="Bound">%AllV2</a> <a id="16851" href="#16824" class="Bound">τ</a> <span id="16853" class="Symbol">(</span><a id="16854" href="#16695" class="Bound">%mapV</a> <a id="16860" href="#16826" class="Bound">v</a><span id="16861" class="Symbol">))</span>
      <span id="16870" class="Symbol">→</span> <span id="16872" class="Symbol">∀</span> <span id="16874" class="Symbol">{</span><a id="16875" href="#16875" class="Bound">τ</a> <a id="16877" href="#16877" class="Bound">rule</a><span id="16881" class="Symbol">}</span> <span id="16883" class="Symbol">→</span> <a id="16885" href="#14464" class="Datatype">AllIntr</a> <a id="16893" href="#16517" class="Bound">%AllA1</a> <a id="16900" href="#16583" class="Bound">%AllV1</a> <a id="16907" href="#16875" class="Bound">τ</a> <a id="16909" href="#16877" class="Bound">rule</a> <span id="16914" class="Symbol">→</span> <a id="16916" href="#14464" class="Datatype">AllIntr</a> <a id="16924" href="#16550" class="Bound">%AllA2</a> <a id="16931" href="#16612" class="Bound">%AllV2</a> <a id="16938" href="#16875" class="Bound">τ</a> <span id="16940" class="Symbol">(</span><a id="16941" href="#12888" class="Function">mapIntr</a> <a id="16949" href="#16649" class="Bound">%mapA</a> <a id="16955" href="#16695" class="Bound">%mapV</a> <a id="16961" href="#16877" class="Bound">rule</a><span id="16965" class="Symbol">)</span>
  <a id="16969" href="#16434" class="Function">mapAllIntr</a> <a id="16980" href="#16980" class="Bound">%mapA</a> <a id="16986" href="#16986" class="Bound">%mapV</a> <a id="16992" href="#16992" class="Bound">%mapAllA</a> <a id="17001" href="#17001" class="Bound">%mapAllV</a> <span id="17010" class="Symbol">(</span><a id="17011" href="#14642" class="InductiveConstructor">mkAllIntrArrow</a> <a id="17026" href="#17026" class="Bound">abs</a><span id="17029" class="Symbol">)</span>           <span id="17041" class="Symbol">=</span> <a id="17043" href="#14642" class="InductiveConstructor">mkAllIntrArrow</a> <span id="17058" class="Symbol">(</span><a id="17059" href="#16992" class="Bound">%mapAllA</a> <a id="17068" href="#17026" class="Bound">abs</a><span id="17071" class="Symbol">)</span>
  <a id="17075" href="#16434" class="Function">mapAllIntr</a> <a id="17086" href="#17086" class="Bound">%mapA</a> <a id="17092" href="#17092" class="Bound">%mapV</a> <a id="17098" href="#17098" class="Bound">%mapAllA</a> <a id="17107" href="#17107" class="Bound">%mapAllV</a> <span id="17116" class="Symbol">(</span><a id="17117" href="#14776" class="InductiveConstructor">mkAllIntrSum</a> <a id="17130" href="#17130" class="Bound">vᵢ</a><span id="17132" class="Symbol">)</span>              <span id="17147" class="Symbol">=</span> <a id="17149" href="#14776" class="InductiveConstructor">mkAllIntrSum</a> <span id="17162" class="Symbol">(</span><a id="17163" href="#5361" class="Function">mapAllAny</a> <a id="17173" href="#17092" class="Bound">%mapV</a> <a id="17179" href="#17107" class="Bound">%mapAllV</a> <a id="17188" href="#17130" class="Bound">vᵢ</a><span id="17190" class="Symbol">)</span>
  <a id="17194" href="#16434" class="Function">mapAllIntr</a> <a id="17205" href="#17205" class="Bound">%mapA</a> <a id="17211" href="#17211" class="Bound">%mapV</a> <a id="17217" href="#17217" class="Bound">%mapAllA</a> <a id="17226" href="#17226" class="Bound">%mapAllV</a> <span id="17235" class="Symbol">(</span><a id="17236" href="#14907" class="InductiveConstructor">mkAllIntrProduct</a> <a id="17253" href="#17253" class="Bound">vs</a><span id="17255" class="Symbol">)</span>          <span id="17266" class="Symbol">=</span> <a id="17268" href="#14907" class="InductiveConstructor">mkAllIntrProduct</a> <span id="17285" class="Symbol">(</span><a id="17286" href="#5002" class="Function">mapAll2</a> <a id="17294" href="#17211" class="Bound">%mapV</a> <a id="17300" href="#17226" class="Bound">%mapAllV</a> <a id="17309" href="#17253" class="Bound">vs</a><span id="17311" class="Symbol">)</span>
  <a id="17315" href="#16434" class="Function">mapAllIntr</a> <a id="17326" href="#17326" class="Bound">%mapA</a> <a id="17332" href="#17332" class="Bound">%mapV</a> <a id="17338" href="#17338" class="Bound">%mapAllA</a> <a id="17347" href="#17347" class="Bound">%mapAllV</a> <span id="17356" class="Symbol">(</span><a id="17357" href="#15042" class="InductiveConstructor">mkAllIntrNat</a> <a id="17370" href="#17370" class="Bound">v</a><span id="17371" class="Symbol">)</span>               <span id="17387" class="Symbol">=</span> <a id="17389" href="#15042" class="InductiveConstructor">mkAllIntrNat</a> <span id="17402" class="Symbol">(</span><a id="17403" href="#17347" class="Bound">%mapAllV</a> <a id="17412" href="#17370" class="Bound">v</a><span id="17413" class="Symbol">)</span>
  <a id="17417" href="#16434" class="Function">mapAllIntr</a> <a id="17428" href="#17428" class="Bound">%mapA</a> <a id="17434" href="#17434" class="Bound">%mapV</a> <a id="17440" href="#17440" class="Bound">%mapAllA</a> <a id="17449" href="#17449" class="Bound">%mapAllV</a> <span id="17458" class="Symbol">(</span><a id="17459" href="#15172" class="InductiveConstructor">mkAllIntrConat</a> <span id="17474" class="Symbol">(</span><a id="17475" href="#17475" class="Bound">ρ</a> <a id="17477" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="17480" href="#17480" class="Bound">v</a> <a id="17482" href="#3647" class="InductiveConstructor Operator">,</a> <a id="17484" href="#17484" class="Bound">f</a><span id="17485" class="Symbol">))</span>  <span id="17489" class="Symbol">=</span> <a id="17491" href="#15172" class="InductiveConstructor">mkAllIntrConat</a> <span id="17506" class="Symbol">(</span><a id="17507" href="#17475" class="Bound">ρ</a> <a id="17509" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="17512" href="#17449" class="Bound">%mapAllV</a> <a id="17521" href="#17480" class="Bound">v</a> <a id="17523" href="#3647" class="InductiveConstructor Operator">,</a> <a id="17525" href="#17449" class="Bound">%mapAllV</a> <a id="17534" href="#17484" class="Bound">f</a><span id="17535" class="Symbol">)</span>
  <a id="17539" href="#16434" class="Function">mapAllIntr</a> <a id="17550" href="#17550" class="Bound">%mapA</a> <a id="17556" href="#17556" class="Bound">%mapV</a> <a id="17562" href="#17562" class="Bound">%mapAllA</a> <a id="17571" href="#17571" class="Bound">%mapAllV</a> <span id="17580" class="Symbol">(</span><a id="17581" href="#15304" class="InductiveConstructor">mkAllIntrStream</a> <span id="17597" class="Symbol">(</span><a id="17598" href="#17598" class="Bound">ρ</a> <a id="17600" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="17603" href="#17603" class="Bound">v</a> <a id="17605" href="#3647" class="InductiveConstructor Operator">,</a> <a id="17607" href="#17607" class="Bound">f</a><span id="17608" class="Symbol">))</span> <span id="17611" class="Symbol">=</span> <a id="17613" href="#15304" class="InductiveConstructor">mkAllIntrStream</a> <span id="17629" class="Symbol">(</span><a id="17630" href="#17598" class="Bound">ρ</a> <a id="17632" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="17635" href="#17571" class="Bound">%mapAllV</a> <a id="17644" href="#17603" class="Bound">v</a> <a id="17646" href="#3647" class="InductiveConstructor Operator">,</a> <a id="17648" href="#17571" class="Bound">%mapAllV</a> <a id="17657" href="#17607" class="Bound">f</a><span id="17658" class="Symbol">)</span>

  <span id="17663" class="Comment">-- Functorial map for AllElim</span>
  <a id="4:Utensils.mapAllElim"></a><a id="17695" href="#17695" class="Function">mapAllElim</a>
      <span id="17712" class="Symbol">:</span> <span id="17714" class="Symbol">{</span><a id="17715" href="#17715" class="Bound">%V1</a> <a id="17719" href="#17719" class="Bound">%V2</a> <span id="17723" class="Symbol">:</span> <a id="17725" href="#8610" class="Datatype">Type</a> <span id="17730" class="Symbol">→</span> <span id="17732" class="PrimitiveType">Set</span><span id="17735" class="Symbol">}</span> <span id="17737" class="Symbol">{</span><a id="17738" href="#17738" class="Bound">%AllV1</a> <span id="17745" class="Symbol">:</span> <span id="17747" class="Symbol">∀</span> <a id="17749" href="#17749" class="Bound">τ</a> <span id="17751" class="Symbol">→</span> <a id="17753" href="#17715" class="Bound">%V1</a> <a id="17757" href="#17749" class="Bound">τ</a> <span id="17759" class="Symbol">→</span> <span id="17761" class="PrimitiveType">Set</span><span id="17764" class="Symbol">}</span> <span id="17766" class="Symbol">{</span><a id="17767" href="#17767" class="Bound">%AllV2</a> <span id="17774" class="Symbol">:</span> <span id="17776" class="Symbol">∀</span> <a id="17778" href="#17778" class="Bound">τ</a> <span id="17780" class="Symbol">→</span> <a id="17782" href="#17719" class="Bound">%V2</a> <a id="17786" href="#17778" class="Bound">τ</a> <span id="17788" class="Symbol">→</span> <span id="17790" class="PrimitiveType">Set</span><span id="17793" class="Symbol">}</span>
      <span id="17801" class="Symbol">→</span> <span id="17803" class="Symbol">(</span><a id="17804" href="#17804" class="Bound">%mapV</a> <span id="17810" class="Symbol">:</span> <span id="17812" class="Symbol">∀</span> <span id="17814" class="Symbol">{</span><a id="17815" href="#17815" class="Bound">τ</a><span id="17816" class="Symbol">}</span> <span id="17818" class="Symbol">→</span> <a id="17820" href="#17715" class="Bound">%V1</a> <a id="17824" href="#17815" class="Bound">τ</a> <span id="17826" class="Symbol">→</span> <a id="17828" href="#17719" class="Bound">%V2</a> <a id="17832" href="#17815" class="Bound">τ</a><span id="17833" class="Symbol">)</span>
      <span id="17841" class="Symbol">→</span> <span id="17843" class="Symbol">(</span><a id="17844" href="#17844" class="Bound">%mapAllV</a> <span id="17853" class="Symbol">:</span> <span id="17855" class="Symbol">∀</span> <span id="17857" class="Symbol">{</span><a id="17858" href="#17858" class="Bound">τ</a> <a id="17860" href="#17860" class="Bound">v</a><span id="17861" class="Symbol">}</span> <span id="17863" class="Symbol">→</span> <a id="17865" href="#17738" class="Bound">%AllV1</a> <a id="17872" href="#17858" class="Bound">τ</a> <a id="17874" href="#17860" class="Bound">v</a> <span id="17876" class="Symbol">→</span> <a id="17878" href="#17767" class="Bound">%AllV2</a> <a id="17885" href="#17858" class="Bound">τ</a> <span id="17887" class="Symbol">(</span><a id="17888" href="#17804" class="Bound">%mapV</a> <a id="17894" href="#17860" class="Bound">v</a><span id="17895" class="Symbol">))</span>
      <span id="17904" class="Symbol">→</span> <span id="17906" class="Symbol">∀</span> <span id="17908" class="Symbol">{</span><a id="17909" href="#17909" class="Bound">τ</a> <a id="17911" href="#17911" class="Bound">ϕ</a> <a id="17913" href="#17913" class="Bound">rule</a><span id="17917" class="Symbol">}</span> <span id="17919" class="Symbol">→</span> <a id="17921" href="#15531" class="Datatype">AllElim</a> <a id="17929" href="#17738" class="Bound">%AllV1</a> <a id="17936" href="#17909" class="Bound">τ</a> <a id="17938" href="#17911" class="Bound">ϕ</a> <a id="17940" href="#17913" class="Bound">rule</a> <span id="17945" class="Symbol">→</span> <a id="17947" href="#15531" class="Datatype">AllElim</a> <a id="17955" href="#17767" class="Bound">%AllV2</a> <a id="17962" href="#17909" class="Bound">τ</a> <a id="17964" href="#17911" class="Bound">ϕ</a> <span id="17966" class="Symbol">(</span><a id="17967" href="#13548" class="Function">mapElim</a> <a id="17975" href="#17804" class="Bound">%mapV</a> <a id="17981" href="#17913" class="Bound">rule</a><span id="17985" class="Symbol">)</span>
  <a id="17989" href="#17695" class="Function">mapAllElim</a> <a id="18000" href="#18000" class="Bound">%mapV</a> <a id="18006" href="#18006" class="Bound">%mapAllV</a> <span id="18015" class="Symbol">(</span><a id="18016" href="#15629" class="InductiveConstructor">mkAllElimArrow</a> <a id="18031" href="#18031" class="Bound">v</a><span id="18032" class="Symbol">)</span>   <span id="18036" class="Symbol">=</span> <a id="18038" href="#15629" class="InductiveConstructor">mkAllElimArrow</a> <span id="18053" class="Symbol">(</span><a id="18054" href="#18006" class="Bound">%mapAllV</a> <a id="18063" href="#18031" class="Bound">v</a><span id="18064" class="Symbol">)</span>
  <a id="18068" href="#17695" class="Function">mapAllElim</a> <a id="18079" href="#18079" class="Bound">%mapV</a> <a id="18085" href="#18085" class="Bound">%mapAllV</a> <span id="18094" class="Symbol">(</span><a id="18095" href="#15759" class="InductiveConstructor">mkAllElimSum</a> <a id="18108" href="#18108" class="Bound">fs</a><span id="18110" class="Symbol">)</span>    <span id="18115" class="Symbol">=</span> <a id="18117" href="#15759" class="InductiveConstructor">mkAllElimSum</a> <span id="18130" class="Symbol">(</span><a id="18131" href="#5002" class="Function">mapAll2</a> <a id="18139" href="#18079" class="Bound">%mapV</a> <a id="18145" href="#18085" class="Bound">%mapAllV</a> <a id="18154" href="#18108" class="Bound">fs</a><span id="18156" class="Symbol">)</span>
  <a id="18160" href="#17695" class="Function">mapAllElim</a> <a id="18171" href="#18171" class="Bound">%mapV</a> <a id="18177" href="#18177" class="Bound">%mapAllV</a> <span id="18186" class="Symbol">(</span><a id="18187" href="#15888" class="InductiveConstructor">mkAllElimProduct</a> <a id="18204" href="#18204" class="Bound">i</a><span id="18205" class="Symbol">)</span> <span id="18207" class="Symbol">=</span> <a id="18209" href="#15888" class="InductiveConstructor">mkAllElimProduct</a> <a id="18226" href="#18204" class="Bound">i</a>
  <a id="18230" href="#17695" class="Function">mapAllElim</a> <a id="18241" href="#18241" class="Bound">%mapV</a> <a id="18247" href="#18247" class="Bound">%mapAllV</a> <span id="18256" class="Symbol">(</span><a id="18257" href="#16020" class="InductiveConstructor">mkAllElimNat</a> <a id="18270" href="#18270" class="Bound">f</a><span id="18271" class="Symbol">)</span>     <span id="18277" class="Symbol">=</span> <a id="18279" href="#16020" class="InductiveConstructor">mkAllElimNat</a> <span id="18292" class="Symbol">(</span><a id="18293" href="#18247" class="Bound">%mapAllV</a> <a id="18302" href="#18270" class="Bound">f</a><span id="18303" class="Symbol">)</span>
  <a id="18307" href="#17695" class="Function">mapAllElim</a> <a id="18318" href="#18318" class="Bound">%mapV</a> <a id="18324" href="#18324" class="Bound">%mapAllV</a>  <a id="18334" href="#16148" class="InductiveConstructor">mkAllElimConat</a>      <span id="18354" class="Symbol">=</span> <a id="18356" href="#16148" class="InductiveConstructor">mkAllElimConat</a>
  <a id="18373" href="#17695" class="Function">mapAllElim</a> <a id="18384" href="#18384" class="Bound">%mapV</a> <a id="18390" href="#18390" class="Bound">%mapAllV</a>  <a id="18400" href="#16275" class="InductiveConstructor">mkAllElimStream</a>     <span id="18420" class="Symbol">=</span> <a id="18422" href="#16275" class="InductiveConstructor">mkAllElimStream</a>

<span id="18439" class="Keyword">open</span> <a id="18444" href="#12761" class="Module">4:Utensils</a>



<span id="18458" class="Keyword">module</span> <a id="5:Term"></a><a id="18465" href="#18465" class="Module">5:Term</a> <span id="18472" class="Keyword">where</span>
  <span id="18480" class="Comment">{-
     5. Terms
  -}</span>

  <span id="18505" class="Keyword">mutual</span>
    <span id="18516" class="Comment">-- Regular de Bruijn representation of a term</span>
    <span id="18566" class="Keyword">data</span> <a id="5:Term.Term"></a><a id="18571" href="#18571" class="Datatype">Term</a> <span id="18576" class="Symbol">(</span><a id="18577" href="#18577" class="Bound">Γ</a> <span id="18579" class="Symbol">:</span> <a id="18581" href="#2771" class="Datatype">List</a> <a id="18586" href="#8610" class="Datatype">Type</a><span id="18590" class="Symbol">)</span> <span id="18592" class="Symbol">(</span><a id="18593" href="#18593" class="Bound">τ</a> <span id="18595" class="Symbol">:</span> <a id="18597" href="#8610" class="Datatype">Type</a><span id="18601" class="Symbol">)</span> <span id="18603" class="Symbol">:</span> <span id="18605" class="PrimitiveType">Set</span> <span id="18609" class="Keyword">where</span>
      <span id="18621" class="Comment">-- a variable</span>
      <a id="5:Term.Term.var"></a><a id="18641" href="#18641" class="InductiveConstructor">var</a>  <span id="18646" class="Symbol">:</span> <a id="18648" href="#3432" class="Function">Has</a> <a id="18652" href="#18577" class="Bound">Γ</a> <a id="18654" href="#18593" class="Bound">τ</a> <span id="18656" class="Symbol">→</span> <a id="18658" href="#18571" class="Datatype">Term</a> <a id="18663" href="#18577" class="Bound">Γ</a> <a id="18665" href="#18593" class="Bound">τ</a>

      <span id="18674" class="Comment">-- an expression recursively containing other terms</span>
      <a id="5:Term.Term.wrap"></a><a id="18732" href="#18732" class="InductiveConstructor">wrap</a> <span id="18737" class="Symbol">:</span> <a id="18739" href="#12502" class="Datatype">Expr</a> <span id="18744" class="Symbol">(</span><a id="18745" href="#18783" class="Function">AbsTerm</a> <a id="18753" href="#18577" class="Bound">Γ</a><span id="18754" class="Symbol">)</span> <span id="18756" class="Symbol">(</span><a id="18757" href="#18571" class="Datatype">Term</a> <a id="18762" href="#18577" class="Bound">Γ</a><span id="18763" class="Symbol">)</span> <a id="18765" href="#18593" class="Bound">τ</a> <span id="18767" class="Symbol">→</span> <a id="18769" href="#18571" class="Datatype">Term</a> <a id="18774" href="#18577" class="Bound">Γ</a> <a id="18776" href="#18593" class="Bound">τ</a>

    <a id="5:Term.AbsTerm"></a><a id="18783" href="#18783" class="Function">AbsTerm</a> <span id="18791" class="Symbol">:</span> <a id="18793" href="#2771" class="Datatype">List</a> <a id="18798" href="#8610" class="Datatype">Type</a> <span id="18803" class="Symbol">→</span> <span id="18805" class="Symbol">(</span><a id="18806" href="#8610" class="Datatype">Type</a> <span id="18811" class="Symbol">→</span> <a id="18813" href="#8610" class="Datatype">Type</a> <span id="18818" class="Symbol">→</span> <span id="18820" class="PrimitiveType">Set</span><span id="18823" class="Symbol">)</span>
    <a id="18829" href="#18783" class="Function">AbsTerm</a> <a id="18837" href="#18837" class="Bound">Γ</a> <a id="18839" href="#18839" class="Bound">ρ</a> <a id="18841" href="#18841" class="Bound">τ</a> <span id="18843" class="Symbol">=</span> <a id="18845" href="#18571" class="Datatype">Term</a> <span id="18850" class="Symbol">(</span><a id="18851" href="#18839" class="Bound">ρ</a> <a id="18853" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="18855" href="#18837" class="Bound">Γ</a><span id="18856" class="Symbol">)</span> <a id="18858" href="#18841" class="Bound">τ</a>

  <span id="18863" class="Comment">-- Maps a function to each variable in a term</span>
  <span id="18911" class="Symbol">{-#</span> <span id="18915" class="Keyword">TERMINATING</span> <span id="18927" class="Symbol">#-}</span> <span id="18931" class="Comment">-- terminating because it preserves structure, inlining 'mapExpr' would convince Agda</span>
  <a id="5:Term.mapTerm"></a><a id="19019" href="#19019" class="Function">mapTerm</a> <span id="19027" class="Symbol">:</span> <span id="19029" class="Symbol">∀</span> <span id="19031" class="Symbol">{</span><a id="19032" href="#19032" class="Bound">Γ</a> <a id="19034" href="#19034" class="Bound">Δ</a><span id="19035" class="Symbol">}</span> <span id="19037" class="Symbol">→</span> <span id="19039" class="Symbol">(∀</span> <span id="19042" class="Symbol">{</span><a id="19043" href="#19043" class="Bound">τ</a><span id="19044" class="Symbol">}</span> <span id="19046" class="Symbol">→</span> <a id="19048" href="#3432" class="Function">Has</a> <a id="19052" href="#19032" class="Bound">Γ</a> <a id="19054" href="#19043" class="Bound">τ</a> <span id="19056" class="Symbol">→</span> <a id="19058" href="#3432" class="Function">Has</a> <a id="19062" href="#19034" class="Bound">Δ</a> <a id="19064" href="#19043" class="Bound">τ</a><span id="19065" class="Symbol">)</span> <span id="19067" class="Symbol">→</span> <span id="19069" class="Symbol">(∀</span> <span id="19072" class="Symbol">{</span><a id="19073" href="#19073" class="Bound">τ</a><span id="19074" class="Symbol">}</span> <span id="19076" class="Symbol">→</span> <a id="19078" href="#18571" class="Datatype">Term</a> <a id="19083" href="#19032" class="Bound">Γ</a> <a id="19085" href="#19073" class="Bound">τ</a> <span id="19087" class="Symbol">→</span> <a id="19089" href="#18571" class="Datatype">Term</a> <a id="19094" href="#19034" class="Bound">Δ</a> <a id="19096" href="#19073" class="Bound">τ</a><span id="19097" class="Symbol">)</span>
  <a id="19101" href="#19019" class="Function">mapTerm</a> <a id="19109" href="#19109" class="Bound">f</a> <span id="19111" class="Symbol">(</span><a id="19112" href="#18641" class="InductiveConstructor">var</a> <a id="19116" href="#19116" class="Bound">x</a><span id="19117" class="Symbol">)</span>     <span id="19123" class="Symbol">=</span> <a id="19125" href="#18641" class="InductiveConstructor">var</a> <span id="19129" class="Symbol">(</span><a id="19130" href="#19109" class="Bound">f</a> <a id="19132" href="#19116" class="Bound">x</a><span id="19133" class="Symbol">)</span>
  <a id="19137" href="#19019" class="Function">mapTerm</a> <a id="19145" href="#19145" class="Bound">f</a> <span id="19147" class="Symbol">(</span><a id="19148" href="#18732" class="InductiveConstructor">wrap</a> <a id="19153" href="#19153" class="Bound">expr</a><span id="19157" class="Symbol">)</span> <span id="19159" class="Symbol">=</span> <a id="19161" href="#18732" class="InductiveConstructor">wrap</a> <span id="19166" class="Symbol">(</span><a id="19167" href="#13981" class="Function">mapExpr</a> <span id="19175" class="Symbol">(</span><a id="19176" href="#19019" class="Function">mapTerm</a> <span id="19184" class="Symbol">(</span><a id="19185" href="#8088" class="Function">has-prepend</a> <a id="19197" href="#19145" class="Bound">f</a> <span id="19199" class="Symbol">_))</span> <span id="19203" class="Symbol">(</span><a id="19204" href="#19019" class="Function">mapTerm</a> <a id="19212" href="#19145" class="Bound">f</a><span id="19213" class="Symbol">)</span> <a id="19215" href="#19153" class="Bound">expr</a><span id="19219" class="Symbol">)</span>

  <span id="19224" class="Comment">-- Expands context with one ignored variable</span>
  <a id="5:Term.↑_"></a><a id="19271" href="#19271" class="Function Operator">↑_</a> <span id="19274" class="Symbol">:</span> <span id="19276" class="Symbol">∀</span> <span id="19278" class="Symbol">{</span><a id="19279" href="#19279" class="Bound">Γ</a> <a id="19281" href="#19281" class="Bound">ρ</a> <a id="19283" href="#19283" class="Bound">τ</a><span id="19284" class="Symbol">}</span> <span id="19286" class="Symbol">→</span> <a id="19288" href="#18571" class="Datatype">Term</a> <a id="19293" href="#19279" class="Bound">Γ</a> <a id="19295" href="#19283" class="Bound">τ</a> <span id="19297" class="Symbol">→</span> <a id="19299" href="#18571" class="Datatype">Term</a> <span id="19304" class="Symbol">(</span><a id="19305" href="#19281" class="Bound">ρ</a> <a id="19307" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="19309" href="#19279" class="Bound">Γ</a><span id="19310" class="Symbol">)</span> <a id="19312" href="#19283" class="Bound">τ</a>
  <a id="19316" href="#19271" class="Function Operator">↑</a> <a id="19318" href="#19318" class="Bound">term</a> <span id="19323" class="Symbol">=</span> <a id="19325" href="#19019" class="Function">mapTerm</a> <a id="19333" href="#3332" class="InductiveConstructor">there</a> <a id="19339" href="#19318" class="Bound">term</a>

<span id="19345" class="Keyword">open</span> <a id="19350" href="#18465" class="Module">5:Term</a>



<span id="19360" class="Keyword">module</span> <a id="6:SomeTerms"></a><a id="19367" href="#19367" class="Module">6:SomeTerms</a> <span id="19379" class="Keyword">where</span>
  <span id="19387" class="Comment">{-
     6. Examples of terms
  -}</span>

  <a id="6:SomeTerms.#lambda"></a><a id="19424" href="#19424" class="Function">#lambda</a> <span id="19432" class="Symbol">:</span> <span id="19434" class="Symbol">∀</span> <span id="19436" class="Symbol">{</span><a id="19437" href="#19437" class="Bound">Γ</a> <a id="19439" href="#19439" class="Bound">σ</a> <a id="19441" href="#19441" class="Bound">τ</a><span id="19442" class="Symbol">}</span> <span id="19444" class="Symbol">→</span> <a id="19446" href="#18571" class="Datatype">Term</a> <span id="19451" class="Symbol">(</span><a id="19452" href="#19439" class="Bound">σ</a> <a id="19454" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="19456" href="#19437" class="Bound">Γ</a><span id="19457" class="Symbol">)</span> <a id="19459" href="#19441" class="Bound">τ</a> <span id="19461" class="Symbol">→</span> <a id="19463" href="#18571" class="Datatype">Term</a> <a id="19468" href="#19437" class="Bound">Γ</a> <span id="19470" class="Symbol">(</span><a id="19471" href="#19439" class="Bound">σ</a> <a id="19473" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="19475" href="#19441" class="Bound">τ</a><span id="19476" class="Symbol">)</span>
  <a id="19480" href="#19424" class="Function">#lambda</a> <a id="19488" href="#19488" class="Bound">f</a> <span id="19490" class="Symbol">=</span> <a id="19492" href="#18732" class="InductiveConstructor">wrap</a> <span id="19497" class="Symbol">(</span><a id="19498" href="#12591" class="InductiveConstructor">intr</a> <span id="19503" class="Symbol">(</span><a id="19504" href="#9949" class="InductiveConstructor">intrArrow</a> <a id="19514" href="#19488" class="Bound">f</a><span id="19515" class="Symbol">))</span>

  <a id="6:SomeTerms.#apply"></a><a id="19521" href="#19521" class="Function">#apply</a> <span id="19528" class="Symbol">:</span> <span id="19530" class="Symbol">∀</span> <span id="19532" class="Symbol">{</span><a id="19533" href="#19533" class="Bound">Γ</a> <a id="19535" href="#19535" class="Bound">σ</a> <a id="19537" href="#19537" class="Bound">τ</a><span id="19538" class="Symbol">}</span> <span id="19540" class="Symbol">→</span> <a id="19542" href="#18571" class="Datatype">Term</a> <a id="19547" href="#19533" class="Bound">Γ</a> <span id="19549" class="Symbol">(</span><a id="19550" href="#19535" class="Bound">σ</a> <a id="19552" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="19554" href="#19537" class="Bound">τ</a><span id="19555" class="Symbol">)</span> <span id="19557" class="Symbol">→</span> <a id="19559" href="#18571" class="Datatype">Term</a> <a id="19564" href="#19533" class="Bound">Γ</a> <a id="19566" href="#19535" class="Bound">σ</a> <span id="19568" class="Symbol">→</span> <a id="19570" href="#18571" class="Datatype">Term</a> <a id="19575" href="#19533" class="Bound">Γ</a> <a id="19577" href="#19537" class="Bound">τ</a>
  <a id="19581" href="#19521" class="Function">#apply</a> <a id="19588" href="#19588" class="Bound">f</a> <a id="19590" href="#19590" class="Bound">v</a> <span id="19592" class="Symbol">=</span> <a id="19594" href="#18732" class="InductiveConstructor">wrap</a> <span id="19599" class="Symbol">(</span><a id="19600" href="#12666" class="InductiveConstructor">elim</a> <a id="19605" href="#19588" class="Bound">f</a> <span id="19607" class="Symbol">(</span><a id="19608" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="19618" href="#19590" class="Bound">v</a><span id="19619" class="Symbol">))</span>

  <a id="6:SomeTerms.#compose"></a><a id="19625" href="#19625" class="Function">#compose</a> <span id="19634" class="Symbol">:</span> <span id="19636" class="Symbol">∀</span> <span id="19638" class="Symbol">{</span><a id="19639" href="#19639" class="Bound">Γ</a> <a id="19641" href="#19641" class="Bound">ρ</a> <a id="19643" href="#19643" class="Bound">σ</a> <a id="19645" href="#19645" class="Bound">τ</a><span id="19646" class="Symbol">}</span> <span id="19648" class="Symbol">→</span> <a id="19650" href="#18571" class="Datatype">Term</a> <a id="19655" href="#19639" class="Bound">Γ</a> <span id="19657" class="Symbol">(</span><a id="19658" href="#19643" class="Bound">σ</a> <a id="19660" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="19662" href="#19645" class="Bound">τ</a><span id="19663" class="Symbol">)</span> <span id="19665" class="Symbol">→</span> <a id="19667" href="#18571" class="Datatype">Term</a> <a id="19672" href="#19639" class="Bound">Γ</a> <span id="19674" class="Symbol">(</span><a id="19675" href="#19641" class="Bound">ρ</a> <a id="19677" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="19679" href="#19643" class="Bound">σ</a><span id="19680" class="Symbol">)</span> <span id="19682" class="Symbol">→</span> <a id="19684" href="#18571" class="Datatype">Term</a> <a id="19689" href="#19639" class="Bound">Γ</a> <span id="19691" class="Symbol">(</span><a id="19692" href="#19641" class="Bound">ρ</a> <a id="19694" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="19696" href="#19645" class="Bound">τ</a><span id="19697" class="Symbol">)</span>
  <a id="19701" href="#19625" class="Function">#compose</a> <a id="19710" href="#19710" class="Bound">f</a> <a id="19712" href="#19712" class="Bound">g</a> <span id="19714" class="Symbol">=</span> <a id="19716" href="#19424" class="Function">#lambda</a> <span id="19724" class="Symbol">(</span><a id="19725" href="#19521" class="Function">#apply</a> <span id="19732" class="Symbol">(</span><a id="19733" href="#19271" class="Function Operator">↑</a> <a id="19735" href="#19710" class="Bound">f</a><span id="19736" class="Symbol">)</span> <span id="19738" class="Symbol">(</span><a id="19739" href="#19521" class="Function">#apply</a> <span id="19746" class="Symbol">(</span><a id="19747" href="#19271" class="Function Operator">↑</a> <a id="19749" href="#19712" class="Bound">g</a><span id="19750" class="Symbol">)</span> <span id="19752" class="Symbol">(</span><a id="19753" href="#18641" class="InductiveConstructor">var</a> <a id="19757" href="#6159" class="Function">$0</a><span id="19759" class="Symbol">)))</span>

  <a id="6:SomeTerms.#inl"></a><a id="19766" href="#19766" class="Function">#inl</a> <span id="19771" class="Symbol">:</span> <span id="19773" class="Symbol">∀</span> <span id="19775" class="Symbol">{</span><a id="19776" href="#19776" class="Bound">Γ</a> <a id="19778" href="#19778" class="Bound">σ</a> <a id="19780" href="#19780" class="Bound">τ</a><span id="19781" class="Symbol">}</span> <span id="19783" class="Symbol">→</span> <a id="19785" href="#18571" class="Datatype">Term</a> <a id="19790" href="#19776" class="Bound">Γ</a> <a id="19792" href="#19778" class="Bound">σ</a> <span id="19794" class="Symbol">→</span> <a id="19796" href="#18571" class="Datatype">Term</a> <a id="19801" href="#19776" class="Bound">Γ</a> <span id="19803" class="Symbol">(</span><a id="19804" href="#9126" class="Function">#Either</a> <a id="19812" href="#19778" class="Bound">σ</a> <a id="19814" href="#19780" class="Bound">τ</a><span id="19815" class="Symbol">)</span>
  <a id="19819" href="#19766" class="Function">#inl</a> <a id="19824" href="#19824" class="Bound">v</a> <span id="19826" class="Symbol">=</span> <a id="19828" href="#18732" class="InductiveConstructor">wrap</a> <span id="19833" class="Symbol">(</span><a id="19834" href="#12591" class="InductiveConstructor">intr</a> <span id="19839" class="Symbol">(</span><a id="19840" href="#10102" class="InductiveConstructor">intrSum</a> <span id="19848" class="Symbol">(</span><a id="19849" href="#3288" class="InductiveConstructor">here</a> <a id="19854" href="#19824" class="Bound">v</a><span id="19855" class="Symbol">)))</span>

  <a id="6:SomeTerms.#inr"></a><a id="19862" href="#19862" class="Function">#inr</a> <span id="19867" class="Symbol">:</span> <span id="19869" class="Symbol">∀</span> <span id="19871" class="Symbol">{</span><a id="19872" href="#19872" class="Bound">Γ</a> <a id="19874" href="#19874" class="Bound">σ</a> <a id="19876" href="#19876" class="Bound">τ</a><span id="19877" class="Symbol">}</span> <span id="19879" class="Symbol">→</span> <a id="19881" href="#18571" class="Datatype">Term</a> <a id="19886" href="#19872" class="Bound">Γ</a> <a id="19888" href="#19876" class="Bound">τ</a> <span id="19890" class="Symbol">→</span> <a id="19892" href="#18571" class="Datatype">Term</a> <a id="19897" href="#19872" class="Bound">Γ</a> <span id="19899" class="Symbol">(</span><a id="19900" href="#9126" class="Function">#Either</a> <a id="19908" href="#19874" class="Bound">σ</a> <a id="19910" href="#19876" class="Bound">τ</a><span id="19911" class="Symbol">)</span>
  <a id="19915" href="#19862" class="Function">#inr</a> <a id="19920" href="#19920" class="Bound">v</a> <span id="19922" class="Symbol">=</span> <a id="19924" href="#18732" class="InductiveConstructor">wrap</a> <span id="19929" class="Symbol">(</span><a id="19930" href="#12591" class="InductiveConstructor">intr</a> <span id="19935" class="Symbol">(</span><a id="19936" href="#10102" class="InductiveConstructor">intrSum</a> <span id="19944" class="Symbol">(</span><a id="19945" href="#3332" class="InductiveConstructor">there</a> <span id="19951" class="Symbol">(</span><a id="19952" href="#3288" class="InductiveConstructor">here</a> <a id="19957" href="#19920" class="Bound">v</a><span id="19958" class="Symbol">))))</span>

  <a id="6:SomeTerms.#either"></a><a id="19966" href="#19966" class="Function">#either</a> <span id="19974" class="Symbol">:</span> <span id="19976" class="Symbol">∀</span> <span id="19978" class="Symbol">{</span><a id="19979" href="#19979" class="Bound">Γ</a> <a id="19981" href="#19981" class="Bound">σ</a> <a id="19983" href="#19983" class="Bound">τ</a> <a id="19985" href="#19985" class="Bound">ϕ</a><span id="19986" class="Symbol">}</span> <span id="19988" class="Symbol">→</span> <a id="19990" href="#18571" class="Datatype">Term</a> <a id="19995" href="#19979" class="Bound">Γ</a> <span id="19997" class="Symbol">(</span><a id="19998" href="#19981" class="Bound">σ</a> <a id="20000" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="20002" href="#19985" class="Bound">ϕ</a><span id="20003" class="Symbol">)</span> <span id="20005" class="Symbol">→</span> <a id="20007" href="#18571" class="Datatype">Term</a> <a id="20012" href="#19979" class="Bound">Γ</a> <span id="20014" class="Symbol">(</span><a id="20015" href="#19983" class="Bound">τ</a> <a id="20017" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="20019" href="#19985" class="Bound">ϕ</a><span id="20020" class="Symbol">)</span> <span id="20022" class="Symbol">→</span> <a id="20024" href="#18571" class="Datatype">Term</a> <a id="20029" href="#19979" class="Bound">Γ</a> <span id="20031" class="Symbol">(</span><a id="20032" href="#9126" class="Function">#Either</a> <a id="20040" href="#19981" class="Bound">σ</a> <a id="20042" href="#19983" class="Bound">τ</a><span id="20043" class="Symbol">)</span> <span id="20045" class="Symbol">→</span> <a id="20047" href="#18571" class="Datatype">Term</a> <a id="20052" href="#19979" class="Bound">Γ</a> <a id="20054" href="#19985" class="Bound">ϕ</a>
  <a id="20058" href="#19966" class="Function">#either</a> <a id="20066" href="#20066" class="Bound">f₁</a> <a id="20069" href="#20069" class="Bound">f₂</a> <a id="20072" href="#20072" class="Bound">v</a> <span id="20074" class="Symbol">=</span> <a id="20076" href="#18732" class="InductiveConstructor">wrap</a> <span id="20081" class="Symbol">(</span><a id="20082" href="#12666" class="InductiveConstructor">elim</a> <a id="20087" href="#20072" class="Bound">v</a> <span id="20089" class="Symbol">(</span><a id="20090" href="#11670" class="InductiveConstructor">elimSum</a> <span id="20098" class="Symbol">(</span><a id="20099" href="#20066" class="Bound">f₁</a> <a id="20102" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="20104" href="#20069" class="Bound">f₂</a> <a id="20107" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="20109" href="#2930" class="InductiveConstructor">ε</a><span id="20110" class="Symbol">)))</span>

  <a id="6:SomeTerms.#unit"></a><a id="20117" href="#20117" class="Function">#unit</a> <span id="20123" class="Symbol">:</span> <span id="20125" class="Symbol">∀</span> <span id="20127" class="Symbol">{</span><a id="20128" href="#20128" class="Bound">Γ</a><span id="20129" class="Symbol">}</span> <span id="20131" class="Symbol">→</span> <a id="20133" href="#18571" class="Datatype">Term</a> <a id="20138" href="#20128" class="Bound">Γ</a> <a id="20140" href="#9067" class="Function">#Unit</a>
  <a id="20148" href="#20117" class="Function">#unit</a> <span id="20154" class="Symbol">=</span> <a id="20156" href="#18732" class="InductiveConstructor">wrap</a> <span id="20161" class="Symbol">(</span><a id="20162" href="#12591" class="InductiveConstructor">intr</a> <span id="20167" class="Symbol">(</span><a id="20168" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="20180" href="#2930" class="InductiveConstructor">ε</a><span id="20181" class="Symbol">))</span>

  <a id="6:SomeTerms.#pair"></a><a id="20187" href="#20187" class="Function">#pair</a> <span id="20193" class="Symbol">:</span> <span id="20195" class="Symbol">∀</span> <span id="20197" class="Symbol">{</span><a id="20198" href="#20198" class="Bound">Γ</a> <a id="20200" href="#20200" class="Bound">σ</a> <a id="20202" href="#20202" class="Bound">τ</a><span id="20203" class="Symbol">}</span> <span id="20205" class="Symbol">→</span> <a id="20207" href="#18571" class="Datatype">Term</a> <a id="20212" href="#20198" class="Bound">Γ</a> <a id="20214" href="#20200" class="Bound">σ</a> <span id="20216" class="Symbol">→</span> <a id="20218" href="#18571" class="Datatype">Term</a> <a id="20223" href="#20198" class="Bound">Γ</a> <a id="20225" href="#20202" class="Bound">τ</a> <span id="20227" class="Symbol">→</span> <a id="20229" href="#18571" class="Datatype">Term</a> <a id="20234" href="#20198" class="Bound">Γ</a> <span id="20236" class="Symbol">(</span><a id="20237" href="#9217" class="Function">#Pair</a> <a id="20243" href="#20200" class="Bound">σ</a> <a id="20245" href="#20202" class="Bound">τ</a><span id="20246" class="Symbol">)</span>
  <a id="20250" href="#20187" class="Function">#pair</a> <a id="20256" href="#20256" class="Bound">v₁</a> <a id="20259" href="#20259" class="Bound">v₂</a> <span id="20262" class="Symbol">=</span> <a id="20264" href="#18732" class="InductiveConstructor">wrap</a> <span id="20269" class="Symbol">(</span><a id="20270" href="#12591" class="InductiveConstructor">intr</a> <span id="20275" class="Symbol">(</span><a id="20276" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="20288" class="Symbol">(</span><a id="20289" href="#20256" class="Bound">v₁</a> <a id="20292" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="20294" href="#20259" class="Bound">v₂</a> <a id="20297" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="20299" href="#2930" class="InductiveConstructor">ε</a><span id="20300" class="Symbol">)))</span>

  <a id="6:SomeTerms.#fst"></a><a id="20307" href="#20307" class="Function">#fst</a> <span id="20312" class="Symbol">:</span> <span id="20314" class="Symbol">∀</span> <span id="20316" class="Symbol">{</span><a id="20317" href="#20317" class="Bound">Γ</a> <a id="20319" href="#20319" class="Bound">σ</a> <a id="20321" href="#20321" class="Bound">τ</a><span id="20322" class="Symbol">}</span> <span id="20324" class="Symbol">→</span> <a id="20326" href="#18571" class="Datatype">Term</a> <a id="20331" href="#20317" class="Bound">Γ</a> <span id="20333" class="Symbol">(</span><a id="20334" href="#9217" class="Function">#Pair</a> <a id="20340" href="#20319" class="Bound">σ</a> <a id="20342" href="#20321" class="Bound">τ</a><span id="20343" class="Symbol">)</span> <span id="20345" class="Symbol">→</span> <a id="20347" href="#18571" class="Datatype">Term</a> <a id="20352" href="#20317" class="Bound">Γ</a> <a id="20354" href="#20319" class="Bound">σ</a>
  <a id="20358" href="#20307" class="Function">#fst</a> <a id="20363" href="#20363" class="Bound">v</a> <span id="20365" class="Symbol">=</span> <a id="20367" href="#18732" class="InductiveConstructor">wrap</a> <span id="20372" class="Symbol">(</span><a id="20373" href="#12666" class="InductiveConstructor">elim</a> <a id="20378" href="#20363" class="Bound">v</a> <span id="20380" class="Symbol">(</span><a id="20381" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="20393" href="#6159" class="Function">$0</a><span id="20395" class="Symbol">))</span>

  <a id="6:SomeTerms.#snd"></a><a id="20401" href="#20401" class="Function">#snd</a> <span id="20406" class="Symbol">:</span> <span id="20408" class="Symbol">∀</span> <span id="20410" class="Symbol">{</span><a id="20411" href="#20411" class="Bound">Γ</a> <a id="20413" href="#20413" class="Bound">σ</a> <a id="20415" href="#20415" class="Bound">τ</a><span id="20416" class="Symbol">}</span> <span id="20418" class="Symbol">→</span> <a id="20420" href="#18571" class="Datatype">Term</a> <a id="20425" href="#20411" class="Bound">Γ</a> <span id="20427" class="Symbol">(</span><a id="20428" href="#9217" class="Function">#Pair</a> <a id="20434" href="#20413" class="Bound">σ</a> <a id="20436" href="#20415" class="Bound">τ</a><span id="20437" class="Symbol">)</span> <span id="20439" class="Symbol">→</span> <a id="20441" href="#18571" class="Datatype">Term</a> <a id="20446" href="#20411" class="Bound">Γ</a> <a id="20448" href="#20415" class="Bound">τ</a>
  <a id="20452" href="#20401" class="Function">#snd</a> <a id="20457" href="#20457" class="Bound">v</a> <span id="20459" class="Symbol">=</span> <a id="20461" href="#18732" class="InductiveConstructor">wrap</a> <span id="20466" class="Symbol">(</span><a id="20467" href="#12666" class="InductiveConstructor">elim</a> <a id="20472" href="#20457" class="Bound">v</a> <span id="20474" class="Symbol">(</span><a id="20475" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="20487" href="#6213" class="Function">$1</a><span id="20489" class="Symbol">))</span>

  <a id="6:SomeTerms.#mapPair"></a><a id="20495" href="#20495" class="Function">#mapPair</a> <span id="20504" class="Symbol">:</span> <span id="20506" class="Symbol">∀</span> <span id="20508" class="Symbol">{</span><a id="20509" href="#20509" class="Bound">Γ</a> <a id="20511" href="#20511" class="Bound">ρ</a> <a id="20513" href="#20513" class="Bound">σ</a> <a id="20515" href="#20515" class="Bound">τ</a><span id="20516" class="Symbol">}</span> <span id="20518" class="Symbol">→</span> <a id="20520" href="#18571" class="Datatype">Term</a> <a id="20525" href="#20509" class="Bound">Γ</a> <span id="20527" class="Symbol">(</span><a id="20528" href="#20513" class="Bound">σ</a> <a id="20530" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="20532" href="#20515" class="Bound">τ</a><span id="20533" class="Symbol">)</span> <span id="20535" class="Symbol">→</span> <a id="20537" href="#18571" class="Datatype">Term</a> <a id="20542" href="#20509" class="Bound">Γ</a> <span id="20544" class="Symbol">(</span><a id="20545" href="#9217" class="Function">#Pair</a> <a id="20551" href="#20511" class="Bound">ρ</a> <a id="20553" href="#20513" class="Bound">σ</a> <a id="20555" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="20557" href="#9217" class="Function">#Pair</a> <a id="20563" href="#20511" class="Bound">ρ</a> <a id="20565" href="#20515" class="Bound">τ</a><span id="20566" class="Symbol">)</span>
  <a id="20570" href="#20495" class="Function">#mapPair</a> <a id="20579" href="#20579" class="Bound">f</a> <span id="20581" class="Symbol">=</span> <a id="20583" href="#19424" class="Function">#lambda</a> <span id="20591" class="Symbol">(</span><a id="20592" href="#20187" class="Function">#pair</a> <span id="20598" class="Symbol">(</span><a id="20599" href="#20307" class="Function">#fst</a> <span id="20604" class="Symbol">(</span><a id="20605" href="#18641" class="InductiveConstructor">var</a> <a id="20609" href="#6159" class="Function">$0</a><span id="20611" class="Symbol">))</span> <span id="20614" class="Symbol">(</span><a id="20615" href="#19521" class="Function">#apply</a> <span id="20622" class="Symbol">(</span><a id="20623" href="#19271" class="Function Operator">↑</a> <a id="20625" href="#20579" class="Bound">f</a><span id="20626" class="Symbol">)</span> <span id="20628" class="Symbol">(</span><a id="20629" href="#20401" class="Function">#snd</a> <span id="20634" class="Symbol">(</span><a id="20635" href="#18641" class="InductiveConstructor">var</a> <a id="20639" href="#6159" class="Function">$0</a><span id="20641" class="Symbol">))))</span>

  <a id="6:SomeTerms.#nothing"></a><a id="20649" href="#20649" class="Function">#nothing</a> <span id="20658" class="Symbol">:</span> <span id="20660" class="Symbol">∀</span> <span id="20662" class="Symbol">{</span><a id="20663" href="#20663" class="Bound">Γ</a> <a id="20665" href="#20665" class="Bound">τ</a><span id="20666" class="Symbol">}</span> <span id="20668" class="Symbol">→</span> <a id="20670" href="#18571" class="Datatype">Term</a> <a id="20675" href="#20663" class="Bound">Γ</a> <span id="20677" class="Symbol">(</span><a id="20678" href="#9349" class="Function">#Maybe</a> <a id="20685" href="#20665" class="Bound">τ</a><span id="20686" class="Symbol">)</span>
  <a id="20690" href="#20649" class="Function">#nothing</a> <span id="20699" class="Symbol">=</span> <a id="20701" href="#19766" class="Function">#inl</a> <a id="20706" href="#20117" class="Function">#unit</a>

  <a id="6:SomeTerms.#just"></a><a id="20715" href="#20715" class="Function">#just</a> <span id="20721" class="Symbol">:</span> <span id="20723" class="Symbol">∀</span> <span id="20725" class="Symbol">{</span><a id="20726" href="#20726" class="Bound">Γ</a> <a id="20728" href="#20728" class="Bound">τ</a><span id="20729" class="Symbol">}</span> <span id="20731" class="Symbol">→</span> <a id="20733" href="#18571" class="Datatype">Term</a> <a id="20738" href="#20726" class="Bound">Γ</a> <a id="20740" href="#20728" class="Bound">τ</a> <span id="20742" class="Symbol">→</span> <a id="20744" href="#18571" class="Datatype">Term</a> <a id="20749" href="#20726" class="Bound">Γ</a> <span id="20751" class="Symbol">(</span><a id="20752" href="#9349" class="Function">#Maybe</a> <a id="20759" href="#20728" class="Bound">τ</a><span id="20760" class="Symbol">)</span>
  <a id="20764" href="#20715" class="Function">#just</a> <a id="20770" href="#20770" class="Bound">v</a> <span id="20772" class="Symbol">=</span> <a id="20774" href="#19862" class="Function">#inr</a> <a id="20779" href="#20770" class="Bound">v</a>

  <a id="6:SomeTerms.#maybe"></a><a id="20784" href="#20784" class="Function">#maybe</a> <span id="20791" class="Symbol">:</span> <span id="20793" class="Symbol">∀</span> <span id="20795" class="Symbol">{</span><a id="20796" href="#20796" class="Bound">Γ</a> <a id="20798" href="#20798" class="Bound">τ</a> <a id="20800" href="#20800" class="Bound">ϕ</a><span id="20801" class="Symbol">}</span> <span id="20803" class="Symbol">→</span> <a id="20805" href="#18571" class="Datatype">Term</a> <a id="20810" href="#20796" class="Bound">Γ</a> <a id="20812" href="#20800" class="Bound">ϕ</a> <span id="20814" class="Symbol">→</span> <a id="20816" href="#18571" class="Datatype">Term</a> <a id="20821" href="#20796" class="Bound">Γ</a> <span id="20823" class="Symbol">(</span><a id="20824" href="#20798" class="Bound">τ</a> <a id="20826" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="20828" href="#20800" class="Bound">ϕ</a><span id="20829" class="Symbol">)</span> <span id="20831" class="Symbol">→</span> <a id="20833" href="#18571" class="Datatype">Term</a> <a id="20838" href="#20796" class="Bound">Γ</a> <span id="20840" class="Symbol">(</span><a id="20841" href="#9349" class="Function">#Maybe</a> <a id="20848" href="#20798" class="Bound">τ</a><span id="20849" class="Symbol">)</span> <span id="20851" class="Symbol">→</span> <a id="20853" href="#18571" class="Datatype">Term</a> <a id="20858" href="#20796" class="Bound">Γ</a> <a id="20860" href="#20800" class="Bound">ϕ</a>
  <a id="20864" href="#20784" class="Function">#maybe</a> <a id="20871" href="#20871" class="Bound">f₁</a> <a id="20874" href="#20874" class="Bound">f₂</a> <a id="20877" href="#20877" class="Bound">v</a> <span id="20879" class="Symbol">=</span> <a id="20881" href="#19966" class="Function">#either</a> <span id="20889" class="Symbol">(</span><a id="20890" href="#19424" class="Function">#lambda</a> <span id="20898" class="Symbol">(</span><a id="20899" href="#19271" class="Function Operator">↑</a> <a id="20901" href="#20871" class="Bound">f₁</a><span id="20903" class="Symbol">))</span> <a id="20906" href="#20874" class="Bound">f₂</a> <a id="20909" href="#20877" class="Bound">v</a>

  <a id="6:SomeTerms.#mapMaybe"></a><a id="20914" href="#20914" class="Function">#mapMaybe</a> <span id="20924" class="Symbol">:</span> <span id="20926" class="Symbol">∀</span> <span id="20928" class="Symbol">{</span><a id="20929" href="#20929" class="Bound">Γ</a> <a id="20931" href="#20931" class="Bound">σ</a> <a id="20933" href="#20933" class="Bound">τ</a><span id="20934" class="Symbol">}</span> <span id="20936" class="Symbol">→</span> <a id="20938" href="#18571" class="Datatype">Term</a> <a id="20943" href="#20929" class="Bound">Γ</a> <span id="20945" class="Symbol">(</span><a id="20946" href="#20931" class="Bound">σ</a> <a id="20948" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="20950" href="#20933" class="Bound">τ</a><span id="20951" class="Symbol">)</span> <span id="20953" class="Symbol">→</span> <a id="20955" href="#18571" class="Datatype">Term</a> <a id="20960" href="#20929" class="Bound">Γ</a> <span id="20962" class="Symbol">(</span><a id="20963" href="#9349" class="Function">#Maybe</a> <a id="20970" href="#20931" class="Bound">σ</a> <a id="20972" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="20974" href="#9349" class="Function">#Maybe</a> <a id="20981" href="#20933" class="Bound">τ</a><span id="20982" class="Symbol">)</span>
  <a id="20986" href="#20914" class="Function">#mapMaybe</a> <a id="20996" href="#20996" class="Bound">f</a> <span id="20998" class="Symbol">=</span> <a id="21000" href="#19424" class="Function">#lambda</a> <span id="21008" class="Symbol">(</span><a id="21009" href="#20784" class="Function">#maybe</a> <a id="21016" href="#20649" class="Function">#nothing</a> <span id="21025" class="Symbol">(</span><a id="21026" href="#19424" class="Function">#lambda</a> <span id="21034" class="Symbol">(</span><a id="21035" href="#20715" class="Function">#just</a> <span id="21041" class="Symbol">(</span><a id="21042" href="#19521" class="Function">#apply</a> <span id="21049" class="Symbol">(</span><a id="21050" href="#19271" class="Function Operator">↑</a> <a id="21052" href="#19271" class="Function Operator">↑</a> <a id="21054" href="#20996" class="Bound">f</a><span id="21055" class="Symbol">)</span> <span id="21057" class="Symbol">(</span><a id="21058" href="#18641" class="InductiveConstructor">var</a> <a id="21062" href="#6159" class="Function">$0</a><span id="21064" class="Symbol">))))</span> <span id="21069" class="Symbol">(</span><a id="21070" href="#18641" class="InductiveConstructor">var</a> <a id="21074" href="#6159" class="Function">$0</a><span id="21076" class="Symbol">))</span>

  <a id="6:SomeTerms.#elimNat"></a><a id="21082" href="#21082" class="Function">#elimNat</a> <span id="21091" class="Symbol">:</span> <span id="21093" class="Symbol">∀</span> <span id="21095" class="Symbol">{</span><a id="21096" href="#21096" class="Bound">Γ</a> <a id="21098" href="#21098" class="Bound">ϕ</a><span id="21099" class="Symbol">}</span> <span id="21101" class="Symbol">→</span> <a id="21103" href="#18571" class="Datatype">Term</a> <a id="21108" href="#21096" class="Bound">Γ</a> <span id="21110" class="Symbol">(</span><a id="21111" href="#9349" class="Function">#Maybe</a> <a id="21118" href="#21098" class="Bound">ϕ</a> <a id="21120" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="21122" href="#21098" class="Bound">ϕ</a><span id="21123" class="Symbol">)</span> <span id="21125" class="Symbol">→</span> <a id="21127" href="#18571" class="Datatype">Term</a> <a id="21132" href="#21096" class="Bound">Γ</a> <span id="21134" class="Symbol">(</span><a id="21135" href="#8801" class="InductiveConstructor">#Nat</a> <a id="21140" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="21142" href="#21098" class="Bound">ϕ</a><span id="21143" class="Symbol">)</span>
  <a id="21147" href="#21082" class="Function">#elimNat</a> <a id="21156" href="#21156" class="Bound">f</a> <span id="21158" class="Symbol">=</span> <a id="21160" href="#19424" class="Function">#lambda</a> <span id="21168" class="Symbol">(</span><a id="21169" href="#18732" class="InductiveConstructor">wrap</a> <span id="21174" class="Symbol">(</span><a id="21175" href="#12666" class="InductiveConstructor">elim</a> <span id="21180" class="Symbol">(</span><a id="21181" href="#18641" class="InductiveConstructor">var</a> <a id="21185" href="#6159" class="Function">$0</a><span id="21187" class="Symbol">)</span> <span id="21189" class="Symbol">(</span><a id="21190" href="#11950" class="InductiveConstructor">elimNat</a> <span id="21198" class="Symbol">(</span><a id="21199" href="#19271" class="Function Operator">↑</a> <a id="21201" href="#21156" class="Bound">f</a><span id="21202" class="Symbol">))))</span>

  <a id="6:SomeTerms.#buildConat"></a><a id="21210" href="#21210" class="Function">#buildConat</a> <span id="21222" class="Symbol">:</span> <span id="21224" class="Symbol">∀</span> <span id="21226" class="Symbol">{</span><a id="21227" href="#21227" class="Bound">Γ</a> <a id="21229" href="#21229" class="Bound">ρ</a><span id="21230" class="Symbol">}</span> <span id="21232" class="Symbol">→</span> <a id="21234" href="#18571" class="Datatype">Term</a> <a id="21239" href="#21227" class="Bound">Γ</a> <span id="21241" class="Symbol">(</span><a id="21242" href="#21229" class="Bound">ρ</a> <a id="21244" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="21246" href="#9349" class="Function">#Maybe</a> <a id="21253" href="#21229" class="Bound">ρ</a><span id="21254" class="Symbol">)</span> <span id="21256" class="Symbol">→</span> <a id="21258" href="#18571" class="Datatype">Term</a> <a id="21263" href="#21227" class="Bound">Γ</a> <span id="21265" class="Symbol">(</span><a id="21266" href="#21229" class="Bound">ρ</a> <a id="21268" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="21270" href="#8853" class="InductiveConstructor">#Conat</a><span id="21276" class="Symbol">)</span>
  <a id="21280" href="#21210" class="Function">#buildConat</a> <a id="21292" href="#21292" class="Bound">f</a> <span id="21294" class="Symbol">=</span> <a id="21296" href="#19424" class="Function">#lambda</a> <span id="21304" class="Symbol">(</span><a id="21305" href="#18732" class="InductiveConstructor">wrap</a> <span id="21310" class="Symbol">(</span><a id="21311" href="#12591" class="InductiveConstructor">intr</a> <span id="21316" class="Symbol">(</span><a id="21317" href="#10848" class="InductiveConstructor">intrConat</a> <span id="21327" class="Symbol">(_</span> <a id="21330" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="21333" href="#18641" class="InductiveConstructor">var</a> <a id="21337" href="#6159" class="Function">$0</a> <a id="21340" href="#2431" class="InductiveConstructor Operator">,</a> <a id="21342" href="#19271" class="Function Operator">↑</a> <a id="21344" href="#21292" class="Bound">f</a><span id="21345" class="Symbol">))))</span>

  <a id="6:SomeTerms.#buildStream"></a><a id="21353" href="#21353" class="Function">#buildStream</a> <span id="21366" class="Symbol">:</span> <span id="21368" class="Symbol">∀</span> <span id="21370" class="Symbol">{</span><a id="21371" href="#21371" class="Bound">Γ</a> <a id="21373" href="#21373" class="Bound">τ</a> <a id="21375" href="#21375" class="Bound">ρ</a><span id="21376" class="Symbol">}</span> <span id="21378" class="Symbol">→</span> <a id="21380" href="#18571" class="Datatype">Term</a> <a id="21385" href="#21371" class="Bound">Γ</a> <span id="21387" class="Symbol">(</span><a id="21388" href="#21375" class="Bound">ρ</a> <a id="21390" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="21392" href="#9217" class="Function">#Pair</a> <a id="21398" href="#21373" class="Bound">τ</a> <a id="21400" href="#21375" class="Bound">ρ</a><span id="21401" class="Symbol">)</span> <span id="21403" class="Symbol">→</span> <a id="21405" href="#18571" class="Datatype">Term</a> <a id="21410" href="#21371" class="Bound">Γ</a> <span id="21412" class="Symbol">(</span><a id="21413" href="#21375" class="Bound">ρ</a> <a id="21415" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="21417" href="#8937" class="InductiveConstructor">#Stream</a> <a id="21425" href="#21373" class="Bound">τ</a><span id="21426" class="Symbol">)</span>
  <a id="21430" href="#21353" class="Function">#buildStream</a> <a id="21443" href="#21443" class="Bound">f</a> <span id="21445" class="Symbol">=</span> <a id="21447" href="#19424" class="Function">#lambda</a> <span id="21455" class="Symbol">(</span><a id="21456" href="#18732" class="InductiveConstructor">wrap</a> <span id="21461" class="Symbol">(</span><a id="21462" href="#12591" class="InductiveConstructor">intr</a> <span id="21467" class="Symbol">(</span><a id="21468" href="#11212" class="InductiveConstructor">intrStream</a> <span id="21479" class="Symbol">(_</span> <a id="21482" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="21485" href="#18641" class="InductiveConstructor">var</a> <a id="21489" href="#6159" class="Function">$0</a> <a id="21492" href="#2431" class="InductiveConstructor Operator">,</a> <a id="21494" href="#19271" class="Function Operator">↑</a> <a id="21496" href="#21443" class="Bound">f</a><span id="21497" class="Symbol">))))</span>

<span id="21503" class="Keyword">open</span> <a id="21508" href="#19367" class="Module">6:SomeTerms</a>



<span id="21523" class="Keyword">module</span> <a id="7:CompiledTerm"></a><a id="21530" href="#21530" class="Module">7:CompiledTerm</a> <span id="21545" class="Keyword">where</span>
  <span id="21553" class="Comment">{-
     7. Compiled term representation
  -}</span>

  <span id="21601" class="Keyword">infixr</span> <span id="21608" class="Number">5</span> <a id="21610" href="#21902" class="InductiveConstructor Operator">_▸_</a>
  <span id="21616" class="Keyword">mutual</span>
    <span id="21627" class="Comment">-- Compiled representation of a term</span>
    <span id="21668" class="Keyword">data</span> <a id="7:CompiledTerm.TermC"></a><a id="21673" href="#21673" class="Datatype">TermC</a> <span id="21679" class="Symbol">(</span><a id="21680" href="#21680" class="Bound">Γ</a> <span id="21682" class="Symbol">:</span> <a id="21684" href="#2771" class="Datatype">List</a> <a id="21689" href="#8610" class="Datatype">Type</a><span id="21693" class="Symbol">)</span> <span id="21695" class="Symbol">(</span><a id="21696" href="#21696" class="Bound">τ</a> <span id="21698" class="Symbol">:</span> <a id="21700" href="#8610" class="Datatype">Type</a><span id="21704" class="Symbol">)</span> <span id="21706" class="Symbol">:</span> <span id="21708" class="PrimitiveType">Set</span> <span id="21712" class="Keyword">where</span>
      <span id="21724" class="Comment">-- 'return x': return the value of variable 'x'</span>
      <a id="7:CompiledTerm.TermC.return"></a><a id="21778" href="#21778" class="InductiveConstructor">return</a> <span id="21785" class="Symbol">:</span> <a id="21787" href="#3432" class="Function">Has</a> <a id="21791" href="#21680" class="Bound">Γ</a> <a id="21793" href="#21696" class="Bound">τ</a> <span id="21795" class="Symbol">→</span> <a id="21797" href="#21673" class="Datatype">TermC</a> <a id="21803" href="#21680" class="Bound">Γ</a> <a id="21805" href="#21696" class="Bound">τ</a>

      <span id="21814" class="Comment">-- 'expr ▸ term': compute 'expr', push the result, then proceed to compute 'term'</span>
      <a id="7:CompiledTerm.TermC._▸_"></a><a id="21902" href="#21902" class="InductiveConstructor Operator">_▸_</a>    <span id="21909" class="Symbol">:</span> <span id="21911" class="Symbol">∀</span> <span id="21913" class="Symbol">{</span><a id="21914" href="#21914" class="Bound">ρ</a><span id="21915" class="Symbol">}</span> <span id="21917" class="Symbol">→</span> <a id="21919" href="#12502" class="Datatype">Expr</a> <span id="21924" class="Symbol">(</span><a id="21925" href="#21982" class="Function">AbsTermC</a> <a id="21934" href="#21680" class="Bound">Γ</a><span id="21935" class="Symbol">)</span> <span id="21937" class="Symbol">(</span><a id="21938" href="#3432" class="Function">Has</a> <a id="21942" href="#21680" class="Bound">Γ</a><span id="21943" class="Symbol">)</span> <a id="21945" href="#21914" class="Bound">ρ</a> <span id="21947" class="Symbol">→</span> <a id="21949" href="#21673" class="Datatype">TermC</a> <span id="21955" class="Symbol">(</span><a id="21956" href="#21914" class="Bound">ρ</a> <a id="21958" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="21960" href="#21680" class="Bound">Γ</a><span id="21961" class="Symbol">)</span> <a id="21963" href="#21696" class="Bound">τ</a> <span id="21965" class="Symbol">→</span> <a id="21967" href="#21673" class="Datatype">TermC</a> <a id="21973" href="#21680" class="Bound">Γ</a> <a id="21975" href="#21696" class="Bound">τ</a>

    <a id="7:CompiledTerm.AbsTermC"></a><a id="21982" href="#21982" class="Function">AbsTermC</a> <span id="21991" class="Symbol">:</span> <a id="21993" href="#2771" class="Datatype">List</a> <a id="21998" href="#8610" class="Datatype">Type</a> <span id="22003" class="Symbol">→</span> <span id="22005" class="Symbol">(</span><a id="22006" href="#8610" class="Datatype">Type</a> <span id="22011" class="Symbol">→</span> <a id="22013" href="#8610" class="Datatype">Type</a> <span id="22018" class="Symbol">→</span> <span id="22020" class="PrimitiveType">Set</span><span id="22023" class="Symbol">)</span>
    <a id="22029" href="#21982" class="Function">AbsTermC</a> <a id="22038" href="#22038" class="Bound">Γ</a> <a id="22040" href="#22040" class="Bound">σ</a> <a id="22042" href="#22042" class="Bound">τ</a> <span id="22044" class="Symbol">=</span> <a id="22046" href="#21673" class="Datatype">TermC</a> <span id="22052" class="Symbol">(</span><a id="22053" href="#22040" class="Bound">σ</a> <a id="22055" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="22057" href="#22038" class="Bound">Γ</a><span id="22058" class="Symbol">)</span> <a id="22060" href="#22042" class="Bound">τ</a>

  <span id="22065" class="Comment">-- Compile-time introduction rule</span>
  <a id="7:CompiledTerm.IntrC"></a><a id="22101" href="#22101" class="Function">IntrC</a> <span id="22107" class="Symbol">:</span> <a id="22109" href="#2771" class="Datatype">List</a> <a id="22114" href="#8610" class="Datatype">Type</a> <span id="22119" class="Symbol">→</span> <a id="22121" href="#8610" class="Datatype">Type</a> <span id="22126" class="Symbol">→</span> <span id="22128" class="PrimitiveType">Set</span>
  <a id="22134" href="#22101" class="Function">IntrC</a> <a id="22140" href="#22140" class="Bound">Γ</a> <a id="22142" href="#22142" class="Bound">τ</a> <span id="22144" class="Symbol">=</span> <a id="22146" href="#9811" class="Datatype">Intr</a> <span id="22151" class="Symbol">(</span><a id="22152" href="#21982" class="Function">AbsTermC</a> <a id="22161" href="#22140" class="Bound">Γ</a><span id="22162" class="Symbol">)</span> <span id="22164" class="Symbol">(</span><a id="22165" href="#3432" class="Function">Has</a> <a id="22169" href="#22140" class="Bound">Γ</a><span id="22170" class="Symbol">)</span> <a id="22172" href="#22142" class="Bound">τ</a>

  <span id="22177" class="Comment">-- Compile-time elimination rule</span>
  <a id="7:CompiledTerm.ElimC"></a><a id="22212" href="#22212" class="Function">ElimC</a> <span id="22218" class="Symbol">:</span> <a id="22220" href="#2771" class="Datatype">List</a> <a id="22225" href="#8610" class="Datatype">Type</a> <span id="22230" class="Symbol">→</span> <a id="22232" href="#8610" class="Datatype">Type</a> <span id="22237" class="Symbol">→</span> <a id="22239" href="#8610" class="Datatype">Type</a> <span id="22244" class="Symbol">→</span> <span id="22246" class="PrimitiveType">Set</span>
  <a id="22252" href="#22212" class="Function">ElimC</a> <a id="22258" href="#22258" class="Bound">Γ</a> <a id="22260" href="#22260" class="Bound">τ</a> <a id="22262" href="#22262" class="Bound">ϕ</a> <span id="22264" class="Symbol">=</span> <a id="22266" href="#11351" class="Datatype">Elim</a> <span id="22271" class="Symbol">(</span><a id="22272" href="#3432" class="Function">Has</a> <a id="22276" href="#22258" class="Bound">Γ</a><span id="22277" class="Symbol">)</span> <a id="22279" href="#22260" class="Bound">τ</a> <a id="22281" href="#22262" class="Bound">ϕ</a>

  <span id="22286" class="Comment">-- Maps a function to each variable in a term</span>
  <span id="22334" class="Symbol">{-#</span> <span id="22338" class="Keyword">TERMINATING</span> <span id="22350" class="Symbol">#-}</span> <span id="22354" class="Comment">-- terminating because it preserves structure, inlining 'mapExpr' would convince Agda</span>
  <a id="7:CompiledTerm.mapTermC"></a><a id="22442" href="#22442" class="Function">mapTermC</a> <span id="22451" class="Symbol">:</span> <span id="22453" class="Symbol">∀</span> <span id="22455" class="Symbol">{</span><a id="22456" href="#22456" class="Bound">Γ</a> <a id="22458" href="#22458" class="Bound">Δ</a> <a id="22460" href="#22460" class="Bound">τ</a><span id="22461" class="Symbol">}</span> <span id="22463" class="Symbol">→</span> <span id="22465" class="Symbol">(∀</span> <span id="22468" class="Symbol">{</span><a id="22469" href="#22469" class="Bound">ϕ</a><span id="22470" class="Symbol">}</span> <span id="22472" class="Symbol">→</span> <a id="22474" href="#3432" class="Function">Has</a> <a id="22478" href="#22456" class="Bound">Γ</a> <a id="22480" href="#22469" class="Bound">ϕ</a> <span id="22482" class="Symbol">→</span> <a id="22484" href="#3432" class="Function">Has</a> <a id="22488" href="#22458" class="Bound">Δ</a> <a id="22490" href="#22469" class="Bound">ϕ</a><span id="22491" class="Symbol">)</span> <span id="22493" class="Symbol">→</span> <span id="22495" class="Symbol">(</span><a id="22496" href="#21673" class="Datatype">TermC</a> <a id="22502" href="#22456" class="Bound">Γ</a> <a id="22504" href="#22460" class="Bound">τ</a> <span id="22506" class="Symbol">→</span> <a id="22508" href="#21673" class="Datatype">TermC</a> <a id="22514" href="#22458" class="Bound">Δ</a> <a id="22516" href="#22460" class="Bound">τ</a><span id="22517" class="Symbol">)</span>
  <a id="22521" href="#22442" class="Function">mapTermC</a> <a id="22530" href="#22530" class="Bound">f</a> <span id="22532" class="Symbol">(</span><a id="22533" href="#21778" class="InductiveConstructor">return</a> <a id="22540" href="#22540" class="Bound">x</a><span id="22541" class="Symbol">)</span> <span id="22543" class="Symbol">=</span> <a id="22545" href="#21778" class="InductiveConstructor">return</a> <span id="22552" class="Symbol">(</span><a id="22553" href="#22530" class="Bound">f</a> <a id="22555" href="#22540" class="Bound">x</a><span id="22556" class="Symbol">)</span>
  <a id="22560" href="#22442" class="Function">mapTermC</a> <a id="22569" href="#22569" class="Bound">f</a> <span id="22571" class="Symbol">(</span><a id="22572" href="#22572" class="Bound">expr</a> <a id="22577" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="22579" href="#22579" class="Bound">term</a><span id="22583" class="Symbol">)</span> <span id="22585" class="Symbol">=</span> <a id="22587" href="#13981" class="Function">mapExpr</a> <span id="22595" class="Symbol">(</span><a id="22596" href="#22442" class="Function">mapTermC</a> <span id="22605" class="Symbol">(</span><a id="22606" href="#8088" class="Function">has-prepend</a> <a id="22618" href="#22569" class="Bound">f</a> <span id="22620" class="Symbol">_))</span> <a id="22624" href="#22569" class="Bound">f</a> <a id="22626" href="#22572" class="Bound">expr</a> <a id="22631" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="22633" href="#22442" class="Function">mapTermC</a> <span id="22642" class="Symbol">(</span><a id="22643" href="#8088" class="Function">has-prepend</a> <a id="22655" href="#22569" class="Bound">f</a> <span id="22657" class="Symbol">_)</span> <a id="22660" href="#22579" class="Bound">term</a>

  <span id="22668" class="Comment">-- Term computing a single expression</span>
  <a id="7:CompiledTerm.pure"></a><a id="22708" href="#22708" class="Function">pure</a> <span id="22713" class="Symbol">:</span> <span id="22715" class="Symbol">∀</span> <span id="22717" class="Symbol">{</span><a id="22718" href="#22718" class="Bound">Γ</a> <a id="22720" href="#22720" class="Bound">τ</a><span id="22721" class="Symbol">}</span> <span id="22723" class="Symbol">→</span> <a id="22725" href="#12502" class="Datatype">Expr</a> <span id="22730" class="Symbol">(</span><a id="22731" href="#21982" class="Function">AbsTermC</a> <a id="22740" href="#22718" class="Bound">Γ</a><span id="22741" class="Symbol">)</span> <span id="22743" class="Symbol">(</span><a id="22744" href="#3432" class="Function">Has</a> <a id="22748" href="#22718" class="Bound">Γ</a><span id="22749" class="Symbol">)</span> <a id="22751" href="#22720" class="Bound">τ</a> <span id="22753" class="Symbol">→</span> <a id="22755" href="#21673" class="Datatype">TermC</a> <a id="22761" href="#22718" class="Bound">Γ</a> <a id="22763" href="#22720" class="Bound">τ</a>
  <a id="22767" href="#22708" class="Function">pure</a> <a id="22772" href="#22772" class="Bound">expr</a> <span id="22777" class="Symbol">=</span> <a id="22779" href="#22772" class="Bound">expr</a> <a id="22784" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="22786" href="#21778" class="InductiveConstructor">return</a> <a id="22793" href="#6159" class="Function">$0</a>

<span id="22797" class="Keyword">open</span> <a id="22802" href="#21530" class="Module">7:CompiledTerm</a>



<span id="22820" class="Keyword">module</span> <a id="8:Compilation"></a><a id="22827" href="#22827" class="Module">8:Compilation</a> <span id="22841" class="Keyword">where</span>
  <span id="22849" class="Comment">{-
     8. Compilation
  -}</span>

  <span id="22880" class="Keyword">infixr</span> <span id="22887" class="Number">5</span> <a id="22889" href="#23022" class="InductiveConstructor Operator">_∷ₗ_</a>
  <span id="22896" class="Keyword">data</span> <a id="8:Compilation.Linear"></a><a id="22901" href="#22901" class="Datatype">Linear</a> <span id="22908" class="Symbol">{</span><a id="22909" href="#22909" class="Bound">Ω</a> <span id="22911" class="Symbol">:</span> <span id="22913" class="PrimitiveType">Set</span><span id="22916" class="Symbol">}</span> <span id="22918" class="Symbol">(</span><a id="22919" href="#22919" class="Bound">%V</a> <span id="22922" class="Symbol">:</span> <a id="22924" href="#22909" class="Bound">Ω</a> <span id="22926" class="Symbol">→</span> <span id="22928" class="PrimitiveType">Set</span><span id="22931" class="Symbol">)</span> <span id="22933" class="Symbol">(</span><a id="22934" href="#22934" class="Bound">%E</a> <span id="22937" class="Symbol">:</span> <a id="22939" href="#2771" class="Datatype">List</a> <a id="22944" href="#22909" class="Bound">Ω</a> <span id="22946" class="Symbol">→</span> <span id="22948" class="PrimitiveType">Set</span><span id="22951" class="Symbol">)</span> <span id="22953" class="Symbol">:</span> <a id="22955" href="#2771" class="Datatype">List</a> <a id="22960" href="#22909" class="Bound">Ω</a> <span id="22962" class="Symbol">→</span> <span id="22964" class="PrimitiveType">Set</span> <span id="22968" class="Keyword">where</span>
    <a id="8:Compilation.Linear.εₗ"></a><a id="22978" href="#22978" class="InductiveConstructor">εₗ</a>   <span id="22983" class="Symbol">:</span> <span id="22985" class="Symbol">∀</span> <span id="22987" class="Symbol">{</span><a id="22988" href="#22988" class="Bound">ρs</a><span id="22990" class="Symbol">}</span> <span id="22992" class="Symbol">→</span> <a id="22994" href="#22934" class="Bound">%E</a> <a id="22997" href="#22988" class="Bound">ρs</a> <span id="23000" class="Symbol">→</span> <a id="23002" href="#22901" class="Datatype">Linear</a> <a id="23009" href="#22919" class="Bound">%V</a> <a id="23012" href="#22934" class="Bound">%E</a> <a id="23015" href="#22988" class="Bound">ρs</a>
    <a id="8:Compilation.Linear._∷ₗ_"></a><a id="23022" href="#23022" class="InductiveConstructor Operator">_∷ₗ_</a> <span id="23027" class="Symbol">:</span> <span id="23029" class="Symbol">∀</span> <span id="23031" class="Symbol">{</span><a id="23032" href="#23032" class="Bound">ρ</a> <a id="23034" href="#23034" class="Bound">ρs</a><span id="23036" class="Symbol">}</span> <span id="23038" class="Symbol">→</span> <a id="23040" href="#22919" class="Bound">%V</a> <a id="23043" href="#23032" class="Bound">ρ</a> <span id="23045" class="Symbol">→</span> <a id="23047" href="#22901" class="Datatype">Linear</a> <a id="23054" href="#22919" class="Bound">%V</a> <a id="23057" href="#22934" class="Bound">%E</a> <span id="23060" class="Symbol">(</span><a id="23061" href="#23032" class="Bound">ρ</a> <a id="23063" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="23065" href="#23034" class="Bound">ρs</a><span id="23067" class="Symbol">)</span> <span id="23069" class="Symbol">→</span> <a id="23071" href="#22901" class="Datatype">Linear</a> <a id="23078" href="#22919" class="Bound">%V</a> <a id="23081" href="#22934" class="Bound">%E</a> <a id="23084" href="#23034" class="Bound">ρs</a>

  <a id="8:Compilation.mapLinear"></a><a id="23090" href="#23090" class="Function">mapLinear</a>
      <span id="23106" class="Symbol">:</span> <span id="23108" class="Symbol">{</span><a id="23109" href="#23109" class="Bound">Ω</a> <span id="23111" class="Symbol">:</span> <span id="23113" class="PrimitiveType">Set</span><span id="23116" class="Symbol">}</span> <span id="23118" class="Symbol">{</span><a id="23119" href="#23119" class="Bound">%V</a> <span id="23122" class="Symbol">:</span> <a id="23124" href="#23109" class="Bound">Ω</a> <span id="23126" class="Symbol">→</span> <span id="23128" class="PrimitiveType">Set</span><span id="23131" class="Symbol">}</span> <span id="23133" class="Symbol">{</span><a id="23134" href="#23134" class="Bound">%E1</a> <a id="23138" href="#23138" class="Bound">%E2</a> <span id="23142" class="Symbol">:</span> <a id="23144" href="#2771" class="Datatype">List</a> <a id="23149" href="#23109" class="Bound">Ω</a> <span id="23151" class="Symbol">→</span> <span id="23153" class="PrimitiveType">Set</span><span id="23156" class="Symbol">}</span>
      <span id="23164" class="Symbol">→</span> <span id="23166" class="Symbol">(∀</span> <span id="23169" class="Symbol">{</span><a id="23170" href="#23170" class="Bound">τs</a><span id="23172" class="Symbol">}</span> <span id="23174" class="Symbol">→</span> <a id="23176" href="#23134" class="Bound">%E1</a> <a id="23180" href="#23170" class="Bound">τs</a> <span id="23183" class="Symbol">→</span> <a id="23185" href="#23138" class="Bound">%E2</a> <a id="23189" href="#23170" class="Bound">τs</a><span id="23191" class="Symbol">)</span> <span id="23193" class="Symbol">→</span> <span id="23195" class="Symbol">(∀</span> <span id="23198" class="Symbol">{</span><a id="23199" href="#23199" class="Bound">τs</a><span id="23201" class="Symbol">}</span> <span id="23203" class="Symbol">→</span> <a id="23205" href="#22901" class="Datatype">Linear</a> <a id="23212" href="#23119" class="Bound">%V</a> <a id="23215" href="#23134" class="Bound">%E1</a> <a id="23219" href="#23199" class="Bound">τs</a> <span id="23222" class="Symbol">→</span> <a id="23224" href="#22901" class="Datatype">Linear</a> <a id="23231" href="#23119" class="Bound">%V</a> <a id="23234" href="#23138" class="Bound">%E2</a> <a id="23238" href="#23199" class="Bound">τs</a><span id="23240" class="Symbol">)</span>
  <a id="23244" href="#23090" class="Function">mapLinear</a> <a id="23254" href="#23254" class="Bound">f</a> <span id="23256" class="Symbol">(</span><a id="23257" href="#22978" class="InductiveConstructor">εₗ</a> <a id="23260" href="#23260" class="Bound">x</a><span id="23261" class="Symbol">)</span>   <span id="23265" class="Symbol">=</span> <a id="23267" href="#22978" class="InductiveConstructor">εₗ</a> <span id="23270" class="Symbol">(</span><a id="23271" href="#23254" class="Bound">f</a> <a id="23273" href="#23260" class="Bound">x</a><span id="23274" class="Symbol">)</span>
  <a id="23278" href="#23090" class="Function">mapLinear</a> <a id="23288" href="#23288" class="Bound">f</a> <span id="23290" class="Symbol">(</span><a id="23291" href="#23291" class="Bound">v</a> <a id="23293" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="23296" href="#23296" class="Bound">l</a><span id="23297" class="Symbol">)</span> <span id="23299" class="Symbol">=</span> <a id="23301" href="#23291" class="Bound">v</a> <a id="23303" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="23306" href="#23090" class="Function">mapLinear</a> <a id="23316" href="#23288" class="Bound">f</a> <a id="23318" href="#23296" class="Bound">l</a>

  <a id="8:Compilation.mapLinear'"></a><a id="23323" href="#23323" class="Function">mapLinear'</a>
      <span id="23340" class="Symbol">:</span> <span id="23342" class="Symbol">{</span><a id="23343" href="#23343" class="Bound">Ω</a> <span id="23345" class="Symbol">:</span> <span id="23347" class="PrimitiveType">Set</span><span id="23350" class="Symbol">}</span> <span id="23352" class="Symbol">{</span><a id="23353" href="#23353" class="Bound">%V</a> <span id="23356" class="Symbol">:</span> <a id="23358" href="#23343" class="Bound">Ω</a> <span id="23360" class="Symbol">→</span> <span id="23362" class="PrimitiveType">Set</span><span id="23365" class="Symbol">}</span> <span id="23367" class="Symbol">{</span><a id="23368" href="#23368" class="Bound">%E1</a> <a id="23372" href="#23372" class="Bound">%E2</a> <span id="23376" class="Symbol">:</span> <a id="23378" href="#2771" class="Datatype">List</a> <a id="23383" href="#23343" class="Bound">Ω</a> <span id="23385" class="Symbol">→</span> <span id="23387" class="PrimitiveType">Set</span><span id="23390" class="Symbol">}</span> <span id="23392" class="Symbol">{</span><a id="23393" href="#23393" class="Bound">Γ</a> <span id="23395" class="Symbol">:</span> <a id="23397" href="#2771" class="Datatype">List</a> <a id="23402" href="#23343" class="Bound">Ω</a><span id="23403" class="Symbol">}</span>
      <span id="23411" class="Symbol">→</span> <span id="23413" class="Symbol">(∀</span> <span id="23416" class="Symbol">{</span><a id="23417" href="#23417" class="Bound">τs</a><span id="23419" class="Symbol">}</span> <span id="23421" class="Symbol">→</span> <a id="23423" href="#23368" class="Bound">%E1</a> <a id="23427" href="#23417" class="Bound">τs</a> <span id="23430" class="Symbol">→</span> <a id="23432" href="#23372" class="Bound">%E2</a> <span id="23436" class="Symbol">(</span><a id="23437" href="#23417" class="Bound">τs</a> <a id="23440" href="#7002" class="Function Operator">++</a> <a id="23443" href="#23393" class="Bound">Γ</a><span id="23444" class="Symbol">))</span> <span id="23447" class="Symbol">→</span> <span id="23449" class="Symbol">(∀</span> <span id="23452" class="Symbol">{</span><a id="23453" href="#23453" class="Bound">τs</a><span id="23455" class="Symbol">}</span> <span id="23457" class="Symbol">→</span> <a id="23459" href="#22901" class="Datatype">Linear</a> <a id="23466" href="#23353" class="Bound">%V</a> <a id="23469" href="#23368" class="Bound">%E1</a> <a id="23473" href="#23453" class="Bound">τs</a> <span id="23476" class="Symbol">→</span> <a id="23478" href="#22901" class="Datatype">Linear</a> <a id="23485" href="#23353" class="Bound">%V</a> <a id="23488" href="#23372" class="Bound">%E2</a> <span id="23492" class="Symbol">(</span><a id="23493" href="#23453" class="Bound">τs</a> <a id="23496" href="#7002" class="Function Operator">++</a> <a id="23499" href="#23393" class="Bound">Γ</a><span id="23500" class="Symbol">))</span>
  <a id="23505" href="#23323" class="Function">mapLinear'</a> <a id="23516" href="#23516" class="Bound">f</a> <span id="23518" class="Symbol">(</span><a id="23519" href="#22978" class="InductiveConstructor">εₗ</a> <a id="23522" href="#23522" class="Bound">x</a><span id="23523" class="Symbol">)</span>   <span id="23527" class="Symbol">=</span> <a id="23529" href="#22978" class="InductiveConstructor">εₗ</a> <span id="23532" class="Symbol">(</span><a id="23533" href="#23516" class="Bound">f</a> <a id="23535" href="#23522" class="Bound">x</a><span id="23536" class="Symbol">)</span>
  <a id="23540" href="#23323" class="Function">mapLinear'</a> <a id="23551" href="#23551" class="Bound">f</a> <span id="23553" class="Symbol">(</span><a id="23554" href="#23554" class="Bound">v</a> <a id="23556" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="23559" href="#23559" class="Bound">l</a><span id="23560" class="Symbol">)</span> <span id="23562" class="Symbol">=</span> <a id="23564" href="#23554" class="Bound">v</a> <a id="23566" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="23569" href="#23323" class="Function">mapLinear'</a> <a id="23580" href="#23551" class="Bound">f</a> <a id="23582" href="#23559" class="Bound">l</a>

  <a id="8:Compilation.linizeAny"></a><a id="23587" href="#23587" class="Function">linizeAny</a>
      <span id="23603" class="Symbol">:</span> <span id="23605" class="Symbol">{</span><a id="23606" href="#23606" class="Bound">Ω</a> <span id="23608" class="Symbol">:</span> <span id="23610" class="PrimitiveType">Set</span><span id="23613" class="Symbol">}</span> <span id="23615" class="Symbol">{</span><a id="23616" href="#23616" class="Bound">%V</a> <span id="23619" class="Symbol">:</span> <a id="23621" href="#23606" class="Bound">Ω</a> <span id="23623" class="Symbol">→</span> <span id="23625" class="PrimitiveType">Set</span><span id="23628" class="Symbol">}</span> <span id="23630" class="Symbol">{</span><a id="23631" href="#23631" class="Bound">τs</a> <span id="23634" class="Symbol">:</span> <a id="23636" href="#2771" class="Datatype">List</a> <a id="23641" href="#23606" class="Bound">Ω</a><span id="23642" class="Symbol">}</span>
      <span id="23650" class="Symbol">→</span> <span id="23652" class="Symbol">(</span><a id="23653" href="#23653" class="Bound">κ</a> <span id="23655" class="Symbol">:</span> <a id="23657" href="#23606" class="Bound">Ω</a> <span id="23659" class="Symbol">→</span> <a id="23661" href="#23606" class="Bound">Ω</a><span id="23662" class="Symbol">)</span> <span id="23664" class="Symbol">→</span> <a id="23666" href="#3235" class="Datatype">Any</a> <span id="23670" class="Symbol">(\</span><a id="23672" href="#23672" class="Bound">τ</a> <span id="23674" class="Symbol">→</span> <a id="23676" href="#23616" class="Bound">%V</a> <span id="23679" class="Symbol">(</span><a id="23680" href="#23653" class="Bound">κ</a> <a id="23682" href="#23672" class="Bound">τ</a><span id="23683" class="Symbol">))</span> <a id="23686" href="#23631" class="Bound">τs</a> <span id="23689" class="Symbol">→</span> <a id="23691" href="#22901" class="Datatype">Linear</a> <a id="23698" href="#23616" class="Bound">%V</a> <span id="23701" class="Symbol">(\</span><a id="23703" href="#23703" class="Bound">ρs</a> <span id="23706" class="Symbol">→</span> <a id="23708" href="#3235" class="Datatype">Any</a> <span id="23712" class="Symbol">(\</span><a id="23714" href="#23714" class="Bound">τ</a> <span id="23716" class="Symbol">→</span> <a id="23718" href="#3432" class="Function">Has</a> <a id="23722" href="#23703" class="Bound">ρs</a> <span id="23725" class="Symbol">(</span><a id="23726" href="#23653" class="Bound">κ</a> <a id="23728" href="#23714" class="Bound">τ</a><span id="23729" class="Symbol">))</span> <a id="23732" href="#23631" class="Bound">τs</a><span id="23734" class="Symbol">)</span> <a id="23736" href="#2802" class="InductiveConstructor">ε</a>
  <a id="23740" href="#23587" class="Function">linizeAny</a> <a id="23750" href="#23750" class="Bound">κ</a> <span id="23752" class="Symbol">(</span><a id="23753" href="#3288" class="InductiveConstructor">here</a> <a id="23758" href="#23758" class="Bound">v</a><span id="23759" class="Symbol">)</span>   <span id="23763" class="Symbol">=</span> <a id="23765" href="#23758" class="Bound">v</a> <a id="23767" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="23770" href="#22978" class="InductiveConstructor">εₗ</a> <span id="23773" class="Symbol">(</span><a id="23774" href="#3288" class="InductiveConstructor">here</a> <a id="23779" href="#6159" class="Function">$0</a><span id="23781" class="Symbol">)</span>
  <a id="23785" href="#23587" class="Function">linizeAny</a> <a id="23795" href="#23795" class="Bound">κ</a> <span id="23797" class="Symbol">(</span><a id="23798" href="#3332" class="InductiveConstructor">there</a> <a id="23804" href="#23804" class="Bound">vᵢ</a><span id="23806" class="Symbol">)</span> <span id="23808" class="Symbol">=</span> <a id="23810" href="#23090" class="Function">mapLinear</a> <a id="23820" href="#3332" class="InductiveConstructor">there</a> <span id="23826" class="Symbol">(</span><a id="23827" href="#23587" class="Function">linizeAny</a> <a id="23837" href="#23795" class="Bound">κ</a> <a id="23839" href="#23804" class="Bound">vᵢ</a><span id="23841" class="Symbol">)</span>

  <a id="8:Compilation.linizeAll"></a><a id="23846" href="#23846" class="Function">linizeAll</a>
      <span id="23862" class="Symbol">:</span> <span id="23864" class="Symbol">{</span><a id="23865" href="#23865" class="Bound">Ω</a> <span id="23867" class="Symbol">:</span> <span id="23869" class="PrimitiveType">Set</span><span id="23872" class="Symbol">}</span> <span id="23874" class="Symbol">{</span><a id="23875" href="#23875" class="Bound">%V</a> <span id="23878" class="Symbol">:</span> <a id="23880" href="#23865" class="Bound">Ω</a> <span id="23882" class="Symbol">→</span> <span id="23884" class="PrimitiveType">Set</span><span id="23887" class="Symbol">}</span> <span id="23889" class="Symbol">{</span><a id="23890" href="#23890" class="Bound">τs</a> <span id="23893" class="Symbol">:</span> <a id="23895" href="#2771" class="Datatype">List</a> <a id="23900" href="#23865" class="Bound">Ω</a><span id="23901" class="Symbol">}</span>
      <span id="23909" class="Symbol">→</span> <span id="23911" class="Symbol">(</span><a id="23912" href="#23912" class="Bound">κ</a> <span id="23914" class="Symbol">:</span> <a id="23916" href="#23865" class="Bound">Ω</a> <span id="23918" class="Symbol">→</span> <a id="23920" href="#23865" class="Bound">Ω</a><span id="23921" class="Symbol">)</span> <span id="23923" class="Symbol">→</span> <a id="23925" href="#2877" class="Datatype">All</a> <span id="23929" class="Symbol">(\</span><a id="23931" href="#23931" class="Bound">τ</a> <span id="23933" class="Symbol">→</span> <a id="23935" href="#23875" class="Bound">%V</a> <span id="23938" class="Symbol">(</span><a id="23939" href="#23912" class="Bound">κ</a> <a id="23941" href="#23931" class="Bound">τ</a><span id="23942" class="Symbol">))</span> <a id="23945" href="#23890" class="Bound">τs</a> <span id="23948" class="Symbol">→</span> <a id="23950" href="#22901" class="Datatype">Linear</a> <a id="23957" href="#23875" class="Bound">%V</a> <span id="23960" class="Symbol">(\</span><a id="23962" href="#23962" class="Bound">ρs</a> <span id="23965" class="Symbol">→</span> <a id="23967" href="#2877" class="Datatype">All</a> <span id="23971" class="Symbol">(\</span><a id="23973" href="#23973" class="Bound">τ</a> <span id="23975" class="Symbol">→</span> <a id="23977" href="#3432" class="Function">Has</a> <a id="23981" href="#23962" class="Bound">ρs</a> <span id="23984" class="Symbol">(</span><a id="23985" href="#23912" class="Bound">κ</a> <a id="23987" href="#23973" class="Bound">τ</a><span id="23988" class="Symbol">))</span> <a id="23991" href="#23890" class="Bound">τs</a><span id="23993" class="Symbol">)</span> <a id="23995" href="#2802" class="InductiveConstructor">ε</a>
  <a id="23999" href="#23846" class="Function">linizeAll</a> <a id="24009" href="#24009" class="Bound">κ</a>  <a id="24012" href="#2930" class="InductiveConstructor">ε</a>       <span id="24020" class="Symbol">=</span> <a id="24022" href="#22978" class="InductiveConstructor">εₗ</a> <a id="24025" href="#2930" class="InductiveConstructor">ε</a>
  <a id="24029" href="#23846" class="Function">linizeAll</a> <a id="24039" href="#24039" class="Bound">κ</a> <span id="24041" class="Symbol">(</span><a id="24042" href="#24042" class="Bound">v</a> <a id="24044" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="24046" href="#24046" class="Bound">vs</a><span id="24048" class="Symbol">)</span> <span id="24050" class="Symbol">=</span> <a id="24052" href="#24042" class="Bound">v</a> <a id="24054" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="24057" href="#23323" class="Function">mapLinear'</a> <span id="24068" class="Symbol">(\</span><a id="24070" href="#24070" class="Bound">vs'</a> <span id="24074" class="Symbol">→</span> <a id="24076" href="#7147" class="Function">has-skip</a> <span id="24085" class="Symbol">_</span> <a id="24087" href="#6159" class="Function">$0</a> <a id="24090" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="24092" href="#4616" class="Function">mapAll</a> <span id="24099" class="Symbol">(</span><a id="24100" href="#7315" class="Function">has-append</a> <span id="24111" class="Symbol">_)</span> <a id="24114" href="#24070" class="Bound">vs'</a><span id="24117" class="Symbol">)</span> <span id="24119" class="Symbol">(</span><a id="24120" href="#23846" class="Function">linizeAll</a> <a id="24130" href="#24039" class="Bound">κ</a> <a id="24132" href="#24046" class="Bound">vs</a><span id="24134" class="Symbol">)</span>

  <a id="8:Compilation.linizeIntr"></a><a id="24139" href="#24139" class="Function">linizeIntr</a> <span id="24150" class="Symbol">:</span> <span id="24152" class="Symbol">∀</span> <span id="24154" class="Symbol">{</span><a id="24155" href="#24155" class="Bound">%A</a> <a id="24158" href="#24158" class="Bound">%V</a> <a id="24161" href="#24161" class="Bound">τ</a><span id="24162" class="Symbol">}</span> <span id="24164" class="Symbol">→</span> <a id="24166" href="#9811" class="Datatype">Intr</a> <a id="24171" href="#24155" class="Bound">%A</a> <a id="24174" href="#24158" class="Bound">%V</a> <a id="24177" href="#24161" class="Bound">τ</a> <span id="24179" class="Symbol">→</span> <a id="24181" href="#22901" class="Datatype">Linear</a> <a id="24188" href="#24158" class="Bound">%V</a> <span id="24191" class="Symbol">(\</span><a id="24193" href="#24193" class="Bound">ρs</a> <span id="24196" class="Symbol">→</span> <a id="24198" href="#9811" class="Datatype">Intr</a> <a id="24203" href="#24155" class="Bound">%A</a> <span id="24206" class="Symbol">(</span><a id="24207" href="#3432" class="Function">Has</a> <a id="24211" href="#24193" class="Bound">ρs</a><span id="24213" class="Symbol">)</span> <a id="24215" href="#24161" class="Bound">τ</a><span id="24216" class="Symbol">)</span> <a id="24218" href="#2802" class="InductiveConstructor">ε</a>
  <a id="24222" href="#24139" class="Function">linizeIntr</a> <span id="24233" class="Symbol">(</span><a id="24234" href="#9949" class="InductiveConstructor">intrArrow</a> <a id="24244" href="#24244" class="Bound">e</a><span id="24245" class="Symbol">)</span>             <span id="24259" class="Symbol">=</span> <a id="24261" href="#22978" class="InductiveConstructor">εₗ</a> <span id="24264" class="Symbol">(</span><a id="24265" href="#9949" class="InductiveConstructor">intrArrow</a> <a id="24275" href="#24244" class="Bound">e</a><span id="24276" class="Symbol">)</span>
  <a id="24280" href="#24139" class="Function">linizeIntr</a> <span id="24291" class="Symbol">(</span><a id="24292" href="#10102" class="InductiveConstructor">intrSum</a> <a id="24300" href="#24300" class="Bound">vᵢ</a><span id="24302" class="Symbol">)</span>              <span id="24317" class="Symbol">=</span> <a id="24319" href="#23090" class="Function">mapLinear</a> <a id="24329" href="#10102" class="InductiveConstructor">intrSum</a> <span id="24337" class="Symbol">(</span><a id="24338" href="#23587" class="Function">linizeAny</a> <a id="24348" href="#5739" class="Function">identity</a> <a id="24357" href="#24300" class="Bound">vᵢ</a><span id="24359" class="Symbol">)</span>
  <a id="24363" href="#24139" class="Function">linizeIntr</a> <span id="24374" class="Symbol">(</span><a id="24375" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="24387" href="#24387" class="Bound">vs</a><span id="24389" class="Symbol">)</span>          <span id="24400" class="Symbol">=</span> <a id="24402" href="#23090" class="Function">mapLinear</a> <a id="24412" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="24424" class="Symbol">(</span><a id="24425" href="#23846" class="Function">linizeAll</a> <a id="24435" href="#5739" class="Function">identity</a> <a id="24444" href="#24387" class="Bound">vs</a><span id="24446" class="Symbol">)</span>
  <a id="24450" href="#24139" class="Function">linizeIntr</a> <span id="24461" class="Symbol">(</span><a id="24462" href="#10481" class="InductiveConstructor">intrNat</a> <a id="24470" href="#24470" class="Bound">v</a><span id="24471" class="Symbol">)</span>               <span id="24487" class="Symbol">=</span> <a id="24489" href="#24470" class="Bound">v</a> <a id="24491" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="24494" href="#22978" class="InductiveConstructor">εₗ</a> <span id="24497" class="Symbol">(</span><a id="24498" href="#10481" class="InductiveConstructor">intrNat</a> <a id="24506" href="#6159" class="Function">$0</a><span id="24508" class="Symbol">)</span>
  <a id="24512" href="#24139" class="Function">linizeIntr</a> <span id="24523" class="Symbol">(</span><a id="24524" href="#10848" class="InductiveConstructor">intrConat</a> <span id="24534" class="Symbol">(</span><a id="24535" href="#24535" class="Bound">ρ</a> <a id="24537" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="24540" href="#24540" class="Bound">v</a> <a id="24542" href="#2431" class="InductiveConstructor Operator">,</a> <a id="24544" href="#24544" class="Bound">f</a><span id="24545" class="Symbol">))</span>  <span id="24549" class="Symbol">=</span> <a id="24551" href="#24540" class="Bound">v</a> <a id="24553" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="24556" href="#24544" class="Bound">f</a> <a id="24558" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="24561" href="#22978" class="InductiveConstructor">εₗ</a> <span id="24564" class="Symbol">(</span><a id="24565" href="#10848" class="InductiveConstructor">intrConat</a> <span id="24575" class="Symbol">(</span><a id="24576" href="#24535" class="Bound">ρ</a> <a id="24578" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="24581" href="#6213" class="Function">$1</a> <a id="24584" href="#2431" class="InductiveConstructor Operator">,</a> <a id="24586" href="#6159" class="Function">$0</a><span id="24588" class="Symbol">))</span>
  <a id="24593" href="#24139" class="Function">linizeIntr</a> <span id="24604" class="Symbol">(</span><a id="24605" href="#11212" class="InductiveConstructor">intrStream</a> <span id="24616" class="Symbol">(</span><a id="24617" href="#24617" class="Bound">ρ</a> <a id="24619" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="24622" href="#24622" class="Bound">v</a> <a id="24624" href="#2431" class="InductiveConstructor Operator">,</a> <a id="24626" href="#24626" class="Bound">f</a><span id="24627" class="Symbol">))</span> <span id="24630" class="Symbol">=</span> <a id="24632" href="#24622" class="Bound">v</a> <a id="24634" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="24637" href="#24626" class="Bound">f</a> <a id="24639" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="24642" href="#22978" class="InductiveConstructor">εₗ</a> <span id="24645" class="Symbol">(</span><a id="24646" href="#11212" class="InductiveConstructor">intrStream</a> <span id="24657" class="Symbol">(</span><a id="24658" href="#24617" class="Bound">ρ</a> <a id="24660" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="24663" href="#6213" class="Function">$1</a> <a id="24666" href="#2431" class="InductiveConstructor Operator">,</a> <a id="24668" href="#6159" class="Function">$0</a><span id="24670" class="Symbol">))</span>

  <a id="8:Compilation.linizeElim"></a><a id="24676" href="#24676" class="Function">linizeElim</a> <span id="24687" class="Symbol">:</span> <span id="24689" class="Symbol">∀</span> <span id="24691" class="Symbol">{</span><a id="24692" href="#24692" class="Bound">%V</a> <a id="24695" href="#24695" class="Bound">τ</a> <a id="24697" href="#24697" class="Bound">ϕ</a><span id="24698" class="Symbol">}</span> <span id="24700" class="Symbol">→</span> <a id="24702" href="#11351" class="Datatype">Elim</a> <a id="24707" href="#24692" class="Bound">%V</a> <a id="24710" href="#24695" class="Bound">τ</a> <a id="24712" href="#24697" class="Bound">ϕ</a> <span id="24714" class="Symbol">→</span> <a id="24716" href="#22901" class="Datatype">Linear</a> <a id="24723" href="#24692" class="Bound">%V</a> <span id="24726" class="Symbol">(\</span><a id="24728" href="#24728" class="Bound">ρs</a> <span id="24731" class="Symbol">→</span> <a id="24733" href="#11351" class="Datatype">Elim</a> <span id="24738" class="Symbol">(</span><a id="24739" href="#3432" class="Function">Has</a> <a id="24743" href="#24728" class="Bound">ρs</a><span id="24745" class="Symbol">)</span> <a id="24747" href="#24695" class="Bound">τ</a> <a id="24749" href="#24697" class="Bound">ϕ</a><span id="24750" class="Symbol">)</span> <a id="24752" href="#2802" class="InductiveConstructor">ε</a>
  <a id="24756" href="#24676" class="Function">linizeElim</a> <span id="24767" class="Symbol">(</span><a id="24768" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="24778" href="#24778" class="Bound">v</a><span id="24779" class="Symbol">)</span>   <span id="24783" class="Symbol">=</span> <a id="24785" href="#24778" class="Bound">v</a> <a id="24787" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="24790" href="#22978" class="InductiveConstructor">εₗ</a> <span id="24793" class="Symbol">(</span><a id="24794" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="24804" href="#6159" class="Function">$0</a><span id="24806" class="Symbol">)</span>
  <a id="24810" href="#24676" class="Function">linizeElim</a> <span id="24821" class="Symbol">(</span><a id="24822" href="#11670" class="InductiveConstructor">elimSum</a> <a id="24830" href="#24830" class="Bound">f</a><span id="24831" class="Symbol">)</span>     <span id="24837" class="Symbol">=</span> <a id="24839" href="#23090" class="Function">mapLinear</a> <a id="24849" href="#11670" class="InductiveConstructor">elimSum</a> <span id="24857" class="Symbol">(</span><a id="24858" href="#23846" class="Function">linizeAll</a> <span id="24868" class="Symbol">(\</span><a id="24870" href="#24870" class="Bound">τ</a> <span id="24872" class="Symbol">→</span> <a id="24874" href="#24870" class="Bound">τ</a> <a id="24876" href="#8631" class="InductiveConstructor Operator">⇒</a> <span id="24878" class="Symbol">_)</span> <a id="24881" href="#24830" class="Bound">f</a><span id="24882" class="Symbol">)</span>
  <a id="24886" href="#24676" class="Function">linizeElim</a> <span id="24897" class="Symbol">(</span><a id="24898" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="24910" href="#24910" class="Bound">i</a><span id="24911" class="Symbol">)</span> <span id="24913" class="Symbol">=</span> <a id="24915" href="#22978" class="InductiveConstructor">εₗ</a> <span id="24918" class="Symbol">(</span><a id="24919" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="24931" href="#24910" class="Bound">i</a><span id="24932" class="Symbol">)</span>
  <a id="24936" href="#24676" class="Function">linizeElim</a> <span id="24947" class="Symbol">(</span><a id="24948" href="#11950" class="InductiveConstructor">elimNat</a> <a id="24956" href="#24956" class="Bound">v</a><span id="24957" class="Symbol">)</span>     <span id="24963" class="Symbol">=</span> <a id="24965" href="#24956" class="Bound">v</a> <a id="24967" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="24970" href="#22978" class="InductiveConstructor">εₗ</a> <span id="24973" class="Symbol">(</span><a id="24974" href="#11950" class="InductiveConstructor">elimNat</a> <a id="24982" href="#6159" class="Function">$0</a><span id="24984" class="Symbol">)</span>
  <a id="24988" href="#24676" class="Function">linizeElim</a>  <a id="25000" href="#12146" class="InductiveConstructor">elimConat</a>      <span id="25015" class="Symbol">=</span> <a id="25017" href="#22978" class="InductiveConstructor">εₗ</a> <a id="25020" href="#12146" class="InductiveConstructor">elimConat</a>
  <a id="25032" href="#24676" class="Function">linizeElim</a>  <a id="25044" href="#12326" class="InductiveConstructor">elimStream</a>     <span id="25059" class="Symbol">=</span> <a id="25061" href="#22978" class="InductiveConstructor">εₗ</a> <a id="25064" href="#12326" class="InductiveConstructor">elimStream</a>

  <a id="8:Compilation.linizeExpr"></a><a id="25078" href="#25078" class="Function">linizeExpr</a> <span id="25089" class="Symbol">:</span> <span id="25091" class="Symbol">∀</span> <span id="25093" class="Symbol">{</span><a id="25094" href="#25094" class="Bound">%A</a> <a id="25097" href="#25097" class="Bound">%V</a> <a id="25100" href="#25100" class="Bound">τ</a><span id="25101" class="Symbol">}</span> <span id="25103" class="Symbol">→</span> <a id="25105" href="#12502" class="Datatype">Expr</a> <a id="25110" href="#25094" class="Bound">%A</a> <a id="25113" href="#25097" class="Bound">%V</a> <a id="25116" href="#25100" class="Bound">τ</a> <span id="25118" class="Symbol">→</span> <a id="25120" href="#22901" class="Datatype">Linear</a> <a id="25127" href="#25097" class="Bound">%V</a> <span id="25130" class="Symbol">(\</span><a id="25132" href="#25132" class="Bound">ρs</a> <span id="25135" class="Symbol">→</span> <a id="25137" href="#12502" class="Datatype">Expr</a> <a id="25142" href="#25094" class="Bound">%A</a> <span id="25145" class="Symbol">(</span><a id="25146" href="#3432" class="Function">Has</a> <a id="25150" href="#25132" class="Bound">ρs</a><span id="25152" class="Symbol">)</span> <a id="25154" href="#25100" class="Bound">τ</a><span id="25155" class="Symbol">)</span> <a id="25157" href="#2802" class="InductiveConstructor">ε</a>
  <a id="25161" href="#25078" class="Function">linizeExpr</a> <span id="25172" class="Symbol">(</span><a id="25173" href="#12591" class="InductiveConstructor">intr</a> <a id="25178" href="#25178" class="Bound">rule</a><span id="25182" class="Symbol">)</span>       <span id="25190" class="Symbol">=</span> <a id="25192" href="#23090" class="Function">mapLinear</a> <a id="25202" href="#12591" class="InductiveConstructor">intr</a> <span id="25207" class="Symbol">(</span><a id="25208" href="#24139" class="Function">linizeIntr</a> <a id="25219" href="#25178" class="Bound">rule</a><span id="25223" class="Symbol">)</span>
  <a id="25227" href="#25078" class="Function">linizeExpr</a> <span id="25238" class="Symbol">(</span><a id="25239" href="#12666" class="InductiveConstructor">elim</a> <a id="25244" href="#25244" class="Bound">value</a> <a id="25250" href="#25250" class="Bound">rule</a><span id="25254" class="Symbol">)</span> <span id="25256" class="Symbol">=</span> <a id="25258" href="#25244" class="Bound">value</a> <a id="25264" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="25267" href="#23323" class="Function">mapLinear'</a> <span id="25278" class="Symbol">(\</span><a id="25280" href="#25280" class="Bound">rule'</a> <span id="25286" class="Symbol">→</span> <a id="25288" href="#12666" class="InductiveConstructor">elim</a> <span id="25293" class="Symbol">(</span><a id="25294" href="#7147" class="Function">has-skip</a> <span id="25303" class="Symbol">_</span> <a id="25305" href="#6159" class="Function">$0</a><span id="25307" class="Symbol">)</span> <span id="25309" class="Symbol">(</span><a id="25310" href="#13548" class="Function">mapElim</a> <span id="25318" class="Symbol">(</span><a id="25319" href="#7315" class="Function">has-append</a> <span id="25330" class="Symbol">_)</span> <a id="25333" href="#25280" class="Bound">rule'</a><span id="25338" class="Symbol">))</span> <span id="25341" class="Symbol">(</span><a id="25342" href="#24676" class="Function">linizeElim</a> <a id="25353" href="#25250" class="Bound">rule</a><span id="25357" class="Symbol">)</span>

  <a id="8:Compilation.combine2"></a><a id="25362" href="#25362" class="Function">combine2</a> <span id="25371" class="Symbol">:</span> <span id="25373" class="Symbol">∀</span> <span id="25375" class="Symbol">{</span><a id="25376" href="#25376" class="Bound">Γ</a> <a id="25378" href="#25378" class="Bound">ρ</a> <a id="25380" href="#25380" class="Bound">τ</a><span id="25381" class="Symbol">}</span> <span id="25383" class="Symbol">→</span> <a id="25385" href="#21673" class="Datatype">TermC</a> <a id="25391" href="#25376" class="Bound">Γ</a> <a id="25393" href="#25378" class="Bound">ρ</a> <span id="25395" class="Symbol">→</span> <a id="25397" href="#21673" class="Datatype">TermC</a> <span id="25403" class="Symbol">(</span><a id="25404" href="#25378" class="Bound">ρ</a> <a id="25406" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="25408" href="#25376" class="Bound">Γ</a><span id="25409" class="Symbol">)</span> <a id="25411" href="#25380" class="Bound">τ</a> <span id="25413" class="Symbol">→</span> <a id="25415" href="#21673" class="Datatype">TermC</a> <a id="25421" href="#25376" class="Bound">Γ</a> <a id="25423" href="#25380" class="Bound">τ</a>
  <a id="25427" href="#25362" class="Function">combine2</a> <span id="25436" class="Symbol">(</span><a id="25437" href="#21778" class="InductiveConstructor">return</a> <a id="25444" href="#25444" class="Bound">x</a><span id="25445" class="Symbol">)</span>     <a id="25451" href="#25451" class="Bound">term2</a> <span id="25457" class="Symbol">=</span> <a id="25459" href="#22442" class="Function">mapTermC</a> <span id="25468" class="Symbol">(</span><a id="25469" href="#7936" class="Function">has-cons</a> <a id="25478" href="#25444" class="Bound">x</a><span id="25479" class="Symbol">)</span> <a id="25481" href="#25451" class="Bound">term2</a>
  <a id="25489" href="#25362" class="Function">combine2</a> <span id="25498" class="Symbol">(</span><a id="25499" href="#25499" class="Bound">expr</a> <a id="25504" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="25506" href="#25506" class="Bound">term1</a><span id="25511" class="Symbol">)</span> <a id="25513" href="#25513" class="Bound">term2</a> <span id="25519" class="Symbol">=</span> <a id="25521" href="#25499" class="Bound">expr</a> <a id="25526" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="25528" href="#25362" class="Function">combine2</a> <a id="25537" href="#25506" class="Bound">term1</a> <span id="25543" class="Symbol">(</span><a id="25544" href="#22442" class="Function">mapTermC</a> <span id="25553" class="Symbol">(</span><a id="25554" href="#7780" class="Function">has-abs</a> <span id="25562" class="Symbol">_</span> <span id="25564" class="Symbol">_</span> <span id="25566" class="Symbol">_)</span> <a id="25569" href="#25513" class="Bound">term2</a><span id="25574" class="Symbol">)</span>

  <a id="8:Compilation.combineL"></a><a id="25579" href="#25579" class="Function">combineL</a> <span id="25588" class="Symbol">:</span> <span id="25590" class="Symbol">∀</span> <span id="25592" class="Symbol">{</span><a id="25593" href="#25593" class="Bound">Γ</a> <a id="25595" href="#25595" class="Bound">Δ</a> <a id="25597" href="#25597" class="Bound">τ</a><span id="25598" class="Symbol">}</span> <span id="25600" class="Symbol">→</span> <a id="25602" href="#22901" class="Datatype">Linear</a> <span id="25609" class="Symbol">(</span><a id="25610" href="#21673" class="Datatype">TermC</a> <a id="25616" href="#25593" class="Bound">Γ</a><span id="25617" class="Symbol">)</span> <span id="25619" class="Symbol">(\</span><a id="25621" href="#25621" class="Bound">ρs</a> <span id="25624" class="Symbol">→</span> <a id="25626" href="#12502" class="Datatype">Expr</a> <span id="25631" class="Symbol">(</span><a id="25632" href="#21982" class="Function">AbsTermC</a> <a id="25641" href="#25593" class="Bound">Γ</a><span id="25642" class="Symbol">)</span> <span id="25644" class="Symbol">(</span><a id="25645" href="#3432" class="Function">Has</a> <a id="25649" href="#25621" class="Bound">ρs</a><span id="25651" class="Symbol">)</span> <a id="25653" href="#25597" class="Bound">τ</a><span id="25654" class="Symbol">)</span> <a id="25656" href="#25595" class="Bound">Δ</a> <span id="25658" class="Symbol">→</span> <a id="25660" href="#21673" class="Datatype">TermC</a> <span id="25666" class="Symbol">(</span><a id="25667" href="#25595" class="Bound">Δ</a> <a id="25669" href="#7002" class="Function Operator">++</a> <a id="25672" href="#25593" class="Bound">Γ</a><span id="25673" class="Symbol">)</span> <a id="25675" href="#25597" class="Bound">τ</a>
  <a id="25679" href="#25579" class="Function">combineL</a> <span id="25688" class="Symbol">(</span><a id="25689" href="#22978" class="InductiveConstructor">εₗ</a> <a id="25692" href="#25692" class="Bound">expr</a><span id="25696" class="Symbol">)</span>   <span id="25700" class="Symbol">=</span> <a id="25702" href="#22708" class="Function">pure</a> <span id="25707" class="Symbol">(</span><a id="25708" href="#13981" class="Function">mapExpr</a> <span id="25716" class="Symbol">(</span><a id="25717" href="#22442" class="Function">mapTermC</a> <span id="25726" class="Symbol">(</span><a id="25727" href="#7780" class="Function">has-abs</a> <span id="25735" class="Symbol">_</span> <span id="25737" class="Symbol">_</span> <span id="25739" class="Symbol">_))</span> <span id="25743" class="Symbol">(</span><a id="25744" href="#7315" class="Function">has-append</a> <span id="25755" class="Symbol">_)</span> <a id="25758" href="#25692" class="Bound">expr</a><span id="25762" class="Symbol">)</span>
  <a id="25766" href="#25579" class="Function">combineL</a> <span id="25775" class="Symbol">(</span><a id="25776" href="#25776" class="Bound">term</a> <a id="25781" href="#23022" class="InductiveConstructor Operator">∷ₗ</a> <a id="25784" href="#25784" class="Bound">l</a><span id="25785" class="Symbol">)</span> <span id="25787" class="Symbol">=</span> <a id="25789" href="#25362" class="Function">combine2</a> <span id="25798" class="Symbol">(</span><a id="25799" href="#22442" class="Function">mapTermC</a> <span id="25808" class="Symbol">(</span><a id="25809" href="#7147" class="Function">has-skip</a> <span id="25818" class="Symbol">_)</span> <a id="25821" href="#25776" class="Bound">term</a><span id="25825" class="Symbol">)</span> <span id="25827" class="Symbol">(</span><a id="25828" href="#25579" class="Function">combineL</a> <a id="25837" href="#25784" class="Bound">l</a><span id="25838" class="Symbol">)</span>

  <a id="8:Compilation.seqize"></a><a id="25843" href="#25843" class="Function">seqize</a> <span id="25850" class="Symbol">:</span> <span id="25852" class="Symbol">∀</span> <span id="25854" class="Symbol">{</span><a id="25855" href="#25855" class="Bound">Γ</a> <a id="25857" href="#25857" class="Bound">τ</a><span id="25858" class="Symbol">}</span> <span id="25860" class="Symbol">→</span> <a id="25862" href="#12502" class="Datatype">Expr</a> <span id="25867" class="Symbol">(</span><a id="25868" href="#21982" class="Function">AbsTermC</a> <a id="25877" href="#25855" class="Bound">Γ</a><span id="25878" class="Symbol">)</span> <span id="25880" class="Symbol">(</span><a id="25881" href="#21673" class="Datatype">TermC</a> <a id="25887" href="#25855" class="Bound">Γ</a><span id="25888" class="Symbol">)</span> <a id="25890" href="#25857" class="Bound">τ</a> <span id="25892" class="Symbol">→</span> <a id="25894" href="#21673" class="Datatype">TermC</a> <a id="25900" href="#25855" class="Bound">Γ</a> <a id="25902" href="#25857" class="Bound">τ</a>
  <a id="25906" href="#25843" class="Function">seqize</a> <a id="25913" href="#25913" class="Bound">expr</a> <span id="25918" class="Symbol">=</span> <a id="25920" href="#25579" class="Function">combineL</a> <span id="25929" class="Symbol">(</span><a id="25930" href="#25078" class="Function">linizeExpr</a> <a id="25941" href="#25913" class="Bound">expr</a><span id="25945" class="Symbol">)</span>

  <span id="25950" class="Comment">-- Transforms regular representation of a term into compiled representation</span>
  <span id="26028" class="Symbol">{-#</span> <span id="26032" class="Keyword">TERMINATING</span> <span id="26044" class="Symbol">#-}</span> <span id="26048" class="Comment">-- terminating because 'mapExpr' preserves structure, inlining 'mapExpr' would convince Agda</span>
  <a id="8:Compilation.compile"></a><a id="26143" href="#26143" class="Function">compile</a> <span id="26151" class="Symbol">:</span> <span id="26153" class="Symbol">∀</span> <span id="26155" class="Symbol">{</span><a id="26156" href="#26156" class="Bound">Γ</a> <a id="26158" href="#26158" class="Bound">τ</a><span id="26159" class="Symbol">}</span> <span id="26161" class="Symbol">→</span> <a id="26163" href="#18571" class="Datatype">Term</a> <a id="26168" href="#26156" class="Bound">Γ</a> <a id="26170" href="#26158" class="Bound">τ</a> <span id="26172" class="Symbol">→</span> <a id="26174" href="#21673" class="Datatype">TermC</a> <a id="26180" href="#26156" class="Bound">Γ</a> <a id="26182" href="#26158" class="Bound">τ</a>
  <a id="26186" href="#26143" class="Function">compile</a> <span id="26194" class="Symbol">(</span><a id="26195" href="#18641" class="InductiveConstructor">var</a> <a id="26199" href="#26199" class="Bound">x</a><span id="26200" class="Symbol">)</span>     <span id="26206" class="Symbol">=</span> <a id="26208" href="#21778" class="InductiveConstructor">return</a> <a id="26215" href="#26199" class="Bound">x</a>
  <a id="26219" href="#26143" class="Function">compile</a> <span id="26227" class="Symbol">(</span><a id="26228" href="#18732" class="InductiveConstructor">wrap</a> <a id="26233" href="#26233" class="Bound">expr</a><span id="26237" class="Symbol">)</span> <span id="26239" class="Symbol">=</span> <a id="26241" href="#25843" class="Function">seqize</a> <span id="26248" class="Symbol">(</span><a id="26249" href="#13981" class="Function">mapExpr</a> <a id="26257" href="#26143" class="Function">compile</a> <a id="26265" href="#26143" class="Function">compile</a> <a id="26273" href="#26233" class="Bound">expr</a><span id="26277" class="Symbol">)</span>

<span id="26280" class="Keyword">open</span> <a id="26285" href="#22827" class="Module">8:Compilation</a>



<span id="26302" class="Keyword">module</span> <a id="9:Runtime"></a><a id="26309" href="#26309" class="Module">9:Runtime</a> <span id="26319" class="Keyword">where</span>
  <span id="26327" class="Comment">{-
     9. Run-time term representation
  -}</span>

  <span id="26375" class="Keyword">mutual</span>
    <span id="26386" class="Comment">-- Result of a computation. Simillar to '<a class="comment-link" href="#5:Term.Term">Term</a>', but constructed using only introduction rules</span>
    <span id="26500" class="Keyword">data</span> <a id="9:Runtime.Value"></a><a id="26505" href="#26505" class="Datatype">Value</a> <span id="26511" class="Symbol">(</span><a id="26512" href="#26512" class="Bound">τ</a> <span id="26514" class="Symbol">:</span> <a id="26516" href="#8610" class="Datatype">Type</a><span id="26520" class="Symbol">)</span> <span id="26522" class="Symbol">:</span> <span id="26524" class="PrimitiveType">Set</span> <span id="26528" class="Keyword">where</span>
      <a id="9:Runtime.Value.construct"></a><a id="26540" href="#26540" class="InductiveConstructor">construct</a> <span id="26550" class="Symbol">:</span> <a id="26552" href="#9811" class="Datatype">Intr</a> <a id="26557" href="#26732" class="Datatype">Closure</a> <a id="26565" href="#26505" class="Datatype">Value</a> <a id="26571" href="#26512" class="Bound">τ</a> <span id="26573" class="Symbol">→</span> <a id="26575" href="#26505" class="Datatype">Value</a> <a id="26581" href="#26512" class="Bound">τ</a>

    <span id="26588" class="Comment">-- Run-time representation of a function 'ρ ⇒ τ'. Consists of a term in context 'ρ ∷ Γ' and</span>
    <span id="26684" class="Comment">-- a list of values for all types in Γ</span>
    <span id="26727" class="Keyword">data</span> <a id="9:Runtime.Closure"></a><a id="26732" href="#26732" class="Datatype">Closure</a> <span id="26740" class="Symbol">(</span><a id="26741" href="#26741" class="Bound">ρ</a> <a id="26743" href="#26743" class="Bound">τ</a> <span id="26745" class="Symbol">:</span> <a id="26747" href="#8610" class="Datatype">Type</a><span id="26751" class="Symbol">)</span> <span id="26753" class="Symbol">:</span> <span id="26755" class="PrimitiveType">Set</span> <span id="26759" class="Keyword">where</span>
      <a id="9:Runtime.Closure._&amp;_"></a><a id="26771" href="#26771" class="InductiveConstructor Operator">_&amp;_</a> <span id="26775" class="Symbol">:</span> <span id="26777" class="Symbol">∀</span> <span id="26779" class="Symbol">{</span><a id="26780" href="#26780" class="Bound">Γ</a><span id="26781" class="Symbol">}</span> <span id="26783" class="Symbol">→</span> <a id="26785" href="#26880" class="Function">Env</a> <a id="26789" href="#26780" class="Bound">Γ</a> <span id="26791" class="Symbol">→</span> <a id="26793" href="#21673" class="Datatype">TermC</a> <span id="26799" class="Symbol">(</span><a id="26800" href="#26741" class="Bound">ρ</a> <a id="26802" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="26804" href="#26780" class="Bound">Γ</a><span id="26805" class="Symbol">)</span> <a id="26807" href="#26743" class="Bound">τ</a> <span id="26809" class="Symbol">→</span> <a id="26811" href="#26732" class="Datatype">Closure</a> <a id="26819" href="#26741" class="Bound">ρ</a> <a id="26821" href="#26743" class="Bound">τ</a>

    <span id="26828" class="Comment">-- A list containing a value for each type in Γ</span>
    <a id="9:Runtime.Env"></a><a id="26880" href="#26880" class="Function">Env</a> <span id="26884" class="Symbol">:</span> <a id="26886" href="#2771" class="Datatype">List</a> <a id="26891" href="#8610" class="Datatype">Type</a> <span id="26896" class="Symbol">→</span> <span id="26898" class="PrimitiveType">Set</span>
    <a id="26906" href="#26880" class="Function">Env</a> <a id="26910" href="#26910" class="Bound">Γ</a> <span id="26912" class="Symbol">=</span> <a id="26914" href="#2877" class="Datatype">All</a> <a id="26918" href="#26505" class="Datatype">Value</a> <a id="26924" href="#26910" class="Bound">Γ</a>

  <span id="26929" class="Comment">-- Run-time introduction rule</span>
  <a id="9:Runtime.IntrR"></a><a id="26961" href="#26961" class="Function">IntrR</a> <span id="26967" class="Symbol">:</span> <a id="26969" href="#8610" class="Datatype">Type</a> <span id="26974" class="Symbol">→</span> <span id="26976" class="PrimitiveType">Set</span>
  <a id="26982" href="#26961" class="Function">IntrR</a> <a id="26988" href="#26988" class="Bound">τ</a> <span id="26990" class="Symbol">=</span> <a id="26992" href="#9811" class="Datatype">Intr</a> <a id="26997" href="#26732" class="Datatype">Closure</a> <a id="27005" href="#26505" class="Datatype">Value</a> <a id="27011" href="#26988" class="Bound">τ</a>

  <span id="27016" class="Comment">-- Run-time elimination rule</span>
  <a id="9:Runtime.ElimR"></a><a id="27047" href="#27047" class="Function">ElimR</a> <span id="27053" class="Symbol">:</span> <a id="27055" href="#8610" class="Datatype">Type</a> <span id="27060" class="Symbol">→</span> <a id="27062" href="#8610" class="Datatype">Type</a> <span id="27067" class="Symbol">→</span> <span id="27069" class="PrimitiveType">Set</span>
  <a id="27075" href="#27047" class="Function">ElimR</a> <a id="27081" href="#27081" class="Bound">τ</a> <a id="27083" href="#27083" class="Bound">ϕ</a> <span id="27085" class="Symbol">=</span> <a id="27087" href="#11351" class="Datatype">Elim</a> <a id="27092" href="#26505" class="Datatype">Value</a> <a id="27098" href="#27081" class="Bound">τ</a> <a id="27100" href="#27083" class="Bound">ϕ</a>

  <span id="27105" class="Comment">-- Unevaluated thunk. Consists of a term and a list of values for all variables of the term</span>
  <span id="27199" class="Keyword">data</span> <a id="9:Runtime.Thunk"></a><a id="27204" href="#27204" class="Datatype">Thunk</a> <span id="27210" class="Symbol">(</span><a id="27211" href="#27211" class="Bound">τ</a> <span id="27213" class="Symbol">:</span> <a id="27215" href="#8610" class="Datatype">Type</a><span id="27219" class="Symbol">)</span> <span id="27221" class="Symbol">:</span> <span id="27223" class="PrimitiveType">Set</span> <span id="27227" class="Keyword">where</span>
    <a id="9:Runtime.Thunk._&amp;_"></a><a id="27237" href="#27237" class="InductiveConstructor Operator">_&amp;_</a> <span id="27241" class="Symbol">:</span> <span id="27243" class="Symbol">∀</span> <span id="27245" class="Symbol">{</span><a id="27246" href="#27246" class="Bound">Γ</a><span id="27247" class="Symbol">}</span> <span id="27249" class="Symbol">→</span> <a id="27251" href="#26880" class="Function">Env</a> <a id="27255" href="#27246" class="Bound">Γ</a> <span id="27257" class="Symbol">→</span> <a id="27259" href="#21673" class="Datatype">TermC</a> <a id="27265" href="#27246" class="Bound">Γ</a> <a id="27267" href="#27211" class="Bound">τ</a> <span id="27269" class="Symbol">→</span> <a id="27271" href="#27204" class="Datatype">Thunk</a> <a id="27277" href="#27211" class="Bound">τ</a>

  <span id="27282" class="Comment">-- A composable sequence of closures</span>
  <span id="27321" class="Keyword">data</span> <a id="9:Runtime.CallStack"></a><a id="27326" href="#27326" class="Datatype">CallStack</a> <span id="27336" class="Symbol">:</span> <a id="27338" href="#8610" class="Datatype">Type</a> <span id="27343" class="Symbol">→</span> <a id="27345" href="#8610" class="Datatype">Type</a> <span id="27350" class="Symbol">→</span> <span id="27352" class="PrimitiveType">Set</span> <span id="27356" class="Keyword">where</span>
    <a id="9:Runtime.CallStack.ε"></a><a id="27366" href="#27366" class="InductiveConstructor">ε</a>   <span id="27370" class="Symbol">:</span> <span id="27372" class="Symbol">∀</span> <span id="27374" class="Symbol">{</span><a id="27375" href="#27375" class="Bound">τ</a><span id="27376" class="Symbol">}</span>     <span id="27382" class="Symbol">→</span> <a id="27384" href="#27326" class="Datatype">CallStack</a> <a id="27394" href="#27375" class="Bound">τ</a> <a id="27396" href="#27375" class="Bound">τ</a>
    <a id="9:Runtime.CallStack._∷_"></a><a id="27402" href="#27402" class="InductiveConstructor Operator">_∷_</a> <span id="27406" class="Symbol">:</span> <span id="27408" class="Symbol">∀</span> <span id="27410" class="Symbol">{</span><a id="27411" href="#27411" class="Bound">ρ</a> <a id="27413" href="#27413" class="Bound">σ</a> <a id="27415" href="#27415" class="Bound">τ</a><span id="27416" class="Symbol">}</span> <span id="27418" class="Symbol">→</span> <a id="27420" href="#26732" class="Datatype">Closure</a> <a id="27428" href="#27411" class="Bound">ρ</a> <a id="27430" href="#27413" class="Bound">σ</a> <span id="27432" class="Symbol">→</span> <a id="27434" href="#27326" class="Datatype">CallStack</a> <a id="27444" href="#27413" class="Bound">σ</a> <a id="27446" href="#27415" class="Bound">τ</a> <span id="27448" class="Symbol">→</span> <a id="27450" href="#27326" class="Datatype">CallStack</a> <a id="27460" href="#27411" class="Bound">ρ</a> <a id="27462" href="#27415" class="Bound">τ</a>

  <span id="27467" class="Comment">-- Computation state</span>
  <span id="27490" class="Comment">-- * a thunk that is currently being evaluated</span>
  <span id="27539" class="Comment">-- * and a continuation which will be applied when we finish evaluating the thunk</span>
  <span id="27623" class="Keyword">data</span> <a id="9:Runtime.Machine"></a><a id="27628" href="#27628" class="Datatype">Machine</a> <span id="27636" class="Symbol">:</span> <a id="27638" href="#8610" class="Datatype">Type</a> <span id="27643" class="Symbol">→</span> <span id="27645" class="PrimitiveType">Set</span> <span id="27649" class="Keyword">where</span>
    <a id="9:Runtime.Machine._▹_"></a><a id="27659" href="#27659" class="InductiveConstructor Operator">_▹_</a> <span id="27663" class="Symbol">:</span> <span id="27665" class="Symbol">∀</span> <span id="27667" class="Symbol">{</span><a id="27668" href="#27668" class="Bound">σ</a> <a id="27670" href="#27670" class="Bound">τ</a><span id="27671" class="Symbol">}</span> <span id="27673" class="Symbol">→</span> <a id="27675" href="#27204" class="Datatype">Thunk</a> <a id="27681" href="#27668" class="Bound">σ</a> <span id="27683" class="Symbol">→</span> <a id="27685" href="#27326" class="Datatype">CallStack</a> <a id="27695" href="#27668" class="Bound">σ</a> <a id="27697" href="#27670" class="Bound">τ</a> <span id="27699" class="Symbol">→</span> <a id="27701" href="#27628" class="Datatype">Machine</a> <a id="27709" href="#27670" class="Bound">τ</a>

  <span id="27714" class="Comment">-- Result of a single computation step</span>
  <span id="27755" class="Comment">-- * final value if the computation finishes</span>
  <span id="27802" class="Comment">-- * next computation state if it doesn't</span>
  <span id="27846" class="Keyword">data</span> <a id="9:Runtime.Step"></a><a id="27851" href="#27851" class="Datatype">Step</a> <span id="27856" class="Symbol">(</span><a id="27857" href="#27857" class="Bound">τ</a> <span id="27859" class="Symbol">:</span> <a id="27861" href="#8610" class="Datatype">Type</a><span id="27865" class="Symbol">)</span> <span id="27867" class="Symbol">:</span> <span id="27869" class="PrimitiveType">Set</span> <span id="27873" class="Keyword">where</span>
    <a id="9:Runtime.Step.finish"></a><a id="27883" href="#27883" class="InductiveConstructor">finish</a>   <span id="27892" class="Symbol">:</span> <a id="27894" href="#26505" class="Datatype">Value</a> <a id="27900" href="#27857" class="Bound">τ</a> <span id="27902" class="Symbol">→</span> <a id="27904" href="#27851" class="Datatype">Step</a> <a id="27909" href="#27857" class="Bound">τ</a>
    <a id="9:Runtime.Step.continue"></a><a id="27915" href="#27915" class="InductiveConstructor">continue</a> <span id="27924" class="Symbol">:</span> <a id="27926" href="#27628" class="Datatype">Machine</a> <a id="27934" href="#27857" class="Bound">τ</a> <span id="27936" class="Symbol">→</span> <a id="27938" href="#27851" class="Datatype">Step</a> <a id="27943" href="#27857" class="Bound">τ</a>

  <span id="27948" class="Comment">-- Plugs a value into a closure, producing a thunk</span>
  <a id="9:Runtime.composeValueClosure"></a><a id="28001" href="#28001" class="Function">composeValueClosure</a> <span id="28021" class="Symbol">:</span> <span id="28023" class="Symbol">∀</span> <span id="28025" class="Symbol">{</span><a id="28026" href="#28026" class="Bound">σ</a> <a id="28028" href="#28028" class="Bound">τ</a><span id="28029" class="Symbol">}</span> <span id="28031" class="Symbol">→</span> <a id="28033" href="#26505" class="Datatype">Value</a> <a id="28039" href="#28026" class="Bound">σ</a> <span id="28041" class="Symbol">→</span> <a id="28043" href="#26732" class="Datatype">Closure</a> <a id="28051" href="#28026" class="Bound">σ</a> <a id="28053" href="#28028" class="Bound">τ</a> <span id="28055" class="Symbol">→</span> <a id="28057" href="#27204" class="Datatype">Thunk</a> <a id="28063" href="#28028" class="Bound">τ</a>
  <a id="28067" href="#28001" class="Function">composeValueClosure</a> <a id="28087" href="#28087" class="Bound">value</a> <span id="28093" class="Symbol">(</span><a id="28094" href="#28094" class="Bound">env</a> <a id="28098" href="#26771" class="InductiveConstructor Operator">&amp;</a> <a id="28100" href="#28100" class="Bound">term</a><span id="28104" class="Symbol">)</span> <span id="28106" class="Symbol">=</span> <span id="28108" class="Symbol">(</span><a id="28109" href="#28087" class="Bound">value</a> <a id="28115" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="28117" href="#28094" class="Bound">env</a><span id="28120" class="Symbol">)</span> <a id="28122" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="28124" href="#28100" class="Bound">term</a>

  <span id="28132" class="Comment">-- Composes two callstacks</span>
  <a id="9:Runtime.composeStackStack"></a><a id="28161" href="#28161" class="Function">composeStackStack</a> <span id="28179" class="Symbol">:</span> <span id="28181" class="Symbol">∀</span> <span id="28183" class="Symbol">{</span><a id="28184" href="#28184" class="Bound">ρ</a> <a id="28186" href="#28186" class="Bound">σ</a> <a id="28188" href="#28188" class="Bound">τ</a><span id="28189" class="Symbol">}</span> <span id="28191" class="Symbol">→</span> <a id="28193" href="#27326" class="Datatype">CallStack</a> <a id="28203" href="#28184" class="Bound">ρ</a> <a id="28205" href="#28186" class="Bound">σ</a> <span id="28207" class="Symbol">→</span> <a id="28209" href="#27326" class="Datatype">CallStack</a> <a id="28219" href="#28186" class="Bound">σ</a> <a id="28221" href="#28188" class="Bound">τ</a> <span id="28223" class="Symbol">→</span> <a id="28225" href="#27326" class="Datatype">CallStack</a> <a id="28235" href="#28184" class="Bound">ρ</a> <a id="28237" href="#28188" class="Bound">τ</a>
  <a id="28241" href="#28161" class="Function">composeStackStack</a>  <a id="28260" href="#27366" class="InductiveConstructor">ε</a>                 <a id="28278" href="#28278" class="Bound">stack2</a> <span id="28285" class="Symbol">=</span> <a id="28287" href="#28278" class="Bound">stack2</a>
  <a id="28296" href="#28161" class="Function">composeStackStack</a> <span id="28314" class="Symbol">(</span><a id="28315" href="#28315" class="Bound">closure</a> <a id="28323" href="#27402" class="InductiveConstructor Operator">∷</a> <a id="28325" href="#28325" class="Bound">stack1</a><span id="28331" class="Symbol">)</span> <a id="28333" href="#28333" class="Bound">stack2</a> <span id="28340" class="Symbol">=</span> <a id="28342" href="#28315" class="Bound">closure</a> <a id="28350" href="#27402" class="InductiveConstructor Operator">∷</a> <a id="28352" href="#28161" class="Function">composeStackStack</a> <a id="28370" href="#28325" class="Bound">stack1</a> <a id="28377" href="#28333" class="Bound">stack2</a>

  <span id="28387" class="Comment">-- Appends a callstack to the current callstack of a machine</span>
  <a id="9:Runtime.composeMachineStack"></a><a id="28450" href="#28450" class="Function">composeMachineStack</a> <span id="28470" class="Symbol">:</span> <span id="28472" class="Symbol">∀</span> <span id="28474" class="Symbol">{</span><a id="28475" href="#28475" class="Bound">σ</a> <a id="28477" href="#28477" class="Bound">τ</a><span id="28478" class="Symbol">}</span> <span id="28480" class="Symbol">→</span> <a id="28482" href="#27628" class="Datatype">Machine</a> <a id="28490" href="#28475" class="Bound">σ</a> <span id="28492" class="Symbol">→</span> <a id="28494" href="#27326" class="Datatype">CallStack</a> <a id="28504" href="#28475" class="Bound">σ</a> <a id="28506" href="#28477" class="Bound">τ</a> <span id="28508" class="Symbol">→</span> <a id="28510" href="#27628" class="Datatype">Machine</a> <a id="28518" href="#28477" class="Bound">τ</a>
  <a id="28522" href="#28450" class="Function">composeMachineStack</a> <span id="28542" class="Symbol">(</span><a id="28543" href="#28543" class="Bound">thunk</a> <a id="28549" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="28551" href="#28551" class="Bound">stack1</a><span id="28557" class="Symbol">)</span> <a id="28559" href="#28559" class="Bound">stack2</a> <span id="28566" class="Symbol">=</span> <a id="28568" href="#28543" class="Bound">thunk</a> <a id="28574" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="28576" href="#28161" class="Function">composeStackStack</a> <a id="28594" href="#28551" class="Bound">stack1</a> <a id="28601" href="#28559" class="Bound">stack2</a>

  <span id="28611" class="Comment">-- Applies a value to a callstack</span>
  <a id="9:Runtime.composeValueStack"></a><a id="28647" href="#28647" class="Function">composeValueStack</a> <span id="28665" class="Symbol">:</span> <span id="28667" class="Symbol">∀</span> <span id="28669" class="Symbol">{</span><a id="28670" href="#28670" class="Bound">σ</a> <a id="28672" href="#28672" class="Bound">τ</a><span id="28673" class="Symbol">}</span> <span id="28675" class="Symbol">→</span> <a id="28677" href="#26505" class="Datatype">Value</a> <a id="28683" href="#28670" class="Bound">σ</a> <span id="28685" class="Symbol">→</span> <a id="28687" href="#27326" class="Datatype">CallStack</a> <a id="28697" href="#28670" class="Bound">σ</a> <a id="28699" href="#28672" class="Bound">τ</a> <span id="28701" class="Symbol">→</span> <a id="28703" href="#27851" class="Datatype">Step</a> <a id="28708" href="#28672" class="Bound">τ</a>
  <a id="28712" href="#28647" class="Function">composeValueStack</a> <a id="28730" href="#28730" class="Bound">value</a>  <a id="28737" href="#27366" class="InductiveConstructor">ε</a>                <span id="28754" class="Symbol">=</span> <a id="28756" href="#27883" class="InductiveConstructor">finish</a> <a id="28763" href="#28730" class="Bound">value</a>
  <a id="28771" href="#28647" class="Function">composeValueStack</a> <a id="28789" href="#28789" class="Bound">value</a> <span id="28795" class="Symbol">(</span><a id="28796" href="#28796" class="Bound">closure</a> <a id="28804" href="#27402" class="InductiveConstructor Operator">∷</a> <a id="28806" href="#28806" class="Bound">stack</a><span id="28811" class="Symbol">)</span> <span id="28813" class="Symbol">=</span> <a id="28815" href="#27915" class="InductiveConstructor">continue</a> <span id="28824" class="Symbol">(</span><a id="28825" href="#28001" class="Function">composeValueClosure</a> <a id="28845" href="#28789" class="Bound">value</a> <a id="28851" href="#28796" class="Bound">closure</a> <a id="28859" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="28861" href="#28806" class="Bound">stack</a><span id="28866" class="Symbol">)</span>

  <span id="28871" class="Comment">-- Composes a computation step and a callstack</span>
  <span id="28920" class="Comment">-- * for a finished computation: applies the callstack to the result</span>
  <span id="28991" class="Comment">-- * for an unfinished computation: append the callstack to the current callstack of the machine</span>
  <a id="9:Runtime.composeStepStack"></a><a id="29090" href="#29090" class="Function">composeStepStack</a> <span id="29107" class="Symbol">:</span> <span id="29109" class="Symbol">∀</span> <span id="29111" class="Symbol">{</span><a id="29112" href="#29112" class="Bound">σ</a> <a id="29114" href="#29114" class="Bound">τ</a><span id="29115" class="Symbol">}</span> <span id="29117" class="Symbol">→</span> <a id="29119" href="#27851" class="Datatype">Step</a> <a id="29124" href="#29112" class="Bound">σ</a> <span id="29126" class="Symbol">→</span> <a id="29128" href="#27326" class="Datatype">CallStack</a> <a id="29138" href="#29112" class="Bound">σ</a> <a id="29140" href="#29114" class="Bound">τ</a> <span id="29142" class="Symbol">→</span> <a id="29144" href="#27851" class="Datatype">Step</a> <a id="29149" href="#29114" class="Bound">τ</a>
  <a id="29153" href="#29090" class="Function">composeStepStack</a> <span id="29170" class="Symbol">(</span><a id="29171" href="#27883" class="InductiveConstructor">finish</a> <a id="29178" href="#29178" class="Bound">value</a><span id="29183" class="Symbol">)</span>     <a id="29189" href="#29189" class="Bound">stack</a> <span id="29195" class="Symbol">=</span> <a id="29197" href="#28647" class="Function">composeValueStack</a> <a id="29215" href="#29178" class="Bound">value</a> <a id="29221" href="#29189" class="Bound">stack</a>
  <a id="29229" href="#29090" class="Function">composeStepStack</a> <span id="29246" class="Symbol">(</span><a id="29247" href="#27915" class="InductiveConstructor">continue</a> <a id="29256" href="#29256" class="Bound">machine</a><span id="29263" class="Symbol">)</span> <a id="29265" href="#29265" class="Bound">stack</a> <span id="29271" class="Symbol">=</span> <a id="29273" href="#27915" class="InductiveConstructor">continue</a> <span id="29282" class="Symbol">(</span><a id="29283" href="#28450" class="Function">composeMachineStack</a> <a id="29303" href="#29256" class="Bound">machine</a> <a id="29311" href="#29265" class="Bound">stack</a><span id="29316" class="Symbol">)</span>

  <span id="29321" class="Comment">-- Transforms compiled representation of a closed term into run-time representation</span>
  <span id="29407" class="Comment">-- * initial environment is empty</span>
  <span id="29443" class="Comment">-- * initial continuation is empty as well</span>
  <a id="9:Runtime.load"></a><a id="29488" href="#29488" class="Function">load</a> <span id="29493" class="Symbol">:</span> <span id="29495" class="Symbol">∀</span> <span id="29497" class="Symbol">{</span><a id="29498" href="#29498" class="Bound">τ</a><span id="29499" class="Symbol">}</span> <span id="29501" class="Symbol">→</span> <a id="29503" href="#21673" class="Datatype">TermC</a> <a id="29509" href="#2802" class="InductiveConstructor">ε</a> <a id="29511" href="#29498" class="Bound">τ</a> <span id="29513" class="Symbol">→</span> <a id="29515" href="#27628" class="Datatype">Machine</a> <a id="29523" href="#29498" class="Bound">τ</a>
  <a id="29527" href="#29488" class="Function">load</a> <a id="29532" href="#29532" class="Bound">term</a> <span id="29537" class="Symbol">=</span> <span id="29539" class="Symbol">(</span><a id="29540" href="#2930" class="InductiveConstructor">ε</a> <a id="29542" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="29544" href="#29532" class="Bound">term</a><span id="29548" class="Symbol">)</span> <a id="29550" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="29552" href="#27366" class="InductiveConstructor">ε</a>

<span id="29555" class="Keyword">open</span> <a id="29560" href="#26309" class="Module">9:Runtime</a>



<span id="29573" class="Keyword">module</span> <a id="10:OperationalElimination"></a><a id="29580" href="#29580" class="Module">10:OperationalElimination</a> <span id="29606" class="Keyword">where</span>
  <span id="29614" class="Comment">{-
     10. Operational semantics for elimination rules
  -}</span>

  <span id="29678" class="Comment">-- Arrow elimination: plug the supplied value into the closure describing the function</span>
  <a id="10:OperationalElimination.eliminateArrow"></a><a id="29767" href="#29767" class="Function">eliminateArrow</a> <span id="29782" class="Symbol">:</span> <span id="29784" class="Symbol">∀</span> <span id="29786" class="Symbol">{</span><a id="29787" href="#29787" class="Bound">ρ</a> <a id="29789" href="#29789" class="Bound">τ</a> <a id="29791" href="#29791" class="Bound">ϕ</a><span id="29792" class="Symbol">}</span> <span id="29794" class="Symbol">→</span> <a id="29796" href="#11351" class="Datatype">Elim</a> <a id="29801" href="#26505" class="Datatype">Value</a> <span id="29807" class="Symbol">(</span><a id="29808" href="#29787" class="Bound">ρ</a> <a id="29810" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="29812" href="#29789" class="Bound">τ</a><span id="29813" class="Symbol">)</span> <a id="29815" href="#29791" class="Bound">ϕ</a> <span id="29817" class="Symbol">→</span> <a id="29819" href="#26505" class="Datatype">Value</a> <span id="29825" class="Symbol">(</span><a id="29826" href="#29787" class="Bound">ρ</a> <a id="29828" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="29830" href="#29789" class="Bound">τ</a><span id="29831" class="Symbol">)</span> <span id="29833" class="Symbol">→</span> <a id="29835" href="#27204" class="Datatype">Thunk</a> <a id="29841" href="#29791" class="Bound">ϕ</a>
  <a id="29845" href="#29767" class="Function">eliminateArrow</a> <span id="29860" class="Symbol">(</span><a id="29861" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="29871" href="#29871" class="Bound">value</a><span id="29876" class="Symbol">)</span> <span id="29878" class="Symbol">(</span><a id="29879" href="#26540" class="InductiveConstructor">construct</a> <span id="29889" class="Symbol">(</span><a id="29890" href="#9949" class="InductiveConstructor">intrArrow</a> <a id="29900" href="#29900" class="Bound">closure</a><span id="29907" class="Symbol">))</span> <span id="29910" class="Symbol">=</span> <a id="29912" href="#28001" class="Function">composeValueClosure</a> <a id="29932" href="#29871" class="Bound">value</a> <a id="29938" href="#29900" class="Bound">closure</a>

  <span id="29949" class="Comment">-- Sum elimination: apply corresponding function to the contained element</span>
  <a id="10:OperationalElimination.eliminateSum"></a><a id="30025" href="#30025" class="Function">eliminateSum</a> <span id="30038" class="Symbol">:</span> <span id="30040" class="Symbol">∀</span> <span id="30042" class="Symbol">{</span><a id="30043" href="#30043" class="Bound">τs</a> <a id="30046" href="#30046" class="Bound">ϕ</a><span id="30047" class="Symbol">}</span> <span id="30049" class="Symbol">→</span> <a id="30051" href="#11351" class="Datatype">Elim</a> <a id="30056" href="#26505" class="Datatype">Value</a> <span id="30062" class="Symbol">(</span><a id="30063" href="#8677" class="InductiveConstructor">#Sum</a> <a id="30068" href="#30043" class="Bound">τs</a><span id="30070" class="Symbol">)</span> <a id="30072" href="#30046" class="Bound">ϕ</a> <span id="30074" class="Symbol">→</span> <a id="30076" href="#26505" class="Datatype">Value</a> <span id="30082" class="Symbol">(</span><a id="30083" href="#8677" class="InductiveConstructor">#Sum</a> <a id="30088" href="#30043" class="Bound">τs</a><span id="30090" class="Symbol">)</span> <span id="30092" class="Symbol">→</span> <a id="30094" href="#27204" class="Datatype">Thunk</a> <a id="30100" href="#30046" class="Bound">ϕ</a>
  <a id="30104" href="#30025" class="Function">eliminateSum</a> <span id="30117" class="Symbol">(</span><a id="30118" href="#11670" class="InductiveConstructor">elimSum</a> <span id="30126" class="Symbol">(</span><a id="30127" href="#30127" class="Bound">f</a> <a id="30129" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="30131" href="#30131" class="Bound">fs</a><span id="30133" class="Symbol">))</span> <span id="30136" class="Symbol">(</span><a id="30137" href="#26540" class="InductiveConstructor">construct</a> <span id="30147" class="Symbol">(</span><a id="30148" href="#10102" class="InductiveConstructor">intrSum</a> <span id="30156" class="Symbol">(</span><a id="30157" href="#3288" class="InductiveConstructor">here</a> <a id="30162" href="#30162" class="Bound">v</a><span id="30163" class="Symbol">)))</span> <span id="30167" class="Symbol">=</span> <span id="30169" class="Symbol">(</span><a id="30170" href="#30127" class="Bound">f</a> <a id="30172" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="30174" href="#30162" class="Bound">v</a> <a id="30176" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="30178" href="#2930" class="InductiveConstructor">ε</a><span id="30179" class="Symbol">)</span> <a id="30181" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="30183" href="#26143" class="Function">compile</a> <span id="30191" class="Symbol">(</span><a id="30192" href="#19521" class="Function">#apply</a> <span id="30199" class="Symbol">(</span><a id="30200" href="#18641" class="InductiveConstructor">var</a> <a id="30204" href="#6159" class="Function">$0</a><span id="30206" class="Symbol">)</span> <span id="30208" class="Symbol">(</span><a id="30209" href="#18641" class="InductiveConstructor">var</a> <a id="30213" href="#6213" class="Function">$1</a><span id="30215" class="Symbol">))</span>
  <a id="30220" href="#30025" class="Function">eliminateSum</a> <span id="30233" class="Symbol">(</span><a id="30234" href="#11670" class="InductiveConstructor">elimSum</a> <span id="30242" class="Symbol">(</span><a id="30243" href="#30243" class="Bound">f</a> <a id="30245" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="30247" href="#30247" class="Bound">fs</a><span id="30249" class="Symbol">))</span> <span id="30252" class="Symbol">(</span><a id="30253" href="#26540" class="InductiveConstructor">construct</a> <span id="30263" class="Symbol">(</span><a id="30264" href="#10102" class="InductiveConstructor">intrSum</a> <span id="30272" class="Symbol">(</span><a id="30273" href="#3332" class="InductiveConstructor">there</a> <a id="30279" href="#30279" class="Bound">vᵢ</a><span id="30281" class="Symbol">)))</span> <span id="30285" class="Symbol">=</span> <a id="30287" href="#30025" class="Function">eliminateSum</a> <span id="30300" class="Symbol">(</span><a id="30301" href="#11670" class="InductiveConstructor">elimSum</a> <a id="30309" href="#30247" class="Bound">fs</a><span id="30311" class="Symbol">)</span> <span id="30313" class="Symbol">(</span><a id="30314" href="#26540" class="InductiveConstructor">construct</a> <span id="30324" class="Symbol">(</span><a id="30325" href="#10102" class="InductiveConstructor">intrSum</a> <a id="30333" href="#30279" class="Bound">vᵢ</a><span id="30335" class="Symbol">))</span>

  <span id="30341" class="Comment">-- Product elimination: extract the element with the corresponding index</span>
  <a id="10:OperationalElimination.eliminateProduct"></a><a id="30416" href="#30416" class="Function">eliminateProduct</a> <span id="30433" class="Symbol">:</span> <span id="30435" class="Symbol">∀</span> <span id="30437" class="Symbol">{</span><a id="30438" href="#30438" class="Bound">τs</a> <a id="30441" href="#30441" class="Bound">ϕ</a><span id="30442" class="Symbol">}</span> <span id="30444" class="Symbol">→</span> <a id="30446" href="#11351" class="Datatype">Elim</a> <a id="30451" href="#26505" class="Datatype">Value</a> <span id="30457" class="Symbol">(</span><a id="30458" href="#8737" class="InductiveConstructor">#Product</a> <a id="30467" href="#30438" class="Bound">τs</a><span id="30469" class="Symbol">)</span> <a id="30471" href="#30441" class="Bound">ϕ</a> <span id="30473" class="Symbol">→</span> <a id="30475" href="#26505" class="Datatype">Value</a> <span id="30481" class="Symbol">(</span><a id="30482" href="#8737" class="InductiveConstructor">#Product</a> <a id="30491" href="#30438" class="Bound">τs</a><span id="30493" class="Symbol">)</span> <span id="30495" class="Symbol">→</span> <a id="30497" href="#27204" class="Datatype">Thunk</a> <a id="30503" href="#30441" class="Bound">ϕ</a>
  <a id="30507" href="#30416" class="Function">eliminateProduct</a> <span id="30524" class="Symbol">(</span><a id="30525" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="30537" href="#30537" class="Bound">i</a><span id="30538" class="Symbol">)</span> <span id="30540" class="Symbol">(</span><a id="30541" href="#26540" class="InductiveConstructor">construct</a> <span id="30551" class="Symbol">(</span><a id="30552" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="30564" href="#30564" class="Bound">vs</a><span id="30566" class="Symbol">))</span> <span id="30569" class="Symbol">=</span> <span id="30571" class="Symbol">(</span><a id="30572" href="#6595" class="Function">get</a> <a id="30576" href="#30564" class="Bound">vs</a> <a id="30579" href="#30537" class="Bound">i</a> <a id="30581" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="30583" href="#2930" class="InductiveConstructor">ε</a><span id="30584" class="Symbol">)</span> <a id="30586" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="30588" href="#26143" class="Function">compile</a> <span id="30596" class="Symbol">(</span><a id="30597" href="#18641" class="InductiveConstructor">var</a> <a id="30601" href="#6159" class="Function">$0</a><span id="30603" class="Symbol">)</span>

  <span id="30608" class="Comment">-- Natural number elimination: given 'f : #Maybe ϕ ⇒ ϕ' and 'w : #Nat', unpack 'w' to get</span>
  <span id="30700" class="Comment">-- 'v : #Maybe #Nat', apply elimination to 'v' recursively to get a value of type '#Maybe ϕ',</span>
  <span id="30796" class="Comment">-- then apply 'f' to the result</span>
  <a id="10:OperationalElimination.eliminateNat"></a><a id="30830" href="#30830" class="Function">eliminateNat</a> <span id="30843" class="Symbol">:</span> <span id="30845" class="Symbol">∀</span> <span id="30847" class="Symbol">{</span><a id="30848" href="#30848" class="Bound">ϕ</a><span id="30849" class="Symbol">}</span> <span id="30851" class="Symbol">→</span> <a id="30853" href="#11351" class="Datatype">Elim</a> <a id="30858" href="#26505" class="Datatype">Value</a> <a id="30864" href="#8801" class="InductiveConstructor">#Nat</a> <a id="30869" href="#30848" class="Bound">ϕ</a> <span id="30871" class="Symbol">→</span> <a id="30873" href="#26505" class="Datatype">Value</a> <a id="30879" href="#8801" class="InductiveConstructor">#Nat</a> <span id="30884" class="Symbol">→</span> <a id="30886" href="#27204" class="Datatype">Thunk</a> <a id="30892" href="#30848" class="Bound">ϕ</a>
  <a id="30896" href="#30830" class="Function">eliminateNat</a> <span id="30909" class="Symbol">(</span><a id="30910" href="#11950" class="InductiveConstructor">elimNat</a> <a id="30918" href="#30918" class="Bound">f</a><span id="30919" class="Symbol">)</span> <span id="30921" class="Symbol">(</span><a id="30922" href="#26540" class="InductiveConstructor">construct</a> <span id="30932" class="Symbol">(</span><a id="30933" href="#10481" class="InductiveConstructor">intrNat</a> <a id="30941" href="#30941" class="Bound">v</a><span id="30942" class="Symbol">))</span> <span id="30945" class="Symbol">=</span>
      <span id="30953" class="Symbol">(</span><a id="30954" href="#30918" class="Bound">f</a> <a id="30956" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="30958" href="#30941" class="Bound">v</a> <a id="30960" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="30962" href="#2930" class="InductiveConstructor">ε</a><span id="30963" class="Symbol">)</span> <a id="30965" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="30967" href="#26143" class="Function">compile</a> <span id="30975" class="Symbol">(</span><a id="30976" href="#19521" class="Function">#apply</a> <span id="30983" class="Symbol">(</span><a id="30984" href="#19625" class="Function">#compose</a> <span id="30993" class="Symbol">(</span><a id="30994" href="#18641" class="InductiveConstructor">var</a> <a id="30998" href="#6159" class="Function">$0</a><span id="31000" class="Symbol">)</span> <span id="31002" class="Symbol">(</span><a id="31003" href="#20914" class="Function">#mapMaybe</a> <span id="31013" class="Symbol">(</span><a id="31014" href="#21082" class="Function">#elimNat</a> <span id="31023" class="Symbol">(</span><a id="31024" href="#18641" class="InductiveConstructor">var</a> <a id="31028" href="#6159" class="Function">$0</a><span id="31030" class="Symbol">))))</span> <span id="31035" class="Symbol">(</span><a id="31036" href="#18641" class="InductiveConstructor">var</a> <a id="31040" href="#6213" class="Function">$1</a><span id="31042" class="Symbol">))</span>

  <span id="31048" class="Comment">-- Conatural number elimination: given 'w : #Conat', unpack it to get</span>
  <span id="31120" class="Comment">-- '(ρ : Type) × (v : ρ) × (f : ρ ⇒ #Maybe ρ)', apply 'f' to 'v' to get a value</span>
  <span id="31202" class="Comment">-- of type '#Maybe ρ', and pack the result into a new Conat</span>
  <a id="10:OperationalElimination.eliminateConat"></a><a id="31264" href="#31264" class="Function">eliminateConat</a> <span id="31279" class="Symbol">:</span> <span id="31281" class="Symbol">∀</span> <span id="31283" class="Symbol">{</span><a id="31284" href="#31284" class="Bound">ϕ</a><span id="31285" class="Symbol">}</span> <span id="31287" class="Symbol">→</span> <a id="31289" href="#11351" class="Datatype">Elim</a> <a id="31294" href="#26505" class="Datatype">Value</a> <a id="31300" href="#8853" class="InductiveConstructor">#Conat</a> <a id="31307" href="#31284" class="Bound">ϕ</a> <span id="31309" class="Symbol">→</span> <a id="31311" href="#26505" class="Datatype">Value</a> <a id="31317" href="#8853" class="InductiveConstructor">#Conat</a> <span id="31324" class="Symbol">→</span> <a id="31326" href="#27204" class="Datatype">Thunk</a> <a id="31332" href="#31284" class="Bound">ϕ</a>
  <a id="31336" href="#31264" class="Function">eliminateConat</a> <a id="31351" href="#12146" class="InductiveConstructor">elimConat</a> <span id="31361" class="Symbol">(</span><a id="31362" href="#26540" class="InductiveConstructor">construct</a> <span id="31372" class="Symbol">(</span><a id="31373" href="#10848" class="InductiveConstructor">intrConat</a> <span id="31383" class="Symbol">(</span><a id="31384" href="#31384" class="Bound">ρ</a> <a id="31386" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="31389" href="#31389" class="Bound">v</a> <a id="31391" href="#2431" class="InductiveConstructor Operator">,</a> <a id="31393" href="#31393" class="Bound">f</a><span id="31394" class="Symbol">)))</span> <span id="31398" class="Symbol">=</span>
      <span id="31406" class="Symbol">(</span><a id="31407" href="#31393" class="Bound">f</a> <a id="31409" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="31411" href="#31389" class="Bound">v</a> <a id="31413" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="31415" href="#2930" class="InductiveConstructor">ε</a><span id="31416" class="Symbol">)</span> <a id="31418" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="31420" href="#26143" class="Function">compile</a> <span id="31428" class="Symbol">(</span><a id="31429" href="#19521" class="Function">#apply</a> <span id="31436" class="Symbol">(</span><a id="31437" href="#19625" class="Function">#compose</a> <span id="31446" class="Symbol">(</span><a id="31447" href="#20914" class="Function">#mapMaybe</a> <span id="31457" class="Symbol">(</span><a id="31458" href="#21210" class="Function">#buildConat</a> <span id="31470" class="Symbol">(</span><a id="31471" href="#18641" class="InductiveConstructor">var</a> <a id="31475" href="#6159" class="Function">$0</a><span id="31477" class="Symbol">)))</span> <span id="31481" class="Symbol">(</span><a id="31482" href="#18641" class="InductiveConstructor">var</a> <a id="31486" href="#6159" class="Function">$0</a><span id="31488" class="Symbol">))</span> <span id="31491" class="Symbol">(</span><a id="31492" href="#18641" class="InductiveConstructor">var</a> <a id="31496" href="#6213" class="Function">$1</a><span id="31498" class="Symbol">))</span>

  <span id="31504" class="Comment">-- Stream elimination: given 'w : #Stream τ', unpack it to get</span>
  <span id="31569" class="Comment">-- '(ρ : Type) × (v : ρ) × (f : ρ ⇒ #Pair τ ρ)', apply 'f' to 'v' to get a value</span>
  <span id="31652" class="Comment">-- of type '#Pair τ ρ', and pack the result into a new Stream</span>
  <a id="10:OperationalElimination.eliminateStream"></a><a id="31716" href="#31716" class="Function">eliminateStream</a> <span id="31732" class="Symbol">:</span> <span id="31734" class="Symbol">∀</span> <span id="31736" class="Symbol">{</span><a id="31737" href="#31737" class="Bound">τ</a> <a id="31739" href="#31739" class="Bound">ϕ</a><span id="31740" class="Symbol">}</span> <span id="31742" class="Symbol">→</span> <a id="31744" href="#11351" class="Datatype">Elim</a> <a id="31749" href="#26505" class="Datatype">Value</a> <span id="31755" class="Symbol">(</span><a id="31756" href="#8937" class="InductiveConstructor">#Stream</a> <a id="31764" href="#31737" class="Bound">τ</a><span id="31765" class="Symbol">)</span> <a id="31767" href="#31739" class="Bound">ϕ</a> <span id="31769" class="Symbol">→</span> <a id="31771" href="#26505" class="Datatype">Value</a> <span id="31777" class="Symbol">(</span><a id="31778" href="#8937" class="InductiveConstructor">#Stream</a> <a id="31786" href="#31737" class="Bound">τ</a><span id="31787" class="Symbol">)</span> <span id="31789" class="Symbol">→</span> <a id="31791" href="#27204" class="Datatype">Thunk</a> <a id="31797" href="#31739" class="Bound">ϕ</a>
  <a id="31801" href="#31716" class="Function">eliminateStream</a> <a id="31817" href="#12326" class="InductiveConstructor">elimStream</a> <span id="31828" class="Symbol">(</span><a id="31829" href="#26540" class="InductiveConstructor">construct</a> <span id="31839" class="Symbol">(</span><a id="31840" href="#11212" class="InductiveConstructor">intrStream</a> <span id="31851" class="Symbol">(</span><a id="31852" href="#31852" class="Bound">ρ</a> <a id="31854" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="31857" href="#31857" class="Bound">v</a> <a id="31859" href="#2431" class="InductiveConstructor Operator">,</a> <a id="31861" href="#31861" class="Bound">f</a><span id="31862" class="Symbol">)))</span> <span id="31866" class="Symbol">=</span>
      <span id="31874" class="Symbol">(</span><a id="31875" href="#31861" class="Bound">f</a> <a id="31877" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="31879" href="#31857" class="Bound">v</a> <a id="31881" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="31883" href="#2930" class="InductiveConstructor">ε</a><span id="31884" class="Symbol">)</span> <a id="31886" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="31888" href="#26143" class="Function">compile</a> <span id="31896" class="Symbol">(</span><a id="31897" href="#19521" class="Function">#apply</a> <span id="31904" class="Symbol">(</span><a id="31905" href="#19625" class="Function">#compose</a> <span id="31914" class="Symbol">(</span><a id="31915" href="#20495" class="Function">#mapPair</a> <span id="31924" class="Symbol">(</span><a id="31925" href="#21353" class="Function">#buildStream</a> <span id="31938" class="Symbol">(</span><a id="31939" href="#18641" class="InductiveConstructor">var</a> <a id="31943" href="#6159" class="Function">$0</a><span id="31945" class="Symbol">)))</span> <span id="31949" class="Symbol">(</span><a id="31950" href="#18641" class="InductiveConstructor">var</a> <a id="31954" href="#6159" class="Function">$0</a><span id="31956" class="Symbol">))</span> <span id="31959" class="Symbol">(</span><a id="31960" href="#18641" class="InductiveConstructor">var</a> <a id="31964" href="#6213" class="Function">$1</a><span id="31966" class="Symbol">))</span>

  <span id="31972" class="Comment">{-
     We don't actually use 'eliminate' definitions for Nat, Conat and Stream given above,
     because they make typechecking in next sections unbearingly slow. Instead we use
     optimized equivalent definitions given below, which compute to the same value but in
     less steps.
  -}</span>

  <a id="10:OperationalElimination.eliminateNat'"></a><a id="32266" href="#32266" class="Function">eliminateNat'</a> <span id="32280" class="Symbol">:</span> <span id="32282" class="Symbol">∀</span> <span id="32284" class="Symbol">{</span><a id="32285" href="#32285" class="Bound">ϕ</a><span id="32286" class="Symbol">}</span> <span id="32288" class="Symbol">→</span> <a id="32290" href="#11351" class="Datatype">Elim</a> <a id="32295" href="#26505" class="Datatype">Value</a> <a id="32301" href="#8801" class="InductiveConstructor">#Nat</a> <a id="32306" href="#32285" class="Bound">ϕ</a> <span id="32308" class="Symbol">→</span> <a id="32310" href="#26505" class="Datatype">Value</a> <a id="32316" href="#8801" class="InductiveConstructor">#Nat</a> <span id="32321" class="Symbol">→</span> <a id="32323" href="#27204" class="Datatype">Thunk</a> <a id="32329" href="#32285" class="Bound">ϕ</a>
  <a id="32333" href="#32266" class="Function">eliminateNat'</a> <span id="32347" class="Symbol">(</span><a id="32348" href="#11950" class="InductiveConstructor">elimNat</a> <a id="32356" href="#32356" class="Bound">f</a><span id="32357" class="Symbol">)</span> <span id="32359" class="Symbol">(</span><a id="32360" href="#26540" class="InductiveConstructor">construct</a> <span id="32370" class="Symbol">(</span><a id="32371" href="#10481" class="InductiveConstructor">intrNat</a> <a id="32379" href="#32379" class="Bound">v</a><span id="32380" class="Symbol">))</span> <span id="32383" class="Symbol">=</span>
      <span id="32391" class="Symbol">(</span><a id="32392" href="#32356" class="Bound">f</a> <a id="32394" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="32396" href="#32379" class="Bound">v</a> <a id="32398" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="32400" href="#2930" class="InductiveConstructor">ε</a><span id="32401" class="Symbol">)</span> <a id="32403" href="#27237" class="InductiveConstructor Operator">&amp;</a>
      <span id="32411" class="Symbol">(</span> <a id="32413" href="#12591" class="InductiveConstructor">intr</a> <span id="32418" class="Symbol">(</span><a id="32419" href="#9949" class="InductiveConstructor">intrArrow</a> <span id="32429" class="Symbol">(</span><a id="32430" href="#12591" class="InductiveConstructor">intr</a> <span id="32435" class="Symbol">(</span><a id="32436" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="32448" href="#2930" class="InductiveConstructor">ε</a><span id="32449" class="Symbol">)</span> <a id="32451" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32453" href="#22708" class="Function">pure</a> <span id="32458" class="Symbol">(</span><a id="32459" href="#12591" class="InductiveConstructor">intr</a> <span id="32464" class="Symbol">(</span><a id="32465" href="#10102" class="InductiveConstructor">intrSum</a> <span id="32473" class="Symbol">(</span><a id="32474" href="#3288" class="InductiveConstructor">here</a> <a id="32479" href="#6159" class="Function">$0</a><span id="32481" class="Symbol">)))))</span>
      <a id="32493" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32495" href="#12591" class="InductiveConstructor">intr</a> <span id="32500" class="Symbol">(</span><a id="32501" href="#9949" class="InductiveConstructor">intrArrow</a> <span id="32511" class="Symbol">(</span><a id="32512" href="#12666" class="InductiveConstructor">elim</a> <a id="32517" href="#6159" class="Function">$0</a> <span id="32520" class="Symbol">(</span><a id="32521" href="#11950" class="InductiveConstructor">elimNat</a> <a id="32529" href="#6272" class="Function">$2</a><span id="32531" class="Symbol">)</span> <a id="32533" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32535" href="#22708" class="Function">pure</a> <span id="32540" class="Symbol">(</span><a id="32541" href="#12591" class="InductiveConstructor">intr</a> <span id="32546" class="Symbol">(</span><a id="32547" href="#10102" class="InductiveConstructor">intrSum</a> <span id="32555" class="Symbol">(</span><a id="32556" href="#3332" class="InductiveConstructor">there</a> <span id="32562" class="Symbol">(</span><a id="32563" href="#3288" class="InductiveConstructor">here</a> <a id="32568" href="#6159" class="Function">$0</a><span id="32570" class="Symbol">))))))</span>
      <a id="32583" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32585" href="#12666" class="InductiveConstructor">elim</a> <a id="32590" href="#6336" class="Function">$3</a> <span id="32593" class="Symbol">(</span><a id="32594" href="#11670" class="InductiveConstructor">elimSum</a> <span id="32602" class="Symbol">(</span><a id="32603" href="#6213" class="Function">$1</a> <a id="32606" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="32608" href="#6159" class="Function">$0</a> <a id="32611" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="32613" href="#2930" class="InductiveConstructor">ε</a><span id="32614" class="Symbol">))</span>
      <a id="32623" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32625" href="#22708" class="Function">pure</a> <span id="32630" class="Symbol">(</span><a id="32631" href="#12666" class="InductiveConstructor">elim</a> <a id="32636" href="#6336" class="Function">$3</a> <span id="32639" class="Symbol">(</span><a id="32640" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="32650" href="#6159" class="Function">$0</a><span id="32652" class="Symbol">))</span>
      <span id="32661" class="Symbol">)</span>

  <a id="10:OperationalElimination.eliminateConat'"></a><a id="32666" href="#32666" class="Function">eliminateConat'</a> <span id="32682" class="Symbol">:</span> <span id="32684" class="Symbol">∀</span> <span id="32686" class="Symbol">{</span><a id="32687" href="#32687" class="Bound">ϕ</a><span id="32688" class="Symbol">}</span> <span id="32690" class="Symbol">→</span> <a id="32692" href="#11351" class="Datatype">Elim</a> <a id="32697" href="#26505" class="Datatype">Value</a> <a id="32703" href="#8853" class="InductiveConstructor">#Conat</a> <a id="32710" href="#32687" class="Bound">ϕ</a> <span id="32712" class="Symbol">→</span> <a id="32714" href="#26505" class="Datatype">Value</a> <a id="32720" href="#8853" class="InductiveConstructor">#Conat</a> <span id="32727" class="Symbol">→</span> <a id="32729" href="#27204" class="Datatype">Thunk</a> <a id="32735" href="#32687" class="Bound">ϕ</a>
  <a id="32739" href="#32666" class="Function">eliminateConat'</a> <a id="32755" href="#12146" class="InductiveConstructor">elimConat</a> <span id="32765" class="Symbol">(</span><a id="32766" href="#26540" class="InductiveConstructor">construct</a> <span id="32776" class="Symbol">(</span><a id="32777" href="#10848" class="InductiveConstructor">intrConat</a> <span id="32787" class="Symbol">(</span><a id="32788" href="#32788" class="Bound">ρ</a> <a id="32790" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="32793" href="#32793" class="Bound">v</a> <a id="32795" href="#2431" class="InductiveConstructor Operator">,</a> <a id="32797" href="#32797" class="Bound">f</a><span id="32798" class="Symbol">)))</span> <span id="32802" class="Symbol">=</span>
      <span id="32810" class="Symbol">(</span><a id="32811" href="#32797" class="Bound">f</a> <a id="32813" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="32815" href="#32793" class="Bound">v</a> <a id="32817" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="32819" href="#2930" class="InductiveConstructor">ε</a><span id="32820" class="Symbol">)</span> <a id="32822" href="#27237" class="InductiveConstructor Operator">&amp;</a>
      <span id="32830" class="Symbol">(</span> <a id="32832" href="#12666" class="InductiveConstructor">elim</a> <a id="32837" href="#6159" class="Function">$0</a> <span id="32840" class="Symbol">(</span><a id="32841" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="32851" href="#6213" class="Function">$1</a><span id="32853" class="Symbol">)</span>
      <a id="32861" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32863" href="#12591" class="InductiveConstructor">intr</a> <span id="32868" class="Symbol">(</span><a id="32869" href="#9949" class="InductiveConstructor">intrArrow</a> <span id="32879" class="Symbol">(</span><a id="32880" href="#12591" class="InductiveConstructor">intr</a> <span id="32885" class="Symbol">(</span><a id="32886" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="32898" href="#2930" class="InductiveConstructor">ε</a><span id="32899" class="Symbol">)</span> <a id="32901" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32903" href="#22708" class="Function">pure</a> <span id="32908" class="Symbol">(</span><a id="32909" href="#12591" class="InductiveConstructor">intr</a> <span id="32914" class="Symbol">(</span><a id="32915" href="#10102" class="InductiveConstructor">intrSum</a> <span id="32923" class="Symbol">(</span><a id="32924" href="#3288" class="InductiveConstructor">here</a> <a id="32929" href="#6159" class="Function">$0</a><span id="32931" class="Symbol">)))))</span>
      <a id="32943" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32945" href="#12591" class="InductiveConstructor">intr</a> <span id="32950" class="Symbol">(</span><a id="32951" href="#9949" class="InductiveConstructor">intrArrow</a> <span id="32961" class="Symbol">(</span><a id="32962" href="#12591" class="InductiveConstructor">intr</a> <span id="32967" class="Symbol">(</span><a id="32968" href="#10848" class="InductiveConstructor">intrConat</a> <span id="32978" class="Symbol">(</span><a id="32979" href="#32788" class="Bound">ρ</a> <a id="32981" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="32984" href="#6159" class="Function">$0</a> <a id="32987" href="#2431" class="InductiveConstructor Operator">,</a> <a id="32989" href="#6336" class="Function">$3</a><span id="32991" class="Symbol">))</span> <a id="32994" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="32996" href="#22708" class="Function">pure</a> <span id="33001" class="Symbol">(</span><a id="33002" href="#12591" class="InductiveConstructor">intr</a> <span id="33007" class="Symbol">(</span><a id="33008" href="#10102" class="InductiveConstructor">intrSum</a> <span id="33016" class="Symbol">(</span><a id="33017" href="#3332" class="InductiveConstructor">there</a> <span id="33023" class="Symbol">(</span><a id="33024" href="#3288" class="InductiveConstructor">here</a> <a id="33029" href="#6159" class="Function">$0</a><span id="33031" class="Symbol">))))))</span>
      <a id="33044" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="33046" href="#22708" class="Function">pure</a> <span id="33051" class="Symbol">(</span><a id="33052" href="#12666" class="InductiveConstructor">elim</a> <a id="33057" href="#6272" class="Function">$2</a> <span id="33060" class="Symbol">(</span><a id="33061" href="#11670" class="InductiveConstructor">elimSum</a> <span id="33069" class="Symbol">(</span><a id="33070" href="#6213" class="Function">$1</a> <a id="33073" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="33075" href="#6159" class="Function">$0</a> <a id="33078" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="33080" href="#2930" class="InductiveConstructor">ε</a><span id="33081" class="Symbol">)))</span>
      <span id="33091" class="Symbol">)</span>

  <a id="10:OperationalElimination.eliminateStream'"></a><a id="33096" href="#33096" class="Function">eliminateStream'</a> <span id="33113" class="Symbol">:</span> <span id="33115" class="Symbol">∀</span> <span id="33117" class="Symbol">{</span><a id="33118" href="#33118" class="Bound">τ</a> <a id="33120" href="#33120" class="Bound">ϕ</a><span id="33121" class="Symbol">}</span> <span id="33123" class="Symbol">→</span> <a id="33125" href="#11351" class="Datatype">Elim</a> <a id="33130" href="#26505" class="Datatype">Value</a> <span id="33136" class="Symbol">(</span><a id="33137" href="#8937" class="InductiveConstructor">#Stream</a> <a id="33145" href="#33118" class="Bound">τ</a><span id="33146" class="Symbol">)</span> <a id="33148" href="#33120" class="Bound">ϕ</a> <span id="33150" class="Symbol">→</span> <a id="33152" href="#26505" class="Datatype">Value</a> <span id="33158" class="Symbol">(</span><a id="33159" href="#8937" class="InductiveConstructor">#Stream</a> <a id="33167" href="#33118" class="Bound">τ</a><span id="33168" class="Symbol">)</span> <span id="33170" class="Symbol">→</span> <a id="33172" href="#27204" class="Datatype">Thunk</a> <a id="33178" href="#33120" class="Bound">ϕ</a>
  <a id="33182" href="#33096" class="Function">eliminateStream'</a> <a id="33199" href="#12326" class="InductiveConstructor">elimStream</a> <span id="33210" class="Symbol">(</span><a id="33211" href="#26540" class="InductiveConstructor">construct</a> <span id="33221" class="Symbol">(</span><a id="33222" href="#11212" class="InductiveConstructor">intrStream</a> <span id="33233" class="Symbol">(</span><a id="33234" href="#33234" class="Bound">ρ</a> <a id="33236" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="33239" href="#33239" class="Bound">v</a> <a id="33241" href="#2431" class="InductiveConstructor Operator">,</a> <a id="33243" href="#33243" class="Bound">f</a><span id="33244" class="Symbol">)))</span> <span id="33248" class="Symbol">=</span>
      <span id="33256" class="Symbol">(</span><a id="33257" href="#33243" class="Bound">f</a> <a id="33259" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="33261" href="#33239" class="Bound">v</a> <a id="33263" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="33265" href="#2930" class="InductiveConstructor">ε</a><span id="33266" class="Symbol">)</span> <a id="33268" href="#27237" class="InductiveConstructor Operator">&amp;</a>
      <span id="33276" class="Symbol">(</span> <a id="33278" href="#12666" class="InductiveConstructor">elim</a> <a id="33283" href="#6159" class="Function">$0</a> <span id="33286" class="Symbol">(</span><a id="33287" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="33297" href="#6213" class="Function">$1</a><span id="33299" class="Symbol">)</span>
      <a id="33307" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="33309" href="#12666" class="InductiveConstructor">elim</a> <a id="33314" href="#6159" class="Function">$0</a> <span id="33317" class="Symbol">(</span><a id="33318" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="33330" href="#6159" class="Function">$0</a><span id="33332" class="Symbol">)</span>
      <a id="33340" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="33342" href="#12666" class="InductiveConstructor">elim</a> <a id="33347" href="#6213" class="Function">$1</a> <span id="33350" class="Symbol">(</span><a id="33351" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="33363" href="#6213" class="Function">$1</a><span id="33365" class="Symbol">)</span>
      <a id="33373" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="33375" href="#12591" class="InductiveConstructor">intr</a> <span id="33380" class="Symbol">(</span><a id="33381" href="#11212" class="InductiveConstructor">intrStream</a> <span id="33392" class="Symbol">(</span><a id="33393" href="#33234" class="Bound">ρ</a> <a id="33395" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="33398" href="#6159" class="Function">$0</a> <a id="33401" href="#2431" class="InductiveConstructor Operator">,</a> <a id="33403" href="#6336" class="Function">$3</a><span id="33405" class="Symbol">))</span>
      <a id="33414" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="33416" href="#22708" class="Function">pure</a> <span id="33421" class="Symbol">(</span><a id="33422" href="#12591" class="InductiveConstructor">intr</a> <span id="33427" class="Symbol">(</span><a id="33428" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="33440" class="Symbol">(</span><a id="33441" href="#6272" class="Function">$2</a> <a id="33444" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="33446" href="#6159" class="Function">$0</a> <a id="33449" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="33451" href="#2930" class="InductiveConstructor">ε</a><span id="33452" class="Symbol">)))</span>
      <span id="33462" class="Symbol">)</span>

  <span id="33467" class="Comment">-- Given a run-time elimination rule and a value, produces a thunk computing the result</span>
  <span id="33557" class="Comment">-- of applying the rule to the value</span>
  <a id="10:OperationalElimination.eliminate"></a><a id="33596" href="#33596" class="Function">eliminate</a> <span id="33606" class="Symbol">:</span> <span id="33608" class="Symbol">∀</span> <span id="33610" class="Symbol">{</span><a id="33611" href="#33611" class="Bound">τ</a> <a id="33613" href="#33613" class="Bound">ϕ</a><span id="33614" class="Symbol">}</span> <span id="33616" class="Symbol">→</span> <a id="33618" href="#11351" class="Datatype">Elim</a> <a id="33623" href="#26505" class="Datatype">Value</a> <a id="33629" href="#33611" class="Bound">τ</a> <a id="33631" href="#33613" class="Bound">ϕ</a> <span id="33633" class="Symbol">→</span> <a id="33635" href="#26505" class="Datatype">Value</a> <a id="33641" href="#33611" class="Bound">τ</a> <span id="33643" class="Symbol">→</span> <a id="33645" href="#27204" class="Datatype">Thunk</a> <a id="33651" href="#33613" class="Bound">ϕ</a>
  <a id="33655" href="#33596" class="Function">eliminate</a> <span id="33665" class="Symbol">{</span><a id="33666" href="#33666" class="Bound">ρ</a> <a id="33668" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="33670" href="#33670" class="Bound">τ</a><span id="33671" class="Symbol">}</span>       <span id="33679" class="Symbol">=</span> <a id="33681" href="#29767" class="Function">eliminateArrow</a>
  <a id="33698" href="#33596" class="Function">eliminate</a> <span id="33708" class="Symbol">{</span><a id="33709" href="#8677" class="InductiveConstructor">#Sum</a> <a id="33714" href="#33714" class="Bound">τs</a><span id="33716" class="Symbol">}</span>     <span id="33722" class="Symbol">=</span> <a id="33724" href="#30025" class="Function">eliminateSum</a>
  <a id="33739" href="#33596" class="Function">eliminate</a> <span id="33749" class="Symbol">{</span><a id="33750" href="#8737" class="InductiveConstructor">#Product</a> <a id="33759" href="#33759" class="Bound">τs</a><span id="33761" class="Symbol">}</span> <span id="33763" class="Symbol">=</span> <a id="33765" href="#30416" class="Function">eliminateProduct</a>
  <a id="33784" href="#33596" class="Function">eliminate</a> <span id="33794" class="Symbol">{</span><a id="33795" href="#8801" class="InductiveConstructor">#Nat</a><span id="33799" class="Symbol">}</span>        <span id="33808" class="Symbol">=</span> <a id="33810" href="#32266" class="Function">eliminateNat'</a>
  <a id="33826" href="#33596" class="Function">eliminate</a> <span id="33836" class="Symbol">{</span><a id="33837" href="#8853" class="InductiveConstructor">#Conat</a><span id="33843" class="Symbol">}</span>      <span id="33850" class="Symbol">=</span> <a id="33852" href="#32666" class="Function">eliminateConat'</a>
  <a id="33870" href="#33596" class="Function">eliminate</a> <span id="33880" class="Symbol">{</span><a id="33881" href="#8937" class="InductiveConstructor">#Stream</a> <a id="33889" href="#33889" class="Bound">τ</a><span id="33890" class="Symbol">}</span>   <span id="33894" class="Symbol">=</span> <a id="33896" href="#33096" class="Function">eliminateStream'</a>

<span id="33914" class="Keyword">open</span> <a id="33919" href="#29580" class="Module">10:OperationalElimination</a>



<span id="33948" class="Keyword">module</span> <a id="11:Operational"></a><a id="33955" href="#33955" class="Module">11:Operational</a> <span id="33970" class="Keyword">where</span>
  <span id="33978" class="Comment">{-
     11. Operational semantics for the whole calculus
  -}</span>

  <span id="34043" class="Comment">-- Given an environment, transforms compile-time introduction rule into a run-time introduction rule</span>
  <a id="11:Operational.plugEnvIntr"></a><a id="34146" href="#34146" class="Function">plugEnvIntr</a> <span id="34158" class="Symbol">:</span> <span id="34160" class="Symbol">∀</span> <span id="34162" class="Symbol">{</span><a id="34163" href="#34163" class="Bound">Γ</a> <a id="34165" href="#34165" class="Bound">τ</a><span id="34166" class="Symbol">}</span> <span id="34168" class="Symbol">→</span> <a id="34170" href="#26880" class="Function">Env</a> <a id="34174" href="#34163" class="Bound">Γ</a> <span id="34176" class="Symbol">→</span> <a id="34178" href="#9811" class="Datatype">Intr</a> <span id="34183" class="Symbol">(</span><a id="34184" href="#21982" class="Function">AbsTermC</a> <a id="34193" href="#34163" class="Bound">Γ</a><span id="34194" class="Symbol">)</span> <span id="34196" class="Symbol">(</span><a id="34197" href="#3432" class="Function">Has</a> <a id="34201" href="#34163" class="Bound">Γ</a><span id="34202" class="Symbol">)</span> <a id="34204" href="#34165" class="Bound">τ</a> <span id="34206" class="Symbol">→</span> <a id="34208" href="#9811" class="Datatype">Intr</a> <a id="34213" href="#26732" class="Datatype">Closure</a> <a id="34221" href="#26505" class="Datatype">Value</a> <a id="34227" href="#34165" class="Bound">τ</a>
  <a id="34231" href="#34146" class="Function">plugEnvIntr</a> <a id="34243" href="#34243" class="Bound">env</a> <a id="34247" href="#34247" class="Bound">rule</a> <span id="34252" class="Symbol">=</span> <a id="34254" href="#12888" class="Function">mapIntr</a> <span id="34262" class="Symbol">(\</span><a id="34264" href="#34264" class="Bound">term</a> <span id="34269" class="Symbol">→</span> <a id="34271" href="#34243" class="Bound">env</a> <a id="34275" href="#26771" class="InductiveConstructor Operator">&amp;</a> <a id="34277" href="#34264" class="Bound">term</a><span id="34281" class="Symbol">)</span> <span id="34283" class="Symbol">(\</span><a id="34285" href="#34285" class="Bound">x</a> <span id="34287" class="Symbol">→</span> <a id="34289" href="#6595" class="Function">get</a> <a id="34293" href="#34243" class="Bound">env</a> <a id="34297" href="#34285" class="Bound">x</a><span id="34298" class="Symbol">)</span> <a id="34300" href="#34247" class="Bound">rule</a>

  <span id="34308" class="Comment">-- Given an environment, transforms compile-time elimination rule into a run-time elimination rule</span>
  <a id="11:Operational.plugEnvElim"></a><a id="34409" href="#34409" class="Function">plugEnvElim</a> <span id="34421" class="Symbol">:</span> <span id="34423" class="Symbol">∀</span> <span id="34425" class="Symbol">{</span><a id="34426" href="#34426" class="Bound">Γ</a> <a id="34428" href="#34428" class="Bound">τ</a> <a id="34430" href="#34430" class="Bound">ϕ</a><span id="34431" class="Symbol">}</span> <span id="34433" class="Symbol">→</span> <a id="34435" href="#26880" class="Function">Env</a> <a id="34439" href="#34426" class="Bound">Γ</a> <span id="34441" class="Symbol">→</span> <a id="34443" href="#11351" class="Datatype">Elim</a> <span id="34448" class="Symbol">(</span><a id="34449" href="#3432" class="Function">Has</a> <a id="34453" href="#34426" class="Bound">Γ</a><span id="34454" class="Symbol">)</span> <a id="34456" href="#34428" class="Bound">τ</a> <a id="34458" href="#34430" class="Bound">ϕ</a> <span id="34460" class="Symbol">→</span> <a id="34462" href="#11351" class="Datatype">Elim</a> <a id="34467" href="#26505" class="Datatype">Value</a> <a id="34473" href="#34428" class="Bound">τ</a> <a id="34475" href="#34430" class="Bound">ϕ</a>
  <a id="34479" href="#34409" class="Function">plugEnvElim</a> <a id="34491" href="#34491" class="Bound">env</a> <a id="34495" href="#34495" class="Bound">rule</a> <span id="34500" class="Symbol">=</span> <a id="34502" href="#13548" class="Function">mapElim</a> <span id="34510" class="Symbol">(\</span><a id="34512" href="#34512" class="Bound">x</a> <span id="34514" class="Symbol">→</span> <a id="34516" href="#6595" class="Function">get</a> <a id="34520" href="#34491" class="Bound">env</a> <a id="34524" href="#34512" class="Bound">x</a><span id="34525" class="Symbol">)</span> <a id="34527" href="#34495" class="Bound">rule</a>


  <span id="34536" class="Comment">-- Performs a single computation step by matching on the current term</span>
  <a id="11:Operational.reduce"></a><a id="34608" href="#34608" class="Function">reduce</a> <span id="34615" class="Symbol">:</span> <span id="34617" class="Symbol">∀</span> <span id="34619" class="Symbol">{</span><a id="34620" href="#34620" class="Bound">τ</a><span id="34621" class="Symbol">}</span> <span id="34623" class="Symbol">→</span> <a id="34625" href="#27628" class="Datatype">Machine</a> <a id="34633" href="#34620" class="Bound">τ</a> <span id="34635" class="Symbol">→</span> <a id="34637" href="#27851" class="Datatype">Step</a> <a id="34642" href="#34620" class="Bound">τ</a>
  <span id="34646" class="Comment">-- * 'return x': supply value of variable 'x' to the continuation stack</span>
  <a id="34720" href="#34608" class="Function">reduce</a> <span id="34727" class="Symbol">((</span><a id="34729" href="#34729" class="Bound">env</a> <a id="34733" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="34735" href="#21778" class="InductiveConstructor">return</a> <a id="34742" href="#34742" class="Bound">x</a><span id="34743" class="Symbol">)</span> <a id="34745" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="34747" href="#34747" class="Bound">stack</a><span id="34752" class="Symbol">)</span> <span id="34754" class="Symbol">=</span> <a id="34756" href="#28647" class="Function">composeValueStack</a> <span id="34774" class="Symbol">(</span><a id="34775" href="#6595" class="Function">get</a> <a id="34779" href="#34729" class="Bound">env</a> <a id="34783" href="#34742" class="Bound">x</a><span id="34784" class="Symbol">)</span> <a id="34786" href="#34747" class="Bound">stack</a>
  <span id="34794" class="Comment">-- * introduction rule: compute value constructed by the introduction rule, push it into</span>
  <span id="34885" class="Comment">--   the environment, and continue with computing the rest of the term</span>
  <a id="34958" href="#34608" class="Function">reduce</a> <span id="34965" class="Symbol">((</span><a id="34967" href="#34967" class="Bound">env</a> <a id="34971" href="#27237" class="InductiveConstructor Operator">&amp;</a> <span id="34973" class="Symbol">(</span><a id="34974" href="#12591" class="InductiveConstructor">intr</a> <a id="34979" href="#34979" class="Bound">rule</a> <a id="34984" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="34986" href="#34986" class="Bound">term'</a><span id="34991" class="Symbol">))</span> <a id="34994" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="34996" href="#34996" class="Bound">stack</a><span id="35001" class="Symbol">)</span> <span id="35003" class="Symbol">=</span> <a id="35005" href="#27915" class="InductiveConstructor">continue</a> <span id="35014" class="Symbol">(((</span><a id="35017" href="#35064" class="Function">value</a> <a id="35023" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="35025" href="#34967" class="Bound">env</a><span id="35028" class="Symbol">)</span> <a id="35030" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="35032" href="#34986" class="Bound">term'</a><span id="35037" class="Symbol">)</span> <a id="35039" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="35041" href="#34996" class="Bound">stack</a><span id="35046" class="Symbol">)</span>
    <span id="35052" class="Keyword">where</span>
      <a id="35064" href="#35064" class="Function">value</a> <span id="35070" class="Symbol">:</span> <a id="35072" href="#26505" class="Datatype">Value</a> <span id="35078" class="Symbol">_</span>
      <a id="35086" href="#35064" class="Function">value</a> <span id="35092" class="Symbol">=</span> <a id="35094" href="#26540" class="InductiveConstructor">construct</a> <span id="35104" class="Symbol">(</span><a id="35105" href="#34146" class="Function">plugEnvIntr</a> <a id="35117" href="#34967" class="Bound">env</a> <a id="35121" href="#34979" class="Bound">rule</a><span id="35125" class="Symbol">)</span>
  <span id="35129" class="Comment">-- * elimination rule: build a thunk computing the result of the elimination rule, push</span>
  <span id="35219" class="Comment">--   current computation into the continuation stack, and start evaluating the new thunk</span>
  <a id="35310" href="#34608" class="Function">reduce</a> <span id="35317" class="Symbol">((</span><a id="35319" href="#35319" class="Bound">env</a> <a id="35323" href="#27237" class="InductiveConstructor Operator">&amp;</a> <span id="35325" class="Symbol">(</span><a id="35326" href="#12666" class="InductiveConstructor">elim</a> <a id="35331" href="#35331" class="Bound">x</a> <a id="35333" href="#35333" class="Bound">rule</a> <a id="35338" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="35340" href="#35340" class="Bound">term'</a><span id="35345" class="Symbol">))</span> <a id="35348" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="35350" href="#35350" class="Bound">stack</a><span id="35355" class="Symbol">)</span> <span id="35357" class="Symbol">=</span> <a id="35359" href="#27915" class="InductiveConstructor">continue</a> <span id="35368" class="Symbol">(</span><a id="35369" href="#35418" class="Function">thunk</a> <a id="35375" href="#27659" class="InductiveConstructor Operator">▹</a> <span id="35377" class="Symbol">((</span><a id="35379" href="#35319" class="Bound">env</a> <a id="35383" href="#26771" class="InductiveConstructor Operator">&amp;</a> <a id="35385" href="#35340" class="Bound">term'</a><span id="35390" class="Symbol">)</span> <a id="35392" href="#27402" class="InductiveConstructor Operator">∷</a> <a id="35394" href="#35350" class="Bound">stack</a><span id="35399" class="Symbol">))</span>
    <span id="35406" class="Keyword">where</span>
      <a id="35418" href="#35418" class="Function">thunk</a> <span id="35424" class="Symbol">:</span> <a id="35426" href="#27204" class="Datatype">Thunk</a> <span id="35432" class="Symbol">_</span>
      <a id="35440" href="#35418" class="Function">thunk</a> <span id="35446" class="Symbol">=</span> <a id="35448" href="#33596" class="Function">eliminate</a> <span id="35458" class="Symbol">(</span><a id="35459" href="#34409" class="Function">plugEnvElim</a> <a id="35471" href="#35319" class="Bound">env</a> <a id="35475" href="#35333" class="Bound">rule</a><span id="35479" class="Symbol">)</span> <span id="35481" class="Symbol">(</span><a id="35482" href="#6595" class="Function">get</a> <a id="35486" href="#35319" class="Bound">env</a> <a id="35490" href="#35331" class="Bound">x</a><span id="35491" class="Symbol">)</span>

<span id="35494" class="Keyword">open</span> <a id="35499" href="#33955" class="Module">11:Operational</a>



<span id="35517" class="Keyword">module</span> <a id="12:Locality"></a><a id="35524" href="#35524" class="Module">12:Locality</a> <span id="35536" class="Keyword">where</span>
  <span id="35544" class="Comment">{-
     12. Locality lemma
  -}</span>

  <span id="35579" class="Comment">-- We can append a callstack to a machine either before, or after performing a reduction</span>
  <span id="35670" class="Comment">-- step, the result will be the same</span>
  <a id="12:Locality.locality-lem"></a><a id="35709" href="#35709" class="Function">locality-lem</a>
      <span id="35728" class="Symbol">:</span> <span id="35730" class="Symbol">∀</span> <span id="35732" class="Symbol">{</span><a id="35733" href="#35733" class="Bound">σ</a> <a id="35735" href="#35735" class="Bound">τ</a><span id="35736" class="Symbol">}</span> <span id="35738" class="Symbol">→</span> <span id="35740" class="Symbol">(</span><a id="35741" href="#35741" class="Bound">machine</a> <span id="35749" class="Symbol">:</span> <a id="35751" href="#27628" class="Datatype">Machine</a> <a id="35759" href="#35733" class="Bound">σ</a><span id="35760" class="Symbol">)</span> <span id="35762" class="Symbol">→</span> <span id="35764" class="Symbol">(</span><a id="35765" href="#35765" class="Bound">stack</a> <span id="35771" class="Symbol">:</span> <a id="35773" href="#27326" class="Datatype">CallStack</a> <a id="35783" href="#35733" class="Bound">σ</a> <a id="35785" href="#35735" class="Bound">τ</a><span id="35786" class="Symbol">)</span>
      <span id="35794" class="Symbol">→</span> <a id="35796" href="#29090" class="Function">composeStepStack</a> <span id="35813" class="Symbol">(</span><a id="35814" href="#34608" class="Function">reduce</a> <a id="35821" href="#35741" class="Bound">machine</a><span id="35828" class="Symbol">)</span> <a id="35830" href="#35765" class="Bound">stack</a> <a id="35836" href="#2729" class="Function Operator">≡</a> <a id="35838" href="#34608" class="Function">reduce</a> <span id="35845" class="Symbol">(</span><a id="35846" href="#28450" class="Function">composeMachineStack</a> <a id="35866" href="#35741" class="Bound">machine</a> <a id="35874" href="#35765" class="Bound">stack</a><span id="35879" class="Symbol">)</span>
  <a id="35883" href="#35709" class="Function">locality-lem</a> <span id="35896" class="Symbol">((</span><a id="35898" href="#35898" class="Bound">env</a> <a id="35902" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="35904" href="#21778" class="InductiveConstructor">return</a> <a id="35911" href="#35911" class="Bound">x</a><span id="35912" class="Symbol">)</span>              <a id="35927" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="35929" href="#27366" class="InductiveConstructor">ε</a><span id="35930" class="Symbol">)</span>                 <a id="35948" href="#35948" class="Bound">stack'</a> <span id="35955" class="Symbol">=</span> <a id="35957" href="#2690" class="InductiveConstructor">refl</a>
  <a id="35964" href="#35709" class="Function">locality-lem</a> <span id="35977" class="Symbol">((</span><a id="35979" href="#35979" class="Bound">env</a> <a id="35983" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="35985" href="#21778" class="InductiveConstructor">return</a> <a id="35992" href="#35992" class="Bound">x</a><span id="35993" class="Symbol">)</span>              <a id="36008" href="#27659" class="InductiveConstructor Operator">▹</a> <span id="36010" class="Symbol">(</span><a id="36011" href="#36011" class="Bound">closure</a> <a id="36019" href="#27402" class="InductiveConstructor Operator">∷</a> <a id="36021" href="#36021" class="Bound">stack</a><span id="36026" class="Symbol">))</span> <a id="36029" href="#36029" class="Bound">stack'</a> <span id="36036" class="Symbol">=</span> <a id="36038" href="#2690" class="InductiveConstructor">refl</a>
  <a id="36045" href="#35709" class="Function">locality-lem</a> <span id="36058" class="Symbol">((</span><a id="36060" href="#36060" class="Bound">env</a> <a id="36064" href="#27237" class="InductiveConstructor Operator">&amp;</a> <span id="36066" class="Symbol">(</span><a id="36067" href="#12591" class="InductiveConstructor">intr</a> <a id="36072" href="#36072" class="Bound">rule</a>   <a id="36079" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="36081" href="#36081" class="Bound">term'</a><span id="36086" class="Symbol">))</span> <a id="36089" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="36091" href="#36091" class="Bound">stack</a><span id="36096" class="Symbol">)</span>             <a id="36110" href="#36110" class="Bound">stack'</a> <span id="36117" class="Symbol">=</span> <a id="36119" href="#2690" class="InductiveConstructor">refl</a>
  <a id="36126" href="#35709" class="Function">locality-lem</a> <span id="36139" class="Symbol">((</span><a id="36141" href="#36141" class="Bound">env</a> <a id="36145" href="#27237" class="InductiveConstructor Operator">&amp;</a> <span id="36147" class="Symbol">(</span><a id="36148" href="#12666" class="InductiveConstructor">elim</a> <a id="36153" href="#36153" class="Bound">x</a> <a id="36155" href="#36155" class="Bound">rule</a> <a id="36160" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="36162" href="#36162" class="Bound">term'</a><span id="36167" class="Symbol">))</span> <a id="36170" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="36172" href="#36172" class="Bound">stack</a><span id="36177" class="Symbol">)</span>             <a id="36191" href="#36191" class="Bound">stack'</a> <span id="36198" class="Symbol">=</span> <a id="36200" href="#2690" class="InductiveConstructor">refl</a>

<span id="36206" class="Keyword">open</span> <a id="36211" href="#35524" class="Module">12:Locality</a>



<span id="36226" class="Keyword">module</span> <a id="13:SomeValues"></a><a id="36233" href="#36233" class="Module">13:SomeValues</a> <span id="36247" class="Keyword">where</span>
  <span id="36255" class="Comment">{-
     13. Examples of values
  -}</span>

  <a id="13:SomeValues.^apply"></a><a id="36294" href="#36294" class="Function">^apply</a> <span id="36301" class="Symbol">:</span> <span id="36303" class="Symbol">∀</span> <span id="36305" class="Symbol">{</span><a id="36306" href="#36306" class="Bound">τ</a> <a id="36308" href="#36308" class="Bound">ϕ</a><span id="36309" class="Symbol">}</span> <span id="36311" class="Symbol">→</span> <a id="36313" href="#26505" class="Datatype">Value</a> <span id="36319" class="Symbol">(</span><a id="36320" href="#36306" class="Bound">τ</a> <a id="36322" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="36324" href="#36308" class="Bound">ϕ</a><span id="36325" class="Symbol">)</span> <span id="36327" class="Symbol">→</span> <a id="36329" href="#26505" class="Datatype">Value</a> <a id="36335" href="#36306" class="Bound">τ</a> <span id="36337" class="Symbol">→</span> <a id="36339" href="#27204" class="Datatype">Thunk</a> <a id="36345" href="#36308" class="Bound">ϕ</a>
  <a id="36349" href="#36294" class="Function">^apply</a> <a id="36356" href="#36356" class="Bound">f</a> <a id="36358" href="#36358" class="Bound">v</a> <span id="36360" class="Symbol">=</span> <a id="36362" href="#29767" class="Function">eliminateArrow</a> <span id="36377" class="Symbol">(</span><a id="36378" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="36388" href="#36358" class="Bound">v</a><span id="36389" class="Symbol">)</span> <a id="36391" href="#36356" class="Bound">f</a>

  <a id="13:SomeValues.^here"></a><a id="36396" href="#36396" class="Function">^here</a> <span id="36402" class="Symbol">:</span> <span id="36404" class="Symbol">∀</span> <span id="36406" class="Symbol">{</span><a id="36407" href="#36407" class="Bound">τ</a> <a id="36409" href="#36409" class="Bound">τs</a><span id="36411" class="Symbol">}</span> <span id="36413" class="Symbol">→</span> <a id="36415" href="#26505" class="Datatype">Value</a> <a id="36421" href="#36407" class="Bound">τ</a> <span id="36423" class="Symbol">→</span> <a id="36425" href="#26505" class="Datatype">Value</a> <span id="36431" class="Symbol">(</span><a id="36432" href="#8677" class="InductiveConstructor">#Sum</a> <span id="36437" class="Symbol">(</span><a id="36438" href="#36407" class="Bound">τ</a> <a id="36440" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="36442" href="#36409" class="Bound">τs</a><span id="36444" class="Symbol">))</span>
  <a id="36449" href="#36396" class="Function">^here</a> <a id="36455" href="#36455" class="Bound">v</a> <span id="36457" class="Symbol">=</span> <a id="36459" href="#26540" class="InductiveConstructor">construct</a> <span id="36469" class="Symbol">(</span><a id="36470" href="#10102" class="InductiveConstructor">intrSum</a> <span id="36478" class="Symbol">(</span><a id="36479" href="#3288" class="InductiveConstructor">here</a> <a id="36484" href="#36455" class="Bound">v</a><span id="36485" class="Symbol">))</span>

  <a id="13:SomeValues.^there"></a><a id="36491" href="#36491" class="Function">^there</a> <span id="36498" class="Symbol">:</span> <span id="36500" class="Symbol">∀</span> <span id="36502" class="Symbol">{</span><a id="36503" href="#36503" class="Bound">τ</a> <a id="36505" href="#36505" class="Bound">τs</a><span id="36507" class="Symbol">}</span> <span id="36509" class="Symbol">→</span> <a id="36511" href="#26505" class="Datatype">Value</a> <span id="36517" class="Symbol">(</span><a id="36518" href="#8677" class="InductiveConstructor">#Sum</a> <a id="36523" href="#36505" class="Bound">τs</a><span id="36525" class="Symbol">)</span> <span id="36527" class="Symbol">→</span> <a id="36529" href="#26505" class="Datatype">Value</a> <span id="36535" class="Symbol">(</span><a id="36536" href="#8677" class="InductiveConstructor">#Sum</a> <span id="36541" class="Symbol">(</span><a id="36542" href="#36503" class="Bound">τ</a> <a id="36544" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="36546" href="#36505" class="Bound">τs</a><span id="36548" class="Symbol">))</span>
  <a id="36553" href="#36491" class="Function">^there</a> <span id="36560" class="Symbol">(</span><a id="36561" href="#26540" class="InductiveConstructor">construct</a> <span id="36571" class="Symbol">(</span><a id="36572" href="#10102" class="InductiveConstructor">intrSum</a> <a id="36580" href="#36580" class="Bound">vᵢ</a><span id="36582" class="Symbol">))</span> <span id="36585" class="Symbol">=</span> <a id="36587" href="#26540" class="InductiveConstructor">construct</a> <span id="36597" class="Symbol">(</span><a id="36598" href="#10102" class="InductiveConstructor">intrSum</a> <span id="36606" class="Symbol">(</span><a id="36607" href="#3332" class="InductiveConstructor">there</a> <a id="36613" href="#36580" class="Bound">vᵢ</a><span id="36615" class="Symbol">))</span>

  <a id="13:SomeValues.^nil"></a><a id="36621" href="#36621" class="Function">^nil</a> <span id="36626" class="Symbol">:</span> <a id="36628" href="#26505" class="Datatype">Value</a> <span id="36634" class="Symbol">(</span><a id="36635" href="#8737" class="InductiveConstructor">#Product</a> <a id="36644" href="#2802" class="InductiveConstructor">ε</a><span id="36645" class="Symbol">)</span>
  <a id="36649" href="#36621" class="Function">^nil</a> <span id="36654" class="Symbol">=</span> <a id="36656" href="#26540" class="InductiveConstructor">construct</a> <span id="36666" class="Symbol">(</span><a id="36667" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="36679" href="#2930" class="InductiveConstructor">ε</a><span id="36680" class="Symbol">)</span>

  <a id="13:SomeValues.^cons"></a><a id="36685" href="#36685" class="Function">^cons</a> <span id="36691" class="Symbol">:</span> <span id="36693" class="Symbol">∀</span> <span id="36695" class="Symbol">{</span><a id="36696" href="#36696" class="Bound">τ</a> <a id="36698" href="#36698" class="Bound">τs</a><span id="36700" class="Symbol">}</span> <span id="36702" class="Symbol">→</span> <a id="36704" href="#26505" class="Datatype">Value</a> <a id="36710" href="#36696" class="Bound">τ</a> <span id="36712" class="Symbol">→</span> <a id="36714" href="#26505" class="Datatype">Value</a> <span id="36720" class="Symbol">(</span><a id="36721" href="#8737" class="InductiveConstructor">#Product</a> <a id="36730" href="#36698" class="Bound">τs</a><span id="36732" class="Symbol">)</span> <span id="36734" class="Symbol">→</span> <a id="36736" href="#26505" class="Datatype">Value</a> <span id="36742" class="Symbol">(</span><a id="36743" href="#8737" class="InductiveConstructor">#Product</a> <span id="36752" class="Symbol">(</span><a id="36753" href="#36696" class="Bound">τ</a> <a id="36755" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="36757" href="#36698" class="Bound">τs</a><span id="36759" class="Symbol">))</span>
  <a id="36764" href="#36685" class="Function">^cons</a> <a id="36770" href="#36770" class="Bound">v</a> <span id="36772" class="Symbol">(</span><a id="36773" href="#26540" class="InductiveConstructor">construct</a> <span id="36783" class="Symbol">(</span><a id="36784" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="36796" href="#36796" class="Bound">vs</a><span id="36798" class="Symbol">))</span> <span id="36801" class="Symbol">=</span> <a id="36803" href="#26540" class="InductiveConstructor">construct</a> <span id="36813" class="Symbol">(</span><a id="36814" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="36826" class="Symbol">(</span><a id="36827" href="#36770" class="Bound">v</a> <a id="36829" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="36831" href="#36796" class="Bound">vs</a><span id="36833" class="Symbol">))</span>

  <a id="13:SomeValues.^pair"></a><a id="36839" href="#36839" class="Function">^pair</a> <span id="36845" class="Symbol">:</span> <span id="36847" class="Symbol">∀</span> <span id="36849" class="Symbol">{</span><a id="36850" href="#36850" class="Bound">σ</a> <a id="36852" href="#36852" class="Bound">τ</a><span id="36853" class="Symbol">}</span> <span id="36855" class="Symbol">→</span> <a id="36857" href="#26505" class="Datatype">Value</a> <a id="36863" href="#36850" class="Bound">σ</a> <span id="36865" class="Symbol">→</span> <a id="36867" href="#26505" class="Datatype">Value</a> <a id="36873" href="#36852" class="Bound">τ</a> <span id="36875" class="Symbol">→</span> <a id="36877" href="#26505" class="Datatype">Value</a> <span id="36883" class="Symbol">(</span><a id="36884" href="#9217" class="Function">#Pair</a> <a id="36890" href="#36850" class="Bound">σ</a> <a id="36892" href="#36852" class="Bound">τ</a><span id="36893" class="Symbol">)</span>
  <a id="36897" href="#36839" class="Function">^pair</a> <a id="36903" href="#36903" class="Bound">v₁</a> <a id="36906" href="#36906" class="Bound">v₂</a> <span id="36909" class="Symbol">=</span> <a id="36911" href="#26540" class="InductiveConstructor">construct</a> <span id="36921" class="Symbol">(</span><a id="36922" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="36934" class="Symbol">(</span><a id="36935" href="#36903" class="Bound">v₁</a> <a id="36938" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="36940" href="#36906" class="Bound">v₂</a> <a id="36943" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="36945" href="#2930" class="InductiveConstructor">ε</a><span id="36946" class="Symbol">))</span>

  <a id="13:SomeValues.^nothing"></a><a id="36952" href="#36952" class="Function">^nothing</a> <span id="36961" class="Symbol">:</span> <span id="36963" class="Symbol">∀</span> <span id="36965" class="Symbol">{</span><a id="36966" href="#36966" class="Bound">τ</a><span id="36967" class="Symbol">}</span> <span id="36969" class="Symbol">→</span> <a id="36971" href="#26505" class="Datatype">Value</a> <span id="36977" class="Symbol">(</span><a id="36978" href="#9349" class="Function">#Maybe</a> <a id="36985" href="#36966" class="Bound">τ</a><span id="36986" class="Symbol">)</span>
  <a id="36990" href="#36952" class="Function">^nothing</a> <span id="36999" class="Symbol">=</span> <a id="37001" href="#26540" class="InductiveConstructor">construct</a> <span id="37011" class="Symbol">(</span><a id="37012" href="#10102" class="InductiveConstructor">intrSum</a> <span id="37020" class="Symbol">(</span><a id="37021" href="#3288" class="InductiveConstructor">here</a> <a id="37026" href="#36621" class="Function">^nil</a><span id="37030" class="Symbol">))</span>

  <a id="13:SomeValues.^just"></a><a id="37036" href="#37036" class="Function">^just</a> <span id="37042" class="Symbol">:</span> <span id="37044" class="Symbol">∀</span> <span id="37046" class="Symbol">{</span><a id="37047" href="#37047" class="Bound">τ</a><span id="37048" class="Symbol">}</span> <span id="37050" class="Symbol">→</span> <a id="37052" href="#26505" class="Datatype">Value</a> <a id="37058" href="#37047" class="Bound">τ</a> <span id="37060" class="Symbol">→</span> <a id="37062" href="#26505" class="Datatype">Value</a> <span id="37068" class="Symbol">(</span><a id="37069" href="#9349" class="Function">#Maybe</a> <a id="37076" href="#37047" class="Bound">τ</a><span id="37077" class="Symbol">)</span>
  <a id="37081" href="#37036" class="Function">^just</a> <a id="37087" href="#37087" class="Bound">v</a> <span id="37089" class="Symbol">=</span> <a id="37091" href="#26540" class="InductiveConstructor">construct</a> <span id="37101" class="Symbol">(</span><a id="37102" href="#10102" class="InductiveConstructor">intrSum</a> <span id="37110" class="Symbol">(</span><a id="37111" href="#3332" class="InductiveConstructor">there</a> <span id="37117" class="Symbol">(</span><a id="37118" href="#3288" class="InductiveConstructor">here</a> <a id="37123" href="#37087" class="Bound">v</a><span id="37124" class="Symbol">)))</span>

  <a id="13:SomeValues.^mkNat"></a><a id="37131" href="#37131" class="Function">^mkNat</a> <span id="37138" class="Symbol">:</span> <a id="37140" href="#26505" class="Datatype">Value</a> <span id="37146" class="Symbol">(</span><a id="37147" href="#9349" class="Function">#Maybe</a> <a id="37154" href="#8801" class="InductiveConstructor">#Nat</a><span id="37158" class="Symbol">)</span> <span id="37160" class="Symbol">→</span> <a id="37162" href="#26505" class="Datatype">Value</a> <a id="37168" href="#8801" class="InductiveConstructor">#Nat</a>
  <a id="37175" href="#37131" class="Function">^mkNat</a> <a id="37182" href="#37182" class="Bound">v</a> <span id="37184" class="Symbol">=</span> <a id="37186" href="#26540" class="InductiveConstructor">construct</a> <span id="37196" class="Symbol">(</span><a id="37197" href="#10481" class="InductiveConstructor">intrNat</a> <a id="37205" href="#37182" class="Bound">v</a><span id="37206" class="Symbol">)</span>

  <a id="13:SomeValues.^mkConat"></a><a id="37211" href="#37211" class="Function">^mkConat</a> <span id="37220" class="Symbol">:</span> <span id="37222" class="Symbol">(</span><a id="37223" href="#37223" class="Bound">ρ</a> <span id="37225" class="Symbol">:</span> <a id="37227" href="#8610" class="Datatype">Type</a><span id="37231" class="Symbol">)</span> <span id="37233" class="Symbol">→</span> <a id="37235" href="#26505" class="Datatype">Value</a> <a id="37241" href="#37223" class="Bound">ρ</a> <span id="37243" class="Symbol">→</span> <a id="37245" href="#26505" class="Datatype">Value</a> <span id="37251" class="Symbol">(</span><a id="37252" href="#37223" class="Bound">ρ</a> <a id="37254" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="37256" href="#9349" class="Function">#Maybe</a> <a id="37263" href="#37223" class="Bound">ρ</a><span id="37264" class="Symbol">)</span> <span id="37266" class="Symbol">→</span> <a id="37268" href="#26505" class="Datatype">Value</a> <a id="37274" href="#8853" class="InductiveConstructor">#Conat</a>
  <a id="37283" href="#37211" class="Function">^mkConat</a> <a id="37292" href="#37292" class="Bound">ρ</a> <a id="37294" href="#37294" class="Bound">v</a> <a id="37296" href="#37296" class="Bound">f</a> <span id="37298" class="Symbol">=</span> <a id="37300" href="#26540" class="InductiveConstructor">construct</a> <span id="37310" class="Symbol">(</span><a id="37311" href="#10848" class="InductiveConstructor">intrConat</a> <span id="37321" class="Symbol">(</span><a id="37322" href="#37292" class="Bound">ρ</a> <a id="37324" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="37327" href="#37294" class="Bound">v</a> <a id="37329" href="#2431" class="InductiveConstructor Operator">,</a> <a id="37331" href="#37296" class="Bound">f</a><span id="37332" class="Symbol">))</span>

  <a id="13:SomeValues.^mkStream"></a><a id="37338" href="#37338" class="Function">^mkStream</a> <span id="37348" class="Symbol">:</span> <span id="37350" class="Symbol">∀</span> <span id="37352" class="Symbol">{</span><a id="37353" href="#37353" class="Bound">τ</a><span id="37354" class="Symbol">}</span> <span id="37356" class="Symbol">→</span> <span id="37358" class="Symbol">(</span><a id="37359" href="#37359" class="Bound">ρ</a> <span id="37361" class="Symbol">:</span> <a id="37363" href="#8610" class="Datatype">Type</a><span id="37367" class="Symbol">)</span> <span id="37369" class="Symbol">→</span> <a id="37371" href="#26505" class="Datatype">Value</a> <a id="37377" href="#37359" class="Bound">ρ</a> <span id="37379" class="Symbol">→</span> <a id="37381" href="#26505" class="Datatype">Value</a> <span id="37387" class="Symbol">(</span><a id="37388" href="#37359" class="Bound">ρ</a> <a id="37390" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="37392" href="#9217" class="Function">#Pair</a> <a id="37398" href="#37353" class="Bound">τ</a> <a id="37400" href="#37359" class="Bound">ρ</a><span id="37401" class="Symbol">)</span> <span id="37403" class="Symbol">→</span> <a id="37405" href="#26505" class="Datatype">Value</a> <span id="37411" class="Symbol">(</span><a id="37412" href="#8937" class="InductiveConstructor">#Stream</a> <a id="37420" href="#37353" class="Bound">τ</a><span id="37421" class="Symbol">)</span>
  <a id="37425" href="#37338" class="Function">^mkStream</a> <a id="37435" href="#37435" class="Bound">ρ</a> <a id="37437" href="#37437" class="Bound">v</a> <a id="37439" href="#37439" class="Bound">f</a> <span id="37441" class="Symbol">=</span> <a id="37443" href="#26540" class="InductiveConstructor">construct</a> <span id="37453" class="Symbol">(</span><a id="37454" href="#11212" class="InductiveConstructor">intrStream</a> <span id="37465" class="Symbol">(</span><a id="37466" href="#37435" class="Bound">ρ</a> <a id="37468" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="37471" href="#37437" class="Bound">v</a> <a id="37473" href="#2431" class="InductiveConstructor Operator">,</a> <a id="37475" href="#37439" class="Bound">f</a><span id="37476" class="Symbol">))</span>

<span id="37480" class="Keyword">open</span> <a id="37485" href="#36233" class="Module">13:SomeValues</a>



<span id="37502" class="Keyword">module</span> <a id="14:Trace"></a><a id="37509" href="#37509" class="Module">14:Trace</a> <span id="37518" class="Keyword">where</span>
  <span id="37526" class="Comment">{-
     14. Definition of a computation trace
  -}</span>

  <span id="37580" class="Comment">{-
     As a convention, we prefix names related to denotational semantics with '!'.
  -}</span>

  <span id="37673" class="Comment">-- 'TraceStep !τ step' states that 'step' is either a value satisfying</span>
  <span id="37746" class="Comment">-- predicate '!τ', or 'step' is a machine, and applying 'reduce' repeatedly</span>
  <span id="37824" class="Comment">-- to that machine will eventually terminate with a value satisfying '!τ'</span>
  <span id="37900" class="Keyword">data</span> <a id="14:Trace.TraceStep"></a><a id="37905" href="#37905" class="Datatype">TraceStep</a> <span id="37915" class="Symbol">{</span><a id="37916" href="#37916" class="Bound">τ</a><span id="37917" class="Symbol">}</span> <span id="37919" class="Symbol">(</span><a id="37920" href="#37920" class="Bound">!τ</a> <span id="37923" class="Symbol">:</span> <a id="37925" href="#26505" class="Datatype">Value</a> <a id="37931" href="#37916" class="Bound">τ</a> <span id="37933" class="Symbol">→</span> <span id="37935" class="PrimitiveType">Set</span><span id="37938" class="Symbol">)</span> <span id="37940" class="Symbol">:</span> <a id="37942" href="#27851" class="Datatype">Step</a> <a id="37947" href="#37916" class="Bound">τ</a> <span id="37949" class="Symbol">→</span> <span id="37951" class="PrimitiveType">Set</span> <span id="37955" class="Keyword">where</span>
    <a id="14:Trace.TraceStep.!finish"></a><a id="37965" href="#37965" class="InductiveConstructor">!finish</a>   <span id="37975" class="Symbol">:</span> <span id="37977" class="Symbol">{</span><a id="37978" href="#37978" class="Bound">value</a> <span id="37984" class="Symbol">:</span> <a id="37986" href="#26505" class="Datatype">Value</a> <a id="37992" href="#37916" class="Bound">τ</a><span id="37993" class="Symbol">}</span> <span id="37995" class="Symbol">→</span> <a id="37997" href="#37920" class="Bound">!τ</a> <a id="38000" href="#37978" class="Bound">value</a> <span id="38006" class="Symbol">→</span> <a id="38008" href="#37905" class="Datatype">TraceStep</a> <a id="38018" href="#37920" class="Bound">!τ</a> <span id="38021" class="Symbol">(</span><a id="38022" href="#27883" class="InductiveConstructor">finish</a> <a id="38029" href="#37978" class="Bound">value</a><span id="38034" class="Symbol">)</span>
    <a id="14:Trace.TraceStep.!continue"></a><a id="38040" href="#38040" class="InductiveConstructor">!continue</a> <span id="38050" class="Symbol">:</span> <span id="38052" class="Symbol">{</span><a id="38053" href="#38053" class="Bound">machine</a> <span id="38061" class="Symbol">:</span> <a id="38063" href="#27628" class="Datatype">Machine</a> <a id="38071" href="#37916" class="Bound">τ</a><span id="38072" class="Symbol">}</span> <span id="38074" class="Symbol">→</span> <a id="38076" href="#37905" class="Datatype">TraceStep</a> <a id="38086" href="#37920" class="Bound">!τ</a> <span id="38089" class="Symbol">(</span><a id="38090" href="#34608" class="Function">reduce</a> <a id="38097" href="#38053" class="Bound">machine</a><span id="38104" class="Symbol">)</span> <span id="38106" class="Symbol">→</span> <a id="38108" href="#37905" class="Datatype">TraceStep</a> <a id="38118" href="#37920" class="Bound">!τ</a> <span id="38121" class="Symbol">(</span><a id="38122" href="#27915" class="InductiveConstructor">continue</a> <a id="38131" href="#38053" class="Bound">machine</a><span id="38138" class="Symbol">)</span>

  <span id="38143" class="Comment">-- 'TraceMachine !τ machine' states that applying 'reduce' repeatedly to</span>
  <span id="38218" class="Comment">-- 'machine' will eventually terminate, and the final value will satisfy '!τ'</span>
  <span id="38298" class="Keyword">data</span> <a id="14:Trace.TraceMachine"></a><a id="38303" href="#38303" class="Datatype">TraceMachine</a> <span id="38316" class="Symbol">{</span><a id="38317" href="#38317" class="Bound">τ</a><span id="38318" class="Symbol">}</span> <span id="38320" class="Symbol">(</span><a id="38321" href="#38321" class="Bound">!τ</a> <span id="38324" class="Symbol">:</span> <a id="38326" href="#26505" class="Datatype">Value</a> <a id="38332" href="#38317" class="Bound">τ</a> <span id="38334" class="Symbol">→</span> <span id="38336" class="PrimitiveType">Set</span><span id="38339" class="Symbol">)</span> <span id="38341" class="Symbol">:</span> <a id="38343" href="#27628" class="Datatype">Machine</a> <a id="38351" href="#38317" class="Bound">τ</a> <span id="38353" class="Symbol">→</span> <span id="38355" class="PrimitiveType">Set</span> <span id="38359" class="Keyword">where</span>
    <a id="14:Trace.TraceMachine.!continueM"></a><a id="38369" href="#38369" class="InductiveConstructor">!continueM</a> <span id="38380" class="Symbol">:</span> <span id="38382" class="Symbol">{</span><a id="38383" href="#38383" class="Bound">machine</a> <span id="38391" class="Symbol">:</span> <a id="38393" href="#27628" class="Datatype">Machine</a> <a id="38401" href="#38317" class="Bound">τ</a><span id="38402" class="Symbol">}</span> <span id="38404" class="Symbol">→</span> <a id="38406" href="#37905" class="Datatype">TraceStep</a> <a id="38416" href="#38321" class="Bound">!τ</a> <span id="38419" class="Symbol">(</span><a id="38420" href="#34608" class="Function">reduce</a> <a id="38427" href="#38383" class="Bound">machine</a><span id="38434" class="Symbol">)</span> <span id="38436" class="Symbol">→</span> <a id="38438" href="#38303" class="Datatype">TraceMachine</a> <a id="38451" href="#38321" class="Bound">!τ</a> <a id="38454" href="#38383" class="Bound">machine</a>

  <span id="38465" class="Comment">-- Trace for a thunk is a trace for the machine consisting of this thunk and</span>
  <span id="38544" class="Comment">-- an empty continuation</span>
  <a id="14:Trace.TraceThunk"></a><a id="38571" href="#38571" class="Function">TraceThunk</a> <span id="38582" class="Symbol">:</span> <span id="38584" class="Symbol">∀</span> <span id="38586" class="Symbol">{</span><a id="38587" href="#38587" class="Bound">τ</a><span id="38588" class="Symbol">}</span> <span id="38590" class="Symbol">→</span> <span id="38592" class="Symbol">(</span><a id="38593" href="#38593" class="Bound">!τ</a> <span id="38596" class="Symbol">:</span> <a id="38598" href="#26505" class="Datatype">Value</a> <a id="38604" href="#38587" class="Bound">τ</a> <span id="38606" class="Symbol">→</span> <span id="38608" class="PrimitiveType">Set</span><span id="38611" class="Symbol">)</span> <span id="38613" class="Symbol">→</span> <a id="38615" href="#27204" class="Datatype">Thunk</a> <a id="38621" href="#38587" class="Bound">τ</a> <span id="38623" class="Symbol">→</span> <span id="38625" class="PrimitiveType">Set</span>
  <a id="38631" href="#38571" class="Function">TraceThunk</a> <a id="38642" href="#38642" class="Bound">!τ</a> <a id="38645" href="#38645" class="Bound">thunk</a> <span id="38651" class="Symbol">=</span> <a id="38653" href="#38303" class="Datatype">TraceMachine</a> <a id="38666" href="#38642" class="Bound">!τ</a> <span id="38669" class="Symbol">(</span><a id="38670" href="#38645" class="Bound">thunk</a> <a id="38676" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="38678" href="#27366" class="InductiveConstructor">ε</a><span id="38679" class="Symbol">)</span>

  <span id="38684" class="Comment">-- Functorial map for TraceStep</span>
  <a id="14:Trace.mapTraceStep"></a><a id="38718" href="#38718" class="Function">mapTraceStep</a>
      <span id="38737" class="Symbol">:</span> <span id="38739" class="Symbol">∀</span> <span id="38741" class="Symbol">{</span><a id="38742" href="#38742" class="Bound">τ</a><span id="38743" class="Symbol">}</span> <span id="38745" class="Symbol">{</span> <a id="38747" href="#38747" class="Bound">!τ</a> <a id="38750" href="#38750" class="Bound">!τ'</a> <span id="38754" class="Symbol">:</span> <a id="38756" href="#26505" class="Datatype">Value</a> <a id="38762" href="#38742" class="Bound">τ</a> <span id="38764" class="Symbol">→</span> <span id="38766" class="PrimitiveType">Set</span> <span id="38770" class="Symbol">}</span>
      <span id="38778" class="Symbol">→</span> <span id="38780" class="Symbol">(∀</span> <span id="38783" class="Symbol">{</span><a id="38784" href="#38784" class="Bound">value</a><span id="38789" class="Symbol">}</span> <span id="38791" class="Symbol">→</span> <a id="38793" href="#38747" class="Bound">!τ</a> <a id="38796" href="#38784" class="Bound">value</a> <span id="38802" class="Symbol">→</span> <a id="38804" href="#38750" class="Bound">!τ'</a> <a id="38808" href="#38784" class="Bound">value</a><span id="38813" class="Symbol">)</span> <span id="38815" class="Symbol">→</span> <span id="38817" class="Symbol">(∀</span> <span id="38820" class="Symbol">{</span><a id="38821" href="#38821" class="Bound">step</a><span id="38825" class="Symbol">}</span> <span id="38827" class="Symbol">→</span> <a id="38829" href="#37905" class="Datatype">TraceStep</a> <a id="38839" href="#38747" class="Bound">!τ</a> <a id="38842" href="#38821" class="Bound">step</a> <span id="38847" class="Symbol">→</span> <a id="38849" href="#37905" class="Datatype">TraceStep</a> <a id="38859" href="#38750" class="Bound">!τ'</a> <a id="38863" href="#38821" class="Bound">step</a><span id="38867" class="Symbol">)</span>
  <a id="38871" href="#38718" class="Function">mapTraceStep</a> <a id="38884" href="#38884" class="Bound">f</a> <span id="38886" class="Symbol">(</span><a id="38887" href="#37965" class="InductiveConstructor">!finish</a> <a id="38895" href="#38895" class="Bound">!v</a><span id="38897" class="Symbol">)</span>      <span id="38904" class="Symbol">=</span> <a id="38906" href="#37965" class="InductiveConstructor">!finish</a> <span id="38914" class="Symbol">(</span><a id="38915" href="#38884" class="Bound">f</a> <a id="38917" href="#38895" class="Bound">!v</a><span id="38919" class="Symbol">)</span>
  <a id="38923" href="#38718" class="Function">mapTraceStep</a> <a id="38936" href="#38936" class="Bound">f</a> <span id="38938" class="Symbol">(</span><a id="38939" href="#38040" class="InductiveConstructor">!continue</a> <a id="38949" href="#38949" class="Bound">!step</a><span id="38954" class="Symbol">)</span> <span id="38956" class="Symbol">=</span> <a id="38958" href="#38040" class="InductiveConstructor">!continue</a> <span id="38968" class="Symbol">(</span><a id="38969" href="#38718" class="Function">mapTraceStep</a> <a id="38982" href="#38936" class="Bound">f</a> <a id="38984" href="#38949" class="Bound">!step</a><span id="38989" class="Symbol">)</span>

  <span id="38994" class="Comment">-- Functorial map for TraceMachine</span>
  <a id="14:Trace.mapTraceMachine"></a><a id="39031" href="#39031" class="Function">mapTraceMachine</a>
      <span id="39053" class="Symbol">:</span> <span id="39055" class="Symbol">∀</span> <span id="39057" class="Symbol">{</span><a id="39058" href="#39058" class="Bound">τ</a><span id="39059" class="Symbol">}</span> <span id="39061" class="Symbol">{</span> <a id="39063" href="#39063" class="Bound">!τ</a> <a id="39066" href="#39066" class="Bound">!τ'</a> <span id="39070" class="Symbol">:</span> <a id="39072" href="#26505" class="Datatype">Value</a> <a id="39078" href="#39058" class="Bound">τ</a> <span id="39080" class="Symbol">→</span> <span id="39082" class="PrimitiveType">Set</span> <span id="39086" class="Symbol">}</span>
      <span id="39094" class="Symbol">→</span> <span id="39096" class="Symbol">(∀</span> <span id="39099" class="Symbol">{</span><a id="39100" href="#39100" class="Bound">value</a><span id="39105" class="Symbol">}</span> <span id="39107" class="Symbol">→</span> <a id="39109" href="#39063" class="Bound">!τ</a> <a id="39112" href="#39100" class="Bound">value</a> <span id="39118" class="Symbol">→</span> <a id="39120" href="#39066" class="Bound">!τ'</a> <a id="39124" href="#39100" class="Bound">value</a><span id="39129" class="Symbol">)</span> <span id="39131" class="Symbol">→</span> <span id="39133" class="Symbol">(∀</span> <span id="39136" class="Symbol">{</span><a id="39137" href="#39137" class="Bound">machine</a><span id="39144" class="Symbol">}</span> <span id="39146" class="Symbol">→</span> <a id="39148" href="#38303" class="Datatype">TraceMachine</a> <a id="39161" href="#39063" class="Bound">!τ</a> <a id="39164" href="#39137" class="Bound">machine</a> <span id="39172" class="Symbol">→</span> <a id="39174" href="#38303" class="Datatype">TraceMachine</a> <a id="39187" href="#39066" class="Bound">!τ'</a> <a id="39191" href="#39137" class="Bound">machine</a><span id="39198" class="Symbol">)</span>
  <a id="39202" href="#39031" class="Function">mapTraceMachine</a> <a id="39218" href="#39218" class="Bound">f</a> <span id="39220" class="Symbol">(</span><a id="39221" href="#38369" class="InductiveConstructor">!continueM</a> <a id="39232" href="#39232" class="Bound">!step</a><span id="39237" class="Symbol">)</span> <span id="39239" class="Symbol">=</span> <a id="39241" href="#38369" class="InductiveConstructor">!continueM</a> <span id="39252" class="Symbol">(</span><a id="39253" href="#38718" class="Function">mapTraceStep</a> <a id="39266" href="#39218" class="Bound">f</a> <a id="39268" href="#39232" class="Bound">!step</a><span id="39273" class="Symbol">)</span>

  <span id="39278" class="Comment">-- Neat aliases for !finish, !continue and !continueM</span>
  <span id="39334" class="Keyword">infix</span> <span id="39340" class="Number">10</span> <a id="39343" href="#39356" class="Function Operator">◽_</a> <a id="39346" href="#39455" class="Function Operator">∗_</a> <a id="39349" href="#39583" class="Function Operator">∗ₘ_</a>

  <a id="14:Trace.◽_"></a><a id="39356" href="#39356" class="Function Operator">◽_</a> <span id="39359" class="Symbol">:</span> <span id="39361" class="Symbol">∀</span> <span id="39363" class="Symbol">{</span><a id="39364" href="#39364" class="Bound">τ</a> <a id="39366" href="#39366" class="Bound">value</a><span id="39371" class="Symbol">}</span> <span id="39373" class="Symbol">{</span> <a id="39375" href="#39375" class="Bound">!τ</a> <span id="39378" class="Symbol">:</span> <a id="39380" href="#26505" class="Datatype">Value</a> <a id="39386" href="#39364" class="Bound">τ</a> <span id="39388" class="Symbol">→</span> <span id="39390" class="PrimitiveType">Set</span> <span id="39394" class="Symbol">}</span> <span id="39396" class="Symbol">→</span> <a id="39398" href="#39375" class="Bound">!τ</a> <a id="39401" href="#39366" class="Bound">value</a> <span id="39407" class="Symbol">→</span> <a id="39409" href="#37905" class="Datatype">TraceStep</a> <a id="39419" href="#39375" class="Bound">!τ</a> <span id="39422" class="Symbol">(</span><a id="39423" href="#27883" class="InductiveConstructor">finish</a> <a id="39430" href="#39366" class="Bound">value</a><span id="39435" class="Symbol">)</span>
  <a id="39439" href="#39356" class="Function Operator">◽_</a> <span id="39442" class="Symbol">=</span> <a id="39444" href="#37965" class="InductiveConstructor">!finish</a>

  <a id="14:Trace.∗_"></a><a id="39455" href="#39455" class="Function Operator">∗_</a> <span id="39458" class="Symbol">:</span> <span id="39460" class="Symbol">∀</span> <span id="39462" class="Symbol">{</span><a id="39463" href="#39463" class="Bound">τ</a> <a id="39465" href="#39465" class="Bound">machine</a><span id="39472" class="Symbol">}</span> <span id="39474" class="Symbol">{</span> <a id="39476" href="#39476" class="Bound">!τ</a> <span id="39479" class="Symbol">:</span> <a id="39481" href="#26505" class="Datatype">Value</a> <a id="39487" href="#39463" class="Bound">τ</a> <span id="39489" class="Symbol">→</span> <span id="39491" class="PrimitiveType">Set</span> <span id="39495" class="Symbol">}</span> <span id="39497" class="Symbol">→</span> <a id="39499" href="#37905" class="Datatype">TraceStep</a> <a id="39509" href="#39476" class="Bound">!τ</a> <span id="39512" class="Symbol">(</span><a id="39513" href="#34608" class="Function">reduce</a> <a id="39520" href="#39465" class="Bound">machine</a><span id="39527" class="Symbol">)</span> <span id="39529" class="Symbol">→</span> <a id="39531" href="#37905" class="Datatype">TraceStep</a> <a id="39541" href="#39476" class="Bound">!τ</a> <span id="39544" class="Symbol">(</span><a id="39545" href="#27915" class="InductiveConstructor">continue</a> <a id="39554" href="#39465" class="Bound">machine</a><span id="39561" class="Symbol">)</span>
  <a id="39565" href="#39455" class="Function Operator">∗_</a> <span id="39568" class="Symbol">=</span> <a id="39570" href="#38040" class="InductiveConstructor">!continue</a>

  <a id="14:Trace.∗ₘ_"></a><a id="39583" href="#39583" class="Function Operator">∗ₘ_</a> <span id="39587" class="Symbol">:</span> <span id="39589" class="Symbol">∀</span> <span id="39591" class="Symbol">{</span><a id="39592" href="#39592" class="Bound">τ</a> <a id="39594" href="#39594" class="Bound">machine</a><span id="39601" class="Symbol">}</span> <span id="39603" class="Symbol">{</span> <a id="39605" href="#39605" class="Bound">!τ</a> <span id="39608" class="Symbol">:</span> <a id="39610" href="#26505" class="Datatype">Value</a> <a id="39616" href="#39592" class="Bound">τ</a> <span id="39618" class="Symbol">→</span> <span id="39620" class="PrimitiveType">Set</span> <span id="39624" class="Symbol">}</span> <span id="39626" class="Symbol">→</span> <a id="39628" href="#37905" class="Datatype">TraceStep</a> <a id="39638" href="#39605" class="Bound">!τ</a> <span id="39641" class="Symbol">(</span><a id="39642" href="#34608" class="Function">reduce</a> <a id="39649" href="#39594" class="Bound">machine</a><span id="39656" class="Symbol">)</span> <span id="39658" class="Symbol">→</span> <a id="39660" href="#38303" class="Datatype">TraceMachine</a> <a id="39673" href="#39605" class="Bound">!τ</a> <a id="39676" href="#39594" class="Bound">machine</a>
  <a id="39686" href="#39583" class="Function Operator">∗ₘ_</a> <span id="39690" class="Symbol">=</span> <a id="39692" href="#38369" class="InductiveConstructor">!continueM</a>

  <span id="39706" class="Comment">-- Composes trace of a step and trace of a callstack</span>
  <a id="14:Trace.!composeStepStack"></a><a id="39761" href="#39761" class="Function">!composeStepStack</a>
      <span id="39785" class="Symbol">:</span> <span id="39787" class="Symbol">∀</span> <span id="39789" class="Symbol">{</span><a id="39790" href="#39790" class="Bound">σ</a> <a id="39792" href="#39792" class="Bound">τ</a> <a id="39794" href="#39794" class="Bound">step</a> <a id="39799" href="#39799" class="Bound">stack</a><span id="39804" class="Symbol">}</span> <span id="39806" class="Symbol">{</span> <a id="39808" href="#39808" class="Bound">!σ</a> <span id="39811" class="Symbol">:</span> <a id="39813" href="#26505" class="Datatype">Value</a> <a id="39819" href="#39790" class="Bound">σ</a> <span id="39821" class="Symbol">→</span> <span id="39823" class="PrimitiveType">Set</span> <span id="39827" class="Symbol">}</span> <span id="39829" class="Symbol">{</span> <a id="39831" href="#39831" class="Bound">!τ</a> <span id="39834" class="Symbol">:</span> <a id="39836" href="#26505" class="Datatype">Value</a> <a id="39842" href="#39792" class="Bound">τ</a> <span id="39844" class="Symbol">→</span> <span id="39846" class="PrimitiveType">Set</span> <span id="39850" class="Symbol">}</span>
      <span id="39858" class="Symbol">→</span> <a id="39860" href="#37905" class="Datatype">TraceStep</a> <a id="39870" href="#39808" class="Bound">!σ</a> <a id="39873" href="#39794" class="Bound">step</a>
      <span id="39884" class="Symbol">→</span> <span id="39886" class="Symbol">(∀</span> <span id="39889" class="Symbol">{</span><a id="39890" href="#39890" class="Bound">value</a><span id="39895" class="Symbol">}</span> <span id="39897" class="Symbol">→</span> <a id="39899" href="#39808" class="Bound">!σ</a> <a id="39902" href="#39890" class="Bound">value</a> <span id="39908" class="Symbol">→</span> <a id="39910" href="#37905" class="Datatype">TraceStep</a> <a id="39920" href="#39831" class="Bound">!τ</a> <span id="39923" class="Symbol">(</span><a id="39924" href="#28647" class="Function">composeValueStack</a> <a id="39942" href="#39890" class="Bound">value</a> <a id="39948" href="#39799" class="Bound">stack</a><span id="39953" class="Symbol">))</span>
      <span id="39962" class="Symbol">→</span> <a id="39964" href="#37905" class="Datatype">TraceStep</a> <a id="39974" href="#39831" class="Bound">!τ</a> <span id="39977" class="Symbol">(</span><a id="39978" href="#29090" class="Function">composeStepStack</a> <a id="39995" href="#39794" class="Bound">step</a> <a id="40000" href="#39799" class="Bound">stack</a><span id="40005" class="Symbol">)</span>
  <a id="40009" href="#39761" class="Function">!composeStepStack</a> <span id="40027" class="Symbol">{</span><a id="40028" href="#40028" class="Bound">σ</a><span id="40029" class="Symbol">}</span> <span id="40031" class="Symbol">{</span><a id="40032" href="#40032" class="Bound">τ</a><span id="40033" class="Symbol">}</span> <span id="40035" class="Symbol">{</span><a id="40036" href="#27883" class="InductiveConstructor">finish</a> <a id="40043" href="#40043" class="Bound">value</a><span id="40048" class="Symbol">}</span>     <span id="40054" class="Symbol">{</span><a id="40055" href="#40055" class="Bound">stack</a><span id="40060" class="Symbol">}</span> <span id="40062" class="Symbol">{</span> <a id="40064" href="#40064" class="Bound">!σ</a> <span id="40067" class="Symbol">}</span> <span id="40069" class="Symbol">{</span> <a id="40071" href="#40071" class="Bound">!τ</a> <span id="40074" class="Symbol">}</span> <span id="40076" class="Symbol">(</span><a id="40077" href="#37965" class="InductiveConstructor">!finish</a> <a id="40085" href="#40085" class="Bound">!value</a><span id="40091" class="Symbol">)</span>   <a id="40095" href="#40095" class="Bound">!stack</a> <span id="40102" class="Symbol">=</span> <a id="40104" href="#40095" class="Bound">!stack</a> <a id="40111" href="#40085" class="Bound">!value</a>
  <a id="40120" href="#39761" class="Function">!composeStepStack</a> <span id="40138" class="Symbol">{</span><a id="40139" href="#40139" class="Bound">σ</a><span id="40140" class="Symbol">}</span> <span id="40142" class="Symbol">{</span><a id="40143" href="#40143" class="Bound">τ</a><span id="40144" class="Symbol">}</span> <span id="40146" class="Symbol">{</span><a id="40147" href="#27915" class="InductiveConstructor">continue</a> <a id="40156" href="#40156" class="Bound">machine</a><span id="40163" class="Symbol">}</span> <span id="40165" class="Symbol">{</span><a id="40166" href="#40166" class="Bound">stack</a><span id="40171" class="Symbol">}</span> <span id="40173" class="Symbol">{</span> <a id="40175" href="#40175" class="Bound">!σ</a> <span id="40178" class="Symbol">}</span> <span id="40180" class="Symbol">{</span> <a id="40182" href="#40182" class="Bound">!τ</a> <span id="40185" class="Symbol">}</span> <span id="40187" class="Symbol">(</span><a id="40188" href="#38040" class="InductiveConstructor">!continue</a> <a id="40198" href="#40198" class="Bound">!step'</a><span id="40204" class="Symbol">)</span> <a id="40206" href="#40206" class="Bound">!stack</a> <span id="40213" class="Symbol">=</span>
      <a id="40221" href="#38040" class="InductiveConstructor">!continue</a> <span id="40231" class="Symbol">(</span><a id="40232" href="#6007" class="Function">transport</a> <span id="40242" class="Symbol">(</span><a id="40243" href="#37905" class="Datatype">TraceStep</a> <a id="40253" href="#40182" class="Bound">!τ</a><span id="40255" class="Symbol">)</span> <span id="40257" class="Symbol">(</span><a id="40258" href="#35709" class="Function">locality-lem</a> <a id="40271" href="#40156" class="Bound">machine</a> <a id="40279" href="#40166" class="Bound">stack</a><span id="40284" class="Symbol">)</span> <span id="40286" class="Symbol">(</span><a id="40287" href="#39761" class="Function">!composeStepStack</a> <a id="40305" href="#40198" class="Bound">!step'</a> <a id="40312" href="#40206" class="Bound">!stack</a><span id="40318" class="Symbol">))</span>

  <span id="40324" class="Comment">-- Composes trace of a thunk and trace of a callstack</span>
  <a id="14:Trace._▹!_"></a><a id="40380" href="#40380" class="Function Operator">_▹!_</a>
      <span id="40391" class="Symbol">:</span> <span id="40393" class="Symbol">∀</span> <span id="40395" class="Symbol">{</span><a id="40396" href="#40396" class="Bound">σ</a> <a id="40398" href="#40398" class="Bound">τ</a> <a id="40400" href="#40400" class="Bound">thunk</a> <a id="40406" href="#40406" class="Bound">stack</a><span id="40411" class="Symbol">}</span> <span id="40413" class="Symbol">{</span> <a id="40415" href="#40415" class="Bound">!σ</a> <span id="40418" class="Symbol">:</span> <a id="40420" href="#26505" class="Datatype">Value</a> <a id="40426" href="#40396" class="Bound">σ</a> <span id="40428" class="Symbol">→</span> <span id="40430" class="PrimitiveType">Set</span> <span id="40434" class="Symbol">}</span> <span id="40436" class="Symbol">{</span> <a id="40438" href="#40438" class="Bound">!τ</a> <span id="40441" class="Symbol">:</span> <a id="40443" href="#26505" class="Datatype">Value</a> <a id="40449" href="#40398" class="Bound">τ</a> <span id="40451" class="Symbol">→</span> <span id="40453" class="PrimitiveType">Set</span> <span id="40457" class="Symbol">}</span>
      <span id="40465" class="Symbol">→</span> <a id="40467" href="#38571" class="Function">TraceThunk</a> <a id="40478" href="#40415" class="Bound">!σ</a> <a id="40481" href="#40400" class="Bound">thunk</a>
      <span id="40493" class="Symbol">→</span> <span id="40495" class="Symbol">(∀</span> <span id="40498" class="Symbol">{</span><a id="40499" href="#40499" class="Bound">value</a><span id="40504" class="Symbol">}</span> <span id="40506" class="Symbol">→</span> <a id="40508" href="#40415" class="Bound">!σ</a> <a id="40511" href="#40499" class="Bound">value</a> <span id="40517" class="Symbol">→</span> <a id="40519" href="#37905" class="Datatype">TraceStep</a> <a id="40529" href="#40438" class="Bound">!τ</a> <span id="40532" class="Symbol">(</span><a id="40533" href="#28647" class="Function">composeValueStack</a> <a id="40551" href="#40499" class="Bound">value</a> <a id="40557" href="#40406" class="Bound">stack</a><span id="40562" class="Symbol">))</span>
      <span id="40571" class="Symbol">→</span> <a id="40573" href="#37905" class="Datatype">TraceStep</a> <a id="40583" href="#40438" class="Bound">!τ</a> <span id="40586" class="Symbol">(</span><a id="40587" href="#34608" class="Function">reduce</a> <span id="40594" class="Symbol">(</span><a id="40595" href="#40400" class="Bound">thunk</a> <a id="40601" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="40603" href="#40406" class="Bound">stack</a><span id="40608" class="Symbol">))</span>
  <a id="40613" href="#40380" class="Function Operator">_▹!_</a> <span id="40618" class="Symbol">{</span><a id="40619" href="#40619" class="Bound">σ</a><span id="40620" class="Symbol">}</span> <span id="40622" class="Symbol">{</span><a id="40623" href="#40623" class="Bound">τ</a><span id="40624" class="Symbol">}</span> <span id="40626" class="Symbol">{</span><a id="40627" href="#40627" class="Bound">thunk</a><span id="40632" class="Symbol">}</span> <span id="40634" class="Symbol">{</span><a id="40635" href="#40635" class="Bound">stack</a><span id="40640" class="Symbol">}</span> <span id="40642" class="Symbol">{</span> <a id="40644" href="#40644" class="Bound">!σ</a> <span id="40647" class="Symbol">}</span> <span id="40649" class="Symbol">{</span> <a id="40651" href="#40651" class="Bound">!τ</a> <span id="40654" class="Symbol">}</span> <span id="40656" class="Symbol">(</span><a id="40657" href="#38369" class="InductiveConstructor">!continueM</a> <a id="40668" href="#40668" class="Bound">!step</a><span id="40673" class="Symbol">)</span> <a id="40675" href="#40675" class="Bound">!stack</a> <span id="40682" class="Symbol">=</span>
      <a id="40690" href="#6007" class="Function">transport</a> <span id="40700" class="Symbol">(</span><a id="40701" href="#37905" class="Datatype">TraceStep</a> <a id="40711" href="#40651" class="Bound">!τ</a><span id="40713" class="Symbol">)</span> <span id="40715" class="Symbol">(</span><a id="40716" href="#35709" class="Function">locality-lem</a> <span id="40729" class="Symbol">(</span><a id="40730" href="#40627" class="Bound">thunk</a> <a id="40736" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="40738" href="#27366" class="InductiveConstructor">ε</a><span id="40739" class="Symbol">)</span> <a id="40741" href="#40635" class="Bound">stack</a><span id="40746" class="Symbol">)</span> <span id="40748" class="Symbol">(</span><a id="40749" href="#39761" class="Function">!composeStepStack</a> <a id="40767" href="#40668" class="Bound">!step</a> <a id="40773" href="#40675" class="Bound">!stack</a><span id="40779" class="Symbol">)</span>

  <span id="40784" class="Comment">-- Returns final value for TraceStep</span>
  <a id="14:Trace.resultStep"></a><a id="40823" href="#40823" class="Function">resultStep</a> <span id="40834" class="Symbol">:</span> <span id="40836" class="Symbol">∀</span> <span id="40838" class="Symbol">{</span><a id="40839" href="#40839" class="Bound">τ</a> <a id="40841" href="#40841" class="Bound">step</a><span id="40845" class="Symbol">}</span> <span id="40847" class="Symbol">→</span> <span id="40849" class="Symbol">{</span> <a id="40851" href="#40851" class="Bound">!τ</a> <span id="40854" class="Symbol">:</span> <a id="40856" href="#26505" class="Datatype">Value</a> <a id="40862" href="#40839" class="Bound">τ</a> <span id="40864" class="Symbol">→</span> <span id="40866" class="PrimitiveType">Set</span> <span id="40870" class="Symbol">}</span> <span id="40872" class="Symbol">→</span> <a id="40874" href="#37905" class="Datatype">TraceStep</a> <a id="40884" href="#40851" class="Bound">!τ</a> <a id="40887" href="#40841" class="Bound">step</a> <span id="40892" class="Symbol">→</span> <a id="40894" href="#26505" class="Datatype">Value</a> <a id="40900" href="#40839" class="Bound">τ</a>
  <a id="40904" href="#40823" class="Function">resultStep</a> <span id="40915" class="Symbol">{</span><span id="40916" class="Argument">step</span> <span id="40921" class="Symbol">=</span> <a id="40923" href="#27883" class="InductiveConstructor">finish</a> <a id="40930" href="#40930" class="Bound">value</a><span id="40935" class="Symbol">}</span>     <span id="40941" class="Symbol">(</span><a id="40942" href="#37965" class="InductiveConstructor">!finish</a> <span id="40950" class="Symbol">_)</span>        <span id="40960" class="Symbol">=</span> <a id="40962" href="#40930" class="Bound">value</a>
  <a id="40970" href="#40823" class="Function">resultStep</a> <span id="40981" class="Symbol">{</span><span id="40982" class="Argument">step</span> <span id="40987" class="Symbol">=</span> <a id="40989" href="#27915" class="InductiveConstructor">continue</a> <a id="40998" href="#40998" class="Bound">machine</a><span id="41005" class="Symbol">}</span> <span id="41007" class="Symbol">(</span><a id="41008" href="#38040" class="InductiveConstructor">!continue</a> <a id="41018" href="#41018" class="Bound">trace'</a><span id="41024" class="Symbol">)</span> <span id="41026" class="Symbol">=</span> <a id="41028" href="#40823" class="Function">resultStep</a> <a id="41039" href="#41018" class="Bound">trace'</a>

  <span id="41049" class="Comment">-- Returns final value for TraceMachine</span>
  <a id="14:Trace.result"></a><a id="41091" href="#41091" class="Function">result</a> <span id="41098" class="Symbol">:</span> <span id="41100" class="Symbol">∀</span> <span id="41102" class="Symbol">{</span><a id="41103" href="#41103" class="Bound">τ</a> <a id="41105" href="#41105" class="Bound">machine</a><span id="41112" class="Symbol">}</span> <span id="41114" class="Symbol">→</span> <span id="41116" class="Symbol">{</span> <a id="41118" href="#41118" class="Bound">!τ</a> <span id="41121" class="Symbol">:</span> <a id="41123" href="#26505" class="Datatype">Value</a> <a id="41129" href="#41103" class="Bound">τ</a> <span id="41131" class="Symbol">→</span> <span id="41133" class="PrimitiveType">Set</span> <span id="41137" class="Symbol">}</span> <span id="41139" class="Symbol">→</span> <a id="41141" href="#38303" class="Datatype">TraceMachine</a> <a id="41154" href="#41118" class="Bound">!τ</a> <a id="41157" href="#41105" class="Bound">machine</a> <span id="41165" class="Symbol">→</span> <a id="41167" href="#26505" class="Datatype">Value</a> <a id="41173" href="#41103" class="Bound">τ</a>
  <a id="41177" href="#41091" class="Function">result</a> <span id="41184" class="Symbol">(</span><a id="41185" href="#38369" class="InductiveConstructor">!continueM</a> <a id="41196" href="#41196" class="Bound">traceStep</a><span id="41205" class="Symbol">)</span> <span id="41207" class="Symbol">=</span> <a id="41209" href="#40823" class="Function">resultStep</a> <a id="41220" href="#41196" class="Bound">traceStep</a>

<span id="41231" class="Keyword">open</span> <a id="41236" href="#37509" class="Module">14:Trace</a>



<span id="41248" class="Keyword">module</span> <a id="15:DenotationValue"></a><a id="41255" href="#41255" class="Module">15:DenotationValue</a> <span id="41274" class="Keyword">where</span>
  <span id="41282" class="Comment">{-
     15. Definition of denotation for values
  -}</span>

  <span id="41338" class="Comment">-- We define denotations on type τ as predicates on values of type τ</span>
  <a id="15:DenotationValue.Val"></a><a id="41409" href="#41409" class="Function">Val</a> <span id="41413" class="Symbol">:</span> <a id="41415" href="#8610" class="Datatype">Type</a> <span id="41420" class="Symbol">→</span> <span id="41422" class="PrimitiveType">Set₁</span>
  <a id="41429" href="#41409" class="Function">Val</a> <a id="41433" href="#41433" class="Bound">τ</a> <span id="41435" class="Symbol">=</span> <a id="41437" href="#26505" class="Datatype">Value</a> <a id="41443" href="#41433" class="Bound">τ</a> <span id="41445" class="Symbol">→</span> <span id="41447" class="PrimitiveType">Set</span>

  <span id="41454" class="Comment">-- Denotations for a list of types</span>
  <a id="15:DenotationValue.Vals"></a><a id="41491" href="#41491" class="Function">Vals</a> <span id="41496" class="Symbol">:</span> <a id="41498" href="#2771" class="Datatype">List</a> <a id="41503" href="#8610" class="Datatype">Type</a> <span id="41508" class="Symbol">→</span> <span id="41510" class="PrimitiveType">Set₁</span>
  <a id="41517" href="#41491" class="Function">Vals</a> <a id="41522" href="#41522" class="Bound">τs</a> <span id="41525" class="Symbol">=</span> <a id="41527" href="#3038" class="Datatype">All₁</a> <a id="41532" href="#41409" class="Function">Val</a> <a id="41536" href="#41522" class="Bound">τs</a>

  <span id="41542" class="Comment">-- Denotation for a function is a function transforming denotation of a value to a denotation</span>
  <span id="41638" class="Comment">-- of the application result</span>
  <span id="41669" class="Keyword">data</span> <a id="15:DenotationValue.!Arrow"></a><a id="41674" href="#41674" class="Datatype">!Arrow</a> <span id="41681" class="Symbol">{</span><a id="41682" href="#41682" class="Bound">ρ</a> <a id="41684" href="#41684" class="Bound">τ</a><span id="41685" class="Symbol">}</span> <span id="41687" class="Symbol">(</span><a id="41688" href="#41688" class="Bound">!ρ</a> <span id="41691" class="Symbol">:</span> <a id="41693" href="#41409" class="Function">Val</a> <a id="41697" href="#41682" class="Bound">ρ</a><span id="41698" class="Symbol">)</span> <span id="41700" class="Symbol">(</span><a id="41701" href="#41701" class="Bound">!τ</a> <span id="41704" class="Symbol">:</span> <a id="41706" href="#41409" class="Function">Val</a> <a id="41710" href="#41684" class="Bound">τ</a><span id="41711" class="Symbol">)</span> <span id="41713" class="Symbol">:</span> <a id="41715" href="#41409" class="Function">Val</a> <span id="41719" class="Symbol">(</span><a id="41720" href="#41682" class="Bound">ρ</a> <a id="41722" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="41724" href="#41684" class="Bound">τ</a><span id="41725" class="Symbol">)</span> <span id="41727" class="Keyword">where</span>
    <a id="15:DenotationValue.!Arrow.!mkArrow"></a><a id="41737" href="#41737" class="InductiveConstructor">!mkArrow</a> <span id="41746" class="Symbol">:</span> <span id="41748" class="Symbol">∀</span> <span id="41750" class="Symbol">{</span><a id="41751" href="#41751" class="Bound">f</a><span id="41752" class="Symbol">}</span> <span id="41754" class="Symbol">→</span> <span id="41756" class="Symbol">(∀</span> <span id="41759" class="Symbol">{</span><a id="41760" href="#41760" class="Bound">v</a><span id="41761" class="Symbol">}</span> <span id="41763" class="Symbol">→</span> <a id="41765" href="#41688" class="Bound">!ρ</a> <a id="41768" href="#41760" class="Bound">v</a> <span id="41770" class="Symbol">→</span> <a id="41772" href="#38571" class="Function">TraceThunk</a> <a id="41783" href="#41701" class="Bound">!τ</a> <span id="41786" class="Symbol">(</span><a id="41787" href="#36294" class="Function">^apply</a> <a id="41794" href="#41751" class="Bound">f</a> <a id="41796" href="#41760" class="Bound">v</a><span id="41797" class="Symbol">))</span> <span id="41800" class="Symbol">→</span> <a id="41802" href="#41674" class="Datatype">!Arrow</a> <a id="41809" href="#41688" class="Bound">!ρ</a> <a id="41812" href="#41701" class="Bound">!τ</a> <a id="41815" href="#41751" class="Bound">f</a>

  <span id="41820" class="Comment">-- Denotation for a sum is a denotation for the value selected by the sum</span>
  <span id="41896" class="Keyword">data</span> <a id="15:DenotationValue.!Sum"></a><a id="41901" href="#41901" class="Datatype">!Sum</a> <span id="41906" class="Symbol">:</span> <span id="41908" class="Symbol">∀</span> <span id="41910" class="Symbol">{</span><a id="41911" href="#41911" class="Bound">τs</a><span id="41913" class="Symbol">}</span> <span id="41915" class="Symbol">→</span> <a id="41917" href="#41491" class="Function">Vals</a> <a id="41922" href="#41911" class="Bound">τs</a> <span id="41925" class="Symbol">→</span> <a id="41927" href="#41409" class="Function">Val</a> <span id="41931" class="Symbol">(</span><a id="41932" href="#8677" class="InductiveConstructor">#Sum</a> <a id="41937" href="#41911" class="Bound">τs</a><span id="41939" class="Symbol">)</span> <span id="41941" class="Keyword">where</span>
    <a id="15:DenotationValue.!Sum.!here"></a><a id="41951" href="#41951" class="InductiveConstructor">!here</a>  <span id="41958" class="Symbol">:</span> <span id="41960" class="Symbol">∀</span> <span id="41962" class="Symbol">{</span><a id="41963" href="#41963" class="Bound">τ</a> <a id="41965" href="#41965" class="Bound">τs</a> <a id="41968" href="#41968" class="Bound">v</a><span id="41969" class="Symbol">}</span>  <span id="41972" class="Symbol">{</span> <a id="41974" href="#41974" class="Bound">!τ</a> <span id="41977" class="Symbol">:</span> <a id="41979" href="#41409" class="Function">Val</a> <a id="41983" href="#41963" class="Bound">τ</a> <span id="41985" class="Symbol">}</span> <span id="41987" class="Symbol">{</span> <a id="41989" href="#41989" class="Bound">!τs</a> <span id="41993" class="Symbol">:</span> <a id="41995" href="#3038" class="Datatype">All₁</a> <a id="42000" href="#41409" class="Function">Val</a> <a id="42004" href="#41965" class="Bound">τs</a> <span id="42007" class="Symbol">}</span> <span id="42009" class="Symbol">→</span> <a id="42011" href="#41974" class="Bound">!τ</a> <a id="42014" href="#41968" class="Bound">v</a>        <span id="42023" class="Symbol">→</span> <a id="42025" href="#41901" class="Datatype">!Sum</a> <span id="42030" class="Symbol">(</span><a id="42031" href="#41974" class="Bound">!τ</a> <a id="42034" href="#3113" class="InductiveConstructor Operator">∷</a> <a id="42036" href="#41989" class="Bound">!τs</a><span id="42039" class="Symbol">)</span> <span id="42041" class="Symbol">(</span><a id="42042" href="#36396" class="Function">^here</a> <a id="42048" href="#41968" class="Bound">v</a><span id="42049" class="Symbol">)</span>
    <a id="15:DenotationValue.!Sum.!there"></a><a id="42055" href="#42055" class="InductiveConstructor">!there</a> <span id="42062" class="Symbol">:</span> <span id="42064" class="Symbol">∀</span> <span id="42066" class="Symbol">{</span><a id="42067" href="#42067" class="Bound">τ</a> <a id="42069" href="#42069" class="Bound">τs</a> <a id="42072" href="#42072" class="Bound">vᵢ</a><span id="42074" class="Symbol">}</span> <span id="42076" class="Symbol">{</span> <a id="42078" href="#42078" class="Bound">!τ</a> <span id="42081" class="Symbol">:</span> <a id="42083" href="#41409" class="Function">Val</a> <a id="42087" href="#42067" class="Bound">τ</a> <span id="42089" class="Symbol">}</span> <span id="42091" class="Symbol">{</span> <a id="42093" href="#42093" class="Bound">!τs</a> <span id="42097" class="Symbol">:</span> <a id="42099" href="#3038" class="Datatype">All₁</a> <a id="42104" href="#41409" class="Function">Val</a> <a id="42108" href="#42069" class="Bound">τs</a> <span id="42111" class="Symbol">}</span> <span id="42113" class="Symbol">→</span> <a id="42115" href="#41901" class="Datatype">!Sum</a> <a id="42120" href="#42093" class="Bound">!τs</a> <a id="42124" href="#42072" class="Bound">vᵢ</a> <span id="42127" class="Symbol">→</span> <a id="42129" href="#41901" class="Datatype">!Sum</a> <span id="42134" class="Symbol">(</span><a id="42135" href="#42078" class="Bound">!τ</a> <a id="42138" href="#3113" class="InductiveConstructor Operator">∷</a> <a id="42140" href="#42093" class="Bound">!τs</a><span id="42143" class="Symbol">)</span> <span id="42145" class="Symbol">(</span><a id="42146" href="#36491" class="Function">^there</a> <a id="42153" href="#42072" class="Bound">vᵢ</a><span id="42155" class="Symbol">)</span>

  <span id="42160" class="Comment">-- Denotation for a product is a product of denotations</span>
  <span id="42218" class="Keyword">infixr</span> <span id="42225" class="Number">5</span> <a id="42227" href="#42324" class="InductiveConstructor Operator">_∷!_</a>
  <span id="42234" class="Keyword">data</span> <a id="15:DenotationValue.!Product"></a><a id="42239" href="#42239" class="Datatype">!Product</a> <span id="42248" class="Symbol">:</span> <span id="42250" class="Symbol">∀</span> <span id="42252" class="Symbol">{</span><a id="42253" href="#42253" class="Bound">τs</a><span id="42255" class="Symbol">}</span> <span id="42257" class="Symbol">→</span> <a id="42259" href="#41491" class="Function">Vals</a> <a id="42264" href="#42253" class="Bound">τs</a> <span id="42267" class="Symbol">→</span> <a id="42269" href="#41409" class="Function">Val</a> <span id="42273" class="Symbol">(</span><a id="42274" href="#8737" class="InductiveConstructor">#Product</a> <a id="42283" href="#42253" class="Bound">τs</a><span id="42285" class="Symbol">)</span> <span id="42287" class="Keyword">where</span>
    <a id="15:DenotationValue.!Product.!ε"></a><a id="42297" href="#42297" class="InductiveConstructor">!ε</a>   <span id="42302" class="Symbol">:</span> <a id="42304" href="#42239" class="Datatype">!Product</a> <a id="42313" href="#3094" class="InductiveConstructor">ε</a> <a id="42315" href="#36621" class="Function">^nil</a>
    <a id="15:DenotationValue.!Product._∷!_"></a><a id="42324" href="#42324" class="InductiveConstructor Operator">_∷!_</a> <span id="42329" class="Symbol">:</span> <span id="42331" class="Symbol">∀</span> <span id="42333" class="Symbol">{</span><a id="42334" href="#42334" class="Bound">τ</a> <a id="42336" href="#42336" class="Bound">τs</a> <a id="42339" href="#42339" class="Bound">v</a> <a id="42341" href="#42341" class="Bound">vs</a><span id="42343" class="Symbol">}</span> <span id="42345" class="Symbol">{</span> <a id="42347" href="#42347" class="Bound">!τ</a> <span id="42350" class="Symbol">:</span> <a id="42352" href="#41409" class="Function">Val</a> <a id="42356" href="#42334" class="Bound">τ</a> <span id="42358" class="Symbol">}</span> <span id="42360" class="Symbol">{</span> <a id="42362" href="#42362" class="Bound">!τs</a> <span id="42366" class="Symbol">:</span> <a id="42368" href="#3038" class="Datatype">All₁</a> <a id="42373" href="#41409" class="Function">Val</a> <a id="42377" href="#42336" class="Bound">τs</a> <span id="42380" class="Symbol">}</span>
         <span id="42391" class="Symbol">→</span> <a id="42393" href="#42347" class="Bound">!τ</a> <a id="42396" href="#42339" class="Bound">v</a> <span id="42398" class="Symbol">→</span> <a id="42400" href="#42239" class="Datatype">!Product</a> <a id="42409" href="#42362" class="Bound">!τs</a> <a id="42413" href="#42341" class="Bound">vs</a> <span id="42416" class="Symbol">→</span> <a id="42418" href="#42239" class="Datatype">!Product</a> <span id="42427" class="Symbol">(</span><a id="42428" href="#42347" class="Bound">!τ</a> <a id="42431" href="#3113" class="InductiveConstructor Operator">∷</a> <a id="42433" href="#42362" class="Bound">!τs</a><span id="42436" class="Symbol">)</span> <span id="42438" class="Symbol">(</span><a id="42439" href="#36685" class="Function">^cons</a> <a id="42445" href="#42339" class="Bound">v</a> <a id="42447" href="#42341" class="Bound">vs</a><span id="42449" class="Symbol">)</span>

  <span id="42454" class="Comment">-- Denotation for a pair is a pair of denotations</span>
  <span id="42506" class="Keyword">data</span> <a id="15:DenotationValue.!Pair"></a><a id="42511" href="#42511" class="Datatype">!Pair</a> <span id="42517" class="Symbol">{</span><a id="42518" href="#42518" class="Bound">σ</a> <a id="42520" href="#42520" class="Bound">τ</a><span id="42521" class="Symbol">}</span> <span id="42523" class="Symbol">(</span><a id="42524" href="#42524" class="Bound">!σ</a> <span id="42527" class="Symbol">:</span> <a id="42529" href="#41409" class="Function">Val</a> <a id="42533" href="#42518" class="Bound">σ</a><span id="42534" class="Symbol">)</span> <span id="42536" class="Symbol">(</span><a id="42537" href="#42537" class="Bound">!τ</a> <span id="42540" class="Symbol">:</span> <a id="42542" href="#41409" class="Function">Val</a> <a id="42546" href="#42520" class="Bound">τ</a><span id="42547" class="Symbol">)</span> <span id="42549" class="Symbol">:</span> <a id="42551" href="#41409" class="Function">Val</a> <span id="42555" class="Symbol">(</span><a id="42556" href="#9217" class="Function">#Pair</a> <a id="42562" href="#42518" class="Bound">σ</a> <a id="42564" href="#42520" class="Bound">τ</a><span id="42565" class="Symbol">)</span> <span id="42567" class="Keyword">where</span>
    <a id="15:DenotationValue.!Pair._,_"></a><a id="42577" href="#42577" class="InductiveConstructor Operator">_,_</a> <span id="42581" class="Symbol">:</span> <span id="42583" class="Symbol">∀</span> <span id="42585" class="Symbol">{</span><a id="42586" href="#42586" class="Bound">v₁</a> <a id="42589" href="#42589" class="Bound">v₂</a><span id="42591" class="Symbol">}</span> <span id="42593" class="Symbol">→</span> <a id="42595" href="#42524" class="Bound">!σ</a> <a id="42598" href="#42586" class="Bound">v₁</a> <span id="42601" class="Symbol">→</span> <a id="42603" href="#42537" class="Bound">!τ</a> <a id="42606" href="#42589" class="Bound">v₂</a> <span id="42609" class="Symbol">→</span> <a id="42611" href="#42511" class="Datatype">!Pair</a> <a id="42617" href="#42524" class="Bound">!σ</a> <a id="42620" href="#42537" class="Bound">!τ</a> <span id="42623" class="Symbol">(</span><a id="42624" href="#36839" class="Function">^pair</a> <a id="42630" href="#42586" class="Bound">v₁</a> <a id="42633" href="#42589" class="Bound">v₂</a><span id="42635" class="Symbol">)</span>

  <span id="42640" class="Comment">-- Denotation for Maybe is a meta-language Maybe</span>
  <span id="42691" class="Keyword">data</span> <a id="15:DenotationValue.!Maybe"></a><a id="42696" href="#42696" class="Datatype">!Maybe</a> <span id="42703" class="Symbol">{</span><a id="42704" href="#42704" class="Bound">τ</a><span id="42705" class="Symbol">}</span> <span id="42707" class="Symbol">(</span><a id="42708" href="#42708" class="Bound">!τ</a> <span id="42711" class="Symbol">:</span> <a id="42713" href="#41409" class="Function">Val</a> <a id="42717" href="#42704" class="Bound">τ</a><span id="42718" class="Symbol">)</span> <span id="42720" class="Symbol">:</span> <a id="42722" href="#41409" class="Function">Val</a> <span id="42726" class="Symbol">(</span><a id="42727" href="#9349" class="Function">#Maybe</a> <a id="42734" href="#42704" class="Bound">τ</a><span id="42735" class="Symbol">)</span> <span id="42737" class="Keyword">where</span>
    <a id="15:DenotationValue.!Maybe.!nothing"></a><a id="42747" href="#42747" class="InductiveConstructor">!nothing</a> <span id="42756" class="Symbol">:</span> <a id="42758" href="#42696" class="Datatype">!Maybe</a> <a id="42765" href="#42708" class="Bound">!τ</a> <a id="42768" href="#36952" class="Function">^nothing</a>
    <a id="15:DenotationValue.!Maybe.!just"></a><a id="42781" href="#42781" class="InductiveConstructor">!just</a>    <span id="42790" class="Symbol">:</span> <span id="42792" class="Symbol">∀</span> <span id="42794" class="Symbol">{</span><a id="42795" href="#42795" class="Bound">v</a><span id="42796" class="Symbol">}</span> <span id="42798" class="Symbol">→</span> <a id="42800" href="#42708" class="Bound">!τ</a> <a id="42803" href="#42795" class="Bound">v</a> <span id="42805" class="Symbol">→</span> <a id="42807" href="#42696" class="Datatype">!Maybe</a> <a id="42814" href="#42708" class="Bound">!τ</a> <span id="42817" class="Symbol">(</span><a id="42818" href="#37036" class="Function">^just</a> <a id="42824" href="#42795" class="Bound">v</a><span id="42825" class="Symbol">)</span>

  <span id="42830" class="Comment">-- Denotation for a natural number is a denotation for the value wrapped by the constructor</span>
  <span id="42924" class="Keyword">data</span> <a id="15:DenotationValue.!Nat"></a><a id="42929" href="#42929" class="Datatype">!Nat</a> <span id="42934" class="Symbol">:</span> <a id="42936" href="#41409" class="Function">Val</a> <a id="42940" href="#8801" class="InductiveConstructor">#Nat</a> <span id="42945" class="Keyword">where</span>
    <a id="15:DenotationValue.!Nat.!mkNat"></a><a id="42955" href="#42955" class="InductiveConstructor">!mkNat</a> <span id="42962" class="Symbol">:</span> <span id="42964" class="Symbol">∀</span> <span id="42966" class="Symbol">{</span><a id="42967" href="#42967" class="Bound">n</a><span id="42968" class="Symbol">}</span> <span id="42970" class="Symbol">→</span> <a id="42972" href="#42696" class="Datatype">!Maybe</a> <a id="42979" href="#42929" class="Datatype">!Nat</a> <a id="42984" href="#42967" class="Bound">n</a> <span id="42986" class="Symbol">→</span> <a id="42988" href="#42929" class="Datatype">!Nat</a> <span id="42993" class="Symbol">(</span><a id="42994" href="#37131" class="Function">^mkNat</a> <a id="43001" href="#42967" class="Bound">n</a><span id="43002" class="Symbol">)</span>

  <span id="43007" class="Comment">-- Helper type for defining denotation for Conat</span>
  <span id="43058" class="Keyword">record</span> <a id="15:DenotationValue.!ConatU"></a><a id="43065" href="#43065" class="Record">!ConatU</a> <span id="43073" class="Symbol">{</span><a id="43074" href="#43074" class="Bound">ρ</a><span id="43075" class="Symbol">}</span> <span id="43077" class="Symbol">(</span><a id="43078" href="#43078" class="Bound">f</a> <span id="43080" class="Symbol">:</span> <a id="43082" href="#26505" class="Datatype">Value</a> <span id="43088" class="Symbol">(</span><a id="43089" href="#43074" class="Bound">ρ</a> <a id="43091" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="43093" href="#9349" class="Function">#Maybe</a> <a id="43100" href="#43074" class="Bound">ρ</a><span id="43101" class="Symbol">))</span> <span id="43104" class="Symbol">(</span><a id="43105" href="#43105" class="Bound">v</a> <span id="43107" class="Symbol">:</span> <a id="43109" href="#26505" class="Datatype">Value</a> <a id="43115" href="#43074" class="Bound">ρ</a><span id="43116" class="Symbol">)</span> <span id="43118" class="Symbol">:</span> <span id="43120" class="PrimitiveType">Set</span> <span id="43124" class="Keyword">where</span>
    <span id="43134" class="Keyword">coinductive</span>
    <span id="43150" class="Keyword">field</span> <a id="15:DenotationValue.!ConatU.!forceConat"></a><a id="43156" href="#43156" class="Field">!forceConat</a> <span id="43168" class="Symbol">:</span> <a id="43170" href="#38571" class="Function">TraceThunk</a> <span id="43181" class="Symbol">(</span><a id="43182" href="#42696" class="Datatype">!Maybe</a> <span id="43189" class="Symbol">(</span><a id="43190" href="#43065" class="Record">!ConatU</a> <a id="43198" href="#43078" class="Bound">f</a><span id="43199" class="Symbol">))</span> <span id="43202" class="Symbol">(</span><a id="43203" href="#36294" class="Function">^apply</a> <a id="43210" href="#43078" class="Bound">f</a> <a id="43212" href="#43105" class="Bound">v</a><span id="43213" class="Symbol">)</span>
  <span id="43217" class="Keyword">open</span> <a id="43222" href="#43065" class="Module">!ConatU</a> <span id="43230" class="Keyword">public</span>

  <span id="43240" class="Comment">-- Denotation for a conatural number described by a triple (ρ ,, v , f) is a stream of</span>
  <span id="43329" class="Comment">-- denotations for all successive applications of 'f' to 'v'</span>
  <span id="43392" class="Keyword">data</span> <a id="15:DenotationValue.!Conat"></a><a id="43397" href="#43397" class="Datatype">!Conat</a> <span id="43404" class="Symbol">:</span> <a id="43406" href="#41409" class="Function">Val</a> <a id="43410" href="#8853" class="InductiveConstructor">#Conat</a> <span id="43417" class="Keyword">where</span>
    <a id="15:DenotationValue.!Conat.!mkConat"></a><a id="43427" href="#43427" class="InductiveConstructor">!mkConat</a> <span id="43436" class="Symbol">:</span> <span id="43438" class="Symbol">∀</span> <span id="43440" class="Symbol">{</span><a id="43441" href="#43441" class="Bound">ρ</a> <a id="43443" href="#43443" class="Bound">v</a> <a id="43445" href="#43445" class="Bound">f</a><span id="43446" class="Symbol">}</span> <span id="43448" class="Symbol">→</span> <a id="43450" href="#43065" class="Record">!ConatU</a> <a id="43458" href="#43445" class="Bound">f</a> <a id="43460" href="#43443" class="Bound">v</a> <span id="43462" class="Symbol">→</span> <a id="43464" href="#43397" class="Datatype">!Conat</a> <span id="43471" class="Symbol">(</span><a id="43472" href="#37211" class="Function">^mkConat</a> <a id="43481" href="#43441" class="Bound">ρ</a> <a id="43483" href="#43443" class="Bound">v</a> <a id="43485" href="#43445" class="Bound">f</a><span id="43486" class="Symbol">)</span>

  <span id="43491" class="Comment">-- Helper type for defining denotation for Stream</span>
  <span id="43543" class="Keyword">record</span> <a id="15:DenotationValue.!StreamU"></a><a id="43550" href="#43550" class="Record">!StreamU</a> <span id="43559" class="Symbol">{</span><a id="43560" href="#43560" class="Bound">τ</a> <a id="43562" href="#43562" class="Bound">ρ</a><span id="43563" class="Symbol">}</span> <span id="43565" class="Symbol">(</span><a id="43566" href="#43566" class="Bound">!τ</a> <span id="43569" class="Symbol">:</span> <a id="43571" href="#41409" class="Function">Val</a> <a id="43575" href="#43560" class="Bound">τ</a><span id="43576" class="Symbol">)</span> <span id="43578" class="Symbol">(</span><a id="43579" href="#43579" class="Bound">f</a> <span id="43581" class="Symbol">:</span> <a id="43583" href="#26505" class="Datatype">Value</a> <span id="43589" class="Symbol">(</span><a id="43590" href="#43562" class="Bound">ρ</a> <a id="43592" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="43594" href="#9217" class="Function">#Pair</a> <a id="43600" href="#43560" class="Bound">τ</a> <a id="43602" href="#43562" class="Bound">ρ</a><span id="43603" class="Symbol">))</span> <span id="43606" class="Symbol">(</span><a id="43607" href="#43607" class="Bound">v</a> <span id="43609" class="Symbol">:</span> <a id="43611" href="#26505" class="Datatype">Value</a> <a id="43617" href="#43562" class="Bound">ρ</a><span id="43618" class="Symbol">)</span> <span id="43620" class="Symbol">:</span> <span id="43622" class="PrimitiveType">Set</span> <span id="43626" class="Keyword">where</span>
    <span id="43636" class="Keyword">coinductive</span>
    <span id="43652" class="Keyword">field</span> <a id="15:DenotationValue.!StreamU.!forceStream"></a><a id="43658" href="#43658" class="Field">!forceStream</a> <span id="43671" class="Symbol">:</span> <a id="43673" href="#38571" class="Function">TraceThunk</a> <span id="43684" class="Symbol">(</span><a id="43685" href="#42511" class="Datatype">!Pair</a> <a id="43691" href="#43566" class="Bound">!τ</a> <span id="43694" class="Symbol">(</span><a id="43695" href="#43550" class="Record">!StreamU</a> <a id="43704" href="#43566" class="Bound">!τ</a> <a id="43707" href="#43579" class="Bound">f</a><span id="43708" class="Symbol">))</span> <span id="43711" class="Symbol">(</span><a id="43712" href="#36294" class="Function">^apply</a> <a id="43719" href="#43579" class="Bound">f</a> <a id="43721" href="#43607" class="Bound">v</a><span id="43722" class="Symbol">)</span>
  <span id="43726" class="Keyword">open</span> <a id="43731" href="#43550" class="Module">!StreamU</a> <span id="43740" class="Keyword">public</span>

  <span id="43750" class="Comment">-- Denotation for a stream described by a triple (ρ ,, v , f) is a stream of</span>
  <span id="43829" class="Comment">-- denotations for all successive applications of 'f' to 'v'</span>
  <span id="43892" class="Keyword">data</span> <a id="15:DenotationValue.!Stream"></a><a id="43897" href="#43897" class="Datatype">!Stream</a> <span id="43905" class="Symbol">{</span><a id="43906" href="#43906" class="Bound">τ</a><span id="43907" class="Symbol">}</span> <span id="43909" class="Symbol">(</span><a id="43910" href="#43910" class="Bound">!τ</a> <span id="43913" class="Symbol">:</span> <a id="43915" href="#41409" class="Function">Val</a> <a id="43919" href="#43906" class="Bound">τ</a><span id="43920" class="Symbol">)</span> <span id="43922" class="Symbol">:</span> <a id="43924" href="#41409" class="Function">Val</a> <span id="43928" class="Symbol">(</span><a id="43929" href="#8937" class="InductiveConstructor">#Stream</a> <a id="43937" href="#43906" class="Bound">τ</a><span id="43938" class="Symbol">)</span> <span id="43940" class="Keyword">where</span>
    <a id="15:DenotationValue.!Stream.!mkStream"></a><a id="43950" href="#43950" class="InductiveConstructor">!mkStream</a> <span id="43960" class="Symbol">:</span> <span id="43962" class="Symbol">∀</span> <span id="43964" class="Symbol">{</span><a id="43965" href="#43965" class="Bound">ρ</a> <a id="43967" href="#43967" class="Bound">v</a> <a id="43969" href="#43969" class="Bound">f</a><span id="43970" class="Symbol">}</span> <span id="43972" class="Symbol">→</span> <a id="43974" href="#43550" class="Record">!StreamU</a> <a id="43983" href="#43910" class="Bound">!τ</a> <a id="43986" href="#43969" class="Bound">f</a> <a id="43988" href="#43967" class="Bound">v</a> <span id="43990" class="Symbol">→</span> <a id="43992" href="#43897" class="Datatype">!Stream</a> <a id="44000" href="#43910" class="Bound">!τ</a> <span id="44003" class="Symbol">(</span><a id="44004" href="#37338" class="Function">^mkStream</a> <a id="44014" href="#43965" class="Bound">ρ</a> <a id="44016" href="#43967" class="Bound">v</a> <a id="44018" href="#43969" class="Bound">f</a><span id="44019" class="Symbol">)</span>

  <span id="44024" class="Keyword">mutual</span>
    <span id="44035" class="Comment">-- Denotation for a value</span>
    <a id="15:DenotationValue.!Value"></a><a id="44065" href="#44065" class="Function">!Value</a> <span id="44072" class="Symbol">:</span> <span id="44074" class="Symbol">(</span><a id="44075" href="#44075" class="Bound">τ</a> <span id="44077" class="Symbol">:</span> <a id="44079" href="#8610" class="Datatype">Type</a><span id="44083" class="Symbol">)</span> <span id="44085" class="Symbol">→</span> <a id="44087" href="#41409" class="Function">Val</a> <a id="44091" href="#44075" class="Bound">τ</a>
    <a id="44097" href="#44065" class="Function">!Value</a> <span id="44104" class="Symbol">(</span><a id="44105" href="#44105" class="Bound">ρ</a> <a id="44107" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="44109" href="#44109" class="Bound">τ</a><span id="44110" class="Symbol">)</span>       <span id="44118" class="Symbol">=</span> <a id="44120" href="#41674" class="Datatype">!Arrow</a> <span id="44127" class="Symbol">(</span><a id="44128" href="#44065" class="Function">!Value</a> <a id="44135" href="#44105" class="Bound">ρ</a><span id="44136" class="Symbol">)</span> <span id="44138" class="Symbol">(</span><a id="44139" href="#44065" class="Function">!Value</a> <a id="44146" href="#44109" class="Bound">τ</a><span id="44147" class="Symbol">)</span>
    <a id="44153" href="#44065" class="Function">!Value</a> <span id="44160" class="Symbol">(</span><a id="44161" href="#8677" class="InductiveConstructor">#Sum</a> <a id="44166" href="#44166" class="Bound">τs</a><span id="44168" class="Symbol">)</span>     <span id="44174" class="Symbol">=</span> <a id="44176" href="#41901" class="Datatype">!Sum</a> <span id="44181" class="Symbol">(</span><a id="44182" href="#44409" class="Function">!Values</a> <a id="44190" href="#44166" class="Bound">τs</a><span id="44192" class="Symbol">)</span>
    <a id="44198" href="#44065" class="Function">!Value</a> <span id="44205" class="Symbol">(</span><a id="44206" href="#8737" class="InductiveConstructor">#Product</a> <a id="44215" href="#44215" class="Bound">τs</a><span id="44217" class="Symbol">)</span> <span id="44219" class="Symbol">=</span> <a id="44221" href="#42239" class="Datatype">!Product</a> <span id="44230" class="Symbol">(</span><a id="44231" href="#44409" class="Function">!Values</a> <a id="44239" href="#44215" class="Bound">τs</a><span id="44241" class="Symbol">)</span>
    <a id="44247" href="#44065" class="Function">!Value</a> <span id="44254" class="Symbol">(</span><a id="44255" href="#8801" class="InductiveConstructor">#Nat</a><span id="44259" class="Symbol">)</span>        <span id="44268" class="Symbol">=</span> <a id="44270" href="#42929" class="Datatype">!Nat</a>
    <a id="44279" href="#44065" class="Function">!Value</a> <span id="44286" class="Symbol">(</span><a id="44287" href="#8853" class="InductiveConstructor">#Conat</a><span id="44293" class="Symbol">)</span>      <span id="44300" class="Symbol">=</span> <a id="44302" href="#43397" class="Datatype">!Conat</a>
    <a id="44313" href="#44065" class="Function">!Value</a> <span id="44320" class="Symbol">(</span><a id="44321" href="#8937" class="InductiveConstructor">#Stream</a> <a id="44329" href="#44329" class="Bound">τ</a><span id="44330" class="Symbol">)</span>   <span id="44334" class="Symbol">=</span> <a id="44336" href="#43897" class="Datatype">!Stream</a> <span id="44344" class="Symbol">(</span><a id="44345" href="#44065" class="Function">!Value</a> <a id="44352" href="#44329" class="Bound">τ</a><span id="44353" class="Symbol">)</span>

    <span id="44360" class="Comment">-- A list of denotations for a list of types</span>
    <a id="15:DenotationValue.!Values"></a><a id="44409" href="#44409" class="Function">!Values</a> <span id="44417" class="Symbol">:</span> <span id="44419" class="Symbol">(</span><a id="44420" href="#44420" class="Bound">τs</a> <span id="44423" class="Symbol">:</span> <a id="44425" href="#2771" class="Datatype">List</a> <a id="44430" href="#8610" class="Datatype">Type</a><span id="44434" class="Symbol">)</span> <span id="44436" class="Symbol">→</span> <a id="44438" href="#41491" class="Function">Vals</a> <a id="44443" href="#44420" class="Bound">τs</a>
    <a id="44450" href="#44409" class="Function">!Values</a>  <a id="44459" href="#2802" class="InductiveConstructor">ε</a>       <span id="44467" class="Symbol">=</span> <a id="44469" href="#3094" class="InductiveConstructor">ε</a>
    <a id="44475" href="#44409" class="Function">!Values</a> <span id="44483" class="Symbol">(</span><a id="44484" href="#44484" class="Bound">τ</a> <a id="44486" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="44488" href="#44488" class="Bound">τs</a><span id="44490" class="Symbol">)</span> <span id="44492" class="Symbol">=</span> <a id="44494" href="#44065" class="Function">!Value</a> <a id="44501" href="#44484" class="Bound">τ</a> <a id="44503" href="#3113" class="InductiveConstructor Operator">∷</a> <a id="44505" href="#44409" class="Function">!Values</a> <a id="44513" href="#44488" class="Bound">τs</a>

<span id="44517" class="Keyword">open</span> <a id="44522" href="#41255" class="Module">15:DenotationValue</a>



<span id="44544" class="Keyword">module</span> <a id="16:DenotationRest"></a><a id="44551" href="#44551" class="Module">16:DenotationRest</a> <span id="44569" class="Keyword">where</span>
  <span id="44577" class="Comment">{-
     16. Definition of denotation for other objects
  -}</span>

  <span id="44640" class="Comment">-- Denotation for a step is a trace for the step with a denotation for the final value</span>
  <a id="16:DenotationRest.!Step"></a><a id="44729" href="#44729" class="Function">!Step</a> <span id="44735" class="Symbol">:</span> <span id="44737" class="Symbol">∀</span> <a id="44739" href="#44739" class="Bound">τ</a> <span id="44741" class="Symbol">→</span> <a id="44743" href="#27851" class="Datatype">Step</a> <a id="44748" href="#44739" class="Bound">τ</a> <span id="44750" class="Symbol">→</span> <span id="44752" class="PrimitiveType">Set</span>
  <a id="44758" href="#44729" class="Function">!Step</a> <a id="44764" href="#44764" class="Bound">τ</a> <span id="44766" class="Symbol">=</span> <a id="44768" href="#37905" class="Datatype">TraceStep</a> <span id="44778" class="Symbol">(</span><a id="44779" href="#44065" class="Function">!Value</a> <a id="44786" href="#44764" class="Bound">τ</a><span id="44787" class="Symbol">)</span>

  <span id="44792" class="Comment">-- Denotation for a machine is a trace for the machine with a denotation for the final value</span>
  <a id="16:DenotationRest.!Machine"></a><a id="44887" href="#44887" class="Function">!Machine</a> <span id="44896" class="Symbol">:</span> <span id="44898" class="Symbol">∀</span> <a id="44900" href="#44900" class="Bound">τ</a> <span id="44902" class="Symbol">→</span> <a id="44904" href="#27628" class="Datatype">Machine</a> <a id="44912" href="#44900" class="Bound">τ</a> <span id="44914" class="Symbol">→</span> <span id="44916" class="PrimitiveType">Set</span>
  <a id="44922" href="#44887" class="Function">!Machine</a> <a id="44931" href="#44931" class="Bound">τ</a> <span id="44933" class="Symbol">=</span> <a id="44935" href="#38303" class="Datatype">TraceMachine</a> <span id="44948" class="Symbol">(</span><a id="44949" href="#44065" class="Function">!Value</a> <a id="44956" href="#44931" class="Bound">τ</a><span id="44957" class="Symbol">)</span>

  <span id="44962" class="Comment">-- We also call denotations for machines simply traces</span>
  <a id="16:DenotationRest.Trace"></a><a id="45019" href="#45019" class="Function">Trace</a> <span id="45025" class="Symbol">:</span> <span id="45027" class="Symbol">∀</span> <span id="45029" class="Symbol">{</span><a id="45030" href="#45030" class="Bound">τ</a><span id="45031" class="Symbol">}</span> <span id="45033" class="Symbol">→</span> <a id="45035" href="#27628" class="Datatype">Machine</a> <a id="45043" href="#45030" class="Bound">τ</a> <span id="45045" class="Symbol">→</span> <span id="45047" class="PrimitiveType">Set</span>
  <a id="45053" href="#45019" class="Function">Trace</a> <span id="45059" class="Symbol">{</span><a id="45060" href="#45060" class="Bound">τ</a><span id="45061" class="Symbol">}</span> <a id="45063" href="#45063" class="Bound">machine</a> <span id="45071" class="Symbol">=</span> <a id="45073" href="#44887" class="Function">!Machine</a> <a id="45082" href="#45060" class="Bound">τ</a> <a id="45084" href="#45063" class="Bound">machine</a>

  <span id="45095" class="Comment">-- Denotation for a thunk is a trace for the thunk with a denotation for the final value</span>
  <a id="16:DenotationRest.!Thunk"></a><a id="45186" href="#45186" class="Function">!Thunk</a> <span id="45193" class="Symbol">:</span> <span id="45195" class="Symbol">∀</span> <a id="45197" href="#45197" class="Bound">τ</a> <span id="45199" class="Symbol">→</span> <a id="45201" href="#27204" class="Datatype">Thunk</a> <a id="45207" href="#45197" class="Bound">τ</a> <span id="45209" class="Symbol">→</span> <span id="45211" class="PrimitiveType">Set</span>
  <a id="45217" href="#45186" class="Function">!Thunk</a> <a id="45224" href="#45224" class="Bound">τ</a> <span id="45226" class="Symbol">=</span> <a id="45228" href="#38571" class="Function">TraceThunk</a> <span id="45239" class="Symbol">(</span><a id="45240" href="#44065" class="Function">!Value</a> <a id="45247" href="#45224" class="Bound">τ</a><span id="45248" class="Symbol">)</span>

  <span id="45253" class="Comment">-- Denotation for an environment consists of denotations for each value in the environment</span>
  <a id="16:DenotationRest.!Env"></a><a id="45346" href="#45346" class="Function">!Env</a> <span id="45351" class="Symbol">:</span> <span id="45353" class="Symbol">∀</span> <a id="45355" href="#45355" class="Bound">Γ</a> <span id="45357" class="Symbol">→</span> <a id="45359" href="#26880" class="Function">Env</a> <a id="45363" href="#45355" class="Bound">Γ</a> <span id="45365" class="Symbol">→</span> <span id="45367" class="PrimitiveType">Set</span>
  <a id="45373" href="#45346" class="Function">!Env</a> <a id="45378" href="#45378" class="Bound">Γ</a> <a id="45380" href="#45380" class="Bound">env</a> <span id="45384" class="Symbol">=</span> <a id="45386" href="#3956" class="Datatype">All2</a> <a id="45391" href="#44065" class="Function">!Value</a> <a id="45398" href="#45378" class="Bound">Γ</a> <a id="45400" href="#45380" class="Bound">env</a>

  <span id="45407" class="Comment">-- Denotation for a closure is a function transforming denotation of a value to a denotation</span>
  <span id="45502" class="Comment">-- of the result of applying the closure to the value</span>
  <a id="16:DenotationRest.!Closure"></a><a id="45558" href="#45558" class="Function">!Closure</a> <span id="45567" class="Symbol">:</span> <span id="45569" class="Symbol">∀</span> <a id="45571" href="#45571" class="Bound">σ</a> <a id="45573" href="#45573" class="Bound">τ</a> <span id="45575" class="Symbol">→</span> <span id="45577" class="Symbol">(</span><a id="45578" href="#45578" class="Bound">closure</a> <span id="45586" class="Symbol">:</span> <a id="45588" href="#26732" class="Datatype">Closure</a> <a id="45596" href="#45571" class="Bound">σ</a> <a id="45598" href="#45573" class="Bound">τ</a><span id="45599" class="Symbol">)</span> <span id="45601" class="Symbol">→</span> <span id="45603" class="PrimitiveType">Set</span>
  <a id="45609" href="#45558" class="Function">!Closure</a> <a id="45618" href="#45618" class="Bound">σ</a> <a id="45620" href="#45620" class="Bound">τ</a> <a id="45622" href="#45622" class="Bound">closure</a> <span id="45630" class="Symbol">=</span> <span id="45632" class="Symbol">∀</span> <span id="45634" class="Symbol">{</span><a id="45635" href="#45635" class="Bound">value</a><span id="45640" class="Symbol">}</span> <span id="45642" class="Symbol">→</span> <a id="45644" href="#44065" class="Function">!Value</a> <a id="45651" href="#45618" class="Bound">σ</a> <a id="45653" href="#45635" class="Bound">value</a> <span id="45659" class="Symbol">→</span> <a id="45661" href="#45186" class="Function">!Thunk</a> <a id="45668" href="#45620" class="Bound">τ</a> <span id="45670" class="Symbol">(</span><a id="45671" href="#28001" class="Function">composeValueClosure</a> <a id="45691" href="#45635" class="Bound">value</a> <a id="45697" href="#45622" class="Bound">closure</a><span id="45704" class="Symbol">)</span>

  <span id="45709" class="Comment">-- Denotation for a callstack is a function transforming denotation of a value to a</span>
  <span id="45795" class="Comment">-- denotation of the result of applying the callstack to the value</span>
  <a id="16:DenotationRest.!CallStack"></a><a id="45864" href="#45864" class="Function">!CallStack</a> <span id="45875" class="Symbol">:</span> <span id="45877" class="Symbol">∀</span> <a id="45879" href="#45879" class="Bound">σ</a> <a id="45881" href="#45881" class="Bound">τ</a> <span id="45883" class="Symbol">→</span> <a id="45885" href="#27326" class="Datatype">CallStack</a> <a id="45895" href="#45879" class="Bound">σ</a> <a id="45897" href="#45881" class="Bound">τ</a> <span id="45899" class="Symbol">→</span> <span id="45901" class="PrimitiveType">Set</span>
  <a id="45907" href="#45864" class="Function">!CallStack</a> <a id="45918" href="#45918" class="Bound">σ</a> <a id="45920" href="#45920" class="Bound">τ</a> <a id="45922" href="#45922" class="Bound">stack</a> <span id="45928" class="Symbol">=</span> <span id="45930" class="Symbol">∀</span> <span id="45932" class="Symbol">{</span><a id="45933" href="#45933" class="Bound">value</a><span id="45938" class="Symbol">}</span> <span id="45940" class="Symbol">→</span> <a id="45942" href="#44065" class="Function">!Value</a> <a id="45949" href="#45918" class="Bound">σ</a> <a id="45951" href="#45933" class="Bound">value</a> <span id="45957" class="Symbol">→</span> <a id="45959" href="#44729" class="Function">!Step</a> <a id="45965" href="#45920" class="Bound">τ</a> <span id="45967" class="Symbol">(</span><a id="45968" href="#28647" class="Function">composeValueStack</a> <a id="45986" href="#45933" class="Bound">value</a> <a id="45992" href="#45922" class="Bound">stack</a><span id="45997" class="Symbol">)</span>

  <span id="46002" class="Comment">-- Denotation for a term is a function computing denotation for any machine containing</span>
  <span id="46091" class="Comment">-- this term</span>
  <a id="16:DenotationRest.!TermC"></a><a id="46106" href="#46106" class="Function">!TermC</a> <span id="46113" class="Symbol">:</span> <span id="46115" class="Symbol">∀</span> <a id="46117" href="#46117" class="Bound">Γ</a> <a id="46119" href="#46119" class="Bound">τ</a> <span id="46121" class="Symbol">→</span> <span id="46123" class="Symbol">(</span><a id="46124" href="#46124" class="Bound">term</a> <span id="46129" class="Symbol">:</span> <a id="46131" href="#21673" class="Datatype">TermC</a> <a id="46137" href="#46117" class="Bound">Γ</a> <a id="46139" href="#46119" class="Bound">τ</a><span id="46140" class="Symbol">)</span> <span id="46142" class="Symbol">→</span> <span id="46144" class="PrimitiveType">Set</span>
  <a id="46150" href="#46106" class="Function">!TermC</a> <a id="46157" href="#46157" class="Bound">Γ</a> <a id="46159" href="#46159" class="Bound">τ</a> <a id="46161" href="#46161" class="Bound">term</a> <span id="46166" class="Symbol">=</span> <span id="46168" class="Symbol">∀</span> <span id="46170" class="Symbol">{</span><a id="46171" href="#46171" class="Bound">ϕ</a> <a id="46173" href="#46173" class="Bound">env</a> <a id="46177" href="#46177" class="Bound">stack</a><span id="46182" class="Symbol">}</span> <span id="46184" class="Symbol">→</span> <a id="46186" href="#45346" class="Function">!Env</a> <a id="46191" href="#46157" class="Bound">Γ</a> <a id="46193" href="#46173" class="Bound">env</a> <span id="46197" class="Symbol">→</span> <a id="46199" href="#45864" class="Function">!CallStack</a> <a id="46210" href="#46159" class="Bound">τ</a> <a id="46212" href="#46171" class="Bound">ϕ</a> <a id="46214" href="#46177" class="Bound">stack</a> <span id="46220" class="Symbol">→</span> <a id="46222" href="#44887" class="Function">!Machine</a> <a id="46231" href="#46171" class="Bound">ϕ</a> <span id="46233" class="Symbol">((</span><a id="46235" href="#46173" class="Bound">env</a> <a id="46239" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="46241" href="#46161" class="Bound">term</a><span id="46245" class="Symbol">)</span> <a id="46247" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="46249" href="#46177" class="Bound">stack</a><span id="46254" class="Symbol">)</span>

  <span id="46259" class="Comment">-- Denotation for 'AbsTermC' is the same as denotation for 'TermC'</span>
  <a id="16:DenotationRest.!AbsTermC"></a><a id="46328" href="#46328" class="Function">!AbsTermC</a> <span id="46338" class="Symbol">:</span> <span id="46340" class="Symbol">∀</span> <a id="46342" href="#46342" class="Bound">Γ</a> <a id="46344" href="#46344" class="Bound">ρ</a> <a id="46346" href="#46346" class="Bound">τ</a> <span id="46348" class="Symbol">→</span> <span id="46350" class="Symbol">(</span><a id="46351" href="#46351" class="Bound">term</a> <span id="46356" class="Symbol">:</span> <a id="46358" href="#21982" class="Function">AbsTermC</a> <a id="46367" href="#46342" class="Bound">Γ</a> <a id="46369" href="#46344" class="Bound">ρ</a> <a id="46371" href="#46346" class="Bound">τ</a><span id="46372" class="Symbol">)</span> <span id="46374" class="Symbol">→</span> <span id="46376" class="PrimitiveType">Set</span>
  <a id="46382" href="#46328" class="Function">!AbsTermC</a> <a id="46392" href="#46392" class="Bound">Γ</a> <a id="46394" href="#46394" class="Bound">ρ</a> <a id="46396" href="#46396" class="Bound">τ</a> <a id="46398" href="#46398" class="Bound">term</a> <span id="46403" class="Symbol">=</span> <a id="46405" href="#46106" class="Function">!TermC</a> <span id="46412" class="Symbol">(</span><a id="46413" href="#46394" class="Bound">ρ</a> <a id="46415" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="46417" href="#46392" class="Bound">Γ</a><span id="46418" class="Symbol">)</span> <a id="46420" href="#46396" class="Bound">τ</a> <a id="46422" href="#46398" class="Bound">term</a>

  <span id="46430" class="Comment">-- Applies function denotation to a value denotation</span>
  <a id="16:DenotationRest.!apply"></a><a id="46485" href="#46485" class="Function">!apply</a> <span id="46492" class="Symbol">:</span> <span id="46494" class="Symbol">∀</span> <span id="46496" class="Symbol">{</span><a id="46497" href="#46497" class="Bound">σ</a> <a id="46499" href="#46499" class="Bound">τ</a> <a id="46501" href="#46501" class="Bound">f</a> <a id="46503" href="#46503" class="Bound">v</a><span id="46504" class="Symbol">}</span> <span id="46506" class="Symbol">→</span> <a id="46508" href="#44065" class="Function">!Value</a> <span id="46515" class="Symbol">(</span><a id="46516" href="#46497" class="Bound">σ</a> <a id="46518" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="46520" href="#46499" class="Bound">τ</a><span id="46521" class="Symbol">)</span> <a id="46523" href="#46501" class="Bound">f</a> <span id="46525" class="Symbol">→</span> <a id="46527" href="#44065" class="Function">!Value</a> <a id="46534" href="#46497" class="Bound">σ</a> <a id="46536" href="#46503" class="Bound">v</a> <span id="46538" class="Symbol">→</span> <a id="46540" href="#45186" class="Function">!Thunk</a> <a id="46547" href="#46499" class="Bound">τ</a> <span id="46549" class="Symbol">(</span><a id="46550" href="#36294" class="Function">^apply</a> <a id="46557" href="#46501" class="Bound">f</a> <a id="46559" href="#46503" class="Bound">v</a><span id="46560" class="Symbol">)</span>
  <a id="46564" href="#46485" class="Function">!apply</a> <span id="46571" class="Symbol">(</span><a id="46572" href="#41737" class="InductiveConstructor">!mkArrow</a> <a id="46581" href="#46581" class="Bound">!f</a><span id="46583" class="Symbol">)</span> <a id="46585" href="#46585" class="Bound">!v</a> <span id="46588" class="Symbol">=</span> <a id="46590" href="#46581" class="Bound">!f</a> <a id="46593" href="#46585" class="Bound">!v</a>

<span id="46597" class="Keyword">open</span> <a id="46602" href="#44551" class="Module">16:DenotationRest</a>



<span id="46623" class="Keyword">module</span> <a id="17:DenotationalIntroduction"></a><a id="46630" href="#46630" class="Module">17:DenotationalIntroduction</a> <span id="46658" class="Keyword">where</span>
  <span id="46666" class="Comment">{-
     17. Denotational semantics for introduction rules
  -}</span>

  <a id="17:DenotationalIntroduction.!constructArrow"></a><a id="46732" href="#46732" class="Function">!constructArrow</a> <span id="46748" class="Symbol">:</span> <span id="46750" class="Symbol">∀</span> <span id="46752" class="Symbol">{</span><a id="46753" href="#46753" class="Bound">ρ</a> <a id="46755" href="#46755" class="Bound">τ</a> <a id="46757" href="#46757" class="Bound">rule</a><span id="46761" class="Symbol">}</span> <span id="46763" class="Symbol">→</span> <a id="46765" href="#14464" class="Datatype">AllIntr</a> <a id="46773" href="#45558" class="Function">!Closure</a> <a id="46782" href="#44065" class="Function">!Value</a> <span id="46789" class="Symbol">(</span><a id="46790" href="#46753" class="Bound">ρ</a> <a id="46792" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="46794" href="#46755" class="Bound">τ</a><span id="46795" class="Symbol">)</span> <a id="46797" href="#46757" class="Bound">rule</a> <span id="46802" class="Symbol">→</span> <a id="46804" href="#44065" class="Function">!Value</a> <span id="46811" class="Symbol">(</span><a id="46812" href="#46753" class="Bound">ρ</a> <a id="46814" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="46816" href="#46755" class="Bound">τ</a><span id="46817" class="Symbol">)</span> <span id="46819" class="Symbol">(</span><a id="46820" href="#26540" class="InductiveConstructor">construct</a> <a id="46830" href="#46757" class="Bound">rule</a><span id="46834" class="Symbol">)</span>
  <a id="46838" href="#46732" class="Function">!constructArrow</a> <span id="46854" class="Symbol">(</span><a id="46855" href="#14642" class="InductiveConstructor">mkAllIntrArrow</a> <a id="46870" href="#46870" class="Bound">!closure</a><span id="46878" class="Symbol">)</span> <span id="46880" class="Symbol">=</span> <a id="46882" href="#41737" class="InductiveConstructor">!mkArrow</a> <a id="46891" href="#46870" class="Bound">!closure</a>

  <a id="17:DenotationalIntroduction.!constructSum"></a><a id="46903" href="#46903" class="Function">!constructSum</a> <span id="46917" class="Symbol">:</span> <span id="46919" class="Symbol">∀</span> <span id="46921" class="Symbol">{</span><a id="46922" href="#46922" class="Bound">τs</a> <a id="46925" href="#46925" class="Bound">rule</a><span id="46929" class="Symbol">}</span> <span id="46931" class="Symbol">→</span> <a id="46933" href="#14464" class="Datatype">AllIntr</a> <a id="46941" href="#45558" class="Function">!Closure</a> <a id="46950" href="#44065" class="Function">!Value</a> <span id="46957" class="Symbol">(</span><a id="46958" href="#8677" class="InductiveConstructor">#Sum</a> <a id="46963" href="#46922" class="Bound">τs</a><span id="46965" class="Symbol">)</span> <a id="46967" href="#46925" class="Bound">rule</a> <span id="46972" class="Symbol">→</span> <a id="46974" href="#44065" class="Function">!Value</a> <span id="46981" class="Symbol">(</span><a id="46982" href="#8677" class="InductiveConstructor">#Sum</a> <a id="46987" href="#46922" class="Bound">τs</a><span id="46989" class="Symbol">)</span> <span id="46991" class="Symbol">(</span><a id="46992" href="#26540" class="InductiveConstructor">construct</a> <a id="47002" href="#46925" class="Bound">rule</a><span id="47006" class="Symbol">)</span>
  <a id="47010" href="#46903" class="Function">!constructSum</a> <span id="47024" class="Symbol">(</span><a id="47025" href="#14776" class="InductiveConstructor">mkAllIntrSum</a> <span id="47038" class="Symbol">(</span><a id="47039" href="#4306" class="InductiveConstructor">here</a> <a id="47044" href="#47044" class="Bound">!v</a><span id="47046" class="Symbol">))</span>   <span id="47051" class="Symbol">=</span> <a id="47053" href="#41951" class="InductiveConstructor">!here</a> <a id="47059" href="#47044" class="Bound">!v</a>
  <a id="47064" href="#46903" class="Function">!constructSum</a> <span id="47078" class="Symbol">(</span><a id="47079" href="#14776" class="InductiveConstructor">mkAllIntrSum</a> <span id="47092" class="Symbol">(</span><a id="47093" href="#4366" class="InductiveConstructor">there</a> <a id="47099" href="#47099" class="Bound">!vᵢ</a><span id="47102" class="Symbol">))</span> <span id="47105" class="Symbol">=</span> <a id="47107" href="#42055" class="InductiveConstructor">!there</a> <span id="47114" class="Symbol">(</span><a id="47115" href="#46903" class="Function">!constructSum</a> <span id="47129" class="Symbol">(</span><a id="47130" href="#14776" class="InductiveConstructor">mkAllIntrSum</a> <a id="47143" href="#47099" class="Bound">!vᵢ</a><span id="47146" class="Symbol">))</span>

  <a id="17:DenotationalIntroduction.!constructProduct"></a><a id="47152" href="#47152" class="Function">!constructProduct</a> <span id="47170" class="Symbol">:</span> <span id="47172" class="Symbol">∀</span> <span id="47174" class="Symbol">{</span><a id="47175" href="#47175" class="Bound">τs</a> <a id="47178" href="#47178" class="Bound">rule</a><span id="47182" class="Symbol">}</span> <span id="47184" class="Symbol">→</span> <a id="47186" href="#14464" class="Datatype">AllIntr</a> <a id="47194" href="#45558" class="Function">!Closure</a> <a id="47203" href="#44065" class="Function">!Value</a> <span id="47210" class="Symbol">(</span><a id="47211" href="#8737" class="InductiveConstructor">#Product</a> <a id="47220" href="#47175" class="Bound">τs</a><span id="47222" class="Symbol">)</span> <a id="47224" href="#47178" class="Bound">rule</a> <span id="47229" class="Symbol">→</span> <a id="47231" href="#44065" class="Function">!Value</a> <span id="47238" class="Symbol">(</span><a id="47239" href="#8737" class="InductiveConstructor">#Product</a> <a id="47248" href="#47175" class="Bound">τs</a><span id="47250" class="Symbol">)</span> <span id="47252" class="Symbol">(</span><a id="47253" href="#26540" class="InductiveConstructor">construct</a> <a id="47263" href="#47178" class="Bound">rule</a><span id="47267" class="Symbol">)</span>
  <a id="47271" href="#47152" class="Function">!constructProduct</a> <span id="47289" class="Symbol">(</span><a id="47290" href="#14907" class="InductiveConstructor">mkAllIntrProduct</a> <a id="47307" href="#4041" class="InductiveConstructor">ε</a><span id="47308" class="Symbol">)</span>          <span id="47319" class="Symbol">=</span> <a id="47321" href="#42297" class="InductiveConstructor">!ε</a>
  <a id="47326" href="#47152" class="Function">!constructProduct</a> <span id="47344" class="Symbol">(</span><a id="47345" href="#14907" class="InductiveConstructor">mkAllIntrProduct</a> <span id="47362" class="Symbol">(</span><a id="47363" href="#47363" class="Bound">!v</a> <a id="47366" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="47368" href="#47368" class="Bound">!vs</a><span id="47371" class="Symbol">))</span> <span id="47374" class="Symbol">=</span> <a id="47376" href="#47363" class="Bound">!v</a> <a id="47379" href="#42324" class="InductiveConstructor Operator">∷!</a> <a id="47382" href="#47152" class="Function">!constructProduct</a> <span id="47400" class="Symbol">(</span><a id="47401" href="#14907" class="InductiveConstructor">mkAllIntrProduct</a> <a id="47418" href="#47368" class="Bound">!vs</a><span id="47421" class="Symbol">)</span>

  <a id="17:DenotationalIntroduction.!constructNat"></a><a id="47426" href="#47426" class="Function">!constructNat</a> <span id="47440" class="Symbol">:</span> <span id="47442" class="Symbol">∀</span> <span id="47444" class="Symbol">{</span><a id="47445" href="#47445" class="Bound">rule</a><span id="47449" class="Symbol">}</span> <span id="47451" class="Symbol">→</span> <a id="47453" href="#14464" class="Datatype">AllIntr</a> <a id="47461" href="#45558" class="Function">!Closure</a> <a id="47470" href="#44065" class="Function">!Value</a> <a id="47477" href="#8801" class="InductiveConstructor">#Nat</a> <a id="47482" href="#47445" class="Bound">rule</a> <span id="47487" class="Symbol">→</span> <a id="47489" href="#44065" class="Function">!Value</a> <a id="47496" href="#8801" class="InductiveConstructor">#Nat</a> <span id="47501" class="Symbol">(</span><a id="47502" href="#26540" class="InductiveConstructor">construct</a> <a id="47512" href="#47445" class="Bound">rule</a><span id="47516" class="Symbol">)</span>
  <a id="47520" href="#47426" class="Function">!constructNat</a> <span id="47534" class="Symbol">(</span><a id="47535" href="#15042" class="InductiveConstructor">mkAllIntrNat</a> <span id="47548" class="Symbol">(</span><a id="47549" href="#41951" class="InductiveConstructor">!here</a> <a id="47555" href="#42297" class="InductiveConstructor">!ε</a><span id="47557" class="Symbol">))</span>          <span id="47569" class="Symbol">=</span> <a id="47571" href="#42955" class="InductiveConstructor">!mkNat</a> <a id="47578" href="#42747" class="InductiveConstructor">!nothing</a>
  <a id="47589" href="#47426" class="Function">!constructNat</a> <span id="47603" class="Symbol">(</span><a id="47604" href="#15042" class="InductiveConstructor">mkAllIntrNat</a> <span id="47617" class="Symbol">(</span><a id="47618" href="#42055" class="InductiveConstructor">!there</a> <span id="47625" class="Symbol">(</span><a id="47626" href="#41951" class="InductiveConstructor">!here</a> <a id="47632" href="#47632" class="Bound">!v</a><span id="47634" class="Symbol">)))</span> <span id="47638" class="Symbol">=</span> <a id="47640" href="#42955" class="InductiveConstructor">!mkNat</a> <span id="47647" class="Symbol">(</span><a id="47648" href="#42781" class="InductiveConstructor">!just</a> <a id="47654" href="#47632" class="Bound">!v</a><span id="47656" class="Symbol">)</span>

  <a id="17:DenotationalIntroduction.!constructConatU"></a><a id="47661" href="#47661" class="Function">!constructConatU</a> <span id="47678" class="Symbol">:</span> <span id="47680" class="Symbol">∀</span> <span id="47682" class="Symbol">{</span><a id="47683" href="#47683" class="Bound">ρ</a> <a id="47685" href="#47685" class="Bound">f</a> <a id="47687" href="#47687" class="Bound">v</a><span id="47688" class="Symbol">}</span> <span id="47690" class="Symbol">→</span> <a id="47692" href="#44065" class="Function">!Value</a> <span id="47699" class="Symbol">(</span><a id="47700" href="#47683" class="Bound">ρ</a> <a id="47702" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="47704" href="#9349" class="Function">#Maybe</a> <a id="47711" href="#47683" class="Bound">ρ</a><span id="47712" class="Symbol">)</span> <a id="47714" href="#47685" class="Bound">f</a> <span id="47716" class="Symbol">→</span> <a id="47718" href="#44065" class="Function">!Value</a> <a id="47725" href="#47683" class="Bound">ρ</a> <a id="47727" href="#47687" class="Bound">v</a> <span id="47729" class="Symbol">→</span> <a id="47731" href="#43065" class="Record">!ConatU</a> <a id="47739" href="#47685" class="Bound">f</a> <a id="47741" href="#47687" class="Bound">v</a>
  <a id="47745" href="#43156" class="Field">!forceConat</a> <span id="47757" class="Symbol">(</span><a id="47758" href="#47661" class="Function">!constructConatU</a> <span id="47775" class="Symbol">{</span><a id="47776" href="#47776" class="Bound">ρ</a><span id="47777" class="Symbol">}</span> <span id="47779" class="Symbol">{</span><a id="47780" href="#47780" class="Bound">f</a><span id="47781" class="Symbol">}</span> <span id="47783" class="Symbol">{</span><a id="47784" href="#47784" class="Bound">v</a><span id="47785" class="Symbol">}</span> <a id="47787" href="#47787" class="Bound">!f</a> <a id="47790" href="#47790" class="Bound">!v</a><span id="47792" class="Symbol">)</span> <span id="47794" class="Symbol">=</span> <a id="47796" href="#48335" class="Function">mapConstructMachine</a> <span id="47816" class="Symbol">(</span><a id="47817" href="#46485" class="Function">!apply</a> <a id="47824" href="#47787" class="Bound">!f</a> <a id="47827" href="#47790" class="Bound">!v</a><span id="47829" class="Symbol">)</span>
    <span id="47835" class="Keyword">where</span>
      <a id="47847" href="#47847" class="Function">mapConstructMaybe</a> <span id="47865" class="Symbol">:</span> <span id="47867" class="Symbol">∀</span> <span id="47869" class="Symbol">{</span><a id="47870" href="#47870" class="Bound">value</a><span id="47875" class="Symbol">}</span> <span id="47877" class="Symbol">→</span> <a id="47879" href="#44065" class="Function">!Value</a> <span id="47886" class="Symbol">(</span><a id="47887" href="#9349" class="Function">#Maybe</a> <a id="47894" href="#47776" class="Bound">ρ</a><span id="47895" class="Symbol">)</span> <a id="47897" href="#47870" class="Bound">value</a> <span id="47903" class="Symbol">→</span> <a id="47905" href="#42696" class="Datatype">!Maybe</a> <span id="47912" class="Symbol">(</span><a id="47913" href="#43065" class="Record">!ConatU</a> <a id="47921" href="#47780" class="Bound">f</a><span id="47922" class="Symbol">)</span> <a id="47924" href="#47870" class="Bound">value</a>
      <a id="47936" href="#47847" class="Function">mapConstructMaybe</a> <span id="47954" class="Symbol">(</span><a id="47955" href="#41951" class="InductiveConstructor">!here</a> <a id="47961" href="#42297" class="InductiveConstructor">!ε</a><span id="47963" class="Symbol">)</span>           <span id="47975" class="Symbol">=</span> <a id="47977" href="#42747" class="InductiveConstructor">!nothing</a>
      <a id="47992" href="#47847" class="Function">mapConstructMaybe</a> <span id="48010" class="Symbol">(</span><a id="48011" href="#42055" class="InductiveConstructor">!there</a> <span id="48018" class="Symbol">(</span><a id="48019" href="#41951" class="InductiveConstructor">!here</a> <a id="48025" href="#48025" class="Bound">!v'</a><span id="48028" class="Symbol">))</span> <span id="48031" class="Symbol">=</span> <a id="48033" href="#42781" class="InductiveConstructor">!just</a> <span id="48039" class="Symbol">(</span><a id="48040" href="#47661" class="Function">!constructConatU</a> <a id="48057" href="#47787" class="Bound">!f</a> <a id="48060" href="#48025" class="Bound">!v'</a><span id="48063" class="Symbol">)</span>

      <a id="48072" href="#48072" class="Function">mapConstructStep</a> <span id="48089" class="Symbol">:</span> <span id="48091" class="Symbol">∀</span> <span id="48093" class="Symbol">{</span><a id="48094" href="#48094" class="Bound">step</a><span id="48098" class="Symbol">}</span> <span id="48100" class="Symbol">→</span> <a id="48102" href="#37905" class="Datatype">TraceStep</a> <span id="48112" class="Symbol">(</span><a id="48113" href="#44065" class="Function">!Value</a> <span id="48120" class="Symbol">(</span><a id="48121" href="#9349" class="Function">#Maybe</a> <a id="48128" href="#47776" class="Bound">ρ</a><span id="48129" class="Symbol">))</span> <a id="48132" href="#48094" class="Bound">step</a> <span id="48137" class="Symbol">→</span> <a id="48139" href="#37905" class="Datatype">TraceStep</a> <span id="48149" class="Symbol">(</span><a id="48150" href="#42696" class="Datatype">!Maybe</a> <span id="48157" class="Symbol">(</span><a id="48158" href="#43065" class="Record">!ConatU</a> <a id="48166" href="#47780" class="Bound">f</a><span id="48167" class="Symbol">))</span> <a id="48170" href="#48094" class="Bound">step</a>
      <a id="48181" href="#48072" class="Function">mapConstructStep</a> <span id="48198" class="Symbol">(</span><a id="48199" href="#37965" class="InductiveConstructor">!finish</a> <a id="48207" href="#48207" class="Bound">!v'</a><span id="48210" class="Symbol">)</span>     <span id="48216" class="Symbol">=</span> <a id="48218" href="#37965" class="InductiveConstructor">!finish</a> <span id="48226" class="Symbol">(</span><a id="48227" href="#47847" class="Function">mapConstructMaybe</a> <a id="48245" href="#48207" class="Bound">!v'</a><span id="48248" class="Symbol">)</span>
      <a id="48256" href="#48072" class="Function">mapConstructStep</a> <span id="48273" class="Symbol">(</span><a id="48274" href="#38040" class="InductiveConstructor">!continue</a> <a id="48284" href="#48284" class="Bound">trace</a><span id="48289" class="Symbol">)</span> <span id="48291" class="Symbol">=</span> <a id="48293" href="#38040" class="InductiveConstructor">!continue</a> <span id="48303" class="Symbol">(</span><a id="48304" href="#48072" class="Function">mapConstructStep</a> <a id="48321" href="#48284" class="Bound">trace</a><span id="48326" class="Symbol">)</span>

      <a id="48335" href="#48335" class="Function">mapConstructMachine</a> <span id="48355" class="Symbol">:</span> <span id="48357" class="Symbol">∀</span> <span id="48359" class="Symbol">{</span><a id="48360" href="#48360" class="Bound">machine</a><span id="48367" class="Symbol">}</span> <span id="48369" class="Symbol">→</span> <a id="48371" href="#38303" class="Datatype">TraceMachine</a> <span id="48384" class="Symbol">(</span><a id="48385" href="#44065" class="Function">!Value</a> <span id="48392" class="Symbol">(</span><a id="48393" href="#9349" class="Function">#Maybe</a> <a id="48400" href="#47776" class="Bound">ρ</a><span id="48401" class="Symbol">))</span> <a id="48404" href="#48360" class="Bound">machine</a> <span id="48412" class="Symbol">→</span> <a id="48414" href="#38303" class="Datatype">TraceMachine</a> <span id="48427" class="Symbol">(</span><a id="48428" href="#42696" class="Datatype">!Maybe</a> <span id="48435" class="Symbol">(</span><a id="48436" href="#43065" class="Record">!ConatU</a> <a id="48444" href="#47780" class="Bound">f</a><span id="48445" class="Symbol">))</span> <a id="48448" href="#48360" class="Bound">machine</a>
      <a id="48462" href="#48335" class="Function">mapConstructMachine</a> <span id="48482" class="Symbol">(</span><a id="48483" href="#38369" class="InductiveConstructor">!continueM</a> <a id="48494" href="#48494" class="Bound">s</a><span id="48495" class="Symbol">)</span> <span id="48497" class="Symbol">=</span> <a id="48499" href="#38369" class="InductiveConstructor">!continueM</a> <span id="48510" class="Symbol">(</span><a id="48511" href="#48072" class="Function">mapConstructStep</a> <a id="48528" href="#48494" class="Bound">s</a><span id="48529" class="Symbol">)</span>

  <a id="17:DenotationalIntroduction.!constructConat"></a><a id="48534" href="#48534" class="Function">!constructConat</a> <span id="48550" class="Symbol">:</span> <span id="48552" class="Symbol">∀</span> <span id="48554" class="Symbol">{</span><a id="48555" href="#48555" class="Bound">rule</a><span id="48559" class="Symbol">}</span> <span id="48561" class="Symbol">→</span> <a id="48563" href="#14464" class="Datatype">AllIntr</a> <a id="48571" href="#45558" class="Function">!Closure</a> <a id="48580" href="#44065" class="Function">!Value</a> <a id="48587" href="#8853" class="InductiveConstructor">#Conat</a> <a id="48594" href="#48555" class="Bound">rule</a> <span id="48599" class="Symbol">→</span> <a id="48601" href="#44065" class="Function">!Value</a> <a id="48608" href="#8853" class="InductiveConstructor">#Conat</a> <span id="48615" class="Symbol">(</span><a id="48616" href="#26540" class="InductiveConstructor">construct</a> <a id="48626" href="#48555" class="Bound">rule</a><span id="48630" class="Symbol">)</span>
  <a id="48634" href="#48534" class="Function">!constructConat</a> <span id="48650" class="Symbol">(</span><a id="48651" href="#15172" class="InductiveConstructor">mkAllIntrConat</a> <span id="48666" class="Symbol">(</span><a id="48667" href="#48667" class="Bound">ρ</a> <a id="48669" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="48672" href="#48672" class="Bound">!v</a> <a id="48675" href="#3647" class="InductiveConstructor Operator">,</a> <a id="48677" href="#48677" class="Bound">!f</a><span id="48679" class="Symbol">))</span> <span id="48682" class="Symbol">=</span> <a id="48684" href="#43427" class="InductiveConstructor">!mkConat</a> <span id="48693" class="Symbol">(</span><a id="48694" href="#47661" class="Function">!constructConatU</a> <a id="48711" href="#48677" class="Bound">!f</a> <a id="48714" href="#48672" class="Bound">!v</a><span id="48716" class="Symbol">)</span>

  <a id="17:DenotationalIntroduction.!constructStreamU"></a><a id="48721" href="#48721" class="Function">!constructStreamU</a> <span id="48739" class="Symbol">:</span> <span id="48741" class="Symbol">∀</span> <span id="48743" class="Symbol">{</span><a id="48744" href="#48744" class="Bound">τ</a> <a id="48746" href="#48746" class="Bound">ρ</a> <a id="48748" href="#48748" class="Bound">f</a> <a id="48750" href="#48750" class="Bound">v</a><span id="48751" class="Symbol">}</span> <span id="48753" class="Symbol">→</span> <a id="48755" href="#44065" class="Function">!Value</a> <span id="48762" class="Symbol">(</span><a id="48763" href="#48746" class="Bound">ρ</a> <a id="48765" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="48767" href="#9217" class="Function">#Pair</a> <a id="48773" href="#48744" class="Bound">τ</a> <a id="48775" href="#48746" class="Bound">ρ</a><span id="48776" class="Symbol">)</span> <a id="48778" href="#48748" class="Bound">f</a> <span id="48780" class="Symbol">→</span> <a id="48782" href="#44065" class="Function">!Value</a> <a id="48789" href="#48746" class="Bound">ρ</a> <a id="48791" href="#48750" class="Bound">v</a> <span id="48793" class="Symbol">→</span> <a id="48795" href="#43550" class="Record">!StreamU</a> <span id="48804" class="Symbol">(</span><a id="48805" href="#44065" class="Function">!Value</a> <a id="48812" href="#48744" class="Bound">τ</a><span id="48813" class="Symbol">)</span> <a id="48815" href="#48748" class="Bound">f</a> <a id="48817" href="#48750" class="Bound">v</a>
  <a id="48821" href="#43658" class="Field">!forceStream</a> <span id="48834" class="Symbol">(</span><a id="48835" href="#48721" class="Function">!constructStreamU</a> <span id="48853" class="Symbol">{</span><a id="48854" href="#48854" class="Bound">τ</a><span id="48855" class="Symbol">}</span> <span id="48857" class="Symbol">{</span><a id="48858" href="#48858" class="Bound">ρ</a><span id="48859" class="Symbol">}</span> <span id="48861" class="Symbol">{</span><a id="48862" href="#48862" class="Bound">f</a><span id="48863" class="Symbol">}</span> <span id="48865" class="Symbol">{</span><a id="48866" href="#48866" class="Bound">v</a><span id="48867" class="Symbol">}</span> <a id="48869" href="#48869" class="Bound">!f</a> <a id="48872" href="#48872" class="Bound">!v</a><span id="48874" class="Symbol">)</span> <span id="48876" class="Symbol">=</span> <a id="48878" href="#49399" class="Function">mapConstructMachine</a> <span id="48898" class="Symbol">(</span><a id="48899" href="#46485" class="Function">!apply</a> <a id="48906" href="#48869" class="Bound">!f</a> <a id="48909" href="#48872" class="Bound">!v</a><span id="48911" class="Symbol">)</span>
    <span id="48917" class="Keyword">where</span>
      <a id="48929" href="#48929" class="Function">mapConstructPair</a> <span id="48946" class="Symbol">:</span> <span id="48948" class="Symbol">∀</span> <span id="48950" class="Symbol">{</span><a id="48951" href="#48951" class="Bound">value</a><span id="48956" class="Symbol">}</span> <span id="48958" class="Symbol">→</span> <a id="48960" href="#44065" class="Function">!Value</a> <span id="48967" class="Symbol">(</span><a id="48968" href="#9217" class="Function">#Pair</a> <a id="48974" href="#48854" class="Bound">τ</a> <a id="48976" href="#48858" class="Bound">ρ</a><span id="48977" class="Symbol">)</span> <a id="48979" href="#48951" class="Bound">value</a> <span id="48985" class="Symbol">→</span> <a id="48987" href="#42511" class="Datatype">!Pair</a> <span id="48993" class="Symbol">(</span><a id="48994" href="#44065" class="Function">!Value</a> <a id="49001" href="#48854" class="Bound">τ</a><span id="49002" class="Symbol">)</span> <span id="49004" class="Symbol">(</span><a id="49005" href="#43550" class="Record">!StreamU</a> <span id="49014" class="Symbol">(</span><a id="49015" href="#44065" class="Function">!Value</a> <a id="49022" href="#48854" class="Bound">τ</a><span id="49023" class="Symbol">)</span> <a id="49025" href="#48862" class="Bound">f</a><span id="49026" class="Symbol">)</span> <a id="49028" href="#48951" class="Bound">value</a>
      <a id="49040" href="#48929" class="Function">mapConstructPair</a> <span id="49057" class="Symbol">(</span><a id="49058" href="#49058" class="Bound">!u</a> <a id="49061" href="#42324" class="InductiveConstructor Operator">∷!</a> <a id="49064" href="#49064" class="Bound">!v'</a> <a id="49068" href="#42324" class="InductiveConstructor Operator">∷!</a> <a id="49071" href="#42297" class="InductiveConstructor">!ε</a><span id="49073" class="Symbol">)</span> <span id="49075" class="Symbol">=</span> <a id="49077" href="#49058" class="Bound">!u</a> <a id="49080" href="#42577" class="InductiveConstructor Operator">,</a> <a id="49082" href="#48721" class="Function">!constructStreamU</a> <a id="49100" href="#48869" class="Bound">!f</a> <a id="49103" href="#49064" class="Bound">!v'</a>

      <a id="49114" href="#49114" class="Function">mapConstructStep</a> <span id="49131" class="Symbol">:</span> <span id="49133" class="Symbol">∀</span> <span id="49135" class="Symbol">{</span><a id="49136" href="#49136" class="Bound">step</a><span id="49140" class="Symbol">}</span> <span id="49142" class="Symbol">→</span> <a id="49144" href="#37905" class="Datatype">TraceStep</a> <span id="49154" class="Symbol">(</span><a id="49155" href="#44065" class="Function">!Value</a> <span id="49162" class="Symbol">(</span><a id="49163" href="#9217" class="Function">#Pair</a> <a id="49169" href="#48854" class="Bound">τ</a> <a id="49171" href="#48858" class="Bound">ρ</a><span id="49172" class="Symbol">))</span> <a id="49175" href="#49136" class="Bound">step</a> <span id="49180" class="Symbol">→</span> <a id="49182" href="#37905" class="Datatype">TraceStep</a> <span id="49192" class="Symbol">(</span><a id="49193" href="#42511" class="Datatype">!Pair</a> <span id="49199" class="Symbol">(</span><a id="49200" href="#44065" class="Function">!Value</a> <a id="49207" href="#48854" class="Bound">τ</a><span id="49208" class="Symbol">)</span> <span id="49210" class="Symbol">(</span><a id="49211" href="#43550" class="Record">!StreamU</a> <span id="49220" class="Symbol">(</span><a id="49221" href="#44065" class="Function">!Value</a> <a id="49228" href="#48854" class="Bound">τ</a><span id="49229" class="Symbol">)</span> <a id="49231" href="#48862" class="Bound">f</a><span id="49232" class="Symbol">))</span> <a id="49235" href="#49136" class="Bound">step</a>
      <a id="49246" href="#49114" class="Function">mapConstructStep</a> <span id="49263" class="Symbol">(</span><a id="49264" href="#37965" class="InductiveConstructor">!finish</a> <a id="49272" href="#49272" class="Bound">!v'</a><span id="49275" class="Symbol">)</span>     <span id="49281" class="Symbol">=</span> <a id="49283" href="#37965" class="InductiveConstructor">!finish</a> <span id="49291" class="Symbol">(</span><a id="49292" href="#48929" class="Function">mapConstructPair</a> <a id="49309" href="#49272" class="Bound">!v'</a><span id="49312" class="Symbol">)</span>
      <a id="49320" href="#49114" class="Function">mapConstructStep</a> <span id="49337" class="Symbol">(</span><a id="49338" href="#38040" class="InductiveConstructor">!continue</a> <a id="49348" href="#49348" class="Bound">trace</a><span id="49353" class="Symbol">)</span> <span id="49355" class="Symbol">=</span> <a id="49357" href="#38040" class="InductiveConstructor">!continue</a> <span id="49367" class="Symbol">(</span><a id="49368" href="#49114" class="Function">mapConstructStep</a> <a id="49385" href="#49348" class="Bound">trace</a><span id="49390" class="Symbol">)</span>

      <a id="49399" href="#49399" class="Function">mapConstructMachine</a> <span id="49419" class="Symbol">:</span> <span id="49421" class="Symbol">∀</span> <span id="49423" class="Symbol">{</span><a id="49424" href="#49424" class="Bound">machine</a><span id="49431" class="Symbol">}</span> <span id="49433" class="Symbol">→</span> <a id="49435" href="#38303" class="Datatype">TraceMachine</a> <span id="49448" class="Symbol">(</span><a id="49449" href="#44065" class="Function">!Value</a> <span id="49456" class="Symbol">(</span><a id="49457" href="#9217" class="Function">#Pair</a> <a id="49463" href="#48854" class="Bound">τ</a> <a id="49465" href="#48858" class="Bound">ρ</a><span id="49466" class="Symbol">))</span> <a id="49469" href="#49424" class="Bound">machine</a> <span id="49477" class="Symbol">→</span> <a id="49479" href="#38303" class="Datatype">TraceMachine</a> <span id="49492" class="Symbol">(</span><a id="49493" href="#42511" class="Datatype">!Pair</a> <span id="49499" class="Symbol">(</span><a id="49500" href="#44065" class="Function">!Value</a> <a id="49507" href="#48854" class="Bound">τ</a><span id="49508" class="Symbol">)</span> <span id="49510" class="Symbol">(</span><a id="49511" href="#43550" class="Record">!StreamU</a> <span id="49520" class="Symbol">(</span><a id="49521" href="#44065" class="Function">!Value</a> <a id="49528" href="#48854" class="Bound">τ</a><span id="49529" class="Symbol">)</span> <a id="49531" href="#48862" class="Bound">f</a><span id="49532" class="Symbol">))</span> <a id="49535" href="#49424" class="Bound">machine</a>
      <a id="49549" href="#49399" class="Function">mapConstructMachine</a> <span id="49569" class="Symbol">(</span><a id="49570" href="#38369" class="InductiveConstructor">!continueM</a> <a id="49581" href="#49581" class="Bound">s</a><span id="49582" class="Symbol">)</span> <span id="49584" class="Symbol">=</span> <a id="49586" href="#38369" class="InductiveConstructor">!continueM</a> <span id="49597" class="Symbol">(</span><a id="49598" href="#49114" class="Function">mapConstructStep</a> <a id="49615" href="#49581" class="Bound">s</a><span id="49616" class="Symbol">)</span>

  <a id="17:DenotationalIntroduction.!constructStream"></a><a id="49621" href="#49621" class="Function">!constructStream</a> <span id="49638" class="Symbol">:</span> <span id="49640" class="Symbol">∀</span> <span id="49642" class="Symbol">{</span><a id="49643" href="#49643" class="Bound">τ</a> <a id="49645" href="#49645" class="Bound">rule</a><span id="49649" class="Symbol">}</span> <span id="49651" class="Symbol">→</span> <a id="49653" href="#14464" class="Datatype">AllIntr</a> <a id="49661" href="#45558" class="Function">!Closure</a> <a id="49670" href="#44065" class="Function">!Value</a> <span id="49677" class="Symbol">(</span><a id="49678" href="#8937" class="InductiveConstructor">#Stream</a> <a id="49686" href="#49643" class="Bound">τ</a><span id="49687" class="Symbol">)</span> <a id="49689" href="#49645" class="Bound">rule</a> <span id="49694" class="Symbol">→</span> <a id="49696" href="#44065" class="Function">!Value</a> <span id="49703" class="Symbol">(</span><a id="49704" href="#8937" class="InductiveConstructor">#Stream</a> <a id="49712" href="#49643" class="Bound">τ</a><span id="49713" class="Symbol">)</span> <span id="49715" class="Symbol">(</span><a id="49716" href="#26540" class="InductiveConstructor">construct</a> <a id="49726" href="#49645" class="Bound">rule</a><span id="49730" class="Symbol">)</span>
  <a id="49734" href="#49621" class="Function">!constructStream</a> <span id="49751" class="Symbol">{</span><a id="49752" href="#49752" class="Bound">τ</a><span id="49753" class="Symbol">}</span> <span id="49755" class="Symbol">(</span><a id="49756" href="#15304" class="InductiveConstructor">mkAllIntrStream</a> <span id="49772" class="Symbol">(</span><a id="49773" href="#49773" class="Bound">ρ</a> <a id="49775" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="49778" href="#49778" class="Bound">!v</a> <a id="49781" href="#3647" class="InductiveConstructor Operator">,</a> <a id="49783" href="#49783" class="Bound">!f</a><span id="49785" class="Symbol">))</span> <span id="49788" class="Symbol">=</span> <a id="49790" href="#43950" class="InductiveConstructor">!mkStream</a> <span id="49800" class="Symbol">(</span><a id="49801" href="#48721" class="Function">!constructStreamU</a> <a id="49819" href="#49783" class="Bound">!f</a> <a id="49822" href="#49778" class="Bound">!v</a><span id="49824" class="Symbol">)</span>

  <span id="49829" class="Comment">-- Given denotations for all components of a run-time introduction rule, returns denotation</span>
  <span id="49923" class="Comment">-- for the value produced by the rule</span>
  <a id="17:DenotationalIntroduction.!construct"></a><a id="49963" href="#49963" class="Function">!construct</a> <span id="49974" class="Symbol">:</span> <span id="49976" class="Symbol">∀</span> <span id="49978" class="Symbol">{</span><a id="49979" href="#49979" class="Bound">τ</a> <a id="49981" href="#49981" class="Bound">rule</a><span id="49985" class="Symbol">}</span> <span id="49987" class="Symbol">→</span> <a id="49989" href="#14464" class="Datatype">AllIntr</a> <a id="49997" href="#45558" class="Function">!Closure</a> <a id="50006" href="#44065" class="Function">!Value</a> <a id="50013" href="#49979" class="Bound">τ</a> <a id="50015" href="#49981" class="Bound">rule</a> <span id="50020" class="Symbol">→</span> <a id="50022" href="#44065" class="Function">!Value</a> <a id="50029" href="#49979" class="Bound">τ</a> <span id="50031" class="Symbol">(</span><a id="50032" href="#26540" class="InductiveConstructor">construct</a> <a id="50042" href="#49981" class="Bound">rule</a><span id="50046" class="Symbol">)</span>
  <a id="50050" href="#49963" class="Function">!construct</a> <span id="50061" class="Symbol">{</span><a id="50062" href="#50062" class="Bound">ρ</a> <a id="50064" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="50066" href="#50066" class="Bound">τ</a><span id="50067" class="Symbol">}</span>       <span id="50075" class="Symbol">=</span> <a id="50077" href="#46732" class="Function">!constructArrow</a>
  <a id="50095" href="#49963" class="Function">!construct</a> <span id="50106" class="Symbol">{</span><a id="50107" href="#8677" class="InductiveConstructor">#Sum</a> <a id="50112" href="#50112" class="Bound">τs</a><span id="50114" class="Symbol">}</span>     <span id="50120" class="Symbol">=</span> <a id="50122" href="#46903" class="Function">!constructSum</a>
  <a id="50138" href="#49963" class="Function">!construct</a> <span id="50149" class="Symbol">{</span><a id="50150" href="#8737" class="InductiveConstructor">#Product</a> <a id="50159" href="#50159" class="Bound">τs</a><span id="50161" class="Symbol">}</span> <span id="50163" class="Symbol">=</span> <a id="50165" href="#47152" class="Function">!constructProduct</a>
  <a id="50185" href="#49963" class="Function">!construct</a> <span id="50196" class="Symbol">{</span><a id="50197" href="#8801" class="InductiveConstructor">#Nat</a><span id="50201" class="Symbol">}</span>        <span id="50210" class="Symbol">=</span> <a id="50212" href="#47426" class="Function">!constructNat</a>
  <a id="50228" href="#49963" class="Function">!construct</a> <span id="50239" class="Symbol">{</span><a id="50240" href="#8853" class="InductiveConstructor">#Conat</a><span id="50246" class="Symbol">}</span>      <span id="50253" class="Symbol">=</span> <a id="50255" href="#48534" class="Function">!constructConat</a>
  <a id="50273" href="#49963" class="Function">!construct</a> <span id="50284" class="Symbol">{</span><a id="50285" href="#8937" class="InductiveConstructor">#Stream</a> <a id="50293" href="#50293" class="Bound">τ</a><span id="50294" class="Symbol">}</span>   <span id="50298" class="Symbol">=</span> <a id="50300" href="#49621" class="Function">!constructStream</a>

<span id="50318" class="Keyword">open</span> <a id="50323" href="#46630" class="Module">17:DenotationalIntroduction</a>



<span id="50354" class="Keyword">module</span> <a id="18:DenotationalElimination"></a><a id="50361" href="#50361" class="Module">18:DenotationalElimination</a> <span id="50388" class="Keyword">where</span>
  <span id="50396" class="Comment">{-
     18. Denotational semantics for elimination rules
  -}</span>

  <a id="18:DenotationalElimination.!eliminateArrow"></a><a id="50461" href="#50461" class="Function">!eliminateArrow</a> <span id="50477" class="Symbol">:</span> <span id="50479" class="Symbol">∀</span> <span id="50481" class="Symbol">{</span><a id="50482" href="#50482" class="Bound">ρ</a> <a id="50484" href="#50484" class="Bound">τ</a> <a id="50486" href="#50486" class="Bound">ϕ</a> <a id="50488" href="#50488" class="Bound">rule</a> <a id="50493" href="#50493" class="Bound">value</a><span id="50498" class="Symbol">}</span> <span id="50500" class="Symbol">→</span> <a id="50502" href="#15531" class="Datatype">AllElim</a> <a id="50510" href="#44065" class="Function">!Value</a> <span id="50517" class="Symbol">(</span><a id="50518" href="#50482" class="Bound">ρ</a> <a id="50520" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="50522" href="#50484" class="Bound">τ</a><span id="50523" class="Symbol">)</span> <a id="50525" href="#50486" class="Bound">ϕ</a> <a id="50527" href="#50488" class="Bound">rule</a> <span id="50532" class="Symbol">→</span> <a id="50534" href="#44065" class="Function">!Value</a> <span id="50541" class="Symbol">(</span><a id="50542" href="#50482" class="Bound">ρ</a> <a id="50544" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="50546" href="#50484" class="Bound">τ</a><span id="50547" class="Symbol">)</span> <a id="50549" href="#50493" class="Bound">value</a> <span id="50555" class="Symbol">→</span> <a id="50557" href="#45186" class="Function">!Thunk</a> <a id="50564" href="#50486" class="Bound">ϕ</a> <span id="50566" class="Symbol">(</span><a id="50567" href="#33596" class="Function">eliminate</a> <a id="50577" href="#50488" class="Bound">rule</a> <a id="50582" href="#50493" class="Bound">value</a><span id="50587" class="Symbol">)</span>
  <a id="50591" href="#50461" class="Function">!eliminateArrow</a> <span id="50607" class="Symbol">(</span><a id="50608" href="#15629" class="InductiveConstructor">mkAllElimArrow</a> <a id="50623" href="#50623" class="Bound">!v</a><span id="50625" class="Symbol">)</span> <span id="50627" class="Symbol">(</span><a id="50628" href="#41737" class="InductiveConstructor">!mkArrow</a> <a id="50637" href="#50637" class="Bound">!f</a><span id="50639" class="Symbol">)</span> <span id="50641" class="Symbol">=</span> <a id="50643" href="#50637" class="Bound">!f</a> <a id="50646" href="#50623" class="Bound">!v</a>

  <a id="18:DenotationalElimination.!eliminateSum"></a><a id="50652" href="#50652" class="Function">!eliminateSum</a> <span id="50666" class="Symbol">:</span> <span id="50668" class="Symbol">∀</span> <span id="50670" class="Symbol">{</span><a id="50671" href="#50671" class="Bound">τs</a> <a id="50674" href="#50674" class="Bound">ϕ</a> <a id="50676" href="#50676" class="Bound">rule</a> <a id="50681" href="#50681" class="Bound">value</a><span id="50686" class="Symbol">}</span> <span id="50688" class="Symbol">→</span> <a id="50690" href="#15531" class="Datatype">AllElim</a> <a id="50698" href="#44065" class="Function">!Value</a> <span id="50705" class="Symbol">(</span><a id="50706" href="#8677" class="InductiveConstructor">#Sum</a> <a id="50711" href="#50671" class="Bound">τs</a><span id="50713" class="Symbol">)</span> <a id="50715" href="#50674" class="Bound">ϕ</a> <a id="50717" href="#50676" class="Bound">rule</a> <span id="50722" class="Symbol">→</span> <a id="50724" href="#44065" class="Function">!Value</a> <span id="50731" class="Symbol">(</span><a id="50732" href="#8677" class="InductiveConstructor">#Sum</a> <a id="50737" href="#50671" class="Bound">τs</a><span id="50739" class="Symbol">)</span> <a id="50741" href="#50681" class="Bound">value</a> <span id="50747" class="Symbol">→</span> <a id="50749" href="#45186" class="Function">!Thunk</a> <a id="50756" href="#50674" class="Bound">ϕ</a> <span id="50758" class="Symbol">(</span><a id="50759" href="#33596" class="Function">eliminate</a> <a id="50769" href="#50676" class="Bound">rule</a> <a id="50774" href="#50681" class="Bound">value</a><span id="50779" class="Symbol">)</span>
  <a id="50783" href="#50652" class="Function">!eliminateSum</a> <span id="50797" class="Symbol">(</span><a id="50798" href="#15759" class="InductiveConstructor">mkAllElimSum</a> <span id="50811" class="Symbol">(</span><a id="50812" href="#50812" class="Bound">!f</a> <a id="50815" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="50817" href="#50817" class="Bound">!fs</a><span id="50820" class="Symbol">))</span> <span id="50823" class="Symbol">(</span><a id="50824" href="#41951" class="InductiveConstructor">!here</a> <a id="50830" href="#50830" class="Bound">!v</a><span id="50832" class="Symbol">)</span> <span id="50834" class="Symbol">=</span> <a id="50836" href="#39583" class="Function Operator">∗ₘ</a> <a id="50839" href="#39455" class="Function Operator">∗</a> <span id="50841" class="Symbol">(</span><a id="50842" href="#46485" class="Function">!apply</a> <a id="50849" href="#50812" class="Bound">!f</a> <a id="50852" href="#50830" class="Bound">!v</a><span id="50854" class="Symbol">)</span> <a id="50856" href="#40380" class="Function Operator">▹!</a> <span id="50859" class="Symbol">\</span> <a id="50861" href="#50861" class="Bound">!v'</a> <span id="50865" class="Symbol">→</span> <a id="50867" href="#39455" class="Function Operator">∗</a> <a id="50869" href="#39356" class="Function Operator">◽</a> <a id="50871" href="#50861" class="Bound">!v'</a>
  <a id="50877" href="#50652" class="Function">!eliminateSum</a> <span id="50891" class="Symbol">(</span><a id="50892" href="#15759" class="InductiveConstructor">mkAllElimSum</a> <span id="50905" class="Symbol">(</span><a id="50906" href="#50906" class="Bound">!f</a> <a id="50909" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="50911" href="#50911" class="Bound">!fs</a><span id="50914" class="Symbol">))</span> <span id="50917" class="Symbol">(</span><a id="50918" href="#42055" class="InductiveConstructor">!there</a> <span id="50925" class="Symbol">{</span><span id="50926" class="Argument">vᵢ</span> <span id="50929" class="Symbol">=</span> <a id="50931" href="#26540" class="InductiveConstructor">construct</a> <span id="50941" class="Symbol">(</span><a id="50942" href="#10102" class="InductiveConstructor">intrSum</a> <span id="50950" class="Symbol">_)}</span> <a id="50954" href="#50954" class="Bound">!vᵢ</a><span id="50957" class="Symbol">)</span> <span id="50959" class="Symbol">=</span> <a id="50961" href="#50652" class="Function">!eliminateSum</a> <span id="50975" class="Symbol">(</span><a id="50976" href="#15759" class="InductiveConstructor">mkAllElimSum</a> <a id="50989" href="#50911" class="Bound">!fs</a><span id="50992" class="Symbol">)</span> <a id="50994" href="#50954" class="Bound">!vᵢ</a>

  <a id="18:DenotationalElimination.!eliminateProduct"></a><a id="51001" href="#51001" class="Function">!eliminateProduct</a> <span id="51019" class="Symbol">:</span> <span id="51021" class="Symbol">∀</span> <span id="51023" class="Symbol">{</span><a id="51024" href="#51024" class="Bound">τs</a> <a id="51027" href="#51027" class="Bound">ϕ</a> <a id="51029" href="#51029" class="Bound">rule</a> <a id="51034" href="#51034" class="Bound">value</a><span id="51039" class="Symbol">}</span> <span id="51041" class="Symbol">→</span> <a id="51043" href="#15531" class="Datatype">AllElim</a> <a id="51051" href="#44065" class="Function">!Value</a> <span id="51058" class="Symbol">(</span><a id="51059" href="#8737" class="InductiveConstructor">#Product</a> <a id="51068" href="#51024" class="Bound">τs</a><span id="51070" class="Symbol">)</span> <a id="51072" href="#51027" class="Bound">ϕ</a> <a id="51074" href="#51029" class="Bound">rule</a> <span id="51079" class="Symbol">→</span> <a id="51081" href="#44065" class="Function">!Value</a> <span id="51088" class="Symbol">(</span><a id="51089" href="#8737" class="InductiveConstructor">#Product</a> <a id="51098" href="#51024" class="Bound">τs</a><span id="51100" class="Symbol">)</span> <a id="51102" href="#51034" class="Bound">value</a> <span id="51108" class="Symbol">→</span> <a id="51110" href="#45186" class="Function">!Thunk</a> <a id="51117" href="#51027" class="Bound">ϕ</a> <span id="51119" class="Symbol">(</span><a id="51120" href="#33596" class="Function">eliminate</a> <a id="51130" href="#51029" class="Bound">rule</a> <a id="51135" href="#51034" class="Bound">value</a><span id="51140" class="Symbol">)</span>
  <a id="51144" href="#51001" class="Function">!eliminateProduct</a> <span id="51162" class="Symbol">(</span><a id="51163" href="#15888" class="InductiveConstructor">mkAllElimProduct</a> <span id="51180" class="Symbol">(</span><a id="51181" href="#3288" class="InductiveConstructor">here</a> <a id="51186" href="#2690" class="InductiveConstructor">refl</a><span id="51190" class="Symbol">))</span> <span id="51193" class="Symbol">(</span><a id="51194" href="#42324" class="InductiveConstructor Operator">_∷!_</a> <span id="51199" class="Symbol">{</span><span id="51200" class="Argument">vs</span> <span id="51203" class="Symbol">=</span> <a id="51205" href="#26540" class="InductiveConstructor">construct</a> <span id="51215" class="Symbol">(</span><a id="51216" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="51228" class="Symbol">_)}</span> <a id="51232" href="#51232" class="Bound">!v</a> <a id="51235" href="#51235" class="Bound">!vs</a><span id="51238" class="Symbol">)</span> <span id="51240" class="Symbol">=</span> <a id="51242" href="#39583" class="Function Operator">∗ₘ</a> <a id="51245" href="#39356" class="Function Operator">◽</a> <a id="51247" href="#51232" class="Bound">!v</a>
  <a id="51252" href="#51001" class="Function">!eliminateProduct</a> <span id="51270" class="Symbol">(</span><a id="51271" href="#15888" class="InductiveConstructor">mkAllElimProduct</a> <span id="51288" class="Symbol">(</span><a id="51289" href="#3332" class="InductiveConstructor">there</a> <a id="51295" href="#51295" class="Bound">i</a><span id="51296" class="Symbol">))</span> <span id="51299" class="Symbol">(</span><a id="51300" href="#42324" class="InductiveConstructor Operator">_∷!_</a> <span id="51305" class="Symbol">{</span><span id="51306" class="Argument">vs</span> <span id="51309" class="Symbol">=</span> <a id="51311" href="#26540" class="InductiveConstructor">construct</a> <span id="51321" class="Symbol">(</span><a id="51322" href="#10248" class="InductiveConstructor">intrProduct</a> <span id="51334" class="Symbol">_)}</span> <a id="51338" href="#51338" class="Bound">!v</a> <a id="51341" href="#51341" class="Bound">!vs</a><span id="51344" class="Symbol">)</span> <span id="51346" class="Symbol">=</span> <a id="51348" href="#51001" class="Function">!eliminateProduct</a> <span id="51366" class="Symbol">(</span><a id="51367" href="#15888" class="InductiveConstructor">mkAllElimProduct</a> <a id="51384" href="#51295" class="Bound">i</a><span id="51385" class="Symbol">)</span> <a id="51387" href="#51341" class="Bound">!vs</a>

  <a id="18:DenotationalElimination.!eliminateNat"></a><a id="51394" href="#51394" class="Function">!eliminateNat</a> <span id="51408" class="Symbol">:</span> <span id="51410" class="Symbol">∀</span> <span id="51412" class="Symbol">{</span><a id="51413" href="#51413" class="Bound">ϕ</a> <a id="51415" href="#51415" class="Bound">rule</a> <a id="51420" href="#51420" class="Bound">value</a><span id="51425" class="Symbol">}</span> <span id="51427" class="Symbol">→</span> <a id="51429" href="#15531" class="Datatype">AllElim</a> <a id="51437" href="#44065" class="Function">!Value</a> <a id="51444" href="#8801" class="InductiveConstructor">#Nat</a> <a id="51449" href="#51413" class="Bound">ϕ</a> <a id="51451" href="#51415" class="Bound">rule</a> <span id="51456" class="Symbol">→</span> <a id="51458" href="#44065" class="Function">!Value</a> <a id="51465" href="#8801" class="InductiveConstructor">#Nat</a> <a id="51470" href="#51420" class="Bound">value</a> <span id="51476" class="Symbol">→</span> <a id="51478" href="#45186" class="Function">!Thunk</a> <a id="51485" href="#51413" class="Bound">ϕ</a> <span id="51487" class="Symbol">(</span><a id="51488" href="#33596" class="Function">eliminate</a> <a id="51498" href="#51415" class="Bound">rule</a> <a id="51503" href="#51420" class="Bound">value</a><span id="51508" class="Symbol">)</span>
  <a id="51512" href="#51394" class="Function">!eliminateNat</a> <span id="51526" class="Symbol">(</span><a id="51527" href="#16020" class="InductiveConstructor">mkAllElimNat</a> <a id="51540" href="#51540" class="Bound">!f</a><span id="51542" class="Symbol">)</span> <span id="51544" class="Symbol">(</span><a id="51545" href="#42955" class="InductiveConstructor">!mkNat</a> <a id="51552" href="#42747" class="InductiveConstructor">!nothing</a><span id="51560" class="Symbol">)</span> <span id="51562" class="Symbol">=</span>
      <a id="51570" href="#39583" class="Function Operator">∗ₘ</a> <a id="51573" href="#39455" class="Function Operator">∗</a> <a id="51575" href="#39455" class="Function Operator">∗</a> <a id="51577" href="#39455" class="Function Operator">∗</a> <a id="51579" href="#39455" class="Function Operator">∗</a> <a id="51581" href="#39455" class="Function Operator">∗</a> <a id="51583" href="#39455" class="Function Operator">∗</a> <a id="51585" href="#39455" class="Function Operator">∗</a> <a id="51587" href="#39455" class="Function Operator">∗</a> <a id="51589" href="#39455" class="Function Operator">∗</a> <span id="51591" class="Symbol">(</span><a id="51592" href="#46485" class="Function">!apply</a> <a id="51599" href="#51540" class="Bound">!f</a> <span id="51602" class="Symbol">(</span><a id="51603" href="#41951" class="InductiveConstructor">!here</a> <a id="51609" href="#42297" class="InductiveConstructor">!ε</a><span id="51611" class="Symbol">))</span> <a id="51614" href="#40380" class="Function Operator">▹!</a> <span id="51617" class="Symbol">\</span> <a id="51619" href="#51619" class="Bound">!v'</a> <span id="51623" class="Symbol">→</span>
      <a id="51631" href="#39455" class="Function Operator">∗</a> <a id="51633" href="#39356" class="Function Operator">◽</a> <a id="51635" href="#51619" class="Bound">!v'</a>
  <a id="51641" href="#51394" class="Function">!eliminateNat</a> <span id="51655" class="Symbol">(</span><a id="51656" href="#16020" class="InductiveConstructor">mkAllElimNat</a> <a id="51669" href="#51669" class="Bound">!f</a><span id="51671" class="Symbol">)</span> <span id="51673" class="Symbol">(</span><a id="51674" href="#42955" class="InductiveConstructor">!mkNat</a> <span id="51681" class="Symbol">(</span><a id="51682" href="#42781" class="InductiveConstructor">!just</a> <a id="51688" href="#51688" class="Bound">!n</a><span id="51690" class="Symbol">))</span> <span id="51693" class="Symbol">=</span>
      <a id="51701" href="#39583" class="Function Operator">∗ₘ</a> <a id="51704" href="#39455" class="Function Operator">∗</a> <a id="51706" href="#39455" class="Function Operator">∗</a> <a id="51708" href="#39455" class="Function Operator">∗</a> <a id="51710" href="#39455" class="Function Operator">∗</a> <a id="51712" href="#39455" class="Function Operator">∗</a> <span id="51714" class="Symbol">(</span><a id="51715" href="#51394" class="Function">!eliminateNat</a> <span id="51729" class="Symbol">(</span><a id="51730" href="#16020" class="InductiveConstructor">mkAllElimNat</a> <a id="51743" href="#51669" class="Bound">!f</a><span id="51745" class="Symbol">)</span> <a id="51747" href="#51688" class="Bound">!n</a><span id="51749" class="Symbol">)</span> <a id="51751" href="#40380" class="Function Operator">▹!</a> <span id="51754" class="Symbol">\</span> <a id="51756" href="#51756" class="Bound">!v'</a> <span id="51760" class="Symbol">→</span>
      <a id="51768" href="#39455" class="Function Operator">∗</a> <a id="51770" href="#39455" class="Function Operator">∗</a> <a id="51772" href="#39455" class="Function Operator">∗</a> <a id="51774" href="#39455" class="Function Operator">∗</a> <a id="51776" href="#39455" class="Function Operator">∗</a>    <span id="51781" class="Symbol">(</span><a id="51782" href="#46485" class="Function">!apply</a> <a id="51789" href="#51669" class="Bound">!f</a> <span id="51792" class="Symbol">(</span><a id="51793" href="#42055" class="InductiveConstructor">!there</a> <span id="51800" class="Symbol">(</span><a id="51801" href="#41951" class="InductiveConstructor">!here</a> <a id="51807" href="#51756" class="Bound">!v'</a><span id="51810" class="Symbol">)))</span>     <a id="51818" href="#40380" class="Function Operator">▹!</a> <span id="51821" class="Symbol">\</span> <a id="51823" href="#51823" class="Bound">!v''</a> <span id="51828" class="Symbol">→</span>
      <a id="51836" href="#39455" class="Function Operator">∗</a> <a id="51838" href="#39356" class="Function Operator">◽</a> <a id="51840" href="#51823" class="Bound">!v''</a>

  <a id="18:DenotationalElimination.!eliminateConat"></a><a id="51848" href="#51848" class="Function">!eliminateConat</a> <span id="51864" class="Symbol">:</span> <span id="51866" class="Symbol">∀</span> <span id="51868" class="Symbol">{</span><a id="51869" href="#51869" class="Bound">ϕ</a> <a id="51871" href="#51871" class="Bound">rule</a> <a id="51876" href="#51876" class="Bound">value</a><span id="51881" class="Symbol">}</span> <span id="51883" class="Symbol">→</span> <a id="51885" href="#15531" class="Datatype">AllElim</a> <a id="51893" href="#44065" class="Function">!Value</a> <a id="51900" href="#8853" class="InductiveConstructor">#Conat</a> <a id="51907" href="#51869" class="Bound">ϕ</a> <a id="51909" href="#51871" class="Bound">rule</a> <span id="51914" class="Symbol">→</span> <a id="51916" href="#44065" class="Function">!Value</a> <a id="51923" href="#8853" class="InductiveConstructor">#Conat</a> <a id="51930" href="#51876" class="Bound">value</a> <span id="51936" class="Symbol">→</span> <a id="51938" href="#45186" class="Function">!Thunk</a> <a id="51945" href="#51869" class="Bound">ϕ</a> <span id="51947" class="Symbol">(</span><a id="51948" href="#33596" class="Function">eliminate</a> <a id="51958" href="#51871" class="Bound">rule</a> <a id="51963" href="#51876" class="Bound">value</a><span id="51968" class="Symbol">)</span>
  <a id="51972" href="#51848" class="Function">!eliminateConat</a> <a id="51988" href="#16148" class="InductiveConstructor">mkAllElimConat</a> <span id="52003" class="Symbol">(</span><a id="52004" href="#43427" class="InductiveConstructor">!mkConat</a> <a id="52013" href="#52013" class="Bound">!v</a><span id="52015" class="Symbol">)</span> <span id="52017" class="Symbol">=</span>
      <a id="52025" href="#39583" class="Function Operator">∗ₘ</a> <a id="52028" href="#39455" class="Function Operator">∗</a> <span id="52030" class="Symbol">(</span><a id="52031" href="#43156" class="Field">!forceConat</a> <a id="52043" href="#52013" class="Bound">!v</a><span id="52045" class="Symbol">)</span> <a id="52047" href="#40380" class="Function Operator">▹!</a> <span id="52050" class="Symbol">\</span>
      <span id="52058" class="Symbol">{</span>  <a id="52061" href="#42747" class="InductiveConstructor">!nothing</a>   <span id="52072" class="Symbol">→</span> <a id="52074" href="#39455" class="Function Operator">∗</a> <a id="52076" href="#39455" class="Function Operator">∗</a> <a id="52078" href="#39455" class="Function Operator">∗</a> <a id="52080" href="#39455" class="Function Operator">∗</a> <a id="52082" href="#39455" class="Function Operator">∗</a> <a id="52084" href="#39455" class="Function Operator">∗</a> <a id="52086" href="#39455" class="Function Operator">∗</a> <a id="52088" href="#39455" class="Function Operator">∗</a> <a id="52090" href="#39455" class="Function Operator">∗</a> <a id="52092" href="#39356" class="Function Operator">◽</a> <span id="52094" class="Symbol">(</span><a id="52095" href="#41951" class="InductiveConstructor">!here</a> <a id="52101" href="#42297" class="InductiveConstructor">!ε</a><span id="52103" class="Symbol">)</span>
      <span id="52111" class="Symbol">;</span> <span id="52113" class="Symbol">(</span><a id="52114" href="#42781" class="InductiveConstructor">!just</a> <a id="52120" href="#52120" class="Bound">!v'</a><span id="52123" class="Symbol">)</span> <span id="52125" class="Symbol">→</span> <a id="52127" href="#39455" class="Function Operator">∗</a> <a id="52129" href="#39455" class="Function Operator">∗</a> <a id="52131" href="#39455" class="Function Operator">∗</a> <a id="52133" href="#39455" class="Function Operator">∗</a> <a id="52135" href="#39455" class="Function Operator">∗</a> <a id="52137" href="#39455" class="Function Operator">∗</a> <a id="52139" href="#39455" class="Function Operator">∗</a> <a id="52141" href="#39455" class="Function Operator">∗</a> <a id="52143" href="#39455" class="Function Operator">∗</a> <a id="52145" href="#39356" class="Function Operator">◽</a> <span id="52147" class="Symbol">(</span><a id="52148" href="#42055" class="InductiveConstructor">!there</a> <span id="52155" class="Symbol">(</span><a id="52156" href="#41951" class="InductiveConstructor">!here</a> <span id="52162" class="Symbol">(</span><a id="52163" href="#43427" class="InductiveConstructor">!mkConat</a> <a id="52172" href="#52120" class="Bound">!v'</a><span id="52175" class="Symbol">)))</span>
      <span id="52185" class="Symbol">}</span>

  <a id="18:DenotationalElimination.!eliminateStream"></a><a id="52190" href="#52190" class="Function">!eliminateStream</a> <span id="52207" class="Symbol">:</span> <span id="52209" class="Symbol">∀</span> <span id="52211" class="Symbol">{</span><a id="52212" href="#52212" class="Bound">τ</a> <a id="52214" href="#52214" class="Bound">ϕ</a> <a id="52216" href="#52216" class="Bound">rule</a> <a id="52221" href="#52221" class="Bound">value</a><span id="52226" class="Symbol">}</span> <span id="52228" class="Symbol">→</span> <a id="52230" href="#15531" class="Datatype">AllElim</a> <a id="52238" href="#44065" class="Function">!Value</a> <span id="52245" class="Symbol">(</span><a id="52246" href="#8937" class="InductiveConstructor">#Stream</a> <a id="52254" href="#52212" class="Bound">τ</a><span id="52255" class="Symbol">)</span> <a id="52257" href="#52214" class="Bound">ϕ</a> <a id="52259" href="#52216" class="Bound">rule</a> <span id="52264" class="Symbol">→</span> <a id="52266" href="#44065" class="Function">!Value</a> <span id="52273" class="Symbol">(</span><a id="52274" href="#8937" class="InductiveConstructor">#Stream</a> <a id="52282" href="#52212" class="Bound">τ</a><span id="52283" class="Symbol">)</span> <a id="52285" href="#52221" class="Bound">value</a> <span id="52291" class="Symbol">→</span> <a id="52293" href="#45186" class="Function">!Thunk</a> <a id="52300" href="#52214" class="Bound">ϕ</a> <span id="52302" class="Symbol">(</span><a id="52303" href="#33596" class="Function">eliminate</a> <a id="52313" href="#52216" class="Bound">rule</a> <a id="52318" href="#52221" class="Bound">value</a><span id="52323" class="Symbol">)</span>
  <a id="52327" href="#52190" class="Function">!eliminateStream</a> <a id="52344" href="#16275" class="InductiveConstructor">mkAllElimStream</a> <span id="52360" class="Symbol">(</span><a id="52361" href="#43950" class="InductiveConstructor">!mkStream</a> <a id="52371" href="#52371" class="Bound">!v</a><span id="52373" class="Symbol">)</span> <span id="52375" class="Symbol">=</span>
      <a id="52383" href="#39583" class="Function Operator">∗ₘ</a> <a id="52386" href="#39455" class="Function Operator">∗</a> <span id="52388" class="Symbol">(</span><a id="52389" href="#43658" class="Field">!forceStream</a> <a id="52402" href="#52371" class="Bound">!v</a><span id="52404" class="Symbol">)</span> <a id="52406" href="#40380" class="Function Operator">▹!</a> <span id="52409" class="Symbol">\</span>
      <span id="52417" class="Symbol">{</span> <span id="52419" class="Symbol">(</span><a id="52420" href="#52420" class="Bound">!u</a> <a id="52423" href="#42577" class="InductiveConstructor Operator">,</a> <a id="52425" href="#52425" class="Bound">!v'</a><span id="52428" class="Symbol">)</span> <span id="52430" class="Symbol">→</span> <a id="52432" href="#39455" class="Function Operator">∗</a> <a id="52434" href="#39455" class="Function Operator">∗</a> <a id="52436" href="#39455" class="Function Operator">∗</a> <a id="52438" href="#39455" class="Function Operator">∗</a> <a id="52440" href="#39455" class="Function Operator">∗</a> <a id="52442" href="#39455" class="Function Operator">∗</a> <a id="52444" href="#39455" class="Function Operator">∗</a> <a id="52446" href="#39356" class="Function Operator">◽</a> <span id="52448" class="Symbol">(</span><a id="52449" href="#52420" class="Bound">!u</a> <a id="52452" href="#42324" class="InductiveConstructor Operator">∷!</a> <a id="52455" href="#43950" class="InductiveConstructor">!mkStream</a> <a id="52465" href="#52425" class="Bound">!v'</a> <a id="52469" href="#42324" class="InductiveConstructor Operator">∷!</a> <a id="52472" href="#42297" class="InductiveConstructor">!ε</a><span id="52474" class="Symbol">)</span> <span id="52476" class="Symbol">}</span>

  <span id="52481" class="Comment">-- Given denotations for all components of a run-time elimination rule and denotation for</span>
  <span id="52573" class="Comment">-- a value, returns denotation for the result of applying the rule to the value</span>
  <a id="18:DenotationalElimination.!eliminate"></a><a id="52655" href="#52655" class="Function">!eliminate</a> <span id="52666" class="Symbol">:</span> <span id="52668" class="Symbol">∀</span> <span id="52670" class="Symbol">{</span><a id="52671" href="#52671" class="Bound">τ</a> <a id="52673" href="#52673" class="Bound">ϕ</a> <a id="52675" href="#52675" class="Bound">rule</a> <a id="52680" href="#52680" class="Bound">value</a><span id="52685" class="Symbol">}</span> <span id="52687" class="Symbol">→</span> <a id="52689" href="#15531" class="Datatype">AllElim</a> <a id="52697" href="#44065" class="Function">!Value</a> <a id="52704" href="#52671" class="Bound">τ</a> <a id="52706" href="#52673" class="Bound">ϕ</a> <a id="52708" href="#52675" class="Bound">rule</a> <span id="52713" class="Symbol">→</span> <a id="52715" href="#44065" class="Function">!Value</a> <a id="52722" href="#52671" class="Bound">τ</a> <a id="52724" href="#52680" class="Bound">value</a> <span id="52730" class="Symbol">→</span> <a id="52732" href="#45186" class="Function">!Thunk</a> <a id="52739" href="#52673" class="Bound">ϕ</a> <span id="52741" class="Symbol">(</span><a id="52742" href="#33596" class="Function">eliminate</a> <a id="52752" href="#52675" class="Bound">rule</a> <a id="52757" href="#52680" class="Bound">value</a><span id="52762" class="Symbol">)</span>
  <a id="52766" href="#52655" class="Function">!eliminate</a> <span id="52777" class="Symbol">{</span><a id="52778" href="#52778" class="Bound">ρ</a> <a id="52780" href="#8631" class="InductiveConstructor Operator">⇒</a> <a id="52782" href="#52782" class="Bound">τ</a><span id="52783" class="Symbol">}</span>       <span id="52791" class="Symbol">=</span> <a id="52793" href="#50461" class="Function">!eliminateArrow</a>
  <a id="52811" href="#52655" class="Function">!eliminate</a> <span id="52822" class="Symbol">{</span><a id="52823" href="#8677" class="InductiveConstructor">#Sum</a> <a id="52828" href="#52828" class="Bound">τs</a><span id="52830" class="Symbol">}</span>     <span id="52836" class="Symbol">=</span> <a id="52838" href="#50652" class="Function">!eliminateSum</a>
  <a id="52854" href="#52655" class="Function">!eliminate</a> <span id="52865" class="Symbol">{</span><a id="52866" href="#8737" class="InductiveConstructor">#Product</a> <a id="52875" href="#52875" class="Bound">τs</a><span id="52877" class="Symbol">}</span> <span id="52879" class="Symbol">=</span> <a id="52881" href="#51001" class="Function">!eliminateProduct</a>
  <a id="52901" href="#52655" class="Function">!eliminate</a> <span id="52912" class="Symbol">{</span><a id="52913" href="#8801" class="InductiveConstructor">#Nat</a><span id="52917" class="Symbol">}</span>        <span id="52926" class="Symbol">=</span> <a id="52928" href="#51394" class="Function">!eliminateNat</a>
  <a id="52944" href="#52655" class="Function">!eliminate</a> <span id="52955" class="Symbol">{</span><a id="52956" href="#8853" class="InductiveConstructor">#Conat</a><span id="52962" class="Symbol">}</span>      <span id="52969" class="Symbol">=</span> <a id="52971" href="#51848" class="Function">!eliminateConat</a>
  <a id="52989" href="#52655" class="Function">!eliminate</a> <span id="53000" class="Symbol">{</span><a id="53001" href="#8937" class="InductiveConstructor">#Stream</a> <a id="53009" href="#53009" class="Bound">τ</a><span id="53010" class="Symbol">}</span>   <span id="53014" class="Symbol">=</span> <a id="53016" href="#52190" class="Function">!eliminateStream</a>

<span id="53034" class="Keyword">open</span> <a id="53039" href="#50361" class="Module">18:DenotationalElimination</a>



<span id="53069" class="Keyword">module</span> <a id="19:Denotational"></a><a id="53076" href="#53076" class="Module">19:Denotational</a> <span id="53092" class="Keyword">where</span>
  <span id="53100" class="Comment">{-
     19. Denotational semantics for the whole calculus
  -}</span>

  <span id="53166" class="Comment">-- Placeholder predicate with a single constructor</span>
  <span id="53219" class="Keyword">data</span> <a id="19:Denotational.!Has"></a><a id="53224" href="#53224" class="Datatype">!Has</a> <span id="53229" class="Symbol">(</span><a id="53230" href="#53230" class="Bound">Γ</a> <span id="53232" class="Symbol">:</span> <a id="53234" href="#2771" class="Datatype">List</a> <a id="53239" href="#8610" class="Datatype">Type</a><span id="53243" class="Symbol">)</span> <span id="53245" class="Symbol">(</span><a id="53246" href="#53246" class="Bound">τ</a> <span id="53248" class="Symbol">:</span> <a id="53250" href="#8610" class="Datatype">Type</a><span id="53254" class="Symbol">)</span> <span id="53256" class="Symbol">:</span> <a id="53258" href="#3432" class="Function">Has</a> <a id="53262" href="#53230" class="Bound">Γ</a> <a id="53264" href="#53246" class="Bound">τ</a> <span id="53266" class="Symbol">→</span> <span id="53268" class="PrimitiveType">Set</span> <span id="53272" class="Keyword">where</span>
    <a id="19:Denotational.!Has.!mkHas"></a><a id="53282" href="#53282" class="InductiveConstructor">!mkHas</a> <span id="53289" class="Symbol">:</span> <span id="53291" class="Symbol">(</span><a id="53292" href="#53292" class="Bound">x</a> <span id="53294" class="Symbol">:</span> <a id="53296" href="#3432" class="Function">Has</a> <a id="53300" href="#53230" class="Bound">Γ</a> <a id="53302" href="#53246" class="Bound">τ</a><span id="53303" class="Symbol">)</span> <span id="53305" class="Symbol">→</span> <a id="53307" href="#53224" class="Datatype">!Has</a> <a id="53312" href="#53230" class="Bound">Γ</a> <a id="53314" href="#53246" class="Bound">τ</a> <a id="53316" href="#53292" class="Bound">x</a>

  <span id="53321" class="Comment">-- 'AllTerm %P Γ τ term' states that each subterm of 'term' satisfies '%P'</span>
  <span id="53398" class="Keyword">data</span> <a id="19:Denotational.AllTerm"></a><a id="53403" href="#53403" class="Datatype">AllTerm</a> <span id="53411" class="Symbol">(</span><a id="53412" href="#53412" class="Bound">%P</a> <span id="53415" class="Symbol">:</span> <span id="53417" class="Symbol">∀</span> <a id="53419" href="#53419" class="Bound">Γ</a> <a id="53421" href="#53421" class="Bound">τ</a> <span id="53423" class="Symbol">→</span> <a id="53425" href="#21673" class="Datatype">TermC</a> <a id="53431" href="#53419" class="Bound">Γ</a> <a id="53433" href="#53421" class="Bound">τ</a> <span id="53435" class="Symbol">→</span> <span id="53437" class="PrimitiveType">Set</span><span id="53440" class="Symbol">)</span> <span id="53442" class="Symbol">:</span> <span id="53444" class="Symbol">∀</span> <a id="53446" href="#53446" class="Bound">Γ</a> <a id="53448" href="#53448" class="Bound">τ</a> <span id="53450" class="Symbol">→</span> <a id="53452" href="#21673" class="Datatype">TermC</a> <a id="53458" href="#53446" class="Bound">Γ</a> <a id="53460" href="#53448" class="Bound">τ</a> <span id="53462" class="Symbol">→</span> <span id="53464" class="PrimitiveType">Set</span> <span id="53468" class="Keyword">where</span>
    <a id="19:Denotational.AllTerm.mkAllTermReturn"></a><a id="53478" href="#53478" class="InductiveConstructor">mkAllTermReturn</a> <span id="53494" class="Symbol">:</span> <span id="53496" class="Symbol">∀</span> <span id="53498" class="Symbol">{</span><a id="53499" href="#53499" class="Bound">Γ</a> <a id="53501" href="#53501" class="Bound">τ</a><span id="53502" class="Symbol">}</span> <span id="53504" class="Symbol">→</span> <span id="53506" class="Symbol">(</span><a id="53507" href="#53507" class="Bound">x</a> <span id="53509" class="Symbol">:</span> <a id="53511" href="#3432" class="Function">Has</a> <a id="53515" href="#53499" class="Bound">Γ</a> <a id="53517" href="#53501" class="Bound">τ</a><span id="53518" class="Symbol">)</span> <span id="53520" class="Symbol">→</span> <a id="53522" href="#53403" class="Datatype">AllTerm</a> <a id="53530" href="#53412" class="Bound">%P</a> <a id="53533" href="#53499" class="Bound">Γ</a> <a id="53535" href="#53501" class="Bound">τ</a> <span id="53537" class="Symbol">(</span><a id="53538" href="#21778" class="InductiveConstructor">return</a> <a id="53545" href="#53507" class="Bound">x</a><span id="53546" class="Symbol">)</span>
    <a id="19:Denotational.AllTerm.mkAllTermIntr"></a><a id="53552" href="#53552" class="InductiveConstructor">mkAllTermIntr</a>
        <span id="53574" class="Symbol">:</span> <span id="53576" class="Symbol">∀</span> <span id="53578" class="Symbol">{</span><a id="53579" href="#53579" class="Bound">Γ</a> <a id="53581" href="#53581" class="Bound">σ</a> <a id="53583" href="#53583" class="Bound">τ</a> <a id="53585" href="#53585" class="Bound">rule</a> <a id="53590" href="#53590" class="Bound">term</a><span id="53594" class="Symbol">}</span>
        <span id="53604" class="Symbol">→</span> <a id="53606" href="#14464" class="Datatype">AllIntr</a> <span id="53614" class="Symbol">(\</span><a id="53616" href="#53616" class="Bound">ρ</a> <a id="53618" href="#53618" class="Bound">τ</a> <span id="53620" class="Symbol">→</span> <a id="53622" href="#53412" class="Bound">%P</a> <span id="53625" class="Symbol">(</span><a id="53626" href="#53616" class="Bound">ρ</a> <a id="53628" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="53630" href="#53579" class="Bound">Γ</a><span id="53631" class="Symbol">)</span> <a id="53633" href="#53618" class="Bound">τ</a><span id="53634" class="Symbol">)</span> <span id="53636" class="Symbol">(</span><a id="53637" href="#53224" class="Datatype">!Has</a> <a id="53642" href="#53579" class="Bound">Γ</a><span id="53643" class="Symbol">)</span> <a id="53645" href="#53581" class="Bound">σ</a> <a id="53647" href="#53585" class="Bound">rule</a> <span id="53652" class="Symbol">→</span> <a id="53654" href="#53403" class="Datatype">AllTerm</a> <a id="53662" href="#53412" class="Bound">%P</a> <span id="53665" class="Symbol">(</span><a id="53666" href="#53581" class="Bound">σ</a> <a id="53668" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="53670" href="#53579" class="Bound">Γ</a><span id="53671" class="Symbol">)</span> <a id="53673" href="#53583" class="Bound">τ</a> <a id="53675" href="#53590" class="Bound">term</a> <span id="53680" class="Symbol">→</span> <a id="53682" href="#53403" class="Datatype">AllTerm</a> <a id="53690" href="#53412" class="Bound">%P</a> <a id="53693" href="#53579" class="Bound">Γ</a> <a id="53695" href="#53583" class="Bound">τ</a> <span id="53697" class="Symbol">(</span><a id="53698" href="#12591" class="InductiveConstructor">intr</a> <a id="53703" href="#53585" class="Bound">rule</a> <a id="53708" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="53710" href="#53590" class="Bound">term</a><span id="53714" class="Symbol">)</span>
    <a id="19:Denotational.AllTerm.mkAllTermElim"></a><a id="53720" href="#53720" class="InductiveConstructor">mkAllTermElim</a>
        <span id="53742" class="Symbol">:</span> <span id="53744" class="Symbol">∀</span> <span id="53746" class="Symbol">{</span><a id="53747" href="#53747" class="Bound">Γ</a> <a id="53749" href="#53749" class="Bound">ρ</a> <a id="53751" href="#53751" class="Bound">σ</a> <a id="53753" href="#53753" class="Bound">τ</a> <a id="53755" href="#53755" class="Bound">rule</a> <a id="53760" href="#53760" class="Bound">term</a><span id="53764" class="Symbol">}</span>
        <span id="53774" class="Symbol">→</span> <span id="53776" class="Symbol">(</span><a id="53777" href="#53777" class="Bound">x</a> <span id="53779" class="Symbol">:</span> <a id="53781" href="#3432" class="Function">Has</a> <a id="53785" href="#53747" class="Bound">Γ</a> <a id="53787" href="#53749" class="Bound">ρ</a><span id="53788" class="Symbol">)</span> <span id="53790" class="Symbol">→</span> <a id="53792" href="#15531" class="Datatype">AllElim</a> <span id="53800" class="Symbol">(</span><a id="53801" href="#53224" class="Datatype">!Has</a> <a id="53806" href="#53747" class="Bound">Γ</a><span id="53807" class="Symbol">)</span> <a id="53809" href="#53749" class="Bound">ρ</a> <a id="53811" href="#53751" class="Bound">σ</a> <a id="53813" href="#53755" class="Bound">rule</a> <span id="53818" class="Symbol">→</span> <a id="53820" href="#53403" class="Datatype">AllTerm</a> <a id="53828" href="#53412" class="Bound">%P</a> <span id="53831" class="Symbol">(</span><a id="53832" href="#53751" class="Bound">σ</a> <a id="53834" href="#2819" class="InductiveConstructor Operator">∷</a> <a id="53836" href="#53747" class="Bound">Γ</a><span id="53837" class="Symbol">)</span> <a id="53839" href="#53753" class="Bound">τ</a> <a id="53841" href="#53760" class="Bound">term</a> <span id="53846" class="Symbol">→</span> <a id="53848" href="#53403" class="Datatype">AllTerm</a> <a id="53856" href="#53412" class="Bound">%P</a> <a id="53859" href="#53747" class="Bound">Γ</a> <a id="53861" href="#53753" class="Bound">τ</a> <span id="53863" class="Symbol">(</span><a id="53864" href="#12666" class="InductiveConstructor">elim</a> <a id="53869" href="#53777" class="Bound">x</a> <a id="53871" href="#53755" class="Bound">rule</a> <a id="53876" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="53878" href="#53760" class="Bound">term</a><span id="53882" class="Symbol">)</span>

  <span id="53887" class="Comment">-- Denotational variant of '<a class="comment-link" href="#11:Operational.plugEnvIntr">plugEnvIntr</a>' function from section 11</span>
  <a id="19:Denotational.!plugEnvIntr"></a><a id="53986" href="#53986" class="Function">!plugEnvIntr</a>
      <span id="54005" class="Symbol">:</span> <span id="54007" class="Symbol">∀</span> <span id="54009" class="Symbol">{</span><a id="54010" href="#54010" class="Bound">Γ</a> <a id="54012" href="#54012" class="Bound">τ</a> <a id="54014" href="#54014" class="Bound">env</a> <a id="54018" href="#54018" class="Bound">rule</a><span id="54022" class="Symbol">}</span>
      <span id="54030" class="Symbol">→</span> <a id="54032" href="#45346" class="Function">!Env</a> <a id="54037" href="#54010" class="Bound">Γ</a> <a id="54039" href="#54014" class="Bound">env</a> <span id="54043" class="Symbol">→</span> <a id="54045" href="#14464" class="Datatype">AllIntr</a> <span id="54053" class="Symbol">(</span><a id="54054" href="#46328" class="Function">!AbsTermC</a> <a id="54064" href="#54010" class="Bound">Γ</a><span id="54065" class="Symbol">)</span> <span id="54067" class="Symbol">(</span><a id="54068" href="#53224" class="Datatype">!Has</a> <a id="54073" href="#54010" class="Bound">Γ</a><span id="54074" class="Symbol">)</span> <a id="54076" href="#54012" class="Bound">τ</a> <a id="54078" href="#54018" class="Bound">rule</a> <span id="54083" class="Symbol">→</span> <a id="54085" href="#14464" class="Datatype">AllIntr</a> <a id="54093" href="#45558" class="Function">!Closure</a> <a id="54102" href="#44065" class="Function">!Value</a> <a id="54109" href="#54012" class="Bound">τ</a> <span id="54111" class="Symbol">(</span><a id="54112" href="#34146" class="Function">plugEnvIntr</a> <a id="54124" href="#54014" class="Bound">env</a> <a id="54128" href="#54018" class="Bound">rule</a><span id="54132" class="Symbol">)</span>
  <a id="54136" href="#53986" class="Function">!plugEnvIntr</a> <span id="54149" class="Symbol">{</span><a id="54150" href="#54150" class="Bound">Γ</a><span id="54151" class="Symbol">}</span> <span id="54153" class="Symbol">{</span><a id="54154" href="#54154" class="Bound">τ</a><span id="54155" class="Symbol">}</span> <span id="54157" class="Symbol">{</span><a id="54158" href="#54158" class="Bound">env</a><span id="54161" class="Symbol">}</span> <span id="54163" class="Symbol">{</span><a id="54164" href="#54164" class="Bound">rule</a><span id="54168" class="Symbol">}</span> <a id="54170" href="#54170" class="Bound">!env</a> <a id="54175" href="#54175" class="Bound">!rule</a> <span id="54181" class="Symbol">=</span>
      <a id="54189" href="#16434" class="Function">mapAllIntr</a> <span id="54200" class="Symbol">(\</span><a id="54202" href="#54202" class="Bound">term</a> <span id="54207" class="Symbol">→</span> <a id="54209" href="#54158" class="Bound">env</a> <a id="54213" href="#26771" class="InductiveConstructor Operator">&amp;</a> <a id="54215" href="#54202" class="Bound">term</a><span id="54219" class="Symbol">)</span> <span id="54221" class="Symbol">(\</span><a id="54223" href="#54223" class="Bound">x</a> <span id="54225" class="Symbol">→</span> <a id="54227" href="#6595" class="Function">get</a> <a id="54231" href="#54158" class="Bound">env</a> <a id="54235" href="#54223" class="Bound">x</a><span id="54236" class="Symbol">)</span>
        <span id="54246" class="Symbol">(\{</span><a id="54249" href="#54249" class="Bound">_</a><span id="54250" class="Symbol">}</span> <a id="54252" href="#54252" class="Bound">!term</a> <span id="54258" class="Symbol">{</span><a id="54259" href="#54259" class="Bound">_</a><span id="54260" class="Symbol">}</span> <a id="54262" href="#54262" class="Bound">!v</a> <span id="54265" class="Symbol">→</span> <a id="54267" href="#54252" class="Bound">!term</a> <span id="54273" class="Symbol">(</span><a id="54274" href="#54262" class="Bound">!v</a> <a id="54277" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="54279" href="#54170" class="Bound">!env</a><span id="54283" class="Symbol">)</span> <a id="54285" href="#37965" class="InductiveConstructor">!finish</a><span id="54292" class="Symbol">)</span>
        <span id="54302" class="Symbol">(\{</span> <span id="54306" class="Symbol">(</span><a id="54307" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="54314" href="#54314" class="Bound">x</a><span id="54315" class="Symbol">)</span> <span id="54317" class="Symbol">→</span> <a id="54319" href="#6771" class="Function">get2</a> <a id="54324" href="#54170" class="Bound">!env</a> <a id="54329" href="#54314" class="Bound">x</a> <span id="54331" class="Symbol">})</span>
        <a id="54342" href="#54175" class="Bound">!rule</a>

  <span id="54351" class="Comment">-- Denotational variant of '<a class="comment-link" href="#11:Operational.plugEnvElim">plugEnvElim</a>' function from section 11</span>
  <a id="19:Denotational.!plugEnvElim"></a><a id="54450" href="#54450" class="Function">!plugEnvElim</a> <span id="54463" class="Symbol">:</span> <span id="54465" class="Symbol">∀</span> <span id="54467" class="Symbol">{</span><a id="54468" href="#54468" class="Bound">Γ</a> <a id="54470" href="#54470" class="Bound">τ</a> <a id="54472" href="#54472" class="Bound">ϕ</a> <a id="54474" href="#54474" class="Bound">env</a> <a id="54478" href="#54478" class="Bound">rule</a><span id="54482" class="Symbol">}</span> <span id="54484" class="Symbol">→</span> <a id="54486" href="#45346" class="Function">!Env</a> <a id="54491" href="#54468" class="Bound">Γ</a> <a id="54493" href="#54474" class="Bound">env</a> <span id="54497" class="Symbol">→</span> <a id="54499" href="#15531" class="Datatype">AllElim</a> <span id="54507" class="Symbol">(</span><a id="54508" href="#53224" class="Datatype">!Has</a> <a id="54513" href="#54468" class="Bound">Γ</a><span id="54514" class="Symbol">)</span> <a id="54516" href="#54470" class="Bound">τ</a> <a id="54518" href="#54472" class="Bound">ϕ</a> <a id="54520" href="#54478" class="Bound">rule</a> <span id="54525" class="Symbol">→</span> <a id="54527" href="#15531" class="Datatype">AllElim</a> <a id="54535" href="#44065" class="Function">!Value</a> <a id="54542" href="#54470" class="Bound">τ</a> <a id="54544" href="#54472" class="Bound">ϕ</a> <span id="54546" class="Symbol">(</span><a id="54547" href="#34409" class="Function">plugEnvElim</a> <a id="54559" href="#54474" class="Bound">env</a> <a id="54563" href="#54478" class="Bound">rule</a><span id="54567" class="Symbol">)</span>
  <a id="54571" href="#54450" class="Function">!plugEnvElim</a> <span id="54584" class="Symbol">{</span><a id="54585" href="#54585" class="Bound">Γ</a><span id="54586" class="Symbol">}</span> <span id="54588" class="Symbol">{</span><a id="54589" href="#54589" class="Bound">τ</a><span id="54590" class="Symbol">}</span> <span id="54592" class="Symbol">{</span><a id="54593" href="#54593" class="Bound">ϕ</a><span id="54594" class="Symbol">}</span> <span id="54596" class="Symbol">{</span><a id="54597" href="#54597" class="Bound">env</a><span id="54600" class="Symbol">}</span> <a id="54602" href="#54602" class="Bound">!env</a> <a id="54607" href="#54607" class="Bound">!rule</a> <span id="54613" class="Symbol">=</span> <a id="54615" href="#17695" class="Function">mapAllElim</a> <span id="54626" class="Symbol">(\</span><a id="54628" href="#54628" class="Bound">x</a> <span id="54630" class="Symbol">→</span> <a id="54632" href="#6595" class="Function">get</a> <a id="54636" href="#54597" class="Bound">env</a> <a id="54640" href="#54628" class="Bound">x</a><span id="54641" class="Symbol">)</span> <span id="54643" class="Symbol">(\{</span> <span id="54647" class="Symbol">(</span><a id="54648" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="54655" href="#54655" class="Bound">x</a><span id="54656" class="Symbol">)</span> <span id="54658" class="Symbol">→</span> <a id="54660" href="#6771" class="Function">get2</a> <a id="54665" href="#54602" class="Bound">!env</a> <a id="54670" href="#54655" class="Bound">x</a> <span id="54672" class="Symbol">})</span> <a id="54675" href="#54607" class="Bound">!rule</a>

  <span id="54684" class="Comment">-- Denotational variant of '<a class="comment-link" href="#11:Operational.reduce">reduce</a>' function from section 11</span>
  <a id="19:Denotational.!reduce"></a><a id="54773" href="#54773" class="Function">!reduce</a>
      <span id="54787" class="Symbol">:</span> <span id="54789" class="Symbol">∀</span> <span id="54791" class="Symbol">{</span><a id="54792" href="#54792" class="Bound">Γ</a> <a id="54794" href="#54794" class="Bound">τ</a> <a id="54796" href="#54796" class="Bound">ϕ</a> <a id="54798" href="#54798" class="Bound">env</a> <a id="54802" href="#54802" class="Bound">term</a> <a id="54807" href="#54807" class="Bound">stack</a><span id="54812" class="Symbol">}</span>
      <span id="54820" class="Symbol">→</span> <a id="54822" href="#45346" class="Function">!Env</a> <a id="54827" href="#54792" class="Bound">Γ</a> <a id="54829" href="#54798" class="Bound">env</a> <span id="54833" class="Symbol">→</span> <a id="54835" href="#53403" class="Datatype">AllTerm</a> <a id="54843" href="#46106" class="Function">!TermC</a> <a id="54850" href="#54792" class="Bound">Γ</a> <a id="54852" href="#54794" class="Bound">τ</a> <a id="54854" href="#54802" class="Bound">term</a> <span id="54859" class="Symbol">→</span> <a id="54861" href="#45864" class="Function">!CallStack</a> <a id="54872" href="#54794" class="Bound">τ</a> <a id="54874" href="#54796" class="Bound">ϕ</a> <a id="54876" href="#54807" class="Bound">stack</a>
      <span id="54888" class="Symbol">→</span> <a id="54890" href="#44729" class="Function">!Step</a> <a id="54896" href="#54796" class="Bound">ϕ</a> <span id="54898" class="Symbol">(</span><a id="54899" href="#34608" class="Function">reduce</a> <span id="54906" class="Symbol">((</span><a id="54908" href="#54798" class="Bound">env</a> <a id="54912" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="54914" href="#54802" class="Bound">term</a><span id="54918" class="Symbol">)</span> <a id="54920" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="54922" href="#54807" class="Bound">stack</a><span id="54927" class="Symbol">))</span>
  <a id="54932" href="#54773" class="Function">!reduce</a> <a id="54940" href="#54940" class="Bound">!env</a> <span id="54945" class="Symbol">(</span><a id="54946" href="#53478" class="InductiveConstructor">mkAllTermReturn</a> <a id="54962" href="#54962" class="Bound">x</a><span id="54963" class="Symbol">)</span> <a id="54965" href="#54965" class="Bound">!stack</a> <span id="54972" class="Symbol">=</span> <a id="54974" href="#54965" class="Bound">!stack</a> <span id="54981" class="Symbol">(</span><a id="54982" href="#6771" class="Function">get2</a> <a id="54987" href="#54940" class="Bound">!env</a> <a id="54992" href="#54962" class="Bound">x</a><span id="54993" class="Symbol">)</span>
  <a id="54997" href="#54773" class="Function">!reduce</a> <a id="55005" href="#55005" class="Bound">!env</a> <span id="55010" class="Symbol">(</span><a id="55011" href="#53552" class="InductiveConstructor">mkAllTermIntr</a> <a id="55025" href="#55025" class="Bound">!rule</a> <a id="55031" href="#55031" class="Bound">!term'</a><span id="55037" class="Symbol">)</span> <a id="55039" href="#55039" class="Bound">!stack</a> <span id="55046" class="Symbol">=</span> <a id="55048" href="#38040" class="InductiveConstructor">!continue</a> <span id="55058" class="Symbol">(</span><a id="55059" href="#54773" class="Function">!reduce</a> <span id="55067" class="Symbol">(</span><a id="55068" href="#55114" class="Function">!value</a> <a id="55075" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="55077" href="#55005" class="Bound">!env</a><span id="55081" class="Symbol">)</span> <a id="55083" href="#55031" class="Bound">!term'</a> <a id="55090" href="#55039" class="Bound">!stack</a><span id="55096" class="Symbol">)</span>
    <span id="55102" class="Keyword">where</span>
      <a id="55114" href="#55114" class="Function">!value</a> <span id="55121" class="Symbol">:</span> <a id="55123" href="#44065" class="Function">!Value</a> <span id="55130" class="Symbol">_</span> <span id="55132" class="Symbol">_</span>
      <a id="55140" href="#55114" class="Function">!value</a> <span id="55147" class="Symbol">=</span> <a id="55149" href="#49963" class="Function">!construct</a> <span id="55160" class="Symbol">(</span><a id="55161" href="#53986" class="Function">!plugEnvIntr</a> <a id="55174" href="#55005" class="Bound">!env</a> <a id="55179" href="#55025" class="Bound">!rule</a><span id="55184" class="Symbol">)</span>
  <a id="55188" href="#54773" class="Function">!reduce</a> <a id="55196" href="#55196" class="Bound">!env</a> <span id="55201" class="Symbol">(</span><a id="55202" href="#53720" class="InductiveConstructor">mkAllTermElim</a> <a id="55216" href="#55216" class="Bound">x</a> <a id="55218" href="#55218" class="Bound">!rule</a> <a id="55224" href="#55224" class="Bound">!term'</a><span id="55230" class="Symbol">)</span> <a id="55232" href="#55232" class="Bound">!stack</a> <span id="55239" class="Symbol">=</span> <a id="55241" href="#38040" class="InductiveConstructor">!continue</a> <span id="55251" class="Symbol">(</span><a id="55252" href="#55322" class="Function">!thunk</a> <a id="55259" href="#40380" class="Function Operator">▹!</a> <span id="55262" class="Symbol">\</span> <a id="55264" href="#55264" class="Bound">!v</a> <span id="55267" class="Symbol">→</span> <a id="55269" href="#39455" class="Function Operator">∗</a> <a id="55271" href="#54773" class="Function">!reduce</a> <span id="55279" class="Symbol">(</span><a id="55280" href="#55264" class="Bound">!v</a> <a id="55283" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="55285" href="#55196" class="Bound">!env</a><span id="55289" class="Symbol">)</span> <a id="55291" href="#55224" class="Bound">!term'</a> <a id="55298" href="#55232" class="Bound">!stack</a><span id="55304" class="Symbol">)</span>
    <span id="55310" class="Keyword">where</span>
      <a id="55322" href="#55322" class="Function">!thunk</a> <span id="55329" class="Symbol">:</span> <a id="55331" href="#45186" class="Function">!Thunk</a> <span id="55338" class="Symbol">_</span> <span id="55340" class="Symbol">_</span>
      <a id="55348" href="#55322" class="Function">!thunk</a> <span id="55355" class="Symbol">=</span> <a id="55357" href="#52655" class="Function">!eliminate</a> <span id="55368" class="Symbol">(</span><a id="55369" href="#54450" class="Function">!plugEnvElim</a> <a id="55382" href="#55196" class="Bound">!env</a> <a id="55387" href="#55218" class="Bound">!rule</a><span id="55392" class="Symbol">)</span> <span id="55394" class="Symbol">(</span><a id="55395" href="#6771" class="Function">get2</a> <a id="55400" href="#55196" class="Bound">!env</a> <a id="55405" href="#55216" class="Bound">x</a><span id="55406" class="Symbol">)</span>

  <span id="55411" class="Comment">{-
     Now we define functions that compute denotations for different objects.
  -}</span>

  <span id="55499" class="Keyword">mutual</span>
    <span id="55510" class="Comment">-- Plugs placeholder '!mkHas' into 'Any'</span>
    <a id="19:Denotational.runAnyC"></a><a id="55555" href="#55555" class="Function">runAnyC</a> <span id="55563" class="Symbol">:</span> <span id="55565" class="Symbol">∀</span> <span id="55567" class="Symbol">{</span><a id="55568" href="#55568" class="Bound">Γ</a> <a id="55570" href="#55570" class="Bound">τs</a><span id="55572" class="Symbol">}</span> <span id="55574" class="Symbol">→</span> <span id="55576" class="Symbol">(</span><a id="55577" href="#55577" class="Bound">κ</a> <span id="55579" class="Symbol">:</span> <a id="55581" href="#8610" class="Datatype">Type</a> <span id="55586" class="Symbol">→</span> <a id="55588" href="#8610" class="Datatype">Type</a><span id="55592" class="Symbol">)</span> <span id="55594" class="Symbol">→</span> <span id="55596" class="Symbol">(</span><a id="55597" href="#55597" class="Bound">vᵢ</a> <span id="55600" class="Symbol">:</span> <a id="55602" href="#3235" class="Datatype">Any</a> <span id="55606" class="Symbol">(\</span><a id="55608" href="#55608" class="Bound">τ</a> <span id="55610" class="Symbol">→</span> <a id="55612" href="#3432" class="Function">Has</a> <a id="55616" href="#55568" class="Bound">Γ</a> <span id="55618" class="Symbol">(</span><a id="55619" href="#55577" class="Bound">κ</a> <a id="55621" href="#55608" class="Bound">τ</a><span id="55622" class="Symbol">))</span> <a id="55625" href="#55570" class="Bound">τs</a><span id="55627" class="Symbol">)</span> <span id="55629" class="Symbol">→</span> <a id="55631" href="#4219" class="Datatype">AllAny</a> <span id="55638" class="Symbol">(\</span><a id="55640" href="#55640" class="Bound">τ</a> <span id="55642" class="Symbol">→</span> <a id="55644" href="#53224" class="Datatype">!Has</a> <a id="55649" href="#55568" class="Bound">Γ</a> <span id="55651" class="Symbol">(</span><a id="55652" href="#55577" class="Bound">κ</a> <a id="55654" href="#55640" class="Bound">τ</a><span id="55655" class="Symbol">))</span> <a id="55658" href="#55570" class="Bound">τs</a> <a id="55661" href="#55597" class="Bound">vᵢ</a>
    <a id="55668" href="#55555" class="Function">runAnyC</a> <a id="55676" href="#55676" class="Bound">κ</a> <span id="55678" class="Symbol">(</span><a id="55679" href="#3288" class="InductiveConstructor">here</a> <a id="55684" href="#55684" class="Bound">v</a><span id="55685" class="Symbol">)</span>   <span id="55689" class="Symbol">=</span> <a id="55691" href="#4306" class="InductiveConstructor">here</a> <span id="55696" class="Symbol">(</span><a id="55697" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="55704" href="#55684" class="Bound">v</a><span id="55705" class="Symbol">)</span>
    <a id="55711" href="#55555" class="Function">runAnyC</a> <a id="55719" href="#55719" class="Bound">κ</a> <span id="55721" class="Symbol">(</span><a id="55722" href="#3332" class="InductiveConstructor">there</a> <a id="55728" href="#55728" class="Bound">vᵢ</a><span id="55730" class="Symbol">)</span> <span id="55732" class="Symbol">=</span> <a id="55734" href="#4366" class="InductiveConstructor">there</a> <span id="55740" class="Symbol">(</span><a id="55741" href="#55555" class="Function">runAnyC</a> <a id="55749" href="#55719" class="Bound">κ</a> <a id="55751" href="#55728" class="Bound">vᵢ</a><span id="55753" class="Symbol">)</span>

    <span id="55760" class="Comment">-- Plugs placeholder '!mkHas' into 'All'</span>
    <a id="19:Denotational.runAllC"></a><a id="55805" href="#55805" class="Function">runAllC</a> <span id="55813" class="Symbol">:</span> <span id="55815" class="Symbol">∀</span> <span id="55817" class="Symbol">{</span><a id="55818" href="#55818" class="Bound">Γ</a> <a id="55820" href="#55820" class="Bound">τs</a><span id="55822" class="Symbol">}</span> <span id="55824" class="Symbol">→</span> <span id="55826" class="Symbol">(</span><a id="55827" href="#55827" class="Bound">κ</a> <span id="55829" class="Symbol">:</span> <a id="55831" href="#8610" class="Datatype">Type</a> <span id="55836" class="Symbol">→</span> <a id="55838" href="#8610" class="Datatype">Type</a><span id="55842" class="Symbol">)</span> <span id="55844" class="Symbol">→</span> <span id="55846" class="Symbol">(</span><a id="55847" href="#55847" class="Bound">vs</a> <span id="55850" class="Symbol">:</span> <a id="55852" href="#2877" class="Datatype">All</a> <span id="55856" class="Symbol">(\</span><a id="55858" href="#55858" class="Bound">τ</a> <span id="55860" class="Symbol">→</span> <a id="55862" href="#3432" class="Function">Has</a> <a id="55866" href="#55818" class="Bound">Γ</a> <span id="55868" class="Symbol">(</span><a id="55869" href="#55827" class="Bound">κ</a> <a id="55871" href="#55858" class="Bound">τ</a><span id="55872" class="Symbol">))</span> <a id="55875" href="#55820" class="Bound">τs</a><span id="55877" class="Symbol">)</span> <span id="55879" class="Symbol">→</span> <a id="55881" href="#3956" class="Datatype">All2</a> <span id="55886" class="Symbol">(\</span><a id="55888" href="#55888" class="Bound">τ</a> <span id="55890" class="Symbol">→</span> <a id="55892" href="#53224" class="Datatype">!Has</a> <a id="55897" href="#55818" class="Bound">Γ</a> <span id="55899" class="Symbol">(</span><a id="55900" href="#55827" class="Bound">κ</a> <a id="55902" href="#55888" class="Bound">τ</a><span id="55903" class="Symbol">))</span> <a id="55906" href="#55820" class="Bound">τs</a> <a id="55909" href="#55847" class="Bound">vs</a>
    <a id="55916" href="#55805" class="Function">runAllC</a> <a id="55924" href="#55924" class="Bound">κ</a>  <a id="55927" href="#2930" class="InductiveConstructor">ε</a>       <span id="55935" class="Symbol">=</span> <a id="55937" href="#4041" class="InductiveConstructor">ε</a>
    <a id="55943" href="#55805" class="Function">runAllC</a> <a id="55951" href="#55951" class="Bound">κ</a> <span id="55953" class="Symbol">(</span><a id="55954" href="#55954" class="Bound">v</a> <a id="55956" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="55958" href="#55958" class="Bound">vs</a><span id="55960" class="Symbol">)</span> <span id="55962" class="Symbol">=</span> <a id="55964" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="55971" href="#55954" class="Bound">v</a> <a id="55973" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="55975" href="#55805" class="Function">runAllC</a> <a id="55983" href="#55951" class="Bound">κ</a> <a id="55985" href="#55958" class="Bound">vs</a>

    <span id="55993" class="Comment">-- Computes denotation for each subterm of a compile-time introduction rule</span>
    <a id="19:Denotational.runIntrC"></a><a id="56073" href="#56073" class="Function">runIntrC</a> <span id="56082" class="Symbol">:</span> <span id="56084" class="Symbol">∀</span> <span id="56086" class="Symbol">{</span><a id="56087" href="#56087" class="Bound">Γ</a> <a id="56089" href="#56089" class="Bound">τ</a><span id="56090" class="Symbol">}</span> <span id="56092" class="Symbol">→</span> <span id="56094" class="Symbol">(</span><a id="56095" href="#56095" class="Bound">rule</a> <span id="56100" class="Symbol">:</span> <a id="56102" href="#9811" class="Datatype">Intr</a> <span id="56107" class="Symbol">(</span><a id="56108" href="#21982" class="Function">AbsTermC</a> <a id="56117" href="#56087" class="Bound">Γ</a><span id="56118" class="Symbol">)</span> <span id="56120" class="Symbol">(</span><a id="56121" href="#3432" class="Function">Has</a> <a id="56125" href="#56087" class="Bound">Γ</a><span id="56126" class="Symbol">)</span> <a id="56128" href="#56089" class="Bound">τ</a><span id="56129" class="Symbol">)</span> <span id="56131" class="Symbol">→</span> <a id="56133" href="#14464" class="Datatype">AllIntr</a> <span id="56141" class="Symbol">(</span><a id="56142" href="#46328" class="Function">!AbsTermC</a> <a id="56152" href="#56087" class="Bound">Γ</a><span id="56153" class="Symbol">)</span> <span id="56155" class="Symbol">(</span><a id="56156" href="#53224" class="Datatype">!Has</a> <a id="56161" href="#56087" class="Bound">Γ</a><span id="56162" class="Symbol">)</span> <a id="56164" href="#56089" class="Bound">τ</a> <a id="56166" href="#56095" class="Bound">rule</a>
    <a id="56175" href="#56073" class="Function">runIntrC</a> <span id="56184" class="Symbol">(</span><a id="56185" href="#9949" class="InductiveConstructor">intrArrow</a> <a id="56195" href="#56195" class="Bound">term</a><span id="56199" class="Symbol">)</span>          <span id="56210" class="Symbol">=</span> <a id="56212" href="#14642" class="InductiveConstructor">mkAllIntrArrow</a> <span id="56227" class="Symbol">(</span><a id="56228" href="#58508" class="Function">runTerm</a> <a id="56236" href="#56195" class="Bound">term</a><span id="56240" class="Symbol">)</span>
    <a id="56246" href="#56073" class="Function">runIntrC</a> <span id="56255" class="Symbol">(</span><a id="56256" href="#10102" class="InductiveConstructor">intrSum</a> <a id="56264" href="#56264" class="Bound">vᵢ</a><span id="56266" class="Symbol">)</span>              <span id="56281" class="Symbol">=</span> <a id="56283" href="#14776" class="InductiveConstructor">mkAllIntrSum</a> <span id="56296" class="Symbol">(</span><a id="56297" href="#55555" class="Function">runAnyC</a> <a id="56305" href="#5739" class="Function">identity</a> <a id="56314" href="#56264" class="Bound">vᵢ</a><span id="56316" class="Symbol">)</span>
    <a id="56322" href="#56073" class="Function">runIntrC</a> <span id="56331" class="Symbol">(</span><a id="56332" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="56344" href="#56344" class="Bound">vs</a><span id="56346" class="Symbol">)</span>          <span id="56357" class="Symbol">=</span> <a id="56359" href="#14907" class="InductiveConstructor">mkAllIntrProduct</a> <span id="56376" class="Symbol">(</span><a id="56377" href="#55805" class="Function">runAllC</a> <a id="56385" href="#5739" class="Function">identity</a> <a id="56394" href="#56344" class="Bound">vs</a><span id="56396" class="Symbol">)</span>
    <a id="56402" href="#56073" class="Function">runIntrC</a> <span id="56411" class="Symbol">(</span><a id="56412" href="#10481" class="InductiveConstructor">intrNat</a> <a id="56420" href="#56420" class="Bound">v</a><span id="56421" class="Symbol">)</span>               <span id="56437" class="Symbol">=</span> <a id="56439" href="#15042" class="InductiveConstructor">mkAllIntrNat</a> <span id="56452" class="Symbol">(</span><a id="56453" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="56460" href="#56420" class="Bound">v</a><span id="56461" class="Symbol">)</span>
    <a id="56467" href="#56073" class="Function">runIntrC</a> <span id="56476" class="Symbol">(</span><a id="56477" href="#10848" class="InductiveConstructor">intrConat</a> <span id="56487" class="Symbol">(</span><a id="56488" href="#56488" class="Bound">ρ</a> <a id="56490" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="56493" href="#56493" class="Bound">v</a> <a id="56495" href="#2431" class="InductiveConstructor Operator">,</a> <a id="56497" href="#56497" class="Bound">f</a><span id="56498" class="Symbol">))</span>  <span id="56502" class="Symbol">=</span> <a id="56504" href="#15172" class="InductiveConstructor">mkAllIntrConat</a> <span id="56519" class="Symbol">(</span><a id="56520" href="#56488" class="Bound">ρ</a> <a id="56522" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="56525" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="56532" href="#56493" class="Bound">v</a> <a id="56534" href="#3647" class="InductiveConstructor Operator">,</a> <a id="56536" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="56543" href="#56497" class="Bound">f</a><span id="56544" class="Symbol">)</span>
    <a id="56550" href="#56073" class="Function">runIntrC</a> <span id="56559" class="Symbol">(</span><a id="56560" href="#11212" class="InductiveConstructor">intrStream</a> <span id="56571" class="Symbol">(</span><a id="56572" href="#56572" class="Bound">ρ</a> <a id="56574" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="56577" href="#56577" class="Bound">v</a> <a id="56579" href="#2431" class="InductiveConstructor Operator">,</a> <a id="56581" href="#56581" class="Bound">f</a><span id="56582" class="Symbol">))</span> <span id="56585" class="Symbol">=</span> <a id="56587" href="#15304" class="InductiveConstructor">mkAllIntrStream</a> <span id="56603" class="Symbol">(</span><a id="56604" href="#56572" class="Bound">ρ</a> <a id="56606" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="56609" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="56616" href="#56577" class="Bound">v</a> <a id="56618" href="#3647" class="InductiveConstructor Operator">,</a> <a id="56620" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="56627" href="#56581" class="Bound">f</a><span id="56628" class="Symbol">)</span>

    <span id="56635" class="Comment">-- Plugs placeholder '!mkHas' into compile-time elimination rule</span>
    <a id="19:Denotational.runElimC"></a><a id="56704" href="#56704" class="Function">runElimC</a> <span id="56713" class="Symbol">:</span> <span id="56715" class="Symbol">∀</span> <span id="56717" class="Symbol">{</span><a id="56718" href="#56718" class="Bound">Γ</a> <a id="56720" href="#56720" class="Bound">τ</a> <a id="56722" href="#56722" class="Bound">ϕ</a><span id="56723" class="Symbol">}</span> <span id="56725" class="Symbol">→</span> <span id="56727" class="Symbol">(</span><a id="56728" href="#56728" class="Bound">rule</a> <span id="56733" class="Symbol">:</span> <a id="56735" href="#11351" class="Datatype">Elim</a> <span id="56740" class="Symbol">(</span><a id="56741" href="#3432" class="Function">Has</a> <a id="56745" href="#56718" class="Bound">Γ</a><span id="56746" class="Symbol">)</span> <a id="56748" href="#56720" class="Bound">τ</a> <a id="56750" href="#56722" class="Bound">ϕ</a><span id="56751" class="Symbol">)</span> <span id="56753" class="Symbol">→</span> <a id="56755" href="#15531" class="Datatype">AllElim</a> <span id="56763" class="Symbol">(</span><a id="56764" href="#53224" class="Datatype">!Has</a> <a id="56769" href="#56718" class="Bound">Γ</a><span id="56770" class="Symbol">)</span> <a id="56772" href="#56720" class="Bound">τ</a> <a id="56774" href="#56722" class="Bound">ϕ</a> <a id="56776" href="#56728" class="Bound">rule</a>
    <a id="56785" href="#56704" class="Function">runElimC</a> <span id="56794" class="Symbol">(</span><a id="56795" href="#11493" class="InductiveConstructor">elimArrow</a> <a id="56805" href="#56805" class="Bound">v</a><span id="56806" class="Symbol">)</span>   <span id="56810" class="Symbol">=</span> <a id="56812" href="#15629" class="InductiveConstructor">mkAllElimArrow</a> <span id="56827" class="Symbol">(</span><a id="56828" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="56835" href="#56805" class="Bound">v</a><span id="56836" class="Symbol">)</span>
    <a id="56842" href="#56704" class="Function">runElimC</a> <span id="56851" class="Symbol">(</span><a id="56852" href="#11670" class="InductiveConstructor">elimSum</a> <a id="56860" href="#56860" class="Bound">fs</a><span id="56862" class="Symbol">)</span>    <span id="56867" class="Symbol">=</span> <a id="56869" href="#15759" class="InductiveConstructor">mkAllElimSum</a> <span id="56882" class="Symbol">(</span><a id="56883" href="#55805" class="Function">runAllC</a> <span id="56891" class="Symbol">(\</span><a id="56893" href="#56893" class="Bound">τ</a> <span id="56895" class="Symbol">→</span> <a id="56897" href="#56893" class="Bound">τ</a> <a id="56899" href="#8631" class="InductiveConstructor Operator">⇒</a> <span id="56901" class="Symbol">_)</span> <a id="56904" href="#56860" class="Bound">fs</a><span id="56906" class="Symbol">)</span>
    <a id="56912" href="#56704" class="Function">runElimC</a> <span id="56921" class="Symbol">(</span><a id="56922" href="#11838" class="InductiveConstructor">elimProduct</a> <a id="56934" href="#56934" class="Bound">i</a><span id="56935" class="Symbol">)</span> <span id="56937" class="Symbol">=</span> <a id="56939" href="#15888" class="InductiveConstructor">mkAllElimProduct</a> <a id="56956" href="#56934" class="Bound">i</a>
    <a id="56962" href="#56704" class="Function">runElimC</a> <span id="56971" class="Symbol">(</span><a id="56972" href="#11950" class="InductiveConstructor">elimNat</a> <a id="56980" href="#56980" class="Bound">f</a><span id="56981" class="Symbol">)</span>     <span id="56987" class="Symbol">=</span> <a id="56989" href="#16020" class="InductiveConstructor">mkAllElimNat</a> <span id="57002" class="Symbol">(</span><a id="57003" href="#53282" class="InductiveConstructor">!mkHas</a> <a id="57010" href="#56980" class="Bound">f</a><span id="57011" class="Symbol">)</span>
    <a id="57017" href="#56704" class="Function">runElimC</a>  <a id="57027" href="#12146" class="InductiveConstructor">elimConat</a>      <span id="57042" class="Symbol">=</span> <a id="57044" href="#16148" class="InductiveConstructor">mkAllElimConat</a>
    <a id="57063" href="#56704" class="Function">runElimC</a>  <a id="57073" href="#12326" class="InductiveConstructor">elimStream</a>     <span id="57088" class="Symbol">=</span> <a id="57090" href="#16275" class="InductiveConstructor">mkAllElimStream</a>

    <span id="57111" class="Comment">-- Computes denotation for each subterm of a term</span>
    <a id="19:Denotational.runAllTerm"></a><a id="57165" href="#57165" class="Function">runAllTerm</a> <span id="57176" class="Symbol">:</span> <span id="57178" class="Symbol">∀</span> <span id="57180" class="Symbol">{</span><a id="57181" href="#57181" class="Bound">Γ</a> <a id="57183" href="#57183" class="Bound">τ</a><span id="57184" class="Symbol">}</span> <span id="57186" class="Symbol">→</span> <span id="57188" class="Symbol">(</span><a id="57189" href="#57189" class="Bound">term</a> <span id="57194" class="Symbol">:</span> <a id="57196" href="#21673" class="Datatype">TermC</a> <a id="57202" href="#57181" class="Bound">Γ</a> <a id="57204" href="#57183" class="Bound">τ</a><span id="57205" class="Symbol">)</span> <span id="57207" class="Symbol">→</span> <a id="57209" href="#53403" class="Datatype">AllTerm</a> <a id="57217" href="#46106" class="Function">!TermC</a> <a id="57224" href="#57181" class="Bound">Γ</a> <a id="57226" href="#57183" class="Bound">τ</a> <a id="57228" href="#57189" class="Bound">term</a>
    <a id="57237" href="#57165" class="Function">runAllTerm</a> <span id="57248" class="Symbol">(</span><a id="57249" href="#21778" class="InductiveConstructor">return</a> <a id="57256" href="#57256" class="Bound">x</a><span id="57257" class="Symbol">)</span>            <span id="57270" class="Symbol">=</span> <a id="57272" href="#53478" class="InductiveConstructor">mkAllTermReturn</a> <a id="57288" href="#57256" class="Bound">x</a>
    <a id="57294" href="#57165" class="Function">runAllTerm</a> <span id="57305" class="Symbol">(</span><a id="57306" href="#12591" class="InductiveConstructor">intr</a> <a id="57311" href="#57311" class="Bound">rule</a>   <a id="57318" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="57320" href="#57320" class="Bound">term'</a><span id="57325" class="Symbol">)</span> <span id="57327" class="Symbol">=</span> <a id="57329" href="#53552" class="InductiveConstructor">mkAllTermIntr</a> <span id="57343" class="Symbol">(</span><a id="57344" href="#56073" class="Function">runIntrC</a> <a id="57353" href="#57311" class="Bound">rule</a><span id="57357" class="Symbol">)</span> <span id="57359" class="Symbol">(</span><a id="57360" href="#57165" class="Function">runAllTerm</a> <a id="57371" href="#57320" class="Bound">term'</a><span id="57376" class="Symbol">)</span>
    <a id="57382" href="#57165" class="Function">runAllTerm</a> <span id="57393" class="Symbol">(</span><a id="57394" href="#12666" class="InductiveConstructor">elim</a> <a id="57399" href="#57399" class="Bound">x</a> <a id="57401" href="#57401" class="Bound">rule</a> <a id="57406" href="#21902" class="InductiveConstructor Operator">▸</a> <a id="57408" href="#57408" class="Bound">term'</a><span id="57413" class="Symbol">)</span> <span id="57415" class="Symbol">=</span> <a id="57417" href="#53720" class="InductiveConstructor">mkAllTermElim</a> <a id="57431" href="#57399" class="Bound">x</a> <span id="57433" class="Symbol">(</span><a id="57434" href="#56704" class="Function">runElimC</a> <a id="57443" href="#57401" class="Bound">rule</a><span id="57447" class="Symbol">)</span> <span id="57449" class="Symbol">(</span><a id="57450" href="#57165" class="Function">runAllTerm</a> <a id="57461" href="#57408" class="Bound">term'</a><span id="57466" class="Symbol">)</span>

    <span id="57473" class="Comment">-- Computes denotation for 'Any Value'</span>
    <a id="19:Denotational.runAnyR"></a><a id="57516" href="#57516" class="Function">runAnyR</a> <span id="57524" class="Symbol">:</span> <span id="57526" class="Symbol">∀</span> <span id="57528" class="Symbol">{</span><a id="57529" href="#57529" class="Bound">τs</a><span id="57531" class="Symbol">}</span> <span id="57533" class="Symbol">→</span> <span id="57535" class="Symbol">(</span><a id="57536" href="#57536" class="Bound">vᵢ</a> <span id="57539" class="Symbol">:</span> <a id="57541" href="#3235" class="Datatype">Any</a> <a id="57545" href="#26505" class="Datatype">Value</a> <a id="57551" href="#57529" class="Bound">τs</a><span id="57553" class="Symbol">)</span> <span id="57555" class="Symbol">→</span> <a id="57557" href="#4219" class="Datatype">AllAny</a> <a id="57564" href="#44065" class="Function">!Value</a> <a id="57571" href="#57529" class="Bound">τs</a> <a id="57574" href="#57536" class="Bound">vᵢ</a>
    <a id="57581" href="#57516" class="Function">runAnyR</a> <span id="57589" class="Symbol">(</span><a id="57590" href="#3288" class="InductiveConstructor">here</a> <a id="57595" href="#57595" class="Bound">v</a><span id="57596" class="Symbol">)</span>   <span id="57600" class="Symbol">=</span> <a id="57602" href="#4306" class="InductiveConstructor">here</a> <span id="57607" class="Symbol">(</span><a id="57608" href="#58691" class="Function">runValue</a> <a id="57617" href="#57595" class="Bound">v</a><span id="57618" class="Symbol">)</span>
    <a id="57624" href="#57516" class="Function">runAnyR</a> <span id="57632" class="Symbol">(</span><a id="57633" href="#3332" class="InductiveConstructor">there</a> <a id="57639" href="#57639" class="Bound">vᵢ</a><span id="57641" class="Symbol">)</span> <span id="57643" class="Symbol">=</span> <a id="57645" href="#4366" class="InductiveConstructor">there</a> <span id="57651" class="Symbol">(</span><a id="57652" href="#57516" class="Function">runAnyR</a> <a id="57660" href="#57639" class="Bound">vᵢ</a><span id="57662" class="Symbol">)</span>

    <span id="57669" class="Comment">-- Computes denotation for 'All Value'</span>
    <a id="19:Denotational.runAllR"></a><a id="57712" href="#57712" class="Function">runAllR</a> <span id="57720" class="Symbol">:</span> <span id="57722" class="Symbol">∀</span> <span id="57724" class="Symbol">{</span><a id="57725" href="#57725" class="Bound">τs</a><span id="57727" class="Symbol">}</span> <span id="57729" class="Symbol">→</span> <span id="57731" class="Symbol">(</span><a id="57732" href="#57732" class="Bound">vs</a> <span id="57735" class="Symbol">:</span> <a id="57737" href="#2877" class="Datatype">All</a> <a id="57741" href="#26505" class="Datatype">Value</a> <a id="57747" href="#57725" class="Bound">τs</a><span id="57749" class="Symbol">)</span> <span id="57751" class="Symbol">→</span> <a id="57753" href="#3956" class="Datatype">All2</a> <a id="57758" href="#44065" class="Function">!Value</a> <a id="57765" href="#57725" class="Bound">τs</a> <a id="57768" href="#57732" class="Bound">vs</a>
    <a id="57775" href="#57712" class="Function">runAllR</a>  <a id="57784" href="#2930" class="InductiveConstructor">ε</a>       <span id="57792" class="Symbol">=</span> <a id="57794" href="#4041" class="InductiveConstructor">ε</a>
    <a id="57800" href="#57712" class="Function">runAllR</a> <span id="57808" class="Symbol">(</span><a id="57809" href="#57809" class="Bound">v</a> <a id="57811" href="#2948" class="InductiveConstructor Operator">∷</a> <a id="57813" href="#57813" class="Bound">vs</a><span id="57815" class="Symbol">)</span> <span id="57817" class="Symbol">=</span> <a id="57819" href="#58691" class="Function">runValue</a> <a id="57828" href="#57809" class="Bound">v</a> <a id="57830" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="57832" href="#57712" class="Function">runAllR</a> <a id="57840" href="#57813" class="Bound">vs</a>

    <span id="57848" class="Comment">-- Computes denotation for each component of a run-time introduction rule</span>
    <a id="19:Denotational.runIntrR"></a><a id="57926" href="#57926" class="Function">runIntrR</a> <span id="57935" class="Symbol">:</span> <span id="57937" class="Symbol">∀</span> <span id="57939" class="Symbol">{</span><a id="57940" href="#57940" class="Bound">τ</a><span id="57941" class="Symbol">}</span> <span id="57943" class="Symbol">→</span> <span id="57945" class="Symbol">(</span><a id="57946" href="#57946" class="Bound">rule</a> <span id="57951" class="Symbol">:</span> <a id="57953" href="#9811" class="Datatype">Intr</a> <a id="57958" href="#26732" class="Datatype">Closure</a> <a id="57966" href="#26505" class="Datatype">Value</a> <a id="57972" href="#57940" class="Bound">τ</a><span id="57973" class="Symbol">)</span> <span id="57975" class="Symbol">→</span> <a id="57977" href="#14464" class="Datatype">AllIntr</a> <a id="57985" href="#45558" class="Function">!Closure</a> <a id="57994" href="#44065" class="Function">!Value</a> <a id="58001" href="#57940" class="Bound">τ</a> <a id="58003" href="#57946" class="Bound">rule</a>
    <a id="58012" href="#57926" class="Function">runIntrR</a> <span id="58021" class="Symbol">(</span><a id="58022" href="#9949" class="InductiveConstructor">intrArrow</a> <a id="58032" href="#58032" class="Bound">closure</a><span id="58039" class="Symbol">)</span>       <span id="58047" class="Symbol">=</span> <a id="58049" href="#14642" class="InductiveConstructor">mkAllIntrArrow</a> <span id="58064" class="Symbol">(</span><a id="58065" href="#58844" class="Function">runClosure</a> <a id="58076" href="#58032" class="Bound">closure</a><span id="58083" class="Symbol">)</span>
    <a id="58089" href="#57926" class="Function">runIntrR</a> <span id="58098" class="Symbol">(</span><a id="58099" href="#10102" class="InductiveConstructor">intrSum</a> <a id="58107" href="#58107" class="Bound">vᵢ</a><span id="58109" class="Symbol">)</span>              <span id="58124" class="Symbol">=</span> <a id="58126" href="#14776" class="InductiveConstructor">mkAllIntrSum</a> <span id="58139" class="Symbol">(</span><a id="58140" href="#57516" class="Function">runAnyR</a> <a id="58148" href="#58107" class="Bound">vᵢ</a><span id="58150" class="Symbol">)</span>
    <a id="58156" href="#57926" class="Function">runIntrR</a> <span id="58165" class="Symbol">(</span><a id="58166" href="#10248" class="InductiveConstructor">intrProduct</a> <a id="58178" href="#58178" class="Bound">vs</a><span id="58180" class="Symbol">)</span>          <span id="58191" class="Symbol">=</span> <a id="58193" href="#14907" class="InductiveConstructor">mkAllIntrProduct</a> <span id="58210" class="Symbol">(</span><a id="58211" href="#57712" class="Function">runAllR</a> <a id="58219" href="#58178" class="Bound">vs</a><span id="58221" class="Symbol">)</span>
    <a id="58227" href="#57926" class="Function">runIntrR</a> <span id="58236" class="Symbol">(</span><a id="58237" href="#10481" class="InductiveConstructor">intrNat</a> <a id="58245" href="#58245" class="Bound">v</a><span id="58246" class="Symbol">)</span>               <span id="58262" class="Symbol">=</span> <a id="58264" href="#15042" class="InductiveConstructor">mkAllIntrNat</a> <span id="58277" class="Symbol">(</span><a id="58278" href="#58691" class="Function">runValue</a> <a id="58287" href="#58245" class="Bound">v</a><span id="58288" class="Symbol">)</span>
    <a id="58294" href="#57926" class="Function">runIntrR</a> <span id="58303" class="Symbol">(</span><a id="58304" href="#10848" class="InductiveConstructor">intrConat</a> <span id="58314" class="Symbol">(</span><a id="58315" href="#58315" class="Bound">ρ</a> <a id="58317" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="58320" href="#58320" class="Bound">v</a> <a id="58322" href="#2431" class="InductiveConstructor Operator">,</a> <a id="58324" href="#58324" class="Bound">f</a><span id="58325" class="Symbol">))</span>  <span id="58329" class="Symbol">=</span> <a id="58331" href="#15172" class="InductiveConstructor">mkAllIntrConat</a> <span id="58346" class="Symbol">(</span><a id="58347" href="#58315" class="Bound">ρ</a> <a id="58349" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="58352" href="#58691" class="Function">runValue</a> <a id="58361" href="#58320" class="Bound">v</a> <a id="58363" href="#3647" class="InductiveConstructor Operator">,</a> <a id="58365" href="#58691" class="Function">runValue</a> <a id="58374" href="#58324" class="Bound">f</a><span id="58375" class="Symbol">)</span>
    <a id="58381" href="#57926" class="Function">runIntrR</a> <span id="58390" class="Symbol">(</span><a id="58391" href="#11212" class="InductiveConstructor">intrStream</a> <span id="58402" class="Symbol">(</span><a id="58403" href="#58403" class="Bound">ρ</a> <a id="58405" href="#2572" class="InductiveConstructor Operator">,,</a> <a id="58408" href="#58408" class="Bound">v</a> <a id="58410" href="#2431" class="InductiveConstructor Operator">,</a> <a id="58412" href="#58412" class="Bound">f</a><span id="58413" class="Symbol">))</span> <span id="58416" class="Symbol">=</span> <a id="58418" href="#15304" class="InductiveConstructor">mkAllIntrStream</a> <span id="58434" class="Symbol">(</span><a id="58435" href="#58403" class="Bound">ρ</a> <a id="58437" href="#3828" class="InductiveConstructor Operator">,,</a> <a id="58440" href="#58691" class="Function">runValue</a> <a id="58449" href="#58408" class="Bound">v</a> <a id="58451" href="#3647" class="InductiveConstructor Operator">,</a> <a id="58453" href="#58691" class="Function">runValue</a> <a id="58462" href="#58412" class="Bound">f</a><span id="58463" class="Symbol">)</span>

    <span id="58470" class="Comment">-- Computes denotation for a term</span>
    <a id="19:Denotational.runTerm"></a><a id="58508" href="#58508" class="Function">runTerm</a> <span id="58516" class="Symbol">:</span> <span id="58518" class="Symbol">∀</span> <span id="58520" class="Symbol">{</span><a id="58521" href="#58521" class="Bound">Γ</a> <a id="58523" href="#58523" class="Bound">τ</a><span id="58524" class="Symbol">}</span> <span id="58526" class="Symbol">→</span> <span id="58528" class="Symbol">(</span><a id="58529" href="#58529" class="Bound">term</a> <span id="58534" class="Symbol">:</span> <a id="58536" href="#21673" class="Datatype">TermC</a> <a id="58542" href="#58521" class="Bound">Γ</a> <a id="58544" href="#58523" class="Bound">τ</a><span id="58545" class="Symbol">)</span> <span id="58547" class="Symbol">→</span> <a id="58549" href="#46106" class="Function">!TermC</a> <a id="58556" href="#58521" class="Bound">Γ</a> <a id="58558" href="#58523" class="Bound">τ</a> <a id="58560" href="#58529" class="Bound">term</a>
    <a id="58569" href="#58508" class="Function">runTerm</a> <a id="58577" href="#58577" class="Bound">term</a> <a id="58582" href="#58582" class="Bound">!env</a> <a id="58587" href="#58587" class="Bound">!stack</a> <span id="58594" class="Symbol">=</span> <a id="58596" href="#38369" class="InductiveConstructor">!continueM</a> <span id="58607" class="Symbol">(</span><a id="58608" href="#54773" class="Function">!reduce</a> <a id="58616" href="#58582" class="Bound">!env</a> <span id="58621" class="Symbol">(</span><a id="58622" href="#57165" class="Function">runAllTerm</a> <a id="58633" href="#58577" class="Bound">term</a><span id="58637" class="Symbol">)</span> <a id="58639" href="#58587" class="Bound">!stack</a><span id="58645" class="Symbol">)</span>

    <span id="58652" class="Comment">-- Computes denotation for a value</span>
    <a id="19:Denotational.runValue"></a><a id="58691" href="#58691" class="Function">runValue</a> <span id="58700" class="Symbol">:</span> <span id="58702" class="Symbol">∀</span> <span id="58704" class="Symbol">{</span><a id="58705" href="#58705" class="Bound">τ</a><span id="58706" class="Symbol">}</span> <span id="58708" class="Symbol">→</span> <span id="58710" class="Symbol">(</span><a id="58711" href="#58711" class="Bound">value</a> <span id="58717" class="Symbol">:</span> <a id="58719" href="#26505" class="Datatype">Value</a> <a id="58725" href="#58705" class="Bound">τ</a><span id="58726" class="Symbol">)</span> <span id="58728" class="Symbol">→</span> <a id="58730" href="#44065" class="Function">!Value</a> <a id="58737" href="#58705" class="Bound">τ</a> <a id="58739" href="#58711" class="Bound">value</a>
    <a id="58749" href="#58691" class="Function">runValue</a> <span id="58758" class="Symbol">(</span><a id="58759" href="#26540" class="InductiveConstructor">construct</a> <a id="58769" href="#58769" class="Bound">x</a><span id="58770" class="Symbol">)</span> <span id="58772" class="Symbol">=</span> <a id="58774" href="#49963" class="Function">!construct</a> <span id="58785" class="Symbol">(</span><a id="58786" href="#57926" class="Function">runIntrR</a> <a id="58795" href="#58769" class="Bound">x</a><span id="58796" class="Symbol">)</span>

    <span id="58803" class="Comment">-- Computes denotation for a closure</span>
    <a id="19:Denotational.runClosure"></a><a id="58844" href="#58844" class="Function">runClosure</a> <span id="58855" class="Symbol">:</span> <span id="58857" class="Symbol">∀</span> <span id="58859" class="Symbol">{</span><a id="58860" href="#58860" class="Bound">ρ</a> <a id="58862" href="#58862" class="Bound">τ</a><span id="58863" class="Symbol">}</span> <span id="58865" class="Symbol">→</span> <span id="58867" class="Symbol">(</span><a id="58868" href="#58868" class="Bound">closure</a> <span id="58876" class="Symbol">:</span> <a id="58878" href="#26732" class="Datatype">Closure</a> <a id="58886" href="#58860" class="Bound">ρ</a> <a id="58888" href="#58862" class="Bound">τ</a><span id="58889" class="Symbol">)</span> <span id="58891" class="Symbol">→</span> <a id="58893" href="#45558" class="Function">!Closure</a> <a id="58902" href="#58860" class="Bound">ρ</a> <a id="58904" href="#58862" class="Bound">τ</a> <a id="58906" href="#58868" class="Bound">closure</a>
    <a id="58918" href="#58844" class="Function">runClosure</a> <span id="58929" class="Symbol">(</span><a id="58930" href="#58930" class="Bound">env</a> <a id="58934" href="#26771" class="InductiveConstructor Operator">&amp;</a> <a id="58936" href="#58936" class="Bound">term</a><span id="58940" class="Symbol">)</span> <a id="58942" href="#58942" class="Bound">!value</a> <span id="58949" class="Symbol">=</span> <a id="58951" href="#58508" class="Function">runTerm</a> <a id="58959" href="#58936" class="Bound">term</a> <span id="58964" class="Symbol">(</span><a id="58965" href="#58942" class="Bound">!value</a> <a id="58972" href="#4062" class="InductiveConstructor Operator">∷</a> <a id="58974" href="#59045" class="Function">runEnv</a> <a id="58981" href="#58930" class="Bound">env</a><span id="58984" class="Symbol">)</span> <a id="58986" href="#37965" class="InductiveConstructor">!finish</a>

    <span id="58999" class="Comment">-- Computes denotation for an environment</span>
    <a id="19:Denotational.runEnv"></a><a id="59045" href="#59045" class="Function">runEnv</a> <span id="59052" class="Symbol">:</span> <span id="59054" class="Symbol">∀</span> <span id="59056" class="Symbol">{</span><a id="59057" href="#59057" class="Bound">τs</a><span id="59059" class="Symbol">}</span> <span id="59061" class="Symbol">→</span> <span id="59063" class="Symbol">(</span><a id="59064" href="#59064" class="Bound">env</a> <span id="59068" class="Symbol">:</span> <a id="59070" href="#26880" class="Function">Env</a> <a id="59074" href="#59057" class="Bound">τs</a><span id="59076" class="Symbol">)</span> <span id="59078" class="Symbol">→</span> <a id="59080" href="#45346" class="Function">!Env</a> <a id="59085" href="#59057" class="Bound">τs</a> <a id="59088" href="#59064" class="Bound">env</a>
    <a id="59096" href="#59045" class="Function">runEnv</a> <span id="59103" class="Symbol">=</span> <a id="59105" href="#57712" class="Function">runAllR</a>

    <span id="59118" class="Comment">-- Computes denotation for a thunk</span>
    <a id="19:Denotational.runThunk"></a><a id="59157" href="#59157" class="Function">runThunk</a> <span id="59166" class="Symbol">:</span> <span id="59168" class="Symbol">∀</span> <span id="59170" class="Symbol">{</span><a id="59171" href="#59171" class="Bound">τ</a><span id="59172" class="Symbol">}</span> <span id="59174" class="Symbol">→</span> <span id="59176" class="Symbol">(</span><a id="59177" href="#59177" class="Bound">thunk</a> <span id="59183" class="Symbol">:</span> <a id="59185" href="#27204" class="Datatype">Thunk</a> <a id="59191" href="#59171" class="Bound">τ</a><span id="59192" class="Symbol">)</span> <span id="59194" class="Symbol">→</span> <a id="59196" href="#45186" class="Function">!Thunk</a> <a id="59203" href="#59171" class="Bound">τ</a> <a id="59205" href="#59177" class="Bound">thunk</a>
    <a id="59215" href="#59157" class="Function">runThunk</a> <span id="59224" class="Symbol">(</span><a id="59225" href="#59225" class="Bound">env</a> <a id="59229" href="#27237" class="InductiveConstructor Operator">&amp;</a> <a id="59231" href="#59231" class="Bound">term</a><span id="59235" class="Symbol">)</span> <span id="59237" class="Symbol">=</span> <a id="59239" href="#58508" class="Function">runTerm</a> <a id="59247" href="#59231" class="Bound">term</a> <span id="59252" class="Symbol">(</span><a id="59253" href="#59045" class="Function">runEnv</a> <a id="59260" href="#59225" class="Bound">env</a><span id="59263" class="Symbol">)</span> <a id="59265" href="#37965" class="InductiveConstructor">!finish</a>

    <span id="59278" class="Comment">-- Computes denotation for a callstack</span>
    <a id="19:Denotational.runStack"></a><a id="59321" href="#59321" class="Function">runStack</a> <span id="59330" class="Symbol">:</span> <span id="59332" class="Symbol">∀</span> <span id="59334" class="Symbol">{</span><a id="59335" href="#59335" class="Bound">ρ</a> <a id="59337" href="#59337" class="Bound">τ</a><span id="59338" class="Symbol">}</span> <span id="59340" class="Symbol">→</span> <span id="59342" class="Symbol">(</span><a id="59343" href="#59343" class="Bound">stack</a> <span id="59349" class="Symbol">:</span> <a id="59351" href="#27326" class="Datatype">CallStack</a> <a id="59361" href="#59335" class="Bound">ρ</a> <a id="59363" href="#59337" class="Bound">τ</a><span id="59364" class="Symbol">)</span> <span id="59366" class="Symbol">→</span> <a id="59368" href="#45864" class="Function">!CallStack</a> <a id="59379" href="#59335" class="Bound">ρ</a> <a id="59381" href="#59337" class="Bound">τ</a> <a id="59383" href="#59343" class="Bound">stack</a>
    <a id="59393" href="#59321" class="Function">runStack</a>  <a id="59403" href="#27366" class="InductiveConstructor">ε</a>                <a id="59420" href="#59420" class="Bound">!value</a> <span id="59427" class="Symbol">=</span> <a id="59429" href="#37965" class="InductiveConstructor">!finish</a> <a id="59437" href="#59420" class="Bound">!value</a>
    <a id="59448" href="#59321" class="Function">runStack</a> <span id="59457" class="Symbol">(</span><a id="59458" href="#59458" class="Bound">closure</a> <a id="59466" href="#27402" class="InductiveConstructor Operator">∷</a> <a id="59468" href="#59468" class="Bound">stack</a><span id="59473" class="Symbol">)</span> <a id="59475" href="#59475" class="Bound">!value</a> <span id="59482" class="Symbol">=</span> <a id="59484" href="#38040" class="InductiveConstructor">!continue</a> <span id="59494" class="Symbol">(</span><a id="59495" href="#58844" class="Function">runClosure</a> <a id="59506" href="#59458" class="Bound">closure</a> <a id="59514" href="#59475" class="Bound">!value</a> <a id="59521" href="#40380" class="Function Operator">▹!</a> <a id="59524" href="#59321" class="Function">runStack</a> <a id="59533" href="#59468" class="Bound">stack</a><span id="59538" class="Symbol">)</span>

    <span id="59545" class="Comment">-- Computes denotation for a machine</span>
    <a id="19:Denotational.runMachine"></a><a id="59586" href="#59586" class="Function">runMachine</a> <span id="59597" class="Symbol">:</span> <span id="59599" class="Symbol">∀</span> <span id="59601" class="Symbol">{</span><a id="59602" href="#59602" class="Bound">τ</a><span id="59603" class="Symbol">}</span> <span id="59605" class="Symbol">→</span> <span id="59607" class="Symbol">(</span><a id="59608" href="#59608" class="Bound">machine</a> <span id="59616" class="Symbol">:</span> <a id="59618" href="#27628" class="Datatype">Machine</a> <a id="59626" href="#59602" class="Bound">τ</a><span id="59627" class="Symbol">)</span> <span id="59629" class="Symbol">→</span> <a id="59631" href="#44887" class="Function">!Machine</a> <a id="59640" href="#59602" class="Bound">τ</a> <a id="59642" href="#59608" class="Bound">machine</a>
    <a id="59654" href="#59586" class="Function">runMachine</a> <span id="59665" class="Symbol">(</span><a id="59666" href="#59666" class="Bound">thunk</a> <a id="59672" href="#27659" class="InductiveConstructor Operator">▹</a> <a id="59674" href="#59674" class="Bound">stack</a><span id="59679" class="Symbol">)</span> <span id="59681" class="Symbol">=</span> <a id="59683" href="#38369" class="InductiveConstructor">!continueM</a> <span id="59694" class="Symbol">(</span><a id="59695" href="#59157" class="Function">runThunk</a> <a id="59704" href="#59666" class="Bound">thunk</a> <a id="59710" href="#40380" class="Function Operator">▹!</a> <a id="59713" href="#59321" class="Function">runStack</a> <a id="59722" href="#59674" class="Bound">stack</a><span id="59727" class="Symbol">)</span>

  <span id="59732" class="Comment">-- Returns computation trace for a machine, proving that it terminates (alias for 'runMachine')</span>
  <a id="19:Denotational.run"></a><a id="59830" href="#59830" class="Function">run</a> <span id="59834" class="Symbol">:</span> <span id="59836" class="Symbol">∀</span> <span id="59838" class="Symbol">{</span><a id="59839" href="#59839" class="Bound">τ</a><span id="59840" class="Symbol">}</span> <span id="59842" class="Symbol">→</span> <span id="59844" class="Symbol">(</span><a id="59845" href="#59845" class="Bound">machine</a> <span id="59853" class="Symbol">:</span> <a id="59855" href="#27628" class="Datatype">Machine</a> <a id="59863" href="#59839" class="Bound">τ</a><span id="59864" class="Symbol">)</span> <span id="59866" class="Symbol">→</span> <a id="59868" href="#45019" class="Function">Trace</a> <a id="59874" href="#59845" class="Bound">machine</a>
  <a id="59884" href="#59830" class="Function">run</a> <span id="59888" class="Symbol">=</span> <a id="59890" href="#59586" class="Function">runMachine</a>

<span id="59902" class="Keyword">open</span> <a id="59907" href="#53076" class="Module">19:Denotational</a>



<span id="59926" class="Keyword">module</span> <a id="20:Interpreter"></a><a id="59933" href="#59933" class="Module">20:Interpreter</a> <span id="59948" class="Keyword">where</span>
  <span id="59956" class="Comment">{-
     20. Interpreter
  -}</span>

  <span id="59988" class="Comment">-- Evaluates closed term to a value</span>
  <a id="20:Interpreter.evaluate"></a><a id="60026" href="#60026" class="Function">evaluate</a> <span id="60035" class="Symbol">:</span> <span id="60037" class="Symbol">∀</span> <span id="60039" class="Symbol">{</span><a id="60040" href="#60040" class="Bound">τ</a><span id="60041" class="Symbol">}</span> <span id="60043" class="Symbol">→</span> <a id="60045" href="#18571" class="Datatype">Term</a> <a id="60050" href="#2802" class="InductiveConstructor">ε</a> <a id="60052" href="#60040" class="Bound">τ</a> <span id="60054" class="Symbol">→</span> <a id="60056" href="#26505" class="Datatype">Value</a> <a id="60062" href="#60040" class="Bound">τ</a>
  <a id="60066" href="#60026" class="Function">evaluate</a> <a id="60075" href="#60075" class="Bound">term</a> <span id="60080" class="Symbol">=</span> <a id="60082" href="#41091" class="Function">result</a> <span id="60089" class="Symbol">(</span><a id="60090" href="#59830" class="Function">run</a> <span id="60094" class="Symbol">(</span><a id="60095" href="#29488" class="Function">load</a> <span id="60100" class="Symbol">(</span><a id="60101" href="#26143" class="Function">compile</a> <a id="60109" href="#60075" class="Bound">term</a><span id="60113" class="Symbol">)))</span>

</pre>
      
      <div style="height: 93vh"></div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs="
      crossorigin="anonymous">
    </script>
    <script>
      oldcur = -1;
cur = -1;

function highlight_current_item() {
  var scroll_top = $(document).scrollTop();

  sections = [
    
      
    
      
        "#1:Library".replace(':', '\\:'),
      
    
      
        "#2:Types".replace(':', '\\:'),
      
    
      
        "#3:Rules".replace(':', '\\:'),
      
    
      
        "#4:Utensils".replace(':', '\\:'),
      
    
      
        "#5:Term".replace(':', '\\:'),
      
    
      
        "#6:SomeTerms".replace(':', '\\:'),
      
    
      
        "#7:CompiledTerm".replace(':', '\\:'),
      
    
      
        "#8:Compilation".replace(':', '\\:'),
      
    
      
        "#9:Runtime".replace(':', '\\:'),
      
    
      
        "#10:OperationalElimination".replace(':', '\\:'),
      
    
      
        "#11:Operational".replace(':', '\\:'),
      
    
      
    
      
        "#12:Locality".replace(':', '\\:'),
      
    
      
        "#13:SomeValues".replace(':', '\\:'),
      
    
      
        "#14:Trace".replace(':', '\\:'),
      
    
      
        "#15:DenotationValue".replace(':', '\\:'),
      
    
      
        "#16:DenotationRest".replace(':', '\\:'),
      
    
      
        "#17:DenotationalIntroduction".replace(':', '\\:'),
      
    
      
        "#18:DenotationalElimination".replace(':', '\\:'),
      
    
      
        "#19:Denotational".replace(':', '\\:'),
      
    
      
        "#20:Interpreter".replace(':', '\\:'),
      
    
  ];

  tops = sections.map(x => $(x).position().top - 42);

  oldcur = cur;
  if (scroll_top < tops[0]) {
    cur = -1;
  }
  for (let i = 0; i < tops.length - 1; i++) {
    if (scroll_top >= tops[i] && scroll_top < tops[i+1]) {
      cur = i;
    }
  }
  if (scroll_top >= tops[tops.length - 1]) {
    cur = tops.length - 1;
  }

  if (oldcur != cur) {
    $("a.nav-item.active").removeClass('active');
  };
  if (cur != -1) {
    $(`a.nav-item[href="${sections[cur]}"]`).addClass('active');
  };
}

$(document).ready(highlight_current_item);
$(document).scroll(highlight_current_item);

    </script>
  </body>
</html>
